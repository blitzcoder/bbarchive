<!DOCTYPE html><html lang="en" ><head ><title >Dx9 Max2d Updated</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Dx9 Max2d Updated</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Dx9 Max2d Updated</a><br><br>
<a name="709090"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have fix a couple minor issues with repeated calling of Graphics/EndGraphics reported by James.  I appreciate the feedback I received so far.  Also optimized setup of textures from images.<br><br>Link to updated Driver:<br><a href="http://smokenmirrors.com/Downloads/Dx9Max2d(0.2).zip" target="_blank">http://smokenmirrors.com/Downloads/Dx9Max2d(0.2).zip</a><br><br>I have seen some interesting numbers on the Clock test only one I cant understand is Grisu.  Although Clock is a lousy benchmark  DXTest is a little better as it is litle more aggressive in whats rendered.<br><br>It seems to be working Ok on ATI and Nvidia cards really would like to see what Intel Motherboard based chipset can do.  Anybody got one?<br><br>If Skid reads this,  One part in looking at Dx7 implmentation of texture creation what is purpose of smear edges and what would I use for test case to see benfit.<br><br>Thanks for feedback and testing in advance.<br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="709131"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SillyPutty</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> dude, you rock, thanks so much for this. <br><br></td></tr></table><br>
<a name="709145"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I get about double the performance of DX9 in OpenGL with the DXTest application. ( I only tried clock in the previous version. )<br><br>If I keep clicking as fast as I can ( unscientific, I know, but how else can I measure? ) it won't drop below 150FPS in DX9. In OGL it never drops below 320FPS.<br><br>Clock is still faster, but only just barely. Not as much as it was in the last version.<br><br>Definitely seems slower.<br><br>6600GT, as before, and no changes to drivers or anything else. <br><br></td></tr></table><br>
<a name="709170"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Gabriel, <br><br>Its not easy to test one vs other, clicking.  I myself cant clickfast enough.  If you exceed the Particle Cache it will grow, I just defaulted to 2600 as that was fastest I could click.<br><br>By definitely seems slower? Than the last version?  Or Dx9  seem slower.  I assume Dx9 seems slower as I didnt change anything that would affect rendering speed.<br><br>As for DX vs OpenGL,  the big problem is unfortunatly architextural, limitations of the design of Max2d. Not so much OpenGL is better or DirectX is better API.  Its more a fundimental difference in what the two API's are designed to due. The DirectX API requires a more batch oriented scene graph, so its dificult to get similar performance espeically if you create a lot of render state changes, which is what the 2d rendering in Max2d does.<br><br>   Other issue is the DirectX drivers need to do more setup work in BlitzMax code, and although its fast its not as fast as C code. Which is why using DEBUG when testing performance makes the DirectX look real bad.<br><br>  I do have a couple of Optimizations that I need to look at as reading dx9 driver debug spew, I have many unnecessary state changes.  But alas its mostly a balance as to what is good enough kinda thing, for a limited 2d API.  <br><br>Personally I understand what Max2d is trying to do, however from a card/api design point of view, there would be a better way to set up this stuff for rendering and get extreme performance at expense of easy coding style.  Just look at how DrawText and Images or Anim Images work makes me cringe as it thrashes the textures.  Just nothing I can do as the driver has to implment the code the way its structured.<br><br>Thanks again for feedback,  still looking for someone with that Intel Motherboard GPU.<br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="709171"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry, I had debug on, and for some reason OpenGL renders at the same speed with debug on and off ( which tricked me ) and DX9 renders considerably slower with debug on. With debug off, you're right, no speed change. Sorry for the false alarm.<br><br>The particle test thingy is about the same speed between OpenGL and DX9, the clock is still a good 25% faster. <br><br></td></tr></table><br>
<a name="709180"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> That seems to have sorted out the problem I had. Thanks Doug... great work, and much appreciated. <br><br></td></tr></table><br>
<a name="709195"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kfprimm</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks alot Budman. I have a Intel chipset.<br><br>DXTest:<br>Debug   - 90-100<br>Release - 100-120<br><br>Clock:<br>Debug   - 1700<br>Release - 1700 <br><br></td></tr></table><br>
<a name="709199"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grisu</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Clock:<br><br>DX9: 7-13.000  <br>OpenGL: 15-17.000<br>DX7 buffered: 7-8.000<br><br>This release seems to be a bit more unstable in terms of framerate for me. <br><br>x850xt-pe with newest Cat 5.9 and NForce 4 ultra chipset. <br><br></td></tr></table><br>
<a name="709250"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Gabriel the issue with Debug on/off with OpenGL is the DirectX Driver basically has to emulate the OpenGL functionality so there is a lot more MAX Code to make same effects happen.  Also "I think" the Module is compiled with the ?NODEBUG so regardless of the DEBUG compile it really is always debug off.  Not sure on NODEBUG though.<br><br>@Grisu not sure why framerate would be effected as didnt change anything in regards to rendering only cicular ref problem with Garbage collection of textures at shutdown that Jame found and some wasted clock cycles loading the textures.  The fact that all of them show flucuation of some sort with the Clock is interesting.  Thats about as simple a program you can get.<br><br>And the X850 is older but pretty highend ATI card right?  What kind of CPU do you have?<br><br>@Khomy thanks,  I am assuming it rendered the fireworks OK?  I need to make a program that just tests the MIPMapping functionality and prompts for driver as correct rendering is highest priority.  Granted its not stellar performance however there is alot of XP(Sp2) editions out there with that Chipset and keeping things above the CPU Framerate is good although the logic of DXTest should handle abrubt frame drops and still keep logic in sync independent of render speed.<br><br>Todo's: <br>Check CAP Bits of card and handle if automipmapping is not avaialable.<br>Find out if SmearEdges is needed(SKID Help me understand here)<br>Reduce excess RenderState changes as much as possible.<br><br>The goal is to provide exact replacement functionality of Dx7. I have some ideas that I have tested and can make work.  But wonder what people think<br>1. Smart Window mode positioning.  Right now its pretty crappy.<br><br>2. Optional Driver Flags to have DirectX notsave FPU State.  This increases performance but you cant use any math with doubles.  Not safe unless you really know what your doing with BMAX code.  The clock for example goes nuts.<br><br>3. Changing Graphics Modes and Toggle window modes on the fly with out calling EndGraphics to Graphics.  This kinda works have to do 1. To make this reality.<br><br>4. Adding Extended Max2d commands to improve performance of Image Rendering. ie.  FastText(Single Texture Fonts) DrawSubImage(Single Texture Animationstrips)<br><br>Any comments and suggestions welcome.<br><br>Thanks so much for all feedback<br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="709261"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kfprimm</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Those FPS for DXTest are the FPS rendering as many fireworks as I could click. With no fireworks, it renders about 200-220 FPS. <br><br></td></tr></table><br>
<a name="715255"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Budman, Thanks again for the great driver. <br>I'm trying to use CreateOffscreenPlainSurface in DX9Utils  but can't make out what to supply for DDevice9 :IDirect3DDevice9.<br>Thanks for any help.<br>P.S. I'm assuming I can create an offscreen surface, setrendertarget, draw to it and then convert to pixmap... Am I right? <br><br></td></tr></table><br>
<a name="715334"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> @tonyg thanks for kind comments.<br><br>the offscreenplainsurface is used to allow copying from a rendertarget to a surface that cant be used as a texture or save to system memory.  I use it to grab image.<br><br> it cant be a render target for that you need to use the following API.<br><br><br>HRESULT CreateRenderTarget(<br>  UINT Width,<br>  UINT Height,<br>  D3DFORMAT Format,<br>  D3DMULTISAMPLE_TYPE MultiSample,<br>  DWORD MultisampleQuality,<br>  BOOL Lockable,<br>  IDirect3DSurface9** ppSurface,<br>  HANDLE* pSharedHandle<br>);<br><br>Here is example that hooks the DirectX Driver Safely and creates an rendertarget.<br><br>Now the current MAX2d driver is not compatible but you can use raw DirectX to draw to it.  Max2d could do it but you really would have to know all the little things to flush and ensure get maintained between switching render targets.<br><br><br>Here is simple sample<br><br><pre class=code>
Import "Dx9Max2dDriver\d3d9.bmx"
Import "Dx9Max2dDriver\Dx9Max2dGraphicsDriver.bmx"
Strict 
SetGraphicsDriver D3D9Max2DDriver()

' this function 
Type TDx9DeviceObject
	Field _D3DDevice9 :IDirect3DDevice9
	Method SendMessage:Object( message:Object,sender:Object )
		Local Msg:TDx9GraphicsDeviceMessage= TDx9GraphicsDeviceMessage(message)
		If Msg
			Select Msg.Message 			
				Case TDx9GraphicsDeviceMessage.DX9GRAPHICSDEVICECREATED
					OnDeviceCreate(TDx9GraphicsDevice(Sender))	
				Case TDx9GraphicsDeviceMessage.DX9GRAPHICSDEVICERESET					
					OnDeviceReset(TDx9GraphicsDevice(Sender))			
				Case TDx9GraphicsDeviceMessage.DX9GRAPHICSDEVICELOST
					OnDeviceLost(TDx9GraphicsDevice(Sender))
				Case TDx9GraphicsDeviceMessage.DX9GRAPHICSDEVICEDESTROYED
					OnDeviceDestroy(TDx9GraphicsDevice(Sender))			
			End Select		
		End If
	End Method
				
	Method OnDeviceLost(Dx9GraphicsDevice:TDx9GraphicsDevice)
		Print "Device OnDeviceLost"
	End Method
	
	Method OnDeviceReset(Dx9GraphicsDevice:TDx9GraphicsDevice)
		Print "Device OnDeviceReset"
	End Method
	
	Method OnDeviceDestroy(Dx9GraphicsDevice:TDx9GraphicsDevice)
		Print "Device OnDeviceDestroy"
		_D3DDevice9 = Null
	End Method
	
	Method OnDeviceCreate(Dx9GraphicsDevice:TDx9GraphicsDevice)	
		Print "Device OnDeviceCreate"	
		' now we have our own referece to the D3D9 Device Interface to make raw dx9 calls
		_D3DDevice9 = Dx9GraphicsDevice._D3DDev9
	End Method	
End Type	

Type TDx9RenderTarget Extends TDx9DeviceObject
	Field _renderTarget: IDirect3DSurface9
	Field _saveTarget : IDirect3DSurface9
	
	' since this is not managegd surface we must create and destroy on reset/lost
	Method OnDeviceLost(Dx9GraphicsDevice:TDx9GraphicsDevice)
		super.OnDeviceLost(Dx9GraphicsDevice)
		If _renderTarget 
			_renderTarget.Release_()
			_renderTarget=Null
		End If
	End Method
	
	Method OnDeviceReset(Dx9GraphicsDevice:TDx9GraphicsDevice)
		super.OnDeviceReset(Dx9GraphicsDevice)
		If _D3DDevice9.CreateRenderTarget(128,128,D3DFMT_X8R8G8B8, D3DMULTISAMPLE_NONE,0,False,_renderTarget,Null)&lt;&gt; 0
			Print "Failed To create"
		Else
			Print "Created Render Target"
		End If
	End Method
	
	Method Use()
		If _renderTarget
			If  _D3DDevice9.GetRenderTarget(0,_saveTarget)= 0 Then
				If _D3DDevice9.SetRenderTarget(0,_renderTarget)	=0 Print "Set Target"			
			End If
		End If
	End Method
	
	Method Restore()
		If _saveTarget 
			If _D3DDevice9.SetRenderTarget(0,_saveTarget)=0 Print "Restored Target"	
			_saveTarget.Release_
			_saveTarget=Null;
		End If
	End Method
	
	Method Cls()
		If  _D3DDevice9.Clear(0,Null,D3DCLEAR_TARGET,$FFFF0000,1.0,0)	&lt;&gt; 0 Throw "Clear Failed"
	End Method

End Type

' this function hooks into the DirectX Device Managment Messaging system
' Devices are created and destroyed you can create your own DX Code
Global rt:TDx9RenderTarget = New TDx9RenderTarget
D3D9Max2DDriver()._DXDriver.Dx9GraphicsDevice().AddDeviceObject(rt)



Graphics 320,240,0
SetClsColor 255,244,0
While Not KeyHit(KEY_ESCAPE)
  rt.Use()	
  rt.Cls()
  rt.Restore()	
  Cls
  DrawText "Regular Buffer",0,0	
  Flip 0
Wend
</pre><br><br>The device object pattern was designed just for these types of extensions.  It will safely ensure whether you have a render surface or not regardless of screen mode changes.<br><br>Hope this helps.  If you can give me idea what your trying to do or sample of what you want to accomplish I will provide you the extension.<br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="715343"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was hoping to <br>- create a rendertarget the size of a loaded image, <br>- draw the image to it, <br>- draw another image or primitive, <br>- Convert to a pixmap<br>- load the pixmap back to the original image.<br>- reset the rendertarget to the backbuffer.<br>Not sure how quick it would be but another attempt to get 'imagebuffers'.<br>I still think it's possible with the standard DX7 driver *except* it uses DX System managed textures. This prevents the DX7 driver images being rendered to directly. <br><br></td></tr></table><br>
<a name="715349"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Let me see if I can understand. <br><br>Do you want to do this every frame?  If so then the technique your thinking would be very slow.  The Dx9 driver uses managed Texutures as well.  Main reason its easy for generic rendering like blitz max.  To try and write optimized texture manager for max would be nightmare since you can call anything at any time.<br><br>Basically you want to Create an Image Render with MAX2d to it, then be able to draw that image on back buffer?  <br><br>If thats it,  I dont have much time right now, but can probably complete an extension like above.<br><br>Something like this.<br><br><pre class=code>
rt=CreateRenderTarget()
SetRenderTarget(rt)
cls
Draw "Hello World",10,10
RestoreRenderTarget()
DrawRenderTarget rt,x,y
...
</pre><br><br>I think I can make it do it without haveing to convert back to pixmap. But can still provide mechanims to convert to managed image or pixmap , if wanted.<br><br>Might be fun to pull that off.<br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="715360"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've had this working to some degree with the DX7 driver and Indiepath has the RTT module. However, in both cases they create a new surface and I haven't cracked how to write that back to a managed texture. <br><br></td></tr></table><br>
<a name="715388"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well you need to create a new surface for rendering to.  <br>DX7 or DX9 rendertargets need to be video memory.  The trick is getting it back to system memory for a pixmap. For DX9 i have disabled the ability to get a device context.  That is how DX7 does but the lock is slow, and in DX9 there is StretchRect and UpdateSurface that work using a blitter style of function.<br><br>Based upon what I see.  As you noted you cant render to a managed texture you can however create a texture that is a render target.  Once you have it as a texture you can use it.  The big issue is that it will need to be recreated if the device is lost since a RenderTarget cant be managed.<br><br>I would assume you want to Update this RenderTarget every frame.<br><br>You could also just draw on the rendertarget and call grabimage or grabpixmap.<br><br>So there is really two choices here.  Create a RenderTexture and be able to use it in functions simlar to DrawImage or create a rendertarget and copy the it back to the managed texture.<br><br>Ill see if I can make it work out over the weekend or if I cant steal some time at work tommorrow.<br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="715418"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> In DX7, when I attempt to blt the rendertarget back to the managed texture the 'image' reduces in size. <br>I suppose I could create a sprite type which has BaseImage and space for a 'renderimage'.<br>Thanks for anything you come up with but I wouldn't put too much focus on it. <br><br></td></tr></table><br>
<a name="715610"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> I suspect your problem is not the blit but the actual drawing.  When you set the render target you need to change the viewport and projection matrix to match your offscreen surface. Then switch it back when done drawing to it.<br><br>Now I did get Rendertargets working,  have a couple of glitches and bugs I found in the Dx9 Driver when converting Offscreen Surfaces to pixmaps.<br><br>Ill get those fixes to the driver in place, and finish a Imagebuffer style of RenderTarget. It will be a either a render target or a full rendertarget texture.<br><br>I now know extactly what your trying to do,  I read the ImageBuffer docs :).<br><br>Only issue might be maintiang the buffer if the surface is lost. If I can capture the surface when lost and restore it upon reset, I can avoid copying the image to a pixmap every frame but not sure if I can avoid that performance hit.<br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="716296"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >amonite</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Another Intel (82815) based test : <br><br>"Unhandled Memory Exception Error" when running clock.bmx <br><br>:(<br><br>also only OpenGL driven app work using Bmax on this machine.<br>D3D7Max2DDriver does not work. <br><br></td></tr></table><br>
<a name="716301"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting that Only OpenGL works but not DX7 or DX9.  I suspect a driver problems.  Might want to reinstall DX9 and find latest driver for the 82815.<br><br>Can you run the DX9 with DEBUG and give the line that causes the exception?<br><br>Thanks<br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="716496"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >amonite</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I suspect a driver problems. <br></div> maybe...<br>latest drivers i managed to find are installed + directx 9.0c.<br><br>In debug mode the following line is highlighted :<br><br>SetOrigin 160,120  <br><br>If i comment this line then the next one is highlighted. <br><br></td></tr></table><br>
<a name="716531"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmm sounds like the Graphics command is failing to initialize the driver.  Try adding changing Graphics command to this..<br><br><pre class=code>
Global MyGraphics:TGraphics =Graphics (Screen_Width, Screen_Height)
If MyGraphics = NULL then print "Failed to init Graphics";End
</pre><br><br>Also try commenting out all the SetGraphicsDriver commands and see if it works with the basic DirectX7 driver.<br><br>Do any of the Max2d programs work with this card?  If the problem is with the Dx9 driver and the bufferedDx7 driver,  I but works with basic driver I think I might be able to track down the issue. If no directx works at all might be tougher.  <br><br>Card driver is here <br><a href="http://www.intel.com/support/graphics/intel815/" target="_blank">http://www.intel.com/support/graphics/intel815/</a><br><br><br>Does anyone else have one of these Intel Graphics cards that works/doesnt work?<br><br><br>Thanks<br>Doug Stastny <br><br></td></tr></table><br>
<a name="716830"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >amonite</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Budman,<br><br>I had 5.12.01.2593 driver version installed for the 85815 Intel. <br>Now (thanks to your link) i have 6.13.01.3196 driver version.<br><br>Now i can run D3D7Max2D applications without any pb so far which is a slight improvement :)<br><br>If i put the line you posted above to verify if the graphics initialisation went ok, the clock.bmx program<br>crashes in debug mode with the " DrawText fps,0,0" line highlighted and with : "unhandled exeption:failed to create texture:-2005530516" message. <br><br></td></tr></table><br>
<a name="716863"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well thats a good start,  now I have to figure out why its failing on the create texture. <br><br>Thanks for feedback,  I am looking into possible causes of failure.<br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="716871"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Upon further reading, that chipset is pretty old,   The DirectSDK doesnt give much guidance.  I am pretty sure I know the cause of the failure in that I am using the AutoGen Mipmap capability in creation of textures.<br><br>This is actually area,  I was unsure of how it would be handled in case that card doesnt support.  SDK says should still create texture,  but I guess the Intel drivers just says ummm no.<br><br>Ill see if I can code a fail back case if Mipmap generation is not supported.<br><br>Look for updated version, to retest in future.<br><br>Glad I got you at least DX7 support :)<br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="716896"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> @BennyBoy<br><br>Can you try this.  Comment out these lines in Dx9Max2dGraphicsDriver.bmx<br><br>line 67-70<br><pre class=code>
'	If (_Flags&amp;MIPMAPPEDIMAGE) 
	'		usage=D3DUSAGE_AUTOGENMIPMAP
	'		level=0
	'	End If	
</pre><br><br>This will disable mipmapping but help determine if this is the cause of the problem.<br><br>Thanks<br>Doug Stastny <br><br></td></tr></table><br>
<a name="718095"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chugs40</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> My old hp pavilian desk top has one of those intel815 chipset cards (pretty sure). My Bmax projects run really slow on that thing. <br><br></td></tr></table><br>
<a name="718219"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >amonite</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry, didn't take the time to visit the forums on the weekends so late reply:<br><br>With the lines commented out it still fails to create the texture, same error message as before. In debug the following line is shown after crash:<br><br>If hr&lt;&gt;D3D_OK Then Throw "Failed to Create Texture:"+HR<br><br>I would be gald to help you more here but unfortunatly my knowledge of directX sucks, the best i can do is simply try the examples. <br><br></td></tr></table><br>
<a name="718229"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Benny - Thanks for trying that.  I am pretty much at a loss as to why create texture is failing.  On that card/chipset.<br><br>@Chugs40 - have you tried the DX9 driver on that older machine?<br><br>I have done some research on the card and its ability to support DX9,  for most part I see issues with calling createtexture failing,  and Game manufatures saying chipset is not supported.  This is in Microsofts SDK examples as well.  Now Intels site shows some compatibility with some games but alot have problems so its hard to say if the game is really using the DX9 api or not.   Many times Game vendors will say requires DX9 but they might use older API, for compatibility rendering with older cards.<br><br>Since Clocks example runs in a window.  What display depth do you have your desktop set to.  If its 16bit can you try changing it to 32 bit.<br><br>I wonder if there is incompatibility with 32bit textures on 16 bit display with this chipset?<br><br>Thanks for trying this all out.<br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="718239"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >amonite</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was in 16 bits, switching to 24 bits (no 32) on Windows 2000 results in having the init graphics failed when running clock.bmx.<br><br>(this PC i am using now with the 85815 intel will soon be replaced by a better one so i won't be using it anymore) <br><br></td></tr></table><br>
<a name="718240"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does this chipset support 32Bit 3D contexts at all? (if so then perhaps only in fullscreen, as 32Bit windowed mode was something cards learned later) <br><br></td></tr></table><br>
<a name="718241"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Dreamora-  I think you identified the problem,  I completly forgot about older cards not supporting 32 bit.  All the textures in the DX9 driver require 32 bit support.  So if this card can not do that depth, the API will fail.<br><br>So that raises a couple of areas I need to look at.  Check CAPS to see if texture format is supported.  I have only been testing against newer cards but that would defintily cause the issue.<br><br>I appreciate all the feedback and help testing.  The more cards the better.<br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="718243"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep thats the issue.  Found this on Intels site.<br><div class="quote"> <br>This game is trying create 32 bit textures for the displaying mouse cursor and the Intel® 815/810 chipset family does not support 32 bit textures.<br> <br></div><br><br>Let me see what I need to do... Grrrr<br><br>Thanks<br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="718440"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chugs40</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, i have not tried the driver but i may try it soon! <br><br></td></tr></table><br>
<a name="718534"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok looking more at this Chipsets documentation/specs.  I dont think there is any way I can make this work acceptably... err defeat!.<br><br>Issue surrounds lack of 32bit texture support for card and BlitzMaxs lack of 16bit support for Pixmaps.<br><br>  They way MAX works with images/pixmaps all of them are internally in 32 bit format.  To get them to this card would require sampling down to 16 bits.  The problem is best format I can get would be a A4R4G4B4. The image quality would be stinko and runtime image conversion is not something I really want to code.  16-&gt;32 is easy 32-&gt;16 not so easy.<br><br>  If and thats a big if MAX supported 16bit pixmaps it might be better since the image can be preprocessed before loading.<br><br>Very weird how DX7 seems to handle this but DX9 doesnt.  As the Dx7 format is 32bit. except it requests texture formats from DirectDraw Surfaces as 24bit RGB with 8 bit alpha and the intel driver likes that.  Dx9 does not support Alpha with a "24 bit" format.<br><br>I think big issue is this is cheapo Dx7 chip that barely cut it when it was released.  Six years later well it still stinks.<br><br>This chip is going to have trouble with pretty much any Max2d implemenation OpenGL/Dx7/Dx9 if you start pushing heavy Graphics at it as it barely qualifies as a 3d card.  It would probably be ok for a puzzle game with low FPS rendering but nothing more, in which case DX7 driver is best for this case.<br><br>Sorry <br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
