<!DOCTYPE html><html lang="en" ><head ><title >xtank port: Am I basically screwed here?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >xtank port: Am I basically screwed here?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >xtank port: Am I basically screwed here?</a><br><br>
<a name="775928"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >watusimoto</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've spent about 500 hours on a project to port and implement a modern version of the classic game xtank in BlitzMax.  For those of you unfamiliar with xtank, it is a multiplayer tank combat game where players design vehicles and duke it out in a maze-like arena.<br><br>The original game was designed to run on a bank of xterm clients, in essence treating the game server like a machine with (say) 8 monitors and 8 keyboards.  All processing of input and generation of output was handled on the server, and the clients were responsible only for displaying the game output.  The game only worked on a LAN.  Performance was great.<br><br>This architecture is archaic, and I envision something akin to a more traditional client/server setup.  Each player would run the game on their PC, and communication would be handled by a central server whose main responsibility would be to relay messages between the clients.  The game would be playable over the internet, and would have the interactive multiplayer feel of bzFlag (a pretty cool interactive online tank combat game not entirely dissimilar to xtank in some respects).<br><br>The creators of bzflag have created a very slick environment where you rarely notice lag and vehicle movement feels very smooth, but the differences between xtank and bzflag make me wonder if the same will be possible for xtank.  In xtank, vehicles move quickly, making sudden, sharp turns, and their precise location can be very clearly seen on the screen.  And the vehicles shoot a lot of bullets.   In bzflag, by contrast, tanks are slow, lumbering vehicles, with limited motion and slow, plodding shots.  The graphic style is 3D, making it more difficult to visually pinpoint the exact location of a vehicle.  Because xtank vehicles change direction so rapidly and frequently, even very short lags can cause dead reckoning algorithms to go wrong, making a vehicle appear to jump around a fair bit.<br><br>I feel I have a respectable architecture in place, but I am not getting satisfactory results even on my own machine running just two clients -- pretty much the absolute best case scenario.  I am coming to the conclusion that the nature of the game may make implementation impractical, and so I bring this question to the forum:<br><br>Is is possible to implement a multi-player highly interactive rapid-paced arcade like game that plays well over the Internet?  Are there any good examples out there?  Can it be done in BlitzMax? <br><br></td></tr></table><br>
<a name="775951"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dmaz</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> yes but it can be hard...<br><br>checkout movement prediction and tweening remote objects back on real course when real and local info don't match up. <br><br></td></tr></table><br>
<a name="775977"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kronholm</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try sending every keypress that occurs to the server, then out to the remaining clients, and use UDP. <br><br></td></tr></table><br>
<a name="776006"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Banshee</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> It is possible, look at racing simulators, cars move very fast and lag isn't a big issue.<br><br>There's a couple of things to bear in mind.  Firstly the millisecs() counter isn't totally accurate, every machine can be up to +/- 5% either way of true time.  You need to measure the time differential between each client and the servers clock and modify your delta accordingly.<br><br>However you problem is more pronounced than this, because you've got problems on local loopback.<br><br>If using TCP.  Stop now.  It's great for reliable data transmission but it's adding 30 odd bytes to every packet (it adds 96 I believe, UDP adds about 65 or so).<br><br>Make sure that you are not using writeline() and readline() to send/receive data.  When you send this over the web it will be truncated because writeline and readline end in a carriage return and this is what the web uses to close connections when browsing.<br><br>Again, this isn't your problem, because it's failing on local loopback...<br><br>Firstly, do away with timed packets.  They do you no favours.  Keep it in but set your packet times to 1 second.  There is a reason for this, it's just a 'backup' in case a packet is lost.<br><br>Add some bytes to your packet order:<br>#define byte packetID<br>#define byte verify<br><br>Use these to order packets at the other end and request missing packets if the verify flag is true.<br><br>Whenever the state of control keys is changed send a new packet immediately.  This way you've just illimated 1000ms/packetsPerSecond of lag from your game.<br><br>Send the control key combination being pressed and continue to process movements on the remote machine as if they are a local player.<br><br>Using the above method so far should give you 100% stability locally, it should be perfect.  If it isn't then there's a bug in your code.<br><br>Now for remote play we need to adjust the local delta according to the speed of the server's clock.  Measure a fixed interval (10000ms works ok) and send it to the server, remove pingtime from the calculation by requesting a receipt, then you know how fast the local delta clock moves.<br><br>When receiving updates of positions that show your calculations to be innacurate, smooth the positional changes over time.<br><br>It is true that fast moving objects are much harder to do multiplayer for, because the difference in ping between one packet and the next causes greater disruption.<br><br>If you do it right, however, then it is still possible. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
