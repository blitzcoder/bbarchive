<!DOCTYPE html><html lang="en" ><head ><title >Timer.fire error (bug?)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Timer.fire error (bug?)</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Timer.fire error (bug?)</a><br><br>
<a name="707808"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SpaceAce</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm having a problem with a program I am working on. I keep getting seemingly random "Unhandled Memory Exception Excpetion Error" crashes. Whenever they happen in a debug build, BLIde opens timer.bmx and highlights this line:<br><br><pre class=code>
Function _TimerFired( timer:TTimer )
--&gt;	timer.Fire
End Function
</pre><br><br>Here is the code I have that deals with timers:<br><br><pre class=code>
  Field DrawTimer:TTimer, ProgressBarTimer:TTimer

  Method StartDrawTimer()
  	DrawTimer = CreateTimer(120)
  End Method

  Method StopDrawTimer()
  	If (DrawTimer) StopTimer(DrawTimer)
  End Method

  Method StartProgressBarTimer()
    ProgressBarTimer = CreateTimer(10)
  End Method

  Method StopProgressBarTimer()
    If (ProgressBarTimer) StopTimer(ProgressBarTimer)
  End Method
</pre><br><br>The error does not happen during the execution of any of the above code; instead, it happens after the timer is created (presumably when it fires). I cannot find any common thread with the crashes. They happen at different times when the program is doing different things under a variety of different circumstances.<br><br>I noticed this line in the documentation for StopTimer:<br>Once stopped, a timer can no longer be used.<br><br>I did not think that applied to creating a new time using the same variable. Does it?<br><br>SpaceAce <br><br></td></tr></table><br>
<a name="707912"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Check the stack information provided by BLIde to know wich function or variable is calling the _TimeFired function, and ensure everything is as spected when this function is called. <br>If this function is called by a hook, be sure that everything is tratened well in the hook. <br><br></td></tr></table><br>
<a name="707944"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SpaceAce</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's what I've been able to figure out so far:<br>BlitzMax seems to be trying to fire a trigger that has already been stopped. Apparently, sometimes when I call the StopTimer() function, the timer fires again, anyway. Since it seems so random, I am guessing the error occurs when the timer is Stop()ped but the timer.fire is already in progress or queued up to go. Maybe the timer is being Stop()ped between the instruction to fire the timer and the actual event emission...? Just speculation.<br><br>My workaround:<br>I created a StopTimer() function that waits for the timer to fire THEN immediately calls StopTimer(). This seems to have completely eliminated the memory error, but it also causes a delay while the StopTimer() loop waits for the timer or timers to fire.<br><br>SpaceAce <br><br></td></tr></table><br>
<a name="708205"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fabian.</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe this helps on win32: Change "mod/brl.mod/timer.mod/timer.win32.c" on line 38 from<pre class=code>return timeSetEvent( 1000.0/hertz,0,timerProc,(DWORD)timer,TIME_PERIODIC );</pre>to<pre class=code>return timeSetEvent( 1000.0/hertz,0,timerProc,(DWORD)timer,TIME_PERIODIC|TIME_KILL_SYNCHRONOUS );</pre> <br><br></td></tr></table><br>
<a name="718682"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know this is a month-old thread but I've been having this problem myself recently.  The debugger was next to useless in resolving it.<br><br>It seems that using too high a frequency for your timer can cause this problem.  I was using 1000 for the sake of simplicity, and getting random errors all over the place.<br><br>Changed timer frequency to 5, problem has apparently been fixed. <br><br></td></tr></table><br>
<a name="718692"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you set your timer to 1000Hrtz (ie every milli), it will sometimes "click" before the milli timer and sometimes after. So if for example all you do is see how long has passed since the last "Click" it will change between 0, 1, and 2 milli.<br>Obviously it isnt taking 2 milli (0r 0 milli), between clicks, its just that the milli is the smallest unit we have to measure it in.<br><br>This may not be the reason for you problems. <br><br></td></tr></table><br>
<a name="718739"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SpaceAce</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> In my situation, the faster timer was set to fire 120 times per second and the slower one to fire 10 times per second.  The error (as far as I could determine) only happened when I shut the timers down then restarted them. The best I can figure is that the timer was firing after it had been deleted. Maybe a firing was already queued up before I deleted the timer. I can't really be sure but I'd sure like to see some sort of reliable solution to this problem.<br><br>SpaceAce <br><br></td></tr></table><br>
<a name="718745"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Maybe a firing was already queued up before I deleted the timer <br></div><br>Well I only ever stop timers from within whatever Function Ive told the Timer to run ( <a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1721" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1721</a> ), and Ive not come across this problem, basicly if I tell i to stop, it stops. However My main code isnt very CPU intensive, so Im assured of getting the Click before the next click, unless disc access or the like grabs the cpu<br><br>You have not posted anycode to show how you are reacting to the timers (ie While message loops etc), so I can only guess, but I would say that its very unlikly that you have taken to long to stop the slower timer, but the faster one, possibly <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
