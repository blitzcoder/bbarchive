<!DOCTYPE html><html lang="en" ><head ><title >Serializing objects</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Serializing objects</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Serializing objects</a><br><br>
<a name="854206"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OremLK</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've just moved over to BlitzMax from XNA, and while I'm generally finding things nice here, one thing I took for granted with XNA and .NET was its capability to automatically serialize your objects (file i/o).  It was nice being able to literally plug in an array of objects--as in, of a user-defined type--and have it automatically spit out a file containing all of their data.<br><br>With the way BlitzMax OOP works, I can't really think of how I could do this myself (in a generic, one function for all object types kind of way), but admittedly I'm not that great of a programmer.  So I was wondering if anyone else has come up with a way of doing this, or just a module that does it.<br><br>Thanks! <br><br></td></tr></table><br>
<a name="854212"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> From 1.26 Blitzmax includes reflection. You would be able to use this to write your own function to do that. <br><br></td></tr></table><br>
<a name="854213"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> This may be a start<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=2132#comments" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=2132#comments</a> <br><br></td></tr></table><br>
<a name="854227"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OremLK</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, I'll see if I can figure it out from there.  If I get something working, I'll post it here. <br><br></td></tr></table><br>
<a name="854309"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I did a Serializer a while back you could look at, it isnt complete though... but it works quite well imo =)<br><a href="http://grable0.googlepages.com/ReflectionSerializer.rar" target="_blank">ReflectionSerializer</a> <br><br></td></tr></table><br>
<a name="854343"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >OremLK</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Excellent!  Thanks for posting it.  Looking at your source, is the incomplete part the lack of array support? <br><br></td></tr></table><br>
<a name="854448"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Looking at your source, is the incomplete part the lack of array support? <br></div><br>Yeah, the JSON codec has partial array support though. <br><br></td></tr></table><br>
<a name="901843"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raph</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> grable, this was really handy! But I ran into problems with my particle system while deserializing -- most values were read in correctly, but it broke on the first float and exited early, then after fixing that, it broke on the first negative number. So here are two minor fixes to this serializer to get it to load floats and negative numbers.<br><br>In Codecs.bmx, change line 231 to this:<br><br><pre class=code>
		ElseIf (c &gt;= Asc("a") And c &lt;= Asc("z")) Or (c &gt;= Asc("A") And c &lt;= Asc("Z")) Or c = Asc("_") Then
</pre><br><br>which removes "c =Asc("-")" so that tokens starting with - are read as numbers once you also change line 242 to<br><br><pre class=code>
		ElseIf (c &gt;= Asc("0") And c &lt;= Asc("9")) Or c = Asc("-") Then
</pre><br><br>Finally, there was code in there to handle floats, but it was in a while loop that would never parse a period. Change line 246 to<br><br><pre class=code>
			While (c &gt;= Asc("0") And c &lt;= Asc("9")) Or c = Asc(".")</pre><br><br>Works great now, thanks! <br><br></td></tr></table><br>
<a name="901882"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Glad you found a use for it, and thanks for the fixes =)<br>Ive updated the archive with the latest changes as well. <br><br></td></tr></table><br>
<a name="901905"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Macguffin</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've had good luck so far with Otus' save code:  <a href="http://blitzmax.com/codearcs/codearcs.php?code=2262" target="_blank">http://blitzmax.com/codearcs/codearcs.php?code=2262</a><br><br>The only limitation I ran into was that, since reflection doesn't handle multi-dimensional arrays, they don't save properly. <br><br></td></tr></table><br>
<a name="901912"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jim Teeuwen</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've been fiddling with this since reflection came into the language and wrote a little framework with 2 serialization implementations.<br><br>You may find them useful. Although they basically do the same as the examples posted above, my code adhere's to a somewhat more OOP compliant code model and it allows you to implement any number of output formats for your files. Included in the codearchives is an ASCII formatter and BinaryFormatter. If you care for it, I also have an XML formatter for you. This one does require a third-party XML module to work though, so I left it out of the code archives.<br><br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=2311" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=2311</a> <br><br></td></tr></table><br>
<a name="901937"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Jim T - I'm a noob to serialization, I use TList to manage particles, sprites, etc. Can your code serialize dynamic Tlists of objects as well? If so, could you please elaborate how I might save/load a current TList of particles for instance? Thanks. <br><br></td></tr></table><br>
<a name="901944"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jim Teeuwen</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> It currently doesn't deal with Tlists or TMap's. I didn't need this functionality when I wrote this stuff.<br><br>It shouldn't be to difficult to add a tlist though, provided the elements stored in the list are all the same (No combination of int's objects, floats, strings etc). The implementation is much the same as what I used to load/save arrays.. The only difference would be that you do not have to pre-initialize a tlist to a fixed amount of elements as it does in the code.<br>You will have to add a separate case (TYPETKN_TLIST) for TLists though. <br><br></td></tr></table><br>
<a name="901945"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ahh... ok.  Thanks for the reply. This might be harder than it seems. M y Tlists all contain the same object type, but each object is mass definition of floats, ints, tlists, etc, etc. I think I would have to write something custom for this. <br><br></td></tr></table><br>
<a name="901965"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Can your code serialize dynamic Tlists of objects as well? <br></div><br>Yes.<br>It doesn't care what types are in the list.<br>It also handles cyclic references.<br><br>Basically you get a snapshot of time. (barring current reflection inadequacies) <br><br></td></tr></table><br>
<a name="901993"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Brucey - This is available in one of your mods? <br><br></td></tr></table><br>
<a name="902004"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> (barring current reflection inadequacies)  <br></div>such as?  I guess there's a thread about it? ... <br><br></td></tr></table><br>
<a name="902013"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> such as? <br></div>Multi-dimensional arrays? (as mentioned previously) <br><br></td></tr></table><br>
<a name="902062"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh sorry.  OK thx.  Well that does sound like a bit of a problem, considering how many games are tile-based ... <br><br></td></tr></table><br>
<a name="902077"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thought I'd have a go at fixing the reflection module.<br><br>A basic test :-)<br><pre class=code>
' the type
Type TObj
	Field numbersi:Int[,] = New Int[4,4]
End Type

' example serialized
&lt;bmo ver="2"&gt;&lt;TObj ref="089VMG"&gt;&lt;field name="numbersi" type="array:Int[,]"&gt;0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15&lt;/field&gt;&lt;/TObj&gt;&lt;/bmo&gt;
</pre><br>Seems to have passed serializing and deserializing. <br><br></td></tr></table><br>
<a name="902094"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> With that example, how can you tell the dimension sizes in the output? <br><br></td></tr></table><br>
<a name="902103"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> I hope your fix goes into the official BRL module! <br><br></td></tr></table><br>
<a name="902105"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> With that example, how can you tell the dimension sizes in the output? <br></div><br><br>In my persistence module, it doesn't matter, since all basic type arrays store a default value (like zero) if not set.<br>And the way in which arrays work in BlitzMax, it doesn't matter there either, since a 2 dimensional array is stored as one long list of entries.<br><br>I've also managed to get things like this working too :<br><pre class=code>
	Field arrarr:Int[][] = [[1,2], [3,4]]
</pre><br>...which is nice, I suppose.<br><br>..during which time I found *another* bug in the reflection code :-p <br><br></td></tr></table><br>
<a name="902124"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> For those interested in such nerdy things, I've posted a new version of the Reflection module (with multi-dimension array support) <a href="/posts.php?topic=80257" target="_blank">here</a>, for testing. <br><br></td></tr></table><br>
<a name="902264"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> But then when loading back in the array how do you know what sizes the dimensions are?  I'm confused... <br><br></td></tr></table><br>
<a name="902279"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think you can do this<br><br>local my_array[6]<br><br>print my_array.length<br><br>if thats what you mean? <br><br></td></tr></table><br>
<a name="902297"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> We need Brucey to write a serialization tutorial for dummies. :) I'm confoosed.... <br><br></td></tr></table><br>
<a name="902327"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Jeremy Paxman:  Yeah I know that, I saying if you have a 2 dimensional array of say dimensions 4,4 and you output it via serialisation as a 16 number long array, when you read it back in, you don't want it as a 16 number long array, you need it back in a 4,4 array - but how can you do that if the serialisation doesn't store the dimensions?  You'd have to output the dimensions yourself... <br><br></td></tr></table><br>
<a name="902330"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> You'd have to output the dimensions yourself...  <br></div><br>We probably don't want to have to do that :-) <br><br></td></tr></table><br>
<a name="902338"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> We probably don't want to have to do that :-) <br></div> Agreed! <br><br></td></tr></table><br>
<a name="902424"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> Updated my BRL.Reflection module hack to enable access to array dimension values, as well as creating multi-dimensional arrays through reflection. (currently available from Module Tweaks area). <br><br></td></tr></table><br>
<a name="902466"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> Awesome.  Sounds like BRL should make it official... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
