<!DOCTYPE html><html lang="en" ><head ><title >Redi.MaxMod and SID files.</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Redi.MaxMod and SID files.</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Redi.MaxMod and SID files.</a><br><br>
<a name="749473"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WiredWorm</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi there,<br><br>I'm using the above module in conjunction with the SID.SidStream module to enable playback of both OGG and SID files within my application.<br><br>Ideally what i'd like it to do is play the SID until the end and the move onto the next file; but it seems i've hit a problem.<br><br>The current location and length values in MaxMod don't seem to work when we're reading in a SID file.<br><br>Is there any way around this issue?<br><br>I realise it could be because it's using the streaming functionality (hence it doesn't know how long the file is until it hits the end), but what seems to happen is that the SID loops indefinately.<br><br>Any clues anyone?<br><br>Cheers<br><br>Pete <br><br></td></tr></table><br>
<a name="749538"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> No idea about SID files, but doesn't MaxMod's tMusic.Geti(MM_ISPLAYING) work? <br><br></td></tr></table><br>
<a name="749604"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >REDi</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi WiredWorm<br><br>The SID module is gmans baby, but AFAIK there is no way in SIDPlay to get the actual length of the music, I think its todo with the way SID files work, could be wrong tho.<br><br>I'd say give gman a shout, see what he thinks. <br><br></td></tr></table><br>
<a name="749608"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >REDi</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I remember something about a song length database for sid files, cant seem to find it ATM tho. <br><br></td></tr></table><br>
<a name="749702"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WiredWorm</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the comments GfK and REDi.<br><br>I've loaded some SID files into SidPlay2 which I believe uses an updated version of the libsidplay.dll file and I notice that this also seems to have a similar issue.<br><br>So, I think you are quite correct - I think the problem I am seeing is a limitation of the file format more than anything.  For now I have put an option in whereby the user can force the next track to start playing.<br><br>GfK, MM_ISPLAYING doesn't seem to work.<br><br>Cheers<br><br>Pete <br><br></td></tr></table><br>
<a name="749720"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WiredWorm</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I found this <a href="http://www.geocities.com/siliconvalley/lakes/5147/sidplay/sldb.html" target="_blank">http://www.geocities.com/siliconvalley/lakes/5147/sidplay/sldb.html</a> which includes a source code download for a utility which will attempt to determine the SID length.<br><br>Unfortunately it seems to be coded in C++ and i've got no clue how i'd make use of it in Blitz.<br><br>Unless of course some kind soul can give some pointers?<br><br>Cheers<br><br>Pete <br><br></td></tr></table><br>
<a name="749785"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> currently there is no way in libsidplay2 (which the mod is based on) to determine the length of SID tunes.  there is a database and some code at the link posted by WiredWorm, but the code is based on the original libsidplay and not compatible with libsidplay2.  <br><br>at this time, the only option that i know of is to write some custom code that uses the verbose file available at the above link to lookup the file and the lengths based on filename.  i have thought about it how i would do this...  i will see if i can add something to the mod to optionally allow use of a verbose file.  i will give a better answer tonight when i can get at my code. <br><br></td></tr></table><br>
<a name="749869"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xerra</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I wrote a gui for playing .Sid files a couple of months back which I planned to rewrite creating the GUI with LogicGUI so the interface is better. I had the same kind of problem with knowing when a .Sid file has finished so kind of put the project on hold waiting to see if there was any way round the problem.<br><br>As has been confirmed already the problem isn't with Maxmod of gman's sidplay library but rather the botchy way the sid tunes are ripped out of C64 games and don't actually contain data structures with the lengths of each embedded tune to work with. Bearing in mind the sound routines on these tunes were written in 6510 assembler in the early eighty's and were designed for only playing music within the game itself then it's understandable to an extent.<br><br>What would be awesome would be someone to write a powerful conversion tool to convert a .Sid tune into a .S64 tune and reformat the data so the times for each piece of music are in it to which it could collect from an internet site SQL database or similar. Then it would just need gman and redi to modify the source to their modules slightly to understand the new format and put in the ability to pull out the playback times of each tune.<br><br>We can all hope as the C64 music days were fantastic.<br><br>Oh yeah, if anyone wants to mess with the Sidplayer I wrote then it's in my project log. The interface isn't great but it works fine and I'll put the source code on my website as soon as I get round to it if it'll help someone else out with using the blitz mods. <br><br></td></tr></table><br>
<a name="751793"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WiredWorm</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the comments Xerra and Gman.  For the moment i've done a couple of things.  Firstly i've modified the config file so we can switch the ability to play SID tunes on and off without having to recompile the binary; i've also put in place the ability to hit the M key to automatically launch into the next song.<br><br>I may look at implementing the length database at some point but i've got a deadline to work to and at the moment the SID functionality isn't essential.  So if I get time at the end then i'll look at it.<br><br>In the meantime someone else might come up with a solution :) <br><br></td></tr></table><br>
<a name="752015"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Diordna</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Would you mind posting your OGG streaming code? I'd love to see how you do it, and I don't have much time these days to delve into this sort of thing. <br><br></td></tr></table><br>
<a name="833731"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MacSven</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Getting this after download and install the sid.mod<br><br>Compile Error<br>Can't find interface for module 'redi.maxmod'<br><br>but the maxmod.module is installed too, but the folder is named as<br><br>mod/maxmod.mod?????<br><br>The MAXMOD is the Version 1.21 <br><br></td></tr></table><br>
<a name="833823"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Matthew Smith</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> MainframeOSX,<br><br>Redi posted this in his MaxMod topic:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SuperStrict 

Rem
bbdoc: SID Stream for MaxMod
End Rem
Module SID.SIDStream

ModuleInfo "Version: 1.04"
ModuleInfo "Name: SID.SIDStream"
ModuleInfo "Description: MaxMod SID streaming player"
ModuleInfo "License: GPL (libsidplay2 is GPL)"
ModuleInfo "Author: gman"
ModuleInfo "Credit: REDi, author of MaxMod (http://www.redi.me.uk/forum/index.php)"
ModuleInfo "History: 2006/7/16 - GG Initial Release"
ModuleInfo "History: 2006/8/1 - REDi Updated for MaxMod v1.9"
ModuleInfo "History: 2006/8/29 - Updated for MaxMod v1.10 by Matt Smith (thank you)"
ModuleInfo "History: 2006/9/5 - Updated for MaxMod v1.11 by REDi (thank you)"
ModuleInfo "History: 2006/10/19 - Recompiled for MaxMod v1.15"
ModuleInfo "History: 2007/02/19 - Recompiled for MaxMod v1.16 by REDi"

Import MaxMod.aMusic
Import SID.SIDPlay
Import BRL.StandardIO

' This adds it to the MaxMod Loader
MaxModLoader.Create(MaxMod_Loader_SID,"SID ~q.sid~q","sid")
Function MaxMod_Loader_SID:TMusic(File:String)
	Local SID:TMusic = SIDStream.Load(File)
	Return SID
EndFunction

Rem
bbdoc: MaxMod SID Stream
End Rem
Type SIDStream Extends TMusic

	' SIDPlayer pointers
	Field resid:Byte Ptr
	Field tune:Byte Ptr
	Field player:Byte Ptr
	
	Field Track:Short
	Field Bits:Short
	Field Channels:Short
	Field clockSpeed:Int

	Rem
	bbdoc: Loads a SID file and returns an audio sample for playback
	returns: an instance of TAudioSample
	about: Filename =&gt; path and name of file to load&lt;BR&gt;
	Track =&gt; the track within the file to return a sample for&lt;BR&gt;
	Rate =&gt; sample rate to play the sample at&lt;BR&gt;
	format =&gt; sample format&lt;BR&gt;
	clockSpeed =&gt; SID sample playback clock speed
	EndRem						
	Function Load:SIDStream(Filename:String, Track:Short=1, Rate:Int=44100, format:Int=MM_STEREO16, clockSpeed:Int=SID2_CLOCK_PAL)
			
		Local file:Byte[]=LoadByteArray(Filename)

		Local This:SIDStream = New SIDStream
		
		' make sure we have the file
		If file
			This.clockSpeed=clockSpeed
			
			' load the SID file into the tune
			This.tune=createSidTune()			
			
			If Not This.tune Then RuntimeError "SIDStream.Load(): Unable to create SidTune"
			
			If Not SidTune_Read(This.tune,file,file.length) Then RuntimeError "SIDStream.Load(): Unable To load "+filename
			file=Null
					
			' select the track within the SID file
			If Not This.SelectTrack(Track) Then RuntimeError "SIDStream.Load(): Unable to select track "+Track
										
			This.channels=sid2_mono
			If format=MM_STEREO8 Or format=MM_STEREO16 Then This.channels=sid2_stereo
		
			' bump down to mono if the sample is mono	
			If This.channels=MM_STEREO8 And Not SidTune_IsStereo(This.tune)
				Select format
					Case MM_STEREO8
						format=MM_MONO8
					Case MM_STEREO16
						format=MM_MONO16
				EndSelect
				This.channels=sid2_mono
			EndIf
			
			This.bits=8
			If format&lt;&gt;MM_MONO8 And format&lt;&gt;MM_STEREO8 Then This.bits=16
		 
			This.STREAM_FORMAT=format
			This.Sample_Rate=Rate
			This.bits=16
		
			' create the ReSIDBuilder
			This.resid=createReSIDBuilder("MaxMod Load SID")
			If Not This.resid Then RuntimeError "SIDStream.Load(): Unable to create ReSIDBuilder"
										
			' create the player for decoding
			This.player=createSidPlay2(This.resid)
			
			' set the player options
			If Not SidPlay2_SetFrequency(This.player,rate) Then RuntimeError "SIDStream.Load(): Unable to set rate "+rate
			If Not SidPlay2_SetBits(This.player,This.bits) Then RuntimeError "SIDStream.Load(): Unable to set bits "+This.bits
			If Not SidPlay2_SetPlayback(This.player,This.channels) Then RuntimeError "SIDStream.Load(): Unable to set format "+format
			If Not SidPlay2_SetClockSpeed(This.player,This.clockSpeed) Then RuntimeError "SIDStream.Load(): Unable to set clockSpeed "+This.clockSpeed
			
			' load the tune into the player
			If SidPlay2_Load(This.player,This.tune)&lt;&gt;0 Then RuntimeError "SIDStream.Load(): Unable to load tune into the player"
			
			Return This					
		Else
			Return Null		
		EndIf	
	EndFunction

	Method Stop()
'		Super.Stop()
		SidPlay2_Load(player,tune)
	EndMethod

	Rem
	bbdoc: Returns the current track being played
	End Rem
	Method CurrentTrack:Short()
		Return Track
	EndMethod

	Rem
	bbdoc: Returns the total tracks within the SID
	End Rem
	Method GetTrackCount:Short()
		Return SidTuneInfo_songs(SidTune_getInfo(tune))
	EndMethod

	Rem
	bbdoc: Selects a track within the SID to play
	returns: True if successful
	End Rem
	Method SelectTrack:Int(track:Short=1)
		' select the track within the SID file
		Local playing:Int
		If PlayStatus = True Then playing = True
		If SidTune_SelectSong(tune,track)=track Then 
'			If playing Then Stop
			SidPlay2_Load(player,tune)
			Self.Track=track
'			If playing Then Play
			Return True
		Else
			Return False
		EndIf
	EndMethod

	Method Delete()
		' cleanup the libsidplay objects
		deleteSidPlay2(player)
		deleteSidTune(tune)
		deleteReSIDBuilder(resid)	
	EndMethod
	
	' this method gets called when the buffer needs filling
	Method FillBuffer(SoundData:Int,Length:Int)
		If Not Length Return
		Global count:Int
		If Not SidPlay2_Play(player,Short Ptr(SoundData),Length) Then RuntimeError "SIDStream.FillBuffer(): Unable to process sample data"
		count:+Length												
	EndMethod
	
EndType
</textarea> <br><br></td></tr></table><br>
<a name="833883"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >REDi</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Matt! :) <br><br></td></tr></table><br>
<a name="833922"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MacSven</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK. It compile the module. I am using the sample of the Sidplayer<br>this is now:<br><br>Building .LoadSIDSample<br>Compiling:.LoadSIDSample.bmx<br>Linking:.LoadSIDSample<br>/usr/bin/ld: archive: /Developer/BlitzMax/lib/libsidplay.a has no table of contents, add one with ranlib(1) (can't load from it)<br>/usr/bin/ld: archive: /Developer/BlitzMax/lib/libresid_builder.a has no table of contents, add one with ranlib(1) (can't load from it)<br>collect2: ld returned 1 exit status<br>Build Error: Failed to link /Developer/BlitzMax/mod/sid.mod/sidsample.mod/doc/.LoadSIDSample<br>Process complete<br><br>any idea, or have i compile the Sidlib2 for MACOS X. The Lib is in the Lib Folder! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
