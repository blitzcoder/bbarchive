<!DOCTYPE html><html lang="en" ><head ><title >..graphics overlay always on the top..</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >..graphics overlay always on the top..</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >..graphics overlay always on the top..</a><br><br>
<a name="1255693"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> ..hi guys..i want to draw some graphics overlay, over other application which runs, all the time and overlay stays on the top regardless user intervention with mouse or any other way..how to do this with BMX ? <br><br></td></tr></table><br>
<a name="1255703"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xerra</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> This for a gui program or something running in a screen?<br><br>If it's the later then what you need to be drawn on top should just be the last thing you display before flipping. <br><br></td></tr></table><br>
<a name="1255706"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Other applications ... I think he talks about stuff like the fps-overlay of "fraps".<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1255707"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes. I want to have logo or some other graphics over screen all the time, regardless what application runs on pc. Its needed for some alert screens system on local airports. Im not sure is that thread for maxgui or not. <br><br></td></tr></table><br>
<a name="1255708"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Xerra</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah missed that. Skim-reading as I'm bored at work. I'll leave this one to someone more knowledgeable than myself then. <br><br></td></tr></table><br>
<a name="1255709"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can't you make an always-on-top app that displays an image on a transparent window? <br><br></td></tr></table><br>
<a name="1255714"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> ..applictions which runs are many, and not done by me..so I need to create application which displays specific logo (based on request) over anything running at given moment..im not sure i understand what you saying Brucey..how can i make 'always on the top' app ?? <br><br></td></tr></table><br>
<a name="1255716"></a>

<a name="1255717"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> As you cannot guarantee to be the "topmost" app all time (what about multiple "stay on top" apps fighting each other?) the most secure way is to have some kind of custom video driver.<br><br>Alternatively you will have to be able to grab every kind of graphics context (gdi, dx, opengl ...) or more specifically "hook into them"<br><br>Maybe use some kind of lib for this<br><a href="http://taksi.sourceforge.net/" target="_blank">http://taksi.sourceforge.net/</a><br><br><br>If all apps on the screen just use "GDI" (no graphical contexts like gl/dx) you could create a fullscreen GDI ("maxgui") app.<br><br>Newer windows incarnations have transparent window support (I think older ones had trouble - so win98 and so on).<br><br>Create your windows with two more flags: WS_EX_LAYERED and WS_EX_TRANSPARENT. This makes the window "click through" aware and transparent.<br>Make it fullscreen (so you can draw to wherever you want). The "topmost"-part to be on top of everything is of course to be done too (dunno if it is available in maxgui).<br><br><br>If you need DX/OGL support:<br><a href="http://www.gamedev.net/topic/445141-c-directdraw-overlay-library/" target="_blank">http://www.gamedev.net/topic/445141-c-directdraw-overlay-library/</a><br><a href="http://www.gamedev.net/topic/359794-c-direct3d-hooking-sample/" target="_blank">http://www.gamedev.net/topic/359794-c-direct3d-hooking-sample/</a><br><a href="http://directdrawoverlaylib.codeplex.com/releases/view/3687" target="_blank">http://directdrawoverlaylib.codeplex.com/releases/view/3687</a><br>...<br><br><br>As soon as you cannot guarantee that only "simple apps" are run you will surely have to bite the bullet.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1255718"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> You haven't specified the operating system, there are different solutions depending on that.<br><br>Also, read this:<br><a href="http://blogs.msdn.com/b/oldnewthing/archive/2011/03/10/10138969.aspx" target="_blank">http://blogs.msdn.com/b/oldnewthing/archive/2011/03/10/10138969.aspx</a> <br><br></td></tr></table><br>
<a name="1255719"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> ..thanks guys..application should be windows only.. <br><br></td></tr></table><br>
<a name="1255744"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I understand. <br>That article and some of the comments there discuss that, if the system is completely unknown, there is no way that you can guarantee to your client that you can make your application window persistently on top of everything else all of the time. <br>The OS functionality that you'd be using to make your application the topmost one would also be available to any other application that also wanted to do the same, and there could be conflicts \ competition.<br><br>All that being said, if your application is the only one trying to make a topmost window in that airport environment, it could work.<br>I'd take a look at the following Win32 functionality, with what Derron said above:<br><br>- <a href="http://msdn.microsoft.com/en-us/library/ms633556(VS.85).aspx" target="_blank">http://msdn.microsoft.com/en-us/library/ms633556(VS.85).aspx</a><br>- <a href="http://www.codeproject.com/Articles/34158/Cool-Semi-transparent-and-Shaped-Dialogs-with-Stan" target="_blank">http://www.codeproject.com/Articles/34158/Cool-Semi-transparent-and-Shaped-Dialogs-with-Stan</a><br>- <a href="http://stackoverflow.com/a/834509/4206247" target="_blank">http://stackoverflow.com/a/834509/4206247</a> <br><br></td></tr></table><br>
<a name="1255749"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> ..thanks Kryzon..i thought it should be not so big task as i have seen plenty of time exactly that effect, with game trainers..every time you run that thing, no matter what application is running or you start it later, game trainer graphics is on the top (until you start particular game), so i thought it could be done relatively straightforward with bmax..but it seems i was wrong.. <br><br></td></tr></table><br>
<a name="1255767"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Another thing you need to consider:<br><br><div class="quote"> <i><b>David@stackoverflow:</b></i> From MSDN: "If this function is called from a 32-bit application running on WOW64, it can only enumerate the modules of a 32-bit process. If the process is a 64-bit process, this function fails and the last error code is ERROR_PARTIAL_COPY (299)." <br></div><br><a href="http://stackoverflow.com/questions/11810854/opengl-directx-hook-similar-to-fraps" target="_blank">http://stackoverflow.com/questions/11810854/opengl-directx-hook-similar-to-fraps</a><br><br>Seems when enumerating GDI windows (open applications) you will need to have a 64bit app if you want to get other 64bit apps too ...in that case you surely will need -ng or another language than BlitzMax.<br><br><br>Above SO-link links to:<br><a href="http://easyhook.codeplex.com" target="_blank">http://easyhook.codeplex.com</a><br>and<br><a href="http://www.ring3circus.com/gameprogramming/case-study-fraps/" target="_blank">http://www.ring3circus.com/gameprogramming/case-study-fraps/</a><br>with the ladder being not available so visit it [a https://web.archive.org/web/20120628161712/http://www.ring3circus.com/gameprogramming/case-study-fraps/]using the wayback machine[/a].<br><br><br>Seems the principle of "fraps" is to enumerate running processes, try to hook into their DLLs and call additionally itself as soon as specific calls are done (like "flip").<br><br><br>All of above is not needed if you can ensure:<br>- no other window on top (dunno how to handle this "fight")<br>- no DX/GL app is running at the screen portion of your overlay<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1255769"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> You might get away with a simple program, just to display a transparent window in the corner with logo (or wherever), and have it poll from time to time, and lift itself back to the top of the window stack.<br><br>You can initially make it topmost and set to always on top - which would be true until presumably another window appears and wants to also be always on top. If this is a static display (i.e not a normal interactive PC) then there's less chance of foreign apps trying to get in your way.<br><br>The other option is to get some stickers and stick your logo on the screens :-) <br><br></td></tr></table><br>
<a name="1255771"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ sticker ... nifty idea<br><br>Another Idea is to run everything in a full-screen-virtualbox  - except your app. So at the end you only have to cover ONE "app" :p<br><br>Similar principle is a remote-vnc-connection.<br><br><br>But Brucey is right: start up with the "always on top + click-through + transparent" window and it will surely do well already.<br><br>Maybe you should mention if you are running other of your blitzmax-apps (non-maxgui) there which would mean DX or OGL.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1255772"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> ..LOL Brucey..well..its basically alert system which should overlay airline logo + some passenger information, on to all PC's , once alert is issued..<br><br>..anyway, I found small application which does exactly what im asking (in terms of keeping graphics over anything running on pc)...unfortunatelly no source so i cant see how it is done...i cant remember name of it, but ill post tomorrow as its on my office pc.. <br><br></td></tr></table><br>
<a name="1255773"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe you didnt see it in the above post:<br><br><a href="http://taksi.sourceforge.net/" target="_blank">http://taksi.sourceforge.net/</a><br><br>this is some kind of "open source fraps" - so it gives insight how to handle it.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1255804"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Scaremonger</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try this:<br><br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SuperStrict
?Not win32
	Assert False, "Windows Only!"
?
Import Maxgui.drivers

Extern "Win32"

	Function GetWindowLong:Int( hwnd:Int, index:Int) = "GetWindowLongA@8"
	Function SetWindowLong:Int( hwnd:Int, index:Int, value:Int) = "SetWindowLongA@12"
	Function SetLayeredWindowAttributes:Int( hwnd:Int, ckey:Int, alpha:Byte, flags:Int)

	Function SetWindowPos:Int( hWnd:Int, hWndInsertAfter:Int, X:Int, Y:Int, cx:Int, cy:Int, uFlags:Int) = "SetWindowPos@28"

EndExtern

'#####

Const GWL_EXSTYLE:Int = -20
Const GWL_STYLE:Int = -16

'Const WS_EX_TRANSPARENT:Int = $20
Const WS_EX_LAYERED:Int = $80000

Const LWA_COLORKEY:Int = $1
Const LWA_ALPHA:Int = $2

Const HWND_TOPMOST:Int = -1
Const HWND_NOTOPMOST:Int = -2

'#####

'# Create a window
Local style:Int 
style = WINDOW_TOOL
'style = WINDOW_RESIZABLE | WINDOW_CLIENTCOORDS
Global window:TGadget = CreateWindow( "Window", 64,64, 256,256, Null, style )
Local hwnd:Int = QueryGadget( window, QUERY_HWND)

'# Make the window LAYERED
style = GetWindowLong( hwnd, GWL_EXSTYLE)
style :| WS_EX_LAYERED
SetWindowLong( hwnd, GWL_EXSTYLE, style)

'# Make BLACK transparant
SetLayeredWindowAttributes( hwnd, $000000, 0, LWA_COLORKEY )

'# Set Opacity Level
'Local alpha:Float = 0.5
'SetLayeredWindowAttributes( hwnd, $FF00FF, Byte(alpha * 255), LWA_ALPHA)

'# Set Window background to BLACK (Transparant)
SetGadgetColor( window, 0,0,0 )	'# BLACK WILL BE TRANSPARENT

'# Set Window as ALWAYS ON TOP
SetWindowPos( hwnd, HWND_TOPMOST, 0, 0, 0, 0, SWP_NOSIZE | SWP_NOMOVE | SWP_NOACTIVATE)


'# Create some window text
Global title:TGadget = CreateLabel( "ALERT WINDOW", 5,5,70,15,window )
SetGadgetTextColor( title, $ff, 0,0 ) 

'# Create a close button (Essential if you use WINDOW_TOOL)
Global close:TGadget = CreateButton( "CLOSE", 5,50,80,22,window )
SetGadgetTextColor( close, $ff,0,0 )

Repeat
	Select WaitEvent()
		Case EVENT_WINDOWCLOSE, EVENT_APPTERMINATE
			End
		Case EVENT_GADGETACTION
			End
	EndSelect
Forever

End

</textarea><br><br>This does a complete overlay, keeps the window on top and does not show in the application bar (WINDOWS_TOOL). If you want an icon in the appbar, change style as required.<br><br>The example uses BLACK as transparent but you can use anything.<br><br>Enjoy... <br><br></td></tr></table><br>
<a name="1255820"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Naughty Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ Scaremonger<br>..thank you very much..i owe you one..<br><br>..program i was reffering in my previous post yesterday is 'Floaty' and very simple..basically what scaremonger posted now will do same job..<br><br><a href="https://dl.dropbox.com/u/6444067/floaty/floaty-0.1.zip" target="_blank">https://dl.dropbox.com/u/6444067/floaty/floaty-0.1.zip</a> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
