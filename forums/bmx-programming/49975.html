<!DOCTYPE html><html lang="en" ><head ><title >UDP sockets, client/server</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >UDP sockets, client/server</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >UDP sockets, client/server</a><br><br>
<a name="555623"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>I want to use UDP in a client/server environment. On the server, should I be opening a new socket for each client, or should I use the 1 socket, and point it to each clients IP/PORT using connectSocket() as and when I need to send data to them?<br><br>Edit:<br><br>I'm also stuck on how you get the IP from a client.<br><br>Cheers<br>Tom <br><br></td></tr></table><br>
<a name="555640"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom Darby</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> In general, you should have a 'listener' port (or ports, if you're gonna have crazy-go-nuts levels of connection requests) on your server that does nothing but process incoming connection requests.  Once you've received a connection request, you should open a new port on the server and tell the client to communicate with that port for the duration of the session.<br><br>To get the IP address from the client, try looking into the SocketLocalIP and SocketRemoteIP functions. <br><br></td></tr></table><br>
<a name="555662"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Been looking at this informative tutorial on sockets: <a href="http://www.coding-zone.co.uk/cpp/articles/140101networkprogrammingn.shtml" target="_blank">http://www.coding-zone.co.uk/cpp/articles/140101networkprogrammingn.shtml</a><br><br>from that I gather max is missing a functional 'sendto()', though the groundwork is already there, it just needs adding to sockets.bmx, that would let you send directly to an IP.<br><br>The functions for finding IPs are returning LAN IPs, I'm behind a router so all I get is either 127.0.0.1 or whatever my LAN IP is at the time 192.168.x.x, I'm just looking to see if UDP sends the source IP along with itself, that'd be ideal. <br><br></td></tr></table><br>
<a name="555701"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RktMan</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> the blitz implementation of sockets is a little confusing because they didn't keep nomenclature consistent with accepted sockets API's.<br><br>having said that, it *appears* to me that with blitz, there is no sendto()/recvfrom() mechanisms specifically, and that you use the ConnectSocket() call with a UDP socket.<br><br>then you can read/write to the socket through the provided mechanisms in blitz.<br><br>and as far as IP's and "firewalls"/broadband connections, if you are behind a local network, and you ask your own machine what you ip address is, you will always get the one assigned to your machine by the router.<br><br>this address, is of course, NOT your external address so clients on the other side of the router can't use that address.<br><br>with a TCP client/server setup, the clients need to know the server ip address/listen port, but the server can query the socket, after it has accept()'ed a connection, to get the remote ip address.<br><br>magically, the address the server will see, will be the address of the remote computers router, so everything just works.<br><br>i have very little experience with UDP specifically, but i think basically, each computer needs to know the external address of the remote computers *router* ahead of time.<br><br>then, the router needs to have "port forwarding" setup to get the inbound packets to the right computer from the outside world.<br><br>i think this is because of the connectionless nature of UDP.<br><br>there isn't really a true "client/server" paradigm, each machine just throws packets onto the wire destined for the other machine.<br><br>so each machine must know the specific details of the other ahead of time, since one isn't "calling" the other.<br><br>again, not having done much UDP, i *think* what some applications do, is use traditional TCP client/serve stuff to have a "conversation" first between client/server, the computers exchange some information quickly, then they move the conversation over to UDP for the actual traffic.<br><br>grain of salt ...<br><br>Tony <br><br></td></tr></table><br>
<a name="555734"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tested this and it works, needs to be added to socket.bmx within 'Type TSocket', and compiled with 'bmk makemods brl.socket' to update the module'<br><pre class=code>
	Method SendTo( buf:Byte Ptr,count,destIP,destPort,flags=0 )
		Local n=sendto_( _socket,buf,count,flags,destIP,destPort )
		If n&lt;0 Return 0
		Return n
	End Method
</pre><br>I'll look into use TCP for establishing a connection and swapping important info. But getting the net or external IP is a must for people with routers. <br><br></td></tr></table><br>
<a name="555763"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can ofcourse use sendto_ receivefrom_ directly in your code (until mark implements the above). That's how I did it in TNet. I'll suggest you check it out. (TNet is a multiplayer library for BMax). It'll probably make your life easier.<br><br>Sendtoo and ReceiveFrom is just like Receive and Send except you use the ip and port directly without the need of "connecting" the socket first. You can use both for both TCP and UDP. I guess you know that, just in case.<br><br>And both UDP and TCP sends the senders IP and Port packed into each message. That's what you retreive with receivefrom. Usually clients ip's stays the same throughout  a session but that is not always the case.<br><br>UDP and TCP have the same problems when you deal with firewalls, routers and internal ip's. In the actuall world a  TCP message travels just like a UDP msg. The difference is when the message arrives or does not arrive. TCP stops traffic until the problem is solved/packet resent, while UDP does nothing. Routers are smart devices, when someone behind a router talk to someone outside it, the router "remembers" the outsider. That's why it can direct the data sent back to you (which is sent to the router) to your computer automatically. That's not a TCP thing. Some routers might however have default settings that blocks/accept TCP/UDP. You only forward ports (on the router) if you want to start a server behind it. I'm pretty sure but correct me if I'm wrong. <br><br></td></tr></table><br>
<a name="555813"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> And both UDP and TCP sends the senders IP and Port packed into each message. That's what you retreive with receivefrom. Usually clients ip's stays the same throughout a session but that is not always the case. <br></div><br><br>I see that the source IP is dependant on whether IPv4+ is used, <a href="http://www.zytrax.com/tech/protocols/tcp.html#udp" target="_blank">http://www.zytrax.com/tech/protocols/tcp.html#udp</a> is IPv4 standard for the Internet?<br><br>Edit: Ok, wikipedia says 'most' of the Internet uses IPv4 as of 2004 <a href="http://en.wikipedia.org/wiki/IPv4" target="_blank">http://en.wikipedia.org/wiki/IPv4</a> but that's not a guarantee. <br><br></td></tr></table><br>
<a name="555869"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wait I was a little wrong there. The port is packed into the message, not the IP. The IP sits "on top" in the IP header. <br><br>Do you know what part of the internet that does not use IPv4? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
