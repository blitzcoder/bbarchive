<!DOCTYPE html><html lang="en" ><head ><title >Negative Millisecs()</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Negative Millisecs()</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Negative Millisecs()</a><br><br>
<a name="671399"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I started to use millisecs as a timer that counter upwards. 1..2..3..4..5..6 and so on. Then I learnt that after some days, or on linux systems, the counter goes into the negative. How does it count when it comes to negative?<br><br>Is it -9...-8...-7...-6...-5 ?<br>or<br>-7...-8...-9...-10...-11...-12?<br><br>And when it laps? How does it start over?<br><br>And to measure the time from A to B, is the correct way to do it like this:<br><div class="quote"> <br>timer:Int = millisecs()<br>' ex time = 400<br>' or time = -600 <br><br>DoSomethingTedious() 'Returns 500ms later<br><br>timeTaken = millisecs() - time<br>' Should be: timeTaken = 900 - 400 ----------&gt;  500 ok!<br>' or negative : timeTaken = -1100 - (-600) --&gt; -500 ok?<br>' Should I use abs() or am I doing something wrong?<br> <br></div><br><br>And when you want to get a time Ex. when 500ms have passed. <br><br><div class="quote"> <br>startTime = millisecs()<br>' Ex1. StartTime = 800<br>' Ex2. StartTime = -800<br><br>Loop<br>   If millisecs() - startTime =&gt; TimePassed Then DoSomething()<br>'Millisecs() - 800<br>'Ex. 900 - 800 = 100ms passed<br>' If 100ms =&gt; 500ms Then.. ok!<br><br>'For negative:<br>' Millisecs() + 800<br>' Ex. -900 + 800 = 100ms<br>' If 100ms =&gt; 500ms Then.. ok! Seems to work, right?<br>EndLoop<br> <br></div><br><br>Is this how millisecs() was intended to be used? Is there more to it? <br><br></td></tr></table><br>
<a name="671416"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would assume it wraps at the 2 billion mark back to minus two billion (then count up towards 0) if it's signed.  Otherwise it would wrap from 4 billion odd to 0.<br><br>You second comment 'For negative shows -900+800 = 100ms, this is wrong it will be -100ms.  Anyway, after 100ms, it should go up to -700ms and then -700 --800 = 100 (because -- = +) :-) <br><br></td></tr></table><br>
<a name="671418"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Eikon</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> After 24 days of uptime or so, the integer value overflows and it goes negative -2,147,483,648 or whatever, and then begins counting back towards 0. I use a custom MilliSecs function that starts counting at 0 to solve the problem. <br><br></td></tr></table><br>
<a name="671420"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> wouldn't this solve the problem?<br><br>Local startTime:Long = millisecs()<br><br>....<br><br>Local timeRunning:Long = millisecs() - startTime<br><br><br>(at least until 2038...) :-) <br><br></td></tr></table><br>
<a name="671421"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> There's no problems with it counting negative as the differences are still positive.  The only problem is the instance when it wraps over, you may get a ridiculous value, but you can protect against that. <br><br></td></tr></table><br>
<a name="671422"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Eikon</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you like to use <br><br>If MilliSecs() &gt;= myTime + 100<br><br>there will be problems with it counting negative. Instead of changing all my instances of that, I just start from 0. <br><br></td></tr></table><br>
<a name="671425"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would avoid using Millisecs() for timing things directly in my game.<br><br>I do the following:<br><br><pre class=code>
	Current_Time	 = MilliSecs()
	Game_Start_Time  = Current_Time
						
	Repeat
		
		SetClsColor 0, 0, 0
		Cls
	
		Repeat 
			Time_Old		= Current_Time						' Store start time of last frame.
			Current_Time 	= MilliSecs()						' Get the current time.  Use this instead of Millisecs() from here on if you need the time.
			Time_Delta 		= Current_Time - Time_Old			' Calculate how long last frame took to render, in milliseconds.
			Time_Delta_Sec# = Float(Time_Delta)/1000.0			' Convert frame time to seconds.
		Until (Time_Delta &gt; 0) And (Time_Delta &lt; 250)			' Handle unnaturally long pauses between frames gracefully.
				
		FPS = 1000.0 / Float(Time_Delta)
</pre><br><br><br>See that bit after Until?  That handles both when the user tabs out of the app and back, and when millisecs wraps to 0.<br><br>Also, when Millisecs() wraps to negative, it counts towards 0, so if Current_Time = -100 and Time_Old = -200, then Time_Delta = 100, which is correct.<br><br>The last bit of the puzzle isn't in the code above.  I have a Game_Time variable which I add Time_Delta to each frame while the game is not paused.  While it is likely someone might leave their PC running for 23 days straight and you might have a negative Millisecs() to deal with, it's not so likely that they will leave your game running for that long, so you need not worry about your Game_Time timer overflowing.  But if you are... Make it a long.  A long will not overflow until around 160 million years have passed. :-) <br><br></td></tr></table><br>
<a name="671514"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> All you need to do is check if the millisecs is larger than a given value and then modulo it with that value and adjust whatever other parameters you have so your whole thing still works... or put the `total millisecs` from all the modulo'd millisecs into a Long. <br><br></td></tr></table><br>
<a name="672363"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for all the great response.<br><br>Okey so it counts from lowest negative to 0 to highest int, then it jumps to lowest negative and counts upwards towards 0 again.<br><br>Brucey thanks, that was a nice idea. I'm going to use that one. Allows me to use A &gt; B and B &lt; A with current time instead of A - B &gt; 0 and B - A &gt; 0.<br><br>Sswift, what I do not really understand is the Repeat-Until loop you have inside you main loop. Is this like a delay?<br><br>Until (Time_Delta &gt; 0) And (Time_Delta &lt; 250) - Is not Time_Delta always be less than 0?<br><br>With a FPS of 75 the frametime should be less than 13 ms. FrameTime = 1000/FPS. And this would be the total time for Graphics, Logic, AI, Effects and more. Or did you mean to draw/update everything then run some delay until time reached?<br><br>AngelDaniel, How did you mean to use Mod with millisecs? How fast is mod? <br><br></td></tr></table><br>
<a name="672379"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm pretty sure sswifts code means that if there is a big delay due to external influences OR the clock has wrapped round, then it will take another reading.  Also Time delta is either 0 or greater normally as it's measure in MS: Time_Delta = Current_Time - Time_Old<br><br>re: Mod considering you are only calling it ONCE per frame, I really wouldn't worry :-) <br><br></td></tr></table><br>
<a name="672409"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Time_Delta should always be greater than 0, not less than 0, so with an FPS of 75 it will be 13.<br><br>The reason I check to see if it is less than 0 is just in case the code is running so fast that it executed in less than a millisecond.  That would cause stuff to crash when it divides by 0.  And I check if it is greater than 250 because that's only gonna happen if the FPS drops below 4fps, like if the hard drive starts thrashing for a moment or the user tabs out of the game.  Saves them from getting killed because everything went choppy for a moment and they missed something important. <br><br></td></tr></table><br>
<a name="672804"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah so it works like a pause when the FPS drops very low, instead of lag in form of warping.<br><br>Wait a minute, I think I confused myself. Yes, I agree Delta_Time, which is the same as frametime, is always greater or equal to 0. However your loop loops when it is greater than 0 or less than 250. Which means it will loop forever unless the logic suddendly takes less than a millisec to do? Or maybe I missunderstood where you put the UpdateEverything() function? <br><br></td></tr></table><br>
<a name="672813"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's not a while loop, it's a repeat until loop so as soon as Delta_Time goes over 1, it exits the look and this is where the logic would be updated and then the drawing would be done. <br><br></td></tr></table><br>
<a name="672832"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wave:<br>No, it won't loop forever, because eventually one read of millisecs will be at the next millisecond when the other was at the previous.  But I suppose it's possible it could loop a few times.  Anyway I haven't ever noted it being an issue, even when the screen is blank and the FPS counter is stuck at 1000. <br><br></td></tr></table><br>
<a name="672839"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> FYI Mod is plenty fast, not sure why you'd worry. I use it thousands of time a loop, maybe tens of thousands. <br><br></td></tr></table><br>
<a name="672974"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry did not think about until = not while :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
