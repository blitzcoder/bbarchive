<!DOCTYPE html><html lang="en" ><head ><title >Fastest way to copy one image into another?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Fastest way to copy one image into another?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Fastest way to copy one image into another?</a><br><br>
<a name="956472"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >elcoo</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br>I wonder if there is a fast way to copy one image in to another in realtime? I tried using pixmap but it's waaayyy to slow. Are there any faster solutions?<br>The problem is that my image is pretty big (1600*2000 pixels) so even writing only one pixel needs pretty much time. But maybe i'm doing something wrong. My function looks like that: <br><br>Function SetImgColor(img,x,y,r,g,b,a=0)<br>Local pix:TPixmap  = LockImage(img)<br>argb = ((a Shl 24) | (r Shl 16) | (g Shl 8) | (b Shl 0))*-1<br><br>WritePixel (pix,x,y,argb)<br>	UnlockImage(img)<br><br>End Function <br><br></td></tr></table><br>
<a name="956477"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You don't want a 1600x1200 image.  You should always use base 2 square images wherever possible.<br><br>A 1600x1200 one takes as much vram as a 2048x2048 image - roughly 16MB, or significantly more if you're using mipmapping.  The reason its so slow after modifying even one pixel via a pixmap, is because the whole thing needs to be dumped to the graphics card again.<br><br>A faster way would be to load the image as a bunch of 128x128 (or anything smaller than 1600x1200) images.  That way you only need to deal with one tiny section at a time. <br><br></td></tr></table><br>
<a name="956479"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you just need to simply recolor an image, you can use SetColor() (that is, if you have a graphical context going. <br><br></td></tr></table><br>
<a name="956487"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> also a way to do it faster is to access the pixels in the pixmap directly:<br><pre class=code>
Function SetImgColor(img,x,y,r,g,b,a=0)
   local pixels:int ptr = int ptr(LockImage(img).pixels)
   pixels[y*img.width+x] = ((a Shl 24) | (r Shl 16) | (g Shl 8) | (b Shl 0))*-1 ' this writes the pixel to the pixmap
   UnlockImage(img)
End Function
</pre><br>if you need to set more than one pixel before drawing, don't go through the process of locking and unlocking the image for every pixel although the UnLockImage function has no use whatsoever. <br><br></td></tr></table><br>
<a name="956490"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >elcoo</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, thanks for those tips! I now used several tiny squares and it works great! <br><br></td></tr></table><br>
<a name="956496"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Note that you can also make a negative numerical value by just sticking a minus sign in front of it (instead of running a mul operator on the processor).<br><br>i.e.<br><pre class=code>pixels[y*img.width+x] = -((a Shl 24) | (r Shl 16) | (g Shl 8) | (b Shl 0))</pre> <br><br></td></tr></table><br>
<a name="956526"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looking at it logically, I don't believe that making the whole thing negative is the same as ORing it with a negative small value. Either way, I don't understand his use of it. That is why I left it alone. <br><br></td></tr></table><br>
<a name="956644"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could draw to the backbuffer and use glCopyTexSubImage2d() in OpenGL. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
