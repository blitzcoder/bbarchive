<!DOCTYPE html><html lang="en" ><head ><title >Pixel-by-pixel comparison each frame</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Pixel-by-pixel comparison each frame</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Pixel-by-pixel comparison each frame</a><br><br>
<a name="1068345"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SpaceAce</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am looking for the fastest way to go about this:<br><br>Execute some drawing commands<br>Do a pixel-by-pixel read of the resulting image, comparing it to another set of data<br>If necessary, revert image to the state it was in before the drawing operation.<br>Do it all over, again on the new image.<br><br>I had this (somewhat) working many months ago, but it was just too slow. I fiddled around with different combinations of pixmaps, and TImages, and various pixel reading strategies, and OpenGL commands, but I could never get a decent speed except on tiny images. I also tried breaking the image up into segments and only checking dirty panels, but that didn't help much and made the program way more complex than I intended.<br><br>If anyone has suggestions on streamlining the process listed above, let me know. I don't mind using third-party libraries, but I'd rather not have to wrap them, myself. Any help would be appreciated. <br><br></td></tr></table><br>
<a name="1068346"></a>

<a name="1068347"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> That is never going to be fast. What are you trying to do? Perhaps there could be another way. Or perhaps a faster, but not 100% accurate, method could be devised. If it's for a game, you'd be suprised how unnoticable &lt;100% can be for many things.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1068354"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SpaceAce</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, it isn't for a game, so I don't need 60 (visual) frames per second, but the faster the better. In a nutshell, I want to compare two images every frame to see if they have become more similar or less similar. If they have become more similar, I carry on. If they have become less similar, or there has been no change, I want to revert the image to its previous state. If it's faster, I can revert the image by re-executing all the drawing commands that have led it to its current state, minus the ones from the current frame. I only need to draw to one of the images. <br><br></td></tr></table><br>
<a name="1068356"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> You'd probably be better off with C++ or something, and "drawing" them to a buffer in memory instead of a real graphic. It might be faster to keep copies of the images at different stages rather than redrawing them from scratch each time you revert, if that takes a long time. Have you profiled the code to determine which step takes longest? How do you define more similar? <br><br></td></tr></table><br>
<a name="1068365"></a>

<a name="1068366"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SpaceAce</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, I thought about taking a stab at this in C#. BlitzMax long ago became my go-to language for reasonably simple graphics-oriented projects, though.<br><br>I fiddled with arrays for a while, but you can eat up some serious RAM that way. Keeping different copies is what I was doing when I was grabbing the entire image each frame. I would simply put back the grabbed image from the last frame if I needed to roll back the image state.<br><br>The vast majority of time was burned in grabbing and releasing pixmaps, if I remember correctly. I can't recall exactly which function it was.<br><br>Similarity is a pixel-by-pixel comparison using the RGB values of the pixels. So, you sum the fitness of each individual pixel into an overall total. If the fitness goes up, we keep the changes, if the fitness goes down, we revert  to the previous state.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1068372"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> if you can post some code I might be able to help you figure out the best alternative. there might be a better way or not. <br><br></td></tr></table><br>
<a name="1068378"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SpaceAce</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> You ever go back and look at your own code after a really long time? Yeah. I seem to have left the program in a broken state, and I have no idea where to start getting it back to where I had it when it was workingish. I was planning to just start from scratch.<br><br>I'll see if I can just dig out the bits that ate all the time. <br><br></td></tr></table><br>
<a name="1068389"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> sounds like your trying to do the old 'mona lisa evolution with genetic algorithms'. If so, your method is not really the best way. I wrote a bmax version the day roger alsing announced it back in '08 (b4 he released the source), your welcome to it, but you can get the jist of it by looking at his source as well. <br><br></td></tr></table><br>
<a name="1068402"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SpaceAce</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am working on something similar, but not exactly like Alsing's program. In fact, I've already done it, it worked fine, but it was too slow to make me happy. What part of my approach is wrong, in your opinion? <br><br></td></tr></table><br>
<a name="1068412"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just the part about reverting to a previous image.<br>The way I did it was create a fixed population of pixmaps. Then do a squared error calcutlation between the source pixmap and each updated pixmap. pixmaps that didn't mutate for that generation would be skipped. I never kept the drawn images between generations, just the drawing commands. That way your most fit image(parent) can be cloned(to children) much faster.<br>If you need to clear the pixmap 'Clearpixels' is pretty fast and so is just replacing it with a new pixmap. Also when doing the squared error check between pixels you can try doing every other pixel or less to get a the same fitness measurement. <br><br></td></tr></table><br>
<a name="1068447"></a>

<a name="1068448"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Panno</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> dunno but maybe  this is a fast way : <br>copy both images to a bank and compare the banks with some "C" or asm code<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1068869"></a>

<a name="1068870"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could also try using a histogram compare-- tally all the values for each color R,G,B and use that to compare to other histograms. You could even break it down further (split R,G,B in half).<br><br>If brute force comparing takes too long, you could try alternating pixels or randomizing the sample pixel set.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
