<!DOCTYPE html><html lang="en" ><head ><title >BlitzMax Thread Priority</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >BlitzMax Thread Priority</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >BlitzMax Thread Priority</a><br><br>
<a name="666244"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does anyone know how to set the priority of a thread in code?  With the help of a framework customer, I've found out that some background tasks can interefere with BlitzMax but if the priority of the thread is pushed up to "high", the interference stops.  I'd really like the option to do this with code and wondered if anyone has any experience of this?  Also does such code work in 98/Me or is it Win 2000/XP only I wonder?<br><br>thanks in advance... <br><br></td></tr></table><br>
<a name="666254"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  With the help of a framework customer, I've found out that some background tasks can interefere with BlitzMax <br></div>Which ones? If your BlitzMAX application is runing at 100% CPU utilization, you only have one logical processor, and you set the thread priority to high, you can say goodbye to windows too.<br><br>I seriously doubt the validity of this claim, and if it is valid it's most certainly a BlitzMAX bug that needs fixing ASAP. It's certainly not something you'd want to potentially freeze up a customers PC with. <br><br></td></tr></table><br>
<a name="666256"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert Cummings</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I get the same problem.<br><br>Even small things cause my game to stutter as if its priority was zero. <br><br></td></tr></table><br>
<a name="666258"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Basically the guy was getting some jerks on my framework demos.  He found a Yahoo Weather thing running.  Disabled it and the demo ran fine.  He re-enabled the weather thing and set the demo priority to high and the demo ran fine.  I've been through the testing process with him.<br><br>Basically I don't want my games to run dodgily on some PCs with certain background tasks running (you can't expect end-users to disable background tasks).  On my PC my demo works fine with loads of stuff running, but it seems that certain tasks hog just a bit too much CPU time on some PCs.  As BlitzMax seems willing to give up this CPU time, I'm looking for a method into bullying it into hogging CPU time for better game performance on more PCs. <br><br></td></tr></table><br>
<a name="666259"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> OEJ: If you boost the priority in Task Manage/Processes, does this help? <br><br></td></tr></table><br>
<a name="666311"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Basically I don't want my games to run dodgily on some PCs with certain background tasks running (you can't expect end-users to disable background tasks). <br></div>Sure you can.<br><br>Exactly what degree of CPU / Frametime utilization are we talking here?<br><br>Generally high priority is reserved for system critical tasks (like the tasksceduler) and jacking it up to high can have very undesired results, particularly if you're on a single logical processor, and are already pushing the systems performance envelope. <br><br></td></tr></table><br>
<a name="666318"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> You do not really need to raise the priority (as mentioned above, a bad idea). But you need to use it in fullscreen in which case the framework will get "higher priority" ...<br><br>If you have it running in window mode, it is normal that it does not run fluently all if other CPU intense stuff hopps in (even if they only do it for 2s each 2 mins)... app windowed mode is meant for apps (=&gt; don't need to have the same cpu time all the time) and not for games after all. <br><br></td></tr></table><br>
<a name="666336"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you put up the priority too high you will probably lose updates to your event queue too ? Any GUi code will grind to a halt.<br><br>Unless you take over the whole system like in the Amiga days you can't be sure that you wont have interference, all you can do is allow for it, aim for less than 100% cpu time and know that you're doing so, so you let the o/s do what it wants to do when it wants to do it. You have to cooperate with it.<br><br>Also what are you going to do if someone is running some other CPU-hogging app on their system? <br><br></td></tr></table><br>
<a name="666339"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I realise that windowed mode should multi-task a bit more why is why I have delay(1) in the windowed mode main loop.  However, yes in full-screen I want other tasks not to be able to interrupt.  All the have to do is hog 20-50ms of time every second or so and suddenly the game looks jerky.  This can be prevented by boosting the thread priority, or is there another way?  In DOS, a game would get interrupted by nothing and run smooth, but run that same DOS game in windows and you get jerks, nice.  I just want to run games in-fullscreen and have them axe all other threads while running, perhaps even axe most threads while the game is focused in windowed mode, but when unfocused, allow windows to have all the CPU time it wants.  This sin't so much to ask from a game programming language is it? <br><br></td></tr></table><br>
<a name="666355"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you run it in fullscreen and do not use delay, it should get all the CPU time (beside time that was granted to higher / Highest / realtime priority threads) ... if you add delay then you will have serious problems as delay 1 ms can take longer than 1 ms if a different thread is doing something at that point. This can become especially worse on systems with VSync on when you skip the "right" ms for flipping because it then will have influence on later flips as well (for that reason I do flip 0 time based)<br><br>I assume you used time difference based interpolation for your framework ... and in that case, these differences shouldn't mather that much ... <br><br></td></tr></table><br>
<a name="666369"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ozak</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I agree. Do not mess with OS priorites!!! <br><br></td></tr></table><br>
<a name="666378"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Dreamora: In full-screen there is no delay(1) but some people (not very many at all) are getting jerks due to background tasks, it's the same in windowed mode.  Watching the timer, you can see it make sudden jumps as the game loses CPU time to other tasks, some taking up to 200MS!  My framework can do Flip 0 or 1 (or -1), VSync is on the options page and in the ini file.  VSync on/off makes no difference to the jerks people are seeing because it's due to the timer skipping ahead a lot due to background tasks.  Yes I used time difference based interpolation.<br><br>I still want to mess with OS priorities. <br><br></td></tr></table><br>
<a name="666382"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Grey, if you hog the cpu in window mode you may find you have a very difficult time even getting the focus to switch to a different window because the GUI may not get any time to handle those events. Catch 22.<br><br>I think maybe it's a good thing to try and get your framework as smooth as possible and to deal with other threads interrupting, but I wouldn't lose too much sleep over it. How do you know that the user doesn't WANT there to be other threads running or other apps in the background. Maybe they're playing a game while doing rendering. If they are choosing to put software on their system that takes up CPU time, that's their business, and you can only do so much to prevent it. <br><br></td></tr></table><br>
<a name="666416"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> well I'm really thinking of the causal gamer with a spyware infested PC who plays a BlitzMax game and goes "it's all jerky" and doesn't buy it.  If the performance can be increased on such PCs, then cool. <br><br></td></tr></table><br>
<a name="666419"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Would it work to only use delay if the logic framerate allows so? If lag, then do not do delay? <br><br></td></tr></table><br>
<a name="666426"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grisu</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you use bmx gui with a proper framework there is no need for a delay! <br><br></td></tr></table><br>
<a name="666449"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Liquid</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> It was me that reported this situation to Grey.<br><br>When the framework runs, in fullscreen, with the process priority in HIGH the animation/movement is smooth.<br>Is obvious that this setting should only be done in fullscreen mode. If you are playing a game in fullscreen you expect that the game gets all the speed it needs. I'm not talking about giving the process REALTIME speed. But HIGH can make a huge difference in the performance of the application. <br><br></td></tr></table><br>
<a name="666463"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why talk about it, why not do something about it?<br><br><a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/getcurrentthread.asp" target="_blank">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/getcurrentthread.asp</a><br><a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/setthreadpriority.asp" target="_blank">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/setthreadpriority.asp</a><br><br>There ya go, that'll take you 2 minutes to implement. <br><br></td></tr></table><br>
<a name="666567"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wave: There are still jerks in full-screen mode wih no Delay(1).  Same in windowed mode with Delay(1).<br><br>Grisu: I wanted people to be able to use a framwork that didn't require them to buy blitzMax. After all BlitzMax standalone is supposed to be for game isn't it?<br><br>Tim. Thanks.  When did you have your procrastination gland removed? <br><br></td></tr></table><br>
<a name="666582"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> But HIGH can make a huge difference in the performance of the application. <br></div>True. For instance setting your application to HIGH priority will set it at the same priority as the Client Server Runtime Subsystem, and on a single CPU maching, may prevent it from being scheduled for execution (which may cause STOP errors).<br><br>I'm not sure most spyware infested PC users are going to want to trade a little jerkiness for a BSOD. <br><br></td></tr></table><br>
<a name="666595"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Liquid</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok FlameDuck. Then give the application ABOVE NORMAL priority. <br>That should give extra processing power to the application without harming other tasks. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
