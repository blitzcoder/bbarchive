<!DOCTYPE html><html lang="en" ><head ><title >Net Connection Detection and File Download?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Net Connection Detection and File Download?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Net Connection Detection and File Download?</a><br><br>
<a name="550225"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> 1) Is there a way to detect if a net connection is available without actually trying to use it? IE: I want to know if an internet connection is available without pinging a site or anything else which would trigger a firewall. If there is no connection available, I don't want to do a thing.<br><br>2) How would I go about downloading a file from a website via http in BMax? Opening a stream and reading bytes seems too simple, and probably doesn't account for lag, site failures, a lost connection, etc. I don't want to corrupt the game every time something goes wrong, so what exactly must I and can I do to make this "correct"? <br><br></td></tr></table><br>
<a name="550256"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not strictly BMAX since we have built these functions into our own dll.<br><br>1) Polling the connection will automatically open it even if you are not pinging a host. If there is no network connection at all (no modem or NIC installed then the dll function will return False). Initialising the dll will either open the connection (return True) or return False.<br><br>2) Downloading a complete file could be problematic for the reasons you mentioned, you would either need to stall the program execution whilst you attempted to pull the complete file or (and I am assuming you are talking downloading question files) read them from a database using an SQL query and read the responses into a buffer. When the server response is complete transfer them into the game. The latter can be done in the background and the player could continue to play the game whilst you are checking for and downloading new questions. We do exactly that in the dll for downloading highscores - in reality you could be downloading any information just by altering the script.<br><br>We are not due to release yet but drop me a line if you wanna pre-release test it, I could get you something in a couple of days :D <br><br></td></tr></table><br>
<a name="550270"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tim, I'm up to pre-release test it if it's ok. <br><br></td></tr></table><br>
<a name="550386"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tim, Thanks for the offer. I've been looking through the PB forums and it seems there is some API stuff to detect a connection without opening it, so I may give that a go. Questions are one of the reasons I posted, but I don't really want to go down the SQL road. I would like to use it for other things as well, and they won't always be suitable to be a db. I could live with FTP.<br><br>I see AlienCodec has a patching program out, but it looks like a slightly clunky approach, and with the number of people posting that their support requests are being ignored, I reckon I'll give that a miss.<br><br>I've looked around for any file transfer libraries too, but the only one I found so far is an ActiveX DLL, so no good for BMax. Perhaps I'll look into writing a PB DLL to do it for me. I guess PB supports threads, so that would be ok. <br><br></td></tr></table><br>
<a name="550514"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jamesmintram</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> There is a free http/ftp all in one library out there but I cant remember the name for the life of me!<br><br>But I did find this - which might be some help.<br><br><a href="http://www.codeproject.com/internet/FTPClientClass.asp" target="_blank">http://www.codeproject.com/internet/FTPClientClass.asp</a> <br><br></td></tr></table><br>
<a name="550516"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have written an FTP library for BlitzMAX if you want that.<br><br>If you want to verify the data, find some code to compute a hash for it, download that hash first, then download the data.  Recompute the hash for the data actually downloaded and then compare it against the original hash.  If they match then you can use the file, else it is corrupted.<br><br>I suggest doing some real-world tests to determine whether corruption is a problem first before you go down this route.  It may be the case that the HTTP stream already has enough built-in mechanisms to deal with transmission errors. <br><br></td></tr></table><br>
<a name="550603"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've heard that the Win32 API function <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/wininet/wininet/internetgetconnectedstate.asp" target="_blank">InternetGetConnectedState</a> () isn't always reliable, but I don't think anything is, oddly enough. Anyway, if the Online () function below returns True, you're theoretically online...<br><br>[EDIT: Oops, Win32 only... not progressed to other OSes' API calls yet!]<br><br><pre class=code>
' Function pointer...

Global Online (flagsptr:Int Ptr, reserved)

' Win32 constants...

Const INTERNET_CONNECTION_CONFIGURED = $40
Const INTERNET_CONNECTION_LAN = $02
Const INTERNET_CONNECTION_MODEM = $01
Const INTERNET_CONNECTION_MODEM_BUSY = $08
Const INTERNET_CONNECTION_OFFLINE = $20
Const INTERNET_CONNECTION_PROXY = $04
Const INTERNET_RAS_INSTALLED = $10

' Load wininet.dll and assign function pointer...

wnet = LoadLibraryA ("wininet.dll")
If wnet
	Online = GetProcAddress (wnet, "InternetGetConnectedState")
EndIf

' Flags integer receives details of connection...

Local flags = 0

' Call function...

result = Online (Varptr (flags), 0)

' Show results...

If result

	Print ""
    Print "Connection found!"
    Print ""

    If flags &amp; INTERNET_CONNECTION_CONFIGURED
            Print "Valid connection found"
    EndIf

    If flags &amp; INTERNET_CONNECTION_LAN
            Print "LAN-based connection to internet"
    EndIf

    If flags &amp; INTERNET_CONNECTION_MODEM
            Print "Modem-based connection to internet"
    EndIf

    If flags &amp; INTERNET_CONNECTION_MODEM_BUSY
            Print "No longer used"
    EndIf

    If flags &amp; INTERNET_CONNECTION_OFFLINE
            Print "Currently offline"
    EndIf

    If flags &amp; INTERNET_CONNECTION_PROXY
            Print "Proxy connection to internet"
    EndIf

    If flags &amp; INTERNET_RAS_INSTALLED
            Print "RAS installed"
    EndIf

Else
    Print "Not connected!"
EndIf
</pre> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
