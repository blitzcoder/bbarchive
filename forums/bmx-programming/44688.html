<!DOCTYPE html><html lang="en" ><head ><title >Mappy</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Mappy</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Mappy</a><br><br>
<a name="497480"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gavin Beard</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> has anyone succesfully for a mappy tile map loaded into bmax? if so d'ya wonna share how :) <br><br></td></tr></table><br>
<a name="499532"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> when i read this i thought it would be a good way to cut my teeth on BlitzMax.  i have a mostly finished mappy mod you can download <a href="http://www.ggsoft.biz/mappy.zip" target="_blank">here</a>.  i used pub.mod and it should go in a mappy.mod directory under that.  also with the zip is the isotest converted to use the new MappyMap class.  there are a couple of issues im hoping someone with more knowledge can pick up on what im doing wrong and fix.<br><br>the first is masking which isnt working.  inside of the method MapDecodeBGFX is the code to set the mask information.  the old BB code used the MaskImage command.  i think i gathered enough info from the posts to convert it correctly to use MaskPixmap, but if i didnt then that may be where the problem lies.  also, im not clear on the SetBlend functionality so i may be screwing something up there too.  not sure where or when to use it.  every image used is created manually from information stored in the mappy file.  CreateImage with the MASKEDIMAGE option is being used.  then each pixel is plotted individually.  in any case, the iso example works, but the masking is not.<br><br>the second issue is converting the 6 parameter form of DrawImageRect.  BlitzMax only has 4 parameters and im not sure how to replicate the desired functionality in BlitzMax.  the locations where these are used can be found by searching on the word "PROBLEM".<br><br>anyone feel like taking a look and picking up where i left off? <br><br></td></tr></table><br>
<a name="499555"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> some heated discussions...<br><a href="/posts.php?topic=44234" target="_blank"> link </a><br>and unofficial code fixes...<br><a href="/codearcs.php?code=1241" target="_blank">link </a><br>No official response on whether it will be fixed. <br><br></td></tr></table><br>
<a name="499588"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gavin Beard</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> apart from big purple bits (i'm guessing the masking prob u mention) this is quiet sweet, congrats<br><br>*edit: noticed if i do my own map and use that one then i get and error every time : "Attempt to index array element beyond array length"<br><br>its a 20x20 non iso map <br><br></td></tr></table><br>
<a name="499592"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> thx tonyg.  didnt even think of the code archives!  i also found:<br><br><a href="/codearcs/codearcs.php?code=1250" >Setimagemask</a> <br><br>that appears to replicate the MaskImage of old.  cant wait to try both these solutions out tonite and see how it goes!  and thx gavin :)  cant really take much credit for the code since im just converting, but it is doing wonders for allowing me to learn BMax syntax and such. <br><br></td></tr></table><br>
<a name="499594"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> could you please email me that map?  id like to use it for testing tonite.<br><br>garritt@...<br><br>thx. <br><br></td></tr></table><br>
<a name="499595"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can you use SetMaskColor at load time?<br>Here's a couple of posts which  found a workaround...<br><a href="/posts.php?topic=42105" target="_blank"> first </a><br><a href="/posts.php?topic=41764" target="_blank">second</a><br>and from the code archives...<br><a href="/codearcs.php?code=1250" target="_blank">code archive</a><br>&lt;edit&gt; Mmm synchronised posting. <br><br></td></tr></table><br>
<a name="499602"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmm...  maybe my problem is in the drawing, not the creation?  im going to try storing the mask colors for each image and then writing a Draw routine that does the SetMaskColor, SetBlend, and draw.  things to try :) <br><br></td></tr></table><br>
<a name="499604"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe <a href="/posts.php?topic=42214" target="_blank"> this </a>? <br><br></td></tr></table><br>
<a name="499720"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok... i have made significant advances.  most of the demos have been converted and are working.  the original download link is now the new zip.  the mod is still not completely converted due to DrawImageRect and how i had to accomplish masking.  also, i am still have not looked at the custom map from gavin.<br><br>the masking issue was a curious one.  i decided to get back to basics and just get it to work with a straight image.  i was able to get it working multiple ways, but still could not figure out a way to get it working with an image that was created with CreateImage and WritePixel instead of LoadImage.  what i ended up doing was masking the pixmap that WritePixel was using via MaskPixmap and storing it in the images masks array.  instead of using DrawImage i use DrawPixmap directly from the masks array. <br><br></td></tr></table><br>
<a name="499778"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gavin Beard</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> hey, that certainly is alot better and running quiet well, and my tst map seems to load and display with no probs at all <br><br></td></tr></table><br>
<a name="500226"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kernle 32DLL_2</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> hey would it be possible to create a real bmx modul of mappy<br><br>edit: k, its done,everything works very well <br><br></td></tr></table><br>
<a name="500245"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gavin Beard</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> lol, it sure does... <br><br></td></tr></table><br>
<a name="500604"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> kinda got sidetracked by a wrapper im working on for blitzmax.  i will see if i can clean up the mappy mod and get the DrawImageRect functionality converted.  will probably be a couple days before i get to it. <br><br></td></tr></table><br>
<a name="500619"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >teamonkey</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmm. Under what conditions does it use DrawImageRect? It would be very inefficient if it used it for each tile and I'm not sure why you'd want to draw a small section of a tile if each tile is stored as a separate image. <br><br></td></tr></table><br>
<a name="500628"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> not quite sure what its there for (im just converting the BB code).  its checking some user field properties for the map block and based on that drawing a portion of the image.  all the images are stored inside of the map file and are built upon load via WritePixel.  i would assume its something with how mappy stores the images inside the map file. <br><br></td></tr></table><br>
<a name="500635"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> this is interesting...  do you think the Window method on TPixmap would be a way to replicate the 6 parameter format of DrawImageRect using pixmaps?  so basically i could use a combination of TPixmap.Window() and DrawPixmap to replicate DrawImageRect.  if thats the case i may switch to just using Pixmaps completely. <br><br></td></tr></table><br>
<a name="500637"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >teamonkey</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Pixmaps will be very very slow compared to TImages.<br><br>This function emulates the BlitzPlus/3D DrawImageRect, but I suspect it's best to avoid drawing partial images whenever possible.<br><pre class=code>Function DrawImageRect2(img:TImage, x#, y#, rx#, ry#, rw#, rh#, frame=0)
	Local vx, vy, vw, vh
	GetViewport(vx, vy, vw, vh)
	
	SetViewport(x, y, rw, rh)
	DrawImage(img, x-rx, x-ry, frame)
	
	SetViewport(vx, vy, vw, vh)
End Function</pre> <br><br></td></tr></table><br>
<a name="500639"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> thx for the reply TM.  <br><br>thats unfortunate considering the only way i could get masking to work on an created image (using CreateImage) was to draw its pixmap directly.  do you have any ideas on a resolution or maybe provide an example of drawing a masked image that was created using CreateImage and WritePixel?  i can get masking to work fine using LoadImage, but since images are loaded pixel by pixel from the mappy file i have to use CreateImage.  <br><br>also, for the "thats good to know" section, what is the reason for the slowness of using DrawPixmap? <br><br></td></tr></table><br>
<a name="500648"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dynaman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; also, for the "thats good to know" section, what is the reason for the slowness of using DrawPixmap?<br><br>I'm sure I have the technical names wrong, but a pixmap is stored in regular system memory while an image is stored on the video card's memory. <br><br></td></tr></table><br>
<a name="500650"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> thx dynaman :)  i also found this to go along with that:<br><br><a href="/posts.php?topic=41641" target="_blank">DrawPixmap slows down?</a><br><br>still at a loss at how to get masks working with CreateImage :(<br><br>edit:  ive been able to get masking working with LoadImage either by using SetMaskColor() before loading or using the SetImageMask function from the code archives, but when i try SetImageMask on an image created by CreateImage or try using lock/maskpixmap/unlock, the masking simply wont work for me. <br><br></td></tr></table><br>
<a name="500661"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> after analyizing some of the Max2D and GLMax2D code, ive got a new lead im going to try.  im going to attempt to manually create the frame from the masked pixmap.  im already storing the masked pixmap back to the masks array.  from the code i have seen, i also need to store the masked frame as well. <br><br></td></tr></table><br>
<a name="500671"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dynaman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> This should work, I had submitted it to the code archives under graphics a while ago.<br><br><br><pre class=code>
Function setimagemask(p_image:Timage, p_red,p_green,p_blue)
	Local l_maskrgb
	Local l_maskargb
	Local l_pixelrgb
	Local l_pixelraw
	Local l_x,l_y
	Local l_pix1:Tpixmap
	
	l_maskrgb = p_red * 65536 + p_green * 256 + p_blue
	l_pix1 = LockImage(p_image)
	For l_x = 0 To ImageWidth(p_image)
		For l_y = 0 To ImageHeight(p_image)
			l_pixelraw = ReadPixel(l_pix1,l_x,l_y)
			l_pixelrgb = l_pixelraw &amp; 16777215
			If l_pixelrgb = l_maskrgb Then
				WritePixel(l_pix1,l_x,l_y,l_maskrgb)
			End if
		Next 
	next

	UnlockImage(p_image)
	Release l_pix1
End function
</pre> <br><br></td></tr></table><br>
<a name="500682"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> i tried that and it worked beautifully for an image loaded with LoadImage...  but when i tried it on an image created with CreateImage it ran without error, but it would not draw the image with the mask for some reason. <br><br></td></tr></table><br>
<a name="500687"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dynaman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'll have to give it another go tonight, maybe something has changed with the latest updates.  I'm using this in particular for images that are created.<br><br>I didn't make it clear, but this needs to be run after the image is updated with something, so first you would create the image, then draw whatever you plan to draw onto the image, and then run this command. <br><br></td></tr></table><br>
<a name="500701"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmmm.  that is exactly what i was trying...  hate to ask this but could you give a complete working example?  maybe there is a Set command i am missing or something beyond the scope of creating.  my code is basically like:<br><br>CreateImage<br>pixmap=LockImage<br>WritePixel in loop<br>UnlockImage<br>SetImageMask<br><br>doing this, i cannot get the mask working.  from your example im hoping to glean what i am missing, whether it be a missing Set command or missing flags. <br><br></td></tr></table><br>
<a name="500708"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dynaman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> You look like your doing it correct.  I'll give this a shot tonight and post a complete example. <br><br></td></tr></table><br>
<a name="500717"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> whoooo!  i think i have it :)  have to wait a few for a full run but here is the solution:<br><br><pre class=code>
Method MaskImage(img:TImage,red:Int=0,green:Int=0,blue:Int=0,frame:Int=0)
	Local pixmap:TPixmap=LockImage(img,frame)
	pixmap=MaskPixmap(pixmap,red,green,blue)		
	UnlockImage(img,frame)
	img.frames[frame]=blitz2d_driver.CreateFrameFromPixmap(pixmap,img.flags)
EndMethod
</pre> <br><br></td></tr></table><br>
<a name="500787"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok, the mappy mod is complete (i think).  its pretty much a straight conversion with a few new tweaks:<br><br>a) everything is wrapped up into a class, so no global vars to worry about<br><br>b) maxmaplayers defaults to 2, but is a parameter to loadmap now<br><br>c) i added the sample functions Collision() and PPCollision() to the MappyMap class as MapCollision() and MapPPCollision()<br><br>i fixed the drawing to use images instead of pixmaps (masking works!) and its much faster.  i also completed the MapFlushMem method and added that to all the examples.  the ZIP has been updated and can be downloaded <a href="http://www.ggsoft.biz/mappy.zip" target="_blank">here</a>.  have fun everyone :)  if you see any problems please let me know.<br><br>and thanks for all the replies.  the active and helpful blitz community is one of major reasons i decided to get into blitz in the first place :) <br><br></td></tr></table><br>
<a name="501289"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gavin Beard</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> works a treat, thanks gman <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
