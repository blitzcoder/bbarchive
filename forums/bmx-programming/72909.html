<!DOCTYPE html><html lang="en" ><head ><title >record with OpenAL</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >record with OpenAL</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >record with OpenAL</a><br><br>
<a name="815010"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vignoli</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello !<br><br>I would like to know if there is a simple tutorial to record a sound in a buffer with OpenAL with Bmax.<br><br>I've found a tutorial in C++ on the web but nothing in Bmax. <br><br></td></tr></table><br>
<a name="815064"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vignoli</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks a lot...................... <br><br></td></tr></table><br>
<a name="815073"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >iprice</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> There isn't. Satisfied? <br><br></td></tr></table><br>
<a name="815089"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vignoli</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks again !! <br><br></td></tr></table><br>
<a name="815098"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vignoli</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, no support for Bmax, i've lost my money... "je change de crèmerie !" <br><br></td></tr></table><br>
<a name="815101"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LarsG</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is OpenAL fully wrapped in a BMax module? <br><br></td></tr></table><br>
<a name="815139"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tom</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'll have max next week some time, I'll be porting my B3D openal code/knowledge over to max. <br><br></td></tr></table><br>
<a name="815143"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vignoli</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't understand your question, LarsG. Sorry.<br>(I'm from Corsica and my english speaking is poor)<br><br>My problem is simple : I'm working on A.I systems, and i must do some experiences sometime.<br>So, now, i try to make communicate two computers ( one with windows, one with linux) with a very simplified system via microphones and speakers. (like a human can do with ears and mouth)<br><br>When one of the computer will need to talk (with squares wav files), the other will have to recognise the frequency, etc...<br><br>This is not so hard but i can't record anything with Bmax for now.<br><br>A little help will be very appreciated.<br>If nothing is possible at this time, thanks to tell me it. <br><br></td></tr></table><br>
<a name="815145"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vignoli</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Tom ;-) <br><br></td></tr></table><br>
<a name="815157"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vertex</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> List input devices:<br>alcGetString(Null, ALC_CAPTURE_DEVICE_SPECIFIER)<br><br>Default input device:<br>alcGetString(Null, ALC_CAPTURE_DEFAULT_DEVICE_SPECIFIER)<br><br>Open device:<br>alcCaptureOpenDevice(...)<br><br>Start recording:<br>alcCaptureStart(...)<br><br>Stop recording.<br>alcCaptureStop()<br><br>Get number of captured samples<br>alcGetIntegerv(Recorder, ALC_CAPTURE_SAMPLES, 4, Varptr(NumSamples))<br><br>Get samples:<br>alcCaptureSamples(...)<br><br>Very easy ^^<br>cu olli <br><br></td></tr></table><br>
<a name="815169"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vignoli</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks a lot Vertex :-) <br><br></td></tr></table><br>
<a name="815181"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vignoli</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've done that finally. It works a little but not perfectly.<br>Does someone see the problem, please ? (just test to listen what is the problem.)<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
'====================================
'          square reptile
'====================================

' record test

If OpenALInstalled()=False Then RuntimeError "You need to install OpenAL !"
EnableOpenALAudio()
SetAudioDriver("OpenAL")

Global Device
Global CaptureDevice
Device=alcOpenDevice(Null)

If Device=Null Then RuntimeError "No access to OpenAL Device !"

Local flag=InitCapture()
If flag=False Then  RuntimeError "No access to OpenAL capture Device !"


Graphics 640,480,0
SeedRnd MilliSecs()
SetClsColor 0,0,0
SetColor 255,255,255

Cls
DrawText "push [RETURN] to start 5 seconds of recording",0,0
Flip

Global sample:TAudioSample=CreateAudioSample(44100*5*2,44100,SF_MONO16LE)


Global NumSamples:Int
Global sound

While KeyDown(KEY_RETURN)=0
	If KeyDown(KEY_ESCAPE)=1
		ShutdownOpenAL()
		End
	EndIf
Wend
Cls
DrawText "RECORDING...",0,0
Flip

alcCaptureStart(CaptureDevice)
Delay 5000
alcCaptureStop(CaptureDevice)
alcGetIntegerv(CaptureDevice, ALC_CAPTURE_SAMPLES, 4, Varptr(NumSamples))
alcCaptureSamples(CaptureDevice, sample.Samples, NumSamples)

sound=LoadSound( sample,False )

Cls
DrawText "PLAYING...",0,0
Flip

PlaySound sound
Delay 5000

ShutdownOpenAL()

End

'============================================================================================

Function InitCapture()

    If (alcIsExtensionPresent(Device, "ALC_EXT_CAPTURE") = AL_FALSE) Then Return False

    CaptureDevice = alcCaptureOpenDevice(Null, 44100, AL_FORMAT_MONO16, 44100*5*2);
    If Not(CaptureDevice) Then Return False

    Return True
EndFunction


Function ShutdownOpenAL()
    alcCloseDevice(CaptureDevice)
    alcCloseDevice(Device)
EndFunction
</textarea> <br><br></td></tr></table><br>
<a name="815477"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vertex</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> My test:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">SuperStrict

Framework Vertex.OpenAL

Const SECONDS : Int = 5

Global Specifiers       : String[], ..
       Specifier        : String, ..
       DefaultSpecifier : String, ..
       Index            : Int, ..
       Input            : String, ..
       Recorder         : Byte Ptr, ..
       Samples          : Byte Ptr, ..
       NumSamples       : Int

Global AudioDevice      : Byte Ptr, ..
       Context          : Byte Ptr, ..
       Source           : Int, ..
       Buffer           : Int, ..
       State            : Int

Try

TOpenAL.Init()

' Recorder
Specifiers = EnumDevices(ALC_CAPTURE_DEVICE_SPECIFIER)
If Not Specifiers Then Throw("No recorders where found")
DefaultSpecifier = String.FromCString(..
                    alcGetString(Null, ALC_CAPTURE_DEFAULT_DEVICE_SPECIFIER))

WriteStdout("Recorders~n")
For Index = 0 Until Specifiers.Length
	Specifier = Specifiers[Index]
	WriteStdout(" " + (Index + 1) + ") " + Specifier)
	If Specifier = DefaultSpecifier Then
		WriteStdout("(Default)~n")
	Else
		WriteStdout("~n")
	EndIf
Next

WriteStdout("Index: ") ; Input = ReadStdin()
If Input Then
	Index = Input.ToInt()
	If Index &lt; 1 Or Index &gt; Specifiers.Length Then ..
		Throw("Index out of range")
	Specifier = Specifiers[Index - 1]
Else
	Specifier = DefaultSpecifier
EndIf

Recorder = alcCaptureOpenDevice(Specifier, 44100, AL_FORMAT_MONO16, ..
                                SECONDS*44100*2)
If Not Recorder Then Throw("Unable to open recorder")

Samples = MemAlloc(SECONDS*44100*2)

' Audio Output
AudioDevice = alcOpenDevice(Null)
If Not AudioDevice Then Throw("Unable to open audio output device")

Context = alcCreateContext(AudioDevice, Null)
If Not Context Then Throw("Unable to create audio context")

If Not alcMakeContextCurrent(Context) Then ..
	Throw("unable to make context current")

alGenSources(1, Varptr(Source))
alGenBuffers(1, Varptr(Buffer))

' Start recording
alcCaptureStart(Recorder)
Repeat
	alcGetIntegerv(Recorder, ALC_CAPTURE_SAMPLES, 4, Varptr(NumSamples))
	WriteStdout(NumSamples + "/" + SECONDS*44100 + " Samples~n")
	Delay(100)
Until NumSamples &gt;= SECONDS*44100
alcCaptureSamples(Recorder, Samples, NumSamples)

' Stop recording
alcCaptureStop(Recorder)

' Output
alBufferData(Buffer, AL_FORMAT_MONO16, Samples, NumSamples*2, 44100)
alSourcei(Source, AL_BUFFER, Buffer)

alSourcePlay(Source)
Repeat
	alGetSourcei(Source, AL_SOURCE_STATE, Varptr(State))
Until State &lt;&gt; AL_PLAYING

Catch Exception : Object
	WriteStdout("~nError:~n " + Exception.ToString())
End Try

alSourceStop(Source)
alDeleteSources(1, Varptr(Source))
alDeleteBuffers(1, Varptr(Buffer))
alcMakeContextCurrent(Null)
alcDestroyContext(Context)
alcCloseDevice(AudioDevice)
alcCaptureCloseDevice(Recorder)

WriteStdout("~nready~n")
End

Function EnumDevices:String[](Device:Int)
	Local Devices : Byte Ptr, ..
	      List    : String[]

	Devices = alcGetString(Null, Device)
	If Not Devices Then Return Null

	While Devices[0]
		List = List[..List.Length + 1]
		List[List.Length - 1] = String.FromCString(Devices)
		Devices :+ List[List.Length - 1].Length + 1
	Wend

	Return List
End Function</textarea><br><br><a href="http://vertex.dreamfall.at/openal/openal103.zip" target="_blank">http://vertex.dreamfall.at/openal/openal103.zip</a><br>(Does only work on Windows and maybe Linux) <br><br></td></tr></table><br>
<a name="815571"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vignoli</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks a lot Vertex ! :-)<br>You saved me ! ;-) <br><br></td></tr></table><br>
<a name="830766"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jhocking</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am trying to record sounds for a project I am working on right now and this information is very useful.  However, I'm unclear on why Vignoli's code was behaving odd, and I don't really want to use Vertex's special framework because I would like to run this on either Windows or Mac.<br><br>Could someone explain why that first example was giving weird results?  Vertex appears to be using alSourcePlay for playing the recorded sound, but I don't understand how that works.<br><br>ADDITION: gah now my ears are ringing and I have a headache because I screwed with the audio format and had the volume all the way up <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
