<!DOCTYPE html><html lang="en" ><head ><title >Can I Force the GC to Collect?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Can I Force the GC to Collect?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Can I Force the GC to Collect?</a><br><br>
<a name="803802"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is there some better way to force the Garbage Collector to Collect than using GCCollect()? Or indeed a better way to use GCCollect()?<br><br>I ask because my TrueVision3D module has to clean up after objects in delete methods. There is no user friendly alternative to this, sadly. If I don't do this, I'll have to completely ditch automatic garbage collection and force everyone to explicitly destroy everything. Which - even if I fancied it - goes a bit against the grain in a language which is supposedly superior because it has a GC.<br><br>So with my reasons justified, here's what I'm doing now. When I shut down the engine, the user may still have some TV objects floating around which haven't been disposed of, right? So I don't want those being called now, do I? Because the engine isn't there, so it will crash. So it seems like the best solution is to call GCCollect immediately before you shut down the engine, right? Then everything goes through, nothing is left behind, right? Doesn't work. Believe me, I wish it worked, but it doesn't. I can call GCCollect() as many times as I like but it won't flush some of these objects. <br><br>Hopefully not too many people are experiencing this, but if I am, they will soon enough. What else is there for me to do apart from call GCCollect()? ( and tell them to do the same,  obviously. )<br><br>And no, I don't have any loose references flying around. The GC just seems to reach a point where it doesn't want to flush anything for a while, then a little time later, it will explode on a GCCollect trying to tell TV to free something that doesn't exist. <br><br></td></tr></table><br>
<a name="803814"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> are you sure you didn't have any cyclic reference in.<br><br>Although even then: if you can still access them to call them and break something, how shall they actually be removed? They aren't garbage :)<br><br>So any chance you broke the ref count somewhere or forgot about assignements you do within your wrapping code that you don't break up? (like callink tlink.remove on a link that is a field of an object without setting the link = null afterwards to free the cyclic reference) <br><br></td></tr></table><br>
<a name="803821"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> GCCollect seems to work in simple cases for me.  I've made cyclic references and seen it fail too.<br><br>Presume you read this too:<br><br><a href="http://www.blitzbasic.com/Community/posts.php?topic=71840" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=71840</a> <br><br></td></tr></table><br>
<a name="803849"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> are you sure you didn't have any cyclic reference in. <br></div><br>Yes, these particular objects only *ever* have one reference and it's most assuredly gone before the GCCollect call.<br><br><div class="quote"> Presume you read this too: <br></div><br>Yes, but I had bad experiences with playing with the GC mode. Strange random bugs which go away magically without being fixed and then new ones which come in. Took me ages to track down the issues, and even now I'm not 100% sure what was wrong and if it's fixed. I figured a GCCollect() took precendence over aggressive automatied collection anyway, but perhaps I'm wrong.<br><br>Definitely no cyclic references though. It just seems that the GC doesn't want to collect them until a certain time after they're ripe for collection. <br><br></td></tr></table><br>
<a name="803854"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> If I understand your problem, the Delete methods of TV3D <b>MUST</b> called before the TV3D engine can be closed, but the GC isnt bothering to call them?<br><br>so errrm guess ok<br><br>Create a load of dummy varaiables allocated to 0 or something, then unalloce them, then call GCCollect() <br><br></td></tr></table><br>
<a name="803861"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> variables are not GC driven.<br>Only objects are.<br><br><br>Gabriel: I found out by accident (when checking for something on the german module board), that there is a GC mode -1, called "aggressive" in the c sources.<br>You might try and check what this one does.<br><br><br>I don't see a reason why it should not work, unless you are really trying to call a kill function in the delete of the object which is a highly critical action that you should never do<br>Destruction handling is something that you should call manually, the delete should only operate on its own data, not on external data as the destruction order is something you can NOT depend on.<br><br>ie<br>obj1 = null<br>obj2 = null<br><br>does not mean that obj1 delete is called before obj2, it might as well be vice versa or in any other order with other objects. (just as an example)<br>perhaps thats creating your problem. <br><br></td></tr></table><br>
<a name="803865"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>obj1 = null<br>obj2 = null<br><br>does not mean that obj1 delete is called before obj2<br> <br></div><br>No, it doesn't, but<br><br>obj1 = null<br>GCCollect()<br>obj2 = null<br><br>Should ensure that it is. ( Well not literally obviously as local variables don't go out of scope until the end of the function or whatever, but you get my point. I'm manually calling GCCollect after the object(s) I expect to be destroyed before I go any further, and they're not.<br><br><div class="quote"> <br>Create a load of dummy varaiables allocated to 0 or something, then unalloce them, then call GCCollect()  <br></div><br>Sure, that's worth a shot. I'm assuming you mean dummy objects, but yeah, maybe it'll help. <br><br></td></tr></table><br>
<a name="803881"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep, I mean Objects. I in error nearly always refer to an instance as a "Variable" even if it has ten million fields. <br><br></td></tr></table><br>
<a name="803885"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> yep when doing GC testing it's important to make sure that you are not trying to GCCollect a local var as it won't be collected until it exits the scope.  This threw me in early testing. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
