<!DOCTYPE html><html lang="en" ><head ><title >String Pointers</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >String Pointers</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >String Pointers</a><br><br>
<a name="1131109"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hours and hours and hours on Google, and nothing.<br><br>I'm getting in to this BMax thing and the pointers system is very tricky.  I'm fresh from Blitz3D.  Am I being stupid?<br><br><br>I've manged to: Access a string's contents from it's pointer<br><br>I need to: discern the string's length from it's pointer<br><br>The first four bytes from the pointer are the same no matter the string length or contents, and the string characters aren't terminated in a predictable way.<br><br>If you're wondering what this is all about, I'm making a console system with a list of console variables which are really pointers to BMax variables.  I've got it working for all standard data types except string.  So far it's reading the numerical variables fine, and I don't even know how I'm going to set variables using just the pointer...<br><br>Any info would be great.  I'm at a stand-still.  ;/ <br><br></td></tr></table><br>
<a name="1131118"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> i'm curious t know why you can just use the built-in string Length method. Anyway, can't help here but taking a look to the implementantion of the Lenth method in the BlitzMax source code can enlighten you. Also, you can use the toCString method to have zero terminated strings, but you'll have to handle references to them manually, as they're unmanaged and never collected by the GC. <br><br></td></tr></table><br>
<a name="1131119"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've tried the FromCString thing...  Can't really get better results with it.<br><br>Length method?  Okay... imagine you have a string but you also need to manipulate it purely with a pointer to it.  There's no length method to go with the pointer.  See the problem?<br><br>I have a list of console variable objects, with these fields:<br><br>VariableName:String<br>VariablePointer:Byte Ptr<br><br>The system is so that you can access BMax variables from within an in-game console.  I could of course just have a VariableValue$ field but that's not very portable.<br><br>Say you have a variable like Gravity:float... and you want the in-game console to be able to maniipulate it... I'd use:<br><br>Global Gravity:Float<br>AddCVar "Gravity",Gravity<br><br>I don't know if you're familiar with in-game consoles...  Well anyway, I've scoured the source code for something that handles the string type and I just can't find it.  Do you know where it will be? <br><br></td></tr></table><br>
<a name="1131147"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Strings are immutable in BlitzMax so you can't modify them in place. <br><br>Even if you find a way of poking around and changing their value you will just end up causing the garbage collector to explode at some random amount of time in the future. <br><br></td></tr></table><br>
<a name="1131149"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Haha, it was really starting to seem like that.  Okay, thanks a lot.  I'll do it the slightly less convenient way. <br><br></td></tr></table><br>
<a name="1131151"></a>

<a name="1131153"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> If I understand what you're trying to do....<br><br>All strings in a game written in c/c++ should end with a Null character. You only need to pass the length if you don't use a Null on the end. You'd have to convert back to a string to then find its length.<br><br>To pass out a string you can use<br><br>StringPtr:Byte Ptr = "String Variable".ToCString()<br>MemFree StringPtr 'remember to use this to free the memory<br><br>This will allocate some new space in memory and the StringPtr variable will be that address which holds a C style Null terminated string of characters, so it has the extra Null on the end. Because this allocates new memory you need to free that yourself with MemFree.<br><br>To get a string back from memory you could use<br><br>Variable$ = String.FromCString( StringPtr )<br>Print Variable$.Length 'Length MINUS the Null character.<br><br>Hope this helps.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1131156"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeh, but it's supposed to be able to casually link to any BMax string.  There's no "passing out", if I understand your meaning of that.<br><br>There's just:<br><br>Global astring$ = "test string contents"<br>AddCVar "teststring", astring$<br><br>Then in-game, in the console, type "echo teststring" and it should print "test string contents" <br><br></td></tr></table><br>
<a name="1131160"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just keep well away from brl.mod/blitz.mod/blitz_string.h and you should be OK. <br><br></td></tr></table><br>
<a name="1131162"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah, cheers.  Weird that the struct doesn't match my experience at all.<br><br>struct BBString{<br>	BBClass*	clas;<br>	int		refs;<br>	int		length;<br>	BBChar	buf[];<br>};<br><br>From the pointer, the structure I'm seeing is 4 bytes that are always the same (probably a class signal), then the character data, and some unpredictable yet often similar characters that I'm too scared to mess with. <br><br></td></tr></table><br>
<a name="1131166"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Strings are treated as objects so you'd need to handle the strings differently by converting them to a mem address via the method I suggested, which then breaks your idea of 'casually linking' unfortunately. <br><br></td></tr></table><br>
<a name="1131172"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I wish it was just:<br><br>Local Name$<br>Local NamePointer:TPointer = GetPointer(Name$)<br>NamePointer.SetData "Mandy"<br><br><br>At least I've got it working with numericals.  I'll just have two kinds of console variable.  Linked numerical ones, and console string variable types that contain the string field instead of linking to a string.  Really makes it inelegant. <br><br></td></tr></table><br>
<a name="1131176"></a>

<a name="1131178"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's worth playing around with your idea, I'm sure it could be made to work, but you may need to tread carefully.<br><br>A long while ago I saw some BMax code that was indexing into a c++ vtable to alter class method pointers and stuff, seemed like real voodoo at the time as I didn't understand it back then, so anway, I'm sure this can be done with some good knowledge and coding and some time experimenting, but as far as 'out of the box BMax' goes.... it doesnt support this.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1131179"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good knowledge isn't one of my assets <br><br></td></tr></table><br>
<a name="1131187"></a>

<a name="1131197"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you want to manipulate BlitzMax variables at runtime, from a console or the like, I would suggest you to use Reflection. This will give you access, not only to varibles, but also to classes and you'll be able to call methods and functions, etc. I think it is a much more convenient way to do that without breaking garbage collection.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1131191"></a>

<a name="1131193"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> BTW, I have it working with a sort of work-around, but I dunno how reliable it is.<br><br>String data, directly read from 4 bytes after the pointer, so far, has always ended in a char with a 4-or-5 digit code always starting with 37##.  So, I've actually had it working this whole time but I've no idea if it's safe to rely on strings always being terminated with such a character.  Like I said, I can get to the data.  It's just the string length I can't reliably discern.<br><br>My whole idea is prolly pointless anyway because, even if I figure out how to get string length etc, I don't even know where to start when it comes to SETTING the data instead of just getting it.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1131192"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Reflection... Don't know anything about that.  Eugh, too tired to look in to it now.  I'll investigate reflection tommorow.  cheers. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
