<!DOCTYPE html><html lang="en" ><head ><title >Network library with guaranteed UDP?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Network library with guaranteed UDP?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Network library with guaranteed UDP?</a><br><br>
<a name="702231"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ozak</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any good cross-platform bmx libraries out there? <br><br></td></tr></table><br>
<a name="702269"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> gnet or BNetEx <br><br></td></tr></table><br>
<a name="702560"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ozak</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I can't seem to find BNetEx. All links I can find are dead? <br><br></td></tr></table><br>
<a name="702981"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RepeatUntil</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't think gnet has garanteed UDP, or ??? (as it is based on ENET, maybe it's implemented ?) <br><br></td></tr></table><br>
<a name="702989"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >errno!</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> BNetEx <br></div><br>Bnet only supports unreliable udp. You would need to code an ack type system for safe udp. <br><br></td></tr></table><br>
<a name="702994"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ozak</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Checked out enet. It has guaranteed UDP and looks pretty cool actually. With bandwidth control and stuff.<br>I'll look into it some more and get back to you :) <br><br></td></tr></table><br>
<a name="703091"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >smilertoo</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> isnt the point of UDP is that its not guaranteed? just fire and forget and hope it gets there. <br><br></td></tr></table><br>
<a name="703093"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes and no.<br><br>The main reason to use UDP is that you can enable guaranteed only on important messages but not on unimportant stuff.<br>That way you can have high frequency where needed but as well guaranteed receive where needed (login message for example) <br><br></td></tr></table><br>
<a name="703194"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ozak</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I wrapped ENet in a simple class in about 10 mins and it works like a charm :) <br><br></td></tr></table><br>
<a name="703339"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >RepeatUntil</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Enet is ALREADY wrapped with BlitzMax !!! This was done by Mark Sibly 6 months ago, and used in gnet. However, I am not sure if it was 100% wrapped?? <br><br></td></tr></table><br>
<a name="703340"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ozak</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> GNet is not what I was looking for ;)<br><br>It's not a 100% wrapped, the ping functions among others are missing.<br>I might have a go at it later, but for now my own wrapper is just what I need :) <br><br></td></tr></table><br>
<a name="704109"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jay Kyburz</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> are you going to post it for us? <br><br></td></tr></table><br>
<a name="704160"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Booticus</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Never done anything multiplayer, but Wave's TNet:<br><br><a href="http://www.truplo.com/TNet/" target="_blank">http://www.truplo.com/TNet/</a><br><br>Dunno about guaranteed UDP, it says "reliable". :) <br><br></td></tr></table><br>
<a name="704185"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ozak</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's not reliable.<br><br>Here's my wrapper.<br>You'll still need the occasional ENet function tho.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

SuperStrict

' ENet wrapper on top of ENet by Odin Jensen (Some borrowing from gnet ;)
' Inherit and override On* funcs to get it off the road :)
Type TENetModule

	' ENet host
	Field _enetHost:Byte Ptr
	
	' Events list
	Field _enetEvents:TList=New TList
	
	' Current unique ID
	Field _uniqueID:Long = 0
	
	' Start server at given port
	Method Host%(port%, maxClients% = 32, incomingLimit% = 0, outgoingLimit% = 0)
	
		' Create server 
		Local addr:Byte Ptr=enet_address_create(ENET_HOST_ANY, port)
		_enetHost=enet_host_create(addr, maxClients, incomingLimit, outgoingLimit)
		enet_address_destroy(addr)
		
		' Failed?
		If (Not _enetHost)
		
			Return False
		
		End If
	
		' All went well
		Return True
		
	End Method
	
	' Connect to server at given address/port
	Method Connect%(address:String, port%, timeout%=10000, incomingLimit% = 0, outgoingLimit% = 0)
	
		' Create client host
		_enetHost=enet_host_create(Null, 32, incomingLimit, outgoingLimit)
		
		' Failed?
		If (Not _enetHost)
		
			Return False
			
		End If
		
		' Attempt connection
		Local addr:Byte Ptr=enet_address_create(HostIp(address),port)
		Local peer:Byte Ptr=enet_host_connect(_enetHost,addr,1)
		enet_address_destroy(addr)
		If (Not peer)
		
			Return False
			
		End If
		
		timeout:+MilliSecs()
		
		While (timeout-MilliSecs() &gt; 0)
		
			UpdateENetEvents(0)
			
			For Local ev:ENetEvent=EachIn _enetEvents
			
				If (ev.event=ENET_EVENT_TYPE_CONNECT And ev.peer=peer)
					
					OnConnect(ev)
					_enetEvents.Remove(ev)
					Return True
					
				EndIf
				
			Next
			
		Wend
	
		' No go bub
		Return False
		
	End Method
		
	' Disconnect
	Method Disconnect(peer:Byte Ptr)
	
		enet_peer_disconnect(peer)
		
	End Method
	
	' Get unique ID
	Method GetUniqueID%()
	
		_uniqueID:+1
		Return _uniqueID
	
	End Method
	
	' Send packet
	Method Send%(peer:Byte Ptr, data:Byte Ptr, dataLen%, reliable%=True)
		
		' Which flag?
		Local flag% = ENET_PACKET_FLAG_RELIABLE
		
		' Unrealiable packet requested?
		If (Not reliable)
		
			flag = 0 ' This correct? Need to check ENet source one day :)
		
		End If
	
		' Build packet
		'Local buf:Byte Ptr=MemAlloc(dataLen)
		'MemCopy(buf, data, dataLen)
		Local packet:Byte Ptr=enet_packet_create(data, dataLen, flag)
		
		'MemFree(buf)
		
		' Attempt send
		If (enet_peer_send(peer, 0, packet) &lt; 0)
		
			Return False
			
		End If
		
		' All went well
		Return True 
		
	End Method

	' Shutdown
	Method Shutdown()
	
		' Destroy ENet stuff
		enet_host_flush(_enetHost)
		enet_host_destroy(_enetHost)
	
	End Method
	
	' Update ENet events
	Method UpdateENetEvents(timeout%=0)
	
		' Loop as long as there's messages waiting in line
		Repeat
		
			Local ev:ENetEvent=New ENetEvent
			If (Not enet_host_service(_enetHost,ev,timeout)) Return
			_enetEvents.AddLast(ev)
			
		Forever
		
	End Method
	
	' Update
	Method Update(timeout%=0)
	
		' Get messages
		UpdateENetEvents(timeout)

		' Loop until no more packets left		
		Repeat	
			
			' Time to leave eternal loop?	
			If (_enetEvents.IsEmpty()) Return
			
			' Get next event
			Local ev:ENetEvent=ENetEvent(_enetEvents.RemoveFirst())
		
			' Check out event type
			Select(ev.event)
				Case ENET_EVENT_TYPE_CONNECT	
					OnConnect(ev)		
				Case ENET_EVENT_TYPE_DISCONNECT
					OnDisconnect(ev)
				Case ENET_EVENT_TYPE_RECEIVE
					OnDataRecieved(ev)
			End Select
				
		Forever
	
	End Method
	
	' Called on new connection
	Method OnConnect(ev:ENetEvent) Abstract
	
			
	' Called on disconnect
	Method OnDisconnect(ev:ENetEvent) Abstract
	
	' Called when data recieved (Remember to enet_packet_destroy() packet, when you're done!)
	Method OnDataRecieved(ev:ENetEvent) Abstract

End Type


</textarea><br><br>So you need to call update and you get callbacks when stuff happens.<br>This  might come in handy too:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SuperStrict

' Network packet for easier handling of banks (C)2006 Odin Jensen
Type TNetPacket

	Field bank:TBank
	Field curOffset%=0

	' Init packet
	Method Init(size%=512)
	
		Self.bank = CreateBank(size)
	
	End Method
	
	' Rewind
	Method Rewind()
	
		curOffset = 0
	
	End Method
	
	' Bank to string
	Method BankToString:String(bank:TBank)
	
		Local ret:String = ""
		For Local i:Int = 0 To BankSize(bank)-1
		
			ret:+Chr(PeekByte(bank, i))
		
		Next
		
		Return ret
	
	End Method
	
	' Create from ENet packet
	Method FromENetPacket(packet:Byte Ptr)
	
		Local buf:Byte Ptr=enet_packet_data( packet )
		Local size%=enet_packet_size( packet )
		
		ResizeBank(Self.Bank, size)
		MemCopy(Lock(), buf, size)
		Unlock()
		
		Rewind()
	
	End Method
		
	' Get offset
	Method GetOffset%()
	
		Return curOffset		
	
	End Method
	
	' Get size
	Method GetSize%()
	
		Return BankSize(bank)
		
	End Method
	
	' Lock it
	Method Lock:Byte Ptr()
	
		Return LockBank(bank)
		
	End Method
	
	' Unlock
	Method Unlock()
	
		UnlockBank(bank)
	
	End Method
	
	' Write integer
	Method WriteInt(value%)
		
		If (curOffset+4 &gt;= GetSize())
		
			ResizeBank(bank, GetSize()+8)
			DebugLog("Bank resize!")
		
		End If
	
		PokeInt(bank, curOffset, value)
		curOffset:+4
	
	End Method
	
	' Write string
	Method WriteString(value:String)
	
		Self.WriteInt(value.length)
		
		If (curOffset+value.length &gt;= GetSize())
		
			ResizeBank(bank, GetSize()+(value.length*2))
			DebugLog("Bank resize!")
		
		End If
		
		For Local i:Int = 0 To value.length
			
			PokeByte(bank, curOffset+i, value[i])
		
		Next
		curOffset:+value.length
		
	End Method
	
	' Write float
	Method WriteFloat(value:Float)
	
		If (curOffset+4 &gt;= GetSize())
		
			ResizeBank(bank, GetSize()+8)
			DebugLog("Bank resize!")
		
		End If
	
		PokeFloat(bank, curOffset, value)
		curOffset:+4
		
		'DebugLog("NetPacket: Wrote float (" + value + ")")
	
	End Method
	
	' Read integer
	Method ReadInt%()
	
		Local ret%=PeekInt(bank, curOffset)
		curOffset:+4
		Return ret
	
	End Method
	
	' Read string
	Method ReadString:String()
	
		Local size% = Self.ReadInt()
		Local ret:String = ""
		For Local i:Int = 0 To size-1
			
			ret:+Chr(PeekByte(bank, curOffset +i))
		
		Next
		curOffset:+size
		
		Return ret
	
	End Method
	
	' Read float
	Method ReadFloat#()
	
		Local ret:Float = PeekFloat(bank, curOffset)
		curOffset:+4
		'DebugLog("NetPacket: Read float (" + ret + ")")
		Return ret
	
	End Method

End Type
</textarea><br><br>Send with<br><br><pre class=code>

' Send it good
SendPacket.Rewind()
SendPacket.WriteInt(SOME_PACKET_ID)
SendPacket.WriteString("Hello!")
Send(player.peer, SendPacket.Lock(), SendPacket.GetOffset())
SendPacket.Unlock()

</pre><br><br>The peer is found in the event structure you get on the callbacks.<br>For futher questions, don't hesitate to ask :) <br><br></td></tr></table><br>
<a name="705209"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Booticus</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> oops! <br><br></td></tr></table><br>
<a name="705239"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WendellM</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd wondered about the "reliable packet" option in GNet ever since it was mentioned that it uses ENet/UDP, so thanks for your ENet wrapper/GNet extender, ozak.  I've been a fan of UDP's optional-reliability nature ever since using Surreal's BlitzPlay with Blitz3D. <br><br></td></tr></table><br>
<a name="705447"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Unless you're writting an application that really ought to use TCP, you don't really need reliable UDP. Sequential is usually good enough. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
