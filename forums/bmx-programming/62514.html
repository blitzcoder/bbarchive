<!DOCTYPE html><html lang="en" ><head ><title >assembly coding!?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >assembly coding!?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >assembly coding!?</a><br><br>
<a name="698401"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Defoc8</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> yes yes..i know this isnt strictly speaking a bmax question,<br>but im using assembly language with bmax..so i guess<br>its kinda ok to post here ;)<br><br>first up..im 8086 newbie..so the following code is probably<br>a joke..but id like folks to look at it + make suggestions<br>and perhaps show me alternatives...<br><br>both of these functions set the elements of 16 element<br>float array to match that of a unit matrix..the first uses<br>basic movement &amp; immediate values - the 2nd uses<br>the fpu instructions..which one is faster?, are there<br>better ways to do this?<br><br>_mat_unit4x4:<br>        push    ebp<br>        mov     ebp,esp<br>	mov     eax,[esp+4+4]<br>        mov     dword [eax],1.0<br>        mov     dword [eax+4],0.0<br>        mov     dword [eax+8],0.0<br>        mov     dword [eax+12],0.0<br>        mov     dword [eax+16],0.0<br>        mov     dword [eax+20],1.0<br>        mov     dword [eax+24],0.0<br>        mov     dword [eax+28],0.0<br>        mov     dword [eax+32],0.0<br>        mov     dword [eax+36],0.0<br>        mov     dword [eax+40],1.0<br>        mov     dword [eax+44],0.0<br>        mov     dword [eax+48],0.0<br>        mov     dword [eax+52],0.0<br>        mov     dword [eax+56],0.0<br>        mov     dword [eax+60],1.0<br>        mov     esp,ebp<br>        pop     ebp<br>        ret<br><br><br>_mat2_unit4x4:      ;;;FPU version<br>        push    ebp<br>        mov     ebp,esp<br>	mov     eax,[esp+4+4]<br>        fldz<br>        fst     qword [eax+4]<br>        fst     qword [eax+12]<br>        fst     qword [eax+24]<br>        fst     qword [eax+32]<br>        fst     qword [eax+44]<br>        fstp    qword [eax+52]<br>        fld1<br>        fst     dword [eax]<br>        fst     dword [eax+20]<br>        fst     dword [eax+40]<br>        fstp    dword [eax+60]<br>        mov     esp,ebp<br>        pop     ebp<br>        ret<br><br><br>thanks ;) <br><br></td></tr></table><br>
<a name="698411"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tested with this code<br><br><pre class=code>
superstrict
import "Matrix.s"
extern 
	function mat_unit4x4(m:Float Ptr)
	function mat2_unit4x4(m:Float Ptr)
end extern

local marray : float[16]

local starttime:Int=millisecs()
for local i:int=0 to 20000000
	mat2_unit4x4(varptr(marray[0]))
next
Print "mat2_unit4x4 "+(millisecs()-starttime)

starttime=millisecs()
for local i:int=0 to 20000000
	mat_unit4x4(varptr(marray[0]))
next
Print "mat_unit4x4 "+ (millisecs()-starttime)
end
</pre><br><br>Seems that FPU version is slightly faster, not significant but faster on my P4 3GHZ.<br><br>I thought maybe using REP STOD setting all to zero then expicitly setting the 1.0 elements would be faster but not so.  Maybe ASM wizard might be able to help you optimize more.  Maybe there is some more exotic opcodes for X86 that can help out.  Possible MMX?<br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="698457"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Defoc8</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> yeh same here..marginal speedup with fpu version..<br> not sure about mmx instructions, havent looked at the<br> anything other than the standard fpu instructions yet..<br> <br> asm wizard?<br><br>thanks for trying it out..<br><br>pointer - in your code you dont need to use all that var ptr<br>stuff...simply call mat2_unit4x4(arrayname)..maybe you<br>were jst trying to make you code clearer..dunno ;) or<br>perhaps you need that with strict code..<br><br><br>EDIT: eh?! - thats odd, the fpu version takes longer if<br>         i use superstrict in my code..lol, must be doing<br>         something odd.. <br><br></td></tr></table><br>
<a name="698460"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Assembly wizard :)<br><br>I did see a libary written in C with inlined ASM that uses MMX instructions.  I didnt understand it at all :)<br><br>Here is optimized lib.<br><br><a href="http://www.cs.technion.ac.il/~zdevir/main1.html" target="_blank">http://www.cs.technion.ac.il/~zdevir/main1.html</a><br><br>If you have membership to Gamasutra you can read the article.<br><br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="698462"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Defoc8</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks :]<br> - interesting doc + code <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
