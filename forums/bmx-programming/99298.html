<!DOCTYPE html><html lang="en" ><head ><title >Threads question</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Threads question</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Threads question</a><br><br>
<a name="1164975"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oddball</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is my first time using threads in BlitzMax and I was wondering about some best practice. Is it ok to create a background thread at application start up and have it run for the lifetime of the app? Or should I be looking to only keep threads live for as short a time as possible? <br><br></td></tr></table><br>
<a name="1164978"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dynaman</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Either is fine. <br><br></td></tr></table><br>
<a name="1164981"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Corum</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know that Mac OS needs to execute all the graphics related code inside the main thread.<br>Do someone can confirm this? <br><br></td></tr></table><br>
<a name="1164986"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PowerPC603</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Windows requires it as well.<br>I figured that out myself.<br><br>I had the main thread doing the rendering, while a separate thread just created 1 sphere every 100ms.<br><br>Most of the time it was ok, but sometimes then app just crashed on xRenderWorld (I was using Xors3D engine).<br>I suppose that was because the main thread was rendering the world while the separate thread was busy creating a sphere, but wasn't completed, and this corrupted some data, resulting in an app crash. <br><br></td></tr></table><br>
<a name="1165019"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jsp</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> And as with the graphics it's the same with MaxGUI, use it only from the main thread.<br>I also start a background thread at application start and then schedule new threads from there. That keeps  things separate, which is very important.<br>Starting and stopping threads add a little overhead, so if that is a problem the thread could go idle until used again. <br><br></td></tr></table><br>
<a name="1165149"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oddball</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks everybody. I've got threads up and running now. I'm putting together a little something for an event on Sunday. If everything goes well I'll have some pics to show on Monday. <br><br></td></tr></table><br>
<a name="1165150"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mahan</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Best practices with threads:<br><br>1. Keep ALL drawing/GUI in the main thread. (As most ppl already mentioned.)<br><br>and equally important:<br><br>2. Keep data and state separated between threads and know your "channels".<br><br>You can shoot yourself in the foot miserably if you don't think about ownership when you create your data structures.<br><br>Channels here mean the places in the code where you transfer data and structures between threads.<br><br>(Almost) Never let threads have references to the same data at once, because if they do you (or someone else) will start accessing it simultaneously and this will eventually create bugs that can get very hard to find.<br><br>Instead, try to think about passing references and data through channels between threads. When data has left one thread and gone through a channel and arrived in another thread, it should not exist in the first anymore.<br><br>I'd strongly recommend thinking of the channels are one-directional, i.e. that the data always leaves one thread and goes to another but not the other way around. If you need the data to be passed back and forth construct two abstract channels, one from A-&gt;B and another from B-&gt;A. That way you'll more easily be able to avoid (or find) deadlocks i.e. when two threads are waiting for one another at the same time (and everything stops working as consequence).<br><br>Avoid race conditions, by not having data or states dependent of other stuff in other threads. Let one piece of data be "self contained" so that independent work can be done on it until it's ready to be passed to another thread (if needed).<br><br>If you follow the advise above, interactions between objects (data/structures) can safely be done when both (or more) objects are "owned" simultaneously by a single thread.<br><br>If applicable: Create immutable objects (objects that are created in a state that will never change during their lifetime). If an object is immutable, it's usually safe for any number of threads to "own" or "know about it" simultaneously. (Immutability is not 100% supported by blitzmax, but you can create your own conventions for making objects hard to change by accident.)<br><br>That's pretty much the highlights of my experience with threads in an OOP/procedural environment. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
