<!DOCTYPE html><html lang="en" ><head ><title >RAND very slow</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >RAND very slow</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >RAND very slow</a><br><br>
<a name="731245"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MrCredo</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> t1=MilliSecs()<br>For i=1 To 2000000<br>	pos=Rand(0,255)<br>	'pos=(pos+7) Mod 256<br>Next<br>t2=MilliSecs()<br>Print t2-t1<br><br>check first time with RAND and second time with MOD (not the same, but it simulate value changing)<br><br>and now see the difference<br>305ms(rand) vs. 45ms(mod)<br><br>(XP-SP2) <br><br></td></tr></table><br>
<a name="731247"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Write a faster one then!<br><br>Source is in mod/brl.mod/random.mod/random.bmx <br><br></td></tr></table><br>
<a name="731261"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Would switching the modules to using superstrict help any?  (I notice random.bmx doesn't use it, just strict). <br><br></td></tr></table><br>
<a name="731263"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Leiden</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Write a faster one then! <br></div><br><br>lol! <br><br></td></tr></table><br>
<a name="731264"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Under what circumstances would you ever require two million random numbers per frame?<br><br>Mark might have taken this more seriously if you were posting a code sample that was anywhere near realistic.<br><br>Apart from that, what equates to 7 million function calls per second can never be branded 'slow'. <br><br></td></tr></table><br>
<a name="731285"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mark Tiffany</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> This:<br><br>pos=(pos+7) Mod 256<br><br>Is a pretty trivial calculation for the processor.<br><br>Algorithms to generate random numbers tend to be much more complex, e.g. to simulate RANDOM numbers.<br><br>If you are really that bothered, you could pre-generate 1 million random numbers, stick them in an array, then pull values out of that array, starting at a random point each time.  (At least, that *feels* like it would be quicker, albeit not truly random). <br><br></td></tr></table><br>
<a name="731326"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is one of those 'forest for the trees' threads.  The speed of RAND, when looked at against your entire game/application, is irrelevant. <br><br></td></tr></table><br>
<a name="731330"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> MOD is definitely not giving you any kind of randomness. <br><br></td></tr></table><br>
<a name="731333"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bailius Maximus</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> sorry to bug...where are those dagnabbit blitz 3d original pre-update download files...like when you first purchase B3D?  Please help the lost...thanks! =) <br><br></td></tr></table><br>
<a name="731377"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MrCredo</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt;&gt;&gt;Under what circumstances would you ever require two million random numbers per frame?<br><br>Hm - do you ever need 2-mio loops? NO? psss... Mark make loops slower ;-)<br><br>I do not need, but i wrote a DLL in C++ and tested this with BlitzMax... I needed a non-liner position changing - random is perfect for this - but my DLL was slower than it should be... so that i checked BlitzMax (is the DLL access so slow or something else?). But the speed of RAND is slower than all other sources that i wrote (in the DLL) - so that i posted this... i see that rand use doubles (hell!!!!) - i will compare this with rand from c++ <br><br></td></tr></table><br>
<a name="731382"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> DLL access is always slower than using it "in code". If you have the CPP code, why not simply import - extern it. Would give you a fair comparision and easy way to have other operations if needed. (fastRand?)<br><br>PS: Above test is a little unfair anyway. MOD against a power of 2 is like testing a car with round wheels against one with some other, no mather what they are (unless the car flies) ;-) <br><br></td></tr></table><br>
<a name="731413"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> sorry to bug...where are those dagnabbit blitz 3d original pre-update download files...like when you first purchase B3D? Please help the lost...thanks! =) <br></div>You'll get more replies if you A) Don't hijack a completely unrelated thread, and B) Post in the appropriate forum.  The Blitzmax forum (and other people's threads at that) isn't the place for Blitz3D problems.<br><br>:) <br><br></td></tr></table><br>
<a name="731456"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >bradford6</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> this is faster. depends on what you are trying to do but an array of pre-generated random numbers will always win the day. <br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

Local RandArray:Int[] = New Int[10000]

For x = 0 To 9999
	RandArray[x] = Rand(0,255)
Next



t1=MilliSecs()
For i=1 To 2000000
rc:+1 If rc&gt;9999 Then rc=0
pos=RandArray[rc]
Print pos
'pos=(pos+7) Mod 256
Next
t2=MilliSecs()
Print t2-t1
</textarea><br><br>this is slightly faster<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
t1=MilliSecs()
For i=1 To 2000000
pos=BillRand(0,255)
'pos=(pos+7) Mod 256
Next
t2=MilliSecs()
Print t2-t1

Function BillRand( min_value,max_value=1 )
	Local delta!=Float(max_value)-Float(min_value)
	If delta&gt;0 Return RndFloat()*(1+delta)+min_value
	Return RndFloat()*(1-delta)+max_value
End Function

</textarea> <br><br></td></tr></table><br>
<a name="731786"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MrCredo</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> this is not the point - fact is: rand IS slow.<br><br>why? -&gt; it use doubles<br><br>workaround -&gt; use this c sample code:<br><br><br>EXPORT int led_array_xxx (int min, int max)<br>{<br>    return rand() % (max-min+1) + min;<br>}<br><br>BlitzMax Rand = ~310ms<br>C Rand = ~90ms<br><br><br>OR<br><br><br>Extern "C"<br>	Function crand:Int () = "rand" <br>End Extern<br><br>Function fastrand:Int (start:Int, ende:Int)<br>	Return crand() Mod (ende-start+1) + start<br>EndFunction<br><br>this Blitz Max code is also fast<br><br><br>(marksibly wrote) Write a faster one then!<br>look it is doable - and its much easier <br><br></td></tr></table><br>
<a name="731791"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Picklesworth</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> (marksibly wrote) Write a faster one then!<br>look it is doable - and its much easier <br></div><br><a href="http://thedailywtf.com/forums/thread/105411.aspx" target="_blank">This may help :P</a> <br><br></td></tr></table><br>
<a name="731840"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mark Tiffany</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> So, what we want are a few different versions of Rand, dependent on what size variable it's being cast into. <br><br></td></tr></table><br>
<a name="731872"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> "We" want that?  This is another one of the pointless tangents that this community seems to get caught up in every few weeks or so.  It doesn't matter.  Move on.  :) <br><br></td></tr></table><br>
<a name="731884"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mark Tiffany</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok, should have said you, not we.  No, not *you* Warren.  However, if there is a genuinely significant speed difference between an Int, Float and Double version of Rand, that seems like a reasonable thing to add. <br><br></td></tr></table><br>
<a name="732001"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's reasonable if it's the primary code path slowing down your game.  However, I'll eat a pony if that's the case. <br><br></td></tr></table><br>
<a name="732051"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SculptureOfSoul</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> doubles should be faster than ints on 64 bit systems, right? <br><br></td></tr></table><br>
<a name="732074"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Beaker</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Something I do is just do one call to Rnd() per game loop (unless its noticable during play) and then multiply when I need a range. Much faster. Like this:<br><pre class=code>SuperStrict

Local blah%
Local now%=MilliSecs()
For Local f%= 1 To 100000
	blah = Rand(0,f)
Next
now = MilliSecs()-now
Print now

now%=MilliSecs()
Local myrnd# = Rnd(0,1)
For Local f%= 1 To 100000
	blah = myrnd*f
Next
now = MilliSecs()-now
Print now</pre><br>Admittedly, it's not always possible to work like this, but you can at least reduce the number of times you call Rnd/Rand. <br><br></td></tr></table><br>
<a name="732077"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> doubles should be faster than ints on 64 bit systems, right? <br></div>No. Which is faster int or float depends primarilly on how many processing units you have (ALU for ints, FPU for floats) and how good you (or your compiler) can restructure a algorithm or expression to allow for out-of-order execution.<br><br>If you have a typical mid-level CPU (Celeron) you'll have 4 ALUs and only 1 FPU so if your algorithm is well suited for out-of-order processing, your ints will be processed 4 times as fast.<br><br>If you have a typical high-end CPU (proper Pentium) you'll have up to 6 ALUs and 2 FPUs, which means your ints will be processed 3 times as fast.<br><br>If you have a server grade CPU (like a Xeon or Itanium) all bets are off, as chances are you'll probably have 8 ALUs and just as many FPUs.<br><br>If your algorithm or expression isn't designed in such a way as to take advantage of out-of-order execution, it won't make any difference at all.<br><br><div class="quote"> However, if there is a genuinely significant speed difference between an Int, Float and Double version of Rand, that seems like a reasonable thing to add. <br></div>There isn't. Not in general anyway. It would only be useful (and then even marginally at that) to people who develop for really old computers. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
