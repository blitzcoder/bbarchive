<!DOCTYPE html><html lang="en" ><head ><title >Can you help with High sprite count optimisations?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Can you help with High sprite count optimisations?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Can you help with High sprite count optimisations?</a><br><br>
<a name="952568"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Arowx</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi I found that my Ludum Dare <a href="http://www.arowx.com/Arowx_LD14_AWOD.zip" target="_blank">entry (source+ windows exe in zip)</a> which quickly generates a lot of sprites ran into major slowdown when the 'Wall of Doom' Bricks multiplied to over 1000!<br><br>I put in a timer for frame and logic [top right of screen] and it looks lik the drawing just slows down rapidly once your past 1000-2000 bricks.<br><br>Are there any optimisations that I can add that would allow a screen of thousands of sprites at 30-60fps?<br><br>Currently I am just using SetScale and DrawImage for each sprite object with ALPHABLEND.<br><br>As well as the tricky to grasp but works well default BlitzMax Collision system!<br><br>This is going to be my entry into the Community Framework Compo so I'd like to make something very fast and cool! <br><br></td></tr></table><br>
<a name="952571"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Do you have to use Bmax? <br>I hate to admit it, but there is are techniques you can use in Blitz3D that can raise your sprite cap by x10. <br><br></td></tr></table><br>
<a name="952588"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> The community competition is for BlitzMax code only.<br><br>Merx, BlitzMax's collision stuff is per-pixel, and that can get to be quite time consuming when you have a lot of collisions. You might look at optimizing your collision detection routines perhaps by using a grid or some kind of spacial partitioning.<br><br>Beyond that you'll need to look to putting multiple sprites onto a single (or few) image/texture so that you don't have to keep swapping textures. <br><br></td></tr></table><br>
<a name="952590"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Do you have to use Bmax?  <br></div><br>Haw... I can guarantee that well written BlitzMax code will be faster than Blitz3D. <br><br></td></tr></table><br>
<a name="952597"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Arowx</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ImaginaryHuman - Yes I currently also don't crop the drawImage calls to only onscreen due to the collision detection being pixel based!<br><br>Cheers for that, so fast collision detection...<br><br>The Blocks do tend to group together could I tile the image over a rectangular areas of them can blitzmax do that or will I just need larger graphics pre-rendered?<br><br>What about the new DX9 driver is that stable enough and faster?<br><br>I also do a lot of scaling as the bricks grow, would it be faster to pre-render the scaling?<br><br>What about state changes e.g. scaling, colours, alpha would sorting and batching these produce faster results?<br><br>What about threading, is it worth looking into threading to divide and conquer e.g. Logic, Graphics, Sound, Input, AI? <br><br></td></tr></table><br>
<a name="952601"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Haw... I can guarantee that well written BlitzMax code will be faster than Blitz3D. <br></div><br>I totally agree. <br>But using jims SpriteMaster ss library will beat the Bmax drawing commands by a lot.<br>I don't know of an equivalent method for Bmax. <br><br></td></tr></table><br>
<a name="952605"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I believe you would get a significant speed inprovement if you use prerendered tiles as well as adding a self made rectangle collision. I read some threads on how ineficient imagescollide is for basic collision. You have the advantage that all you are using are box and circle collision which are about the simplest and fastest collision detection for games. Even if you decide to leave it to the hardware to scale, if you can calculate the corners of the scaled image by your self you can have the speed increase just by creating your own collision function. most optimized collision do a distance check first:<br><pre class=code>
if abs(x2-x1) &gt; n then return ' n is usually the radius from the center of the object/image
if abs(y2-y1) &gt; n then return ' to the fardest edge/corner of the object/image
</pre><br><br>Once close enough a final collision check is performed. <br><br></td></tr></table><br>
<a name="952609"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> yes I dont think  imagescollide does a distance check so you do have to do it yourself <br><br></td></tr></table><br>
<a name="952612"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pete Rigz</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> DrawImageRect is what you want for tiling the same image over an area, which looks like it'd help a lot in your case. Nice game concept btw!<br><br>I'd be interested to know why b3d would be faster then bmax seeing as it shouldn't be too difficult to replicate what b3d does in bmax. But I doubt it'd be any different speed wise other then bmax being a more efficient compiler. I know you could create your own single surface system in b3d as the native sprite command would create its own surface for each sprite which wasn't very efficient. But even with single surface you're still pumping vertices to the gfx card every frame which is basically the same thing that throttles bmax. <br><br></td></tr></table><br>
<a name="952622"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Arowx</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Jesse excellent that should work a treat as all the sprites have a game position and calculate their graphics position!<br><br>@Pete Rigz DrawImageRect sounds just Ideal! <br><br></td></tr></table><br>
<a name="952676"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is your code using a proper fixed logic or delta? Going from 60-30-20fps is no big deal and is very common when there is lot's of rendering. It's really only noticeable when the coder does not have a proper timing routine.<br><br>Scaling takes a hit, rotation takes a hit. Granted on more modern hardware the hit is very small. And yes, pre rendered images will help, but not that much to be honest. I wouldn't do it personally.<br><br>Remember to draw all images that don't have alpha with the proper stage flag. (Solid?) You'll gain some speed there.<br><br>State changes are a small hit. It might be worth grouping all alpha, all additive blending, etc, but again..I wouldn't do it.<br><br>Depending on the driver, dx9 will be alot faster. But I would still default to dx7.<br><br>My engine uses a single surface rendering system in Blitzmax. It's alot faster on older cards, not worth the hassle on newer cards. At least that's my opinion.<br><br>I've never used the blitzmax built in collision checking. I've always used my own software rect, circle collisions. Which work well for 99% of the games most peeps will ever code and it's blazingly fast. When using rect or circle, make your hit zone slightly smaller than the sprite so it overlaps when colliding. Workls best for shooters. ;)<br><br>Do you have to collision check every loop? Sometimes you can spread out the load over 1-3 frames and "get away with it". A trick used more than peeps realize. ;) <br><br></td></tr></table><br>
<a name="952712"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Arowx</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> @MGE excellent thanks for that...<br><br>So to summarise, I am going to try and optimize the game by adding:<br>  1. Collision detection logic<br>  2. Fixed Rate or Delta Timing<br>  3. Tiled Images on grouped sprites<br>  4. Test pre-rendered tiles versus scaled<br><br>?No one has mentioned threads yet anyone using threads within a game to take advantage of all those CPU cores?<br><br>I'll repost as I go with benchmarks and downloads!<br><br>So benchmark mode for game needed... I'll be back <br><br></td></tr></table><br>
<a name="952713"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can't thread graphics rendering. Well, as far as I know.<br><br>Although you could of course have a single render thread, with other stuff going on in other threads. <br><br></td></tr></table><br>
<a name="952815"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> One possible advantage of doing scaling of sprites in realtime rather than pre-rendered, is that if your `original image` (with no zooming) is say 64x64 pixels, and you want to zoom it UP to 128x128, you are a) using less texture memory, b) utilizing the cache better because you're accessing the same pixels from the texture quite often, c) you don't have to read lots of pixels which effectively contain the same color values as their immediate neighbors due to the scale operation. However if you're scaling DOWN, then pre-rendered zoom frames may be faster. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
