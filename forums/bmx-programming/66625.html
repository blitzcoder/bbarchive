<!DOCTYPE html><html lang="en" ><head ><title >Blitzmax SOAP</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Blitzmax SOAP</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Blitzmax SOAP</a><br><br>
<a name="744135"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Leon Brown</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does anyone know if and how to use SOAP with BlitzMax to allow for interaction with online applications? <br><br></td></tr></table><br>
<a name="744136"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't think it's safe to use *any* water-based products anywhere near your computer... <br><br></td></tr></table><br>
<a name="744137"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Leon Brown</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> ha ha ha... no, seriously :-). I'm interested in using it to integrate desktop interfaces to my web application. All shall be revealed soon. <br><br></td></tr></table><br>
<a name="744138"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> SOAP is just a "send and receive XML via HTTP" communication thingy.<br><br>So, I imagine all you need is:<br><br>1) Something to create/read XML  (I would suggest getting yourself an XML module so you aren't reinventing wheels - there are two currently I know of, maxml and libxml. maxml is a pure BlitzMax implementation. Libxml is a cross-platform wrapper for the extremely full-featured Libxml2 library)<br><br>2) A way to send and receive via HTTP. Which, I believe, Max can do for you (via sockets etc).<br><br>Essentially, you send an HTTP request with your XML, and the server sends you back a response, also in XML.<br><br>A small guide <a href="http://www.w3schools.com/soap/default.asp" target="_blank">here</a>.<br><br><br>Aren't RSS feeds done via SOAP? <br><br></td></tr></table><br>
<a name="744139"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't have any SOAP examples with my libxml module, I'm afraid.. but it can't be too hard to do it. <br><br></td></tr></table><br>
<a name="744144"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Leon Brown</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks. Do you know where I can find information about using the Blitz socket commands? <br><br></td></tr></table><br>
<a name="744147"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> There's a nice example <a href="/codearcs.php?code=1555" target="_blank"> here </a>.<br>Not exactly what you need, but it'll set you off in the right direction. <br><br></td></tr></table><br>
<a name="744187"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Scott Shaver</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> here is some java code for connecting to a .NET SOAP Web Service<br><br><pre class=code>
package com.foo.util.comm;

import java.io.BufferedReader;
import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.net.HttpURLConnection;
import java.net.SocketException;
import java.net.URL;
import java.net.URLConnection;
import java.util.logging.Level;

import com.foo.util.logging.CCLogger;

public class WebServiceAccess {
	private String m_NameSpace; // 
	private String m_ServiceAddress; // the address of the .asmx file
	public String m_ServiceName; // the name of the service

	/** Creates a new instance of WebbserviceAccess */
	public WebServiceAccess() {
		m_ServiceAddress = "";
		m_ServiceName = "";
		m_NameSpace = "";
	}

	public void setNameSpace(String nameSpace) {
		m_NameSpace = nameSpace;
	}

	public void setServiceAddress(String ServiceAddress) {
		m_ServiceAddress = ServiceAddress;
	}

	public void setServiceName(String ServiceName) {
		m_ServiceName = ServiceName;
	}

	public String sendParamerterizedSoapRequest(String xml, String cookies) throws Exception{
		return sendSoapRequest(m_ServiceAddress, xml, cookies);
	}
	
	public String sendNonParamerterizedSoapRequest(String xml, String cookies) throws Exception{
		return sendSoapRequest(m_ServiceAddress+"/"+m_ServiceName, xml, cookies);
	}
	
	private String sendSoapRequest(String postUrl, String xml, String cookies) throws Exception {
		int retry=0;
		CCLogger.getLogger().log(Level.INFO, "Sending: "+xml);
		while(retry&lt;5) // try to recover from a connection reset error
		{
			try
			{
				// Create the connection where we're going to send the file.
				URL url = new URL(postUrl);
				URLConnection connection = url.openConnection();
				HttpURLConnection httpConn = (HttpURLConnection) connection;
		
				// After we copy it to a byte array, we can see
				// how big it is so that we can set the HTTP Cotent-Length
				// property. (See complete e-mail below for more on this.)
		
		//		FileInputStream fin = new FileInputStream(xmlFile2Send);
				ByteArrayInputStream str = new ByteArrayInputStream(xml.getBytes("ISO8859_1"));
				ByteArrayOutputStream bout = new ByteArrayOutputStream();
		
				// Copy the SOAP file to the open connection.
				copy(str, bout);
				str.close();
		
				byte[] b = bout.toByteArray();
		
				// Set the appropriate HTTP parameters.
				
				if(cookies!=null &amp;&amp; cookies.length()&gt;0)
					httpConn.setRequestProperty("Cookie", cookies);
				httpConn.setRequestProperty("Content-Length", String.valueOf(b.length));
				httpConn.setRequestProperty("Content-Type", "text/xml; charset=utf-8");
				httpConn.setRequestProperty("SOAPAction", m_NameSpace+"/"+ m_ServiceName);
				httpConn.setRequestMethod("POST");
				httpConn.setDoOutput(true);
				httpConn.setDoInput(true);
		
				// Everything's set up; send the XML that was read in to b.
				OutputStream out = httpConn.getOutputStream();
				out.write(b);
				out.close();
		
				// Read the response and write it to standard out.
				InputStreamReader isr = null;
				boolean printOutputOnFailure = false;
				try{
					isr = new InputStreamReader(httpConn.getInputStream());
				}
				catch(IOException io){
					io.printStackTrace();
					isr = new InputStreamReader(httpConn.getErrorStream());
					printOutputOnFailure = true;
					com.cc.util.logging.CCLogger.getLogger().log(Level.SEVERE, "FAILURE on: "+m_ServiceName);
				}
				BufferedReader in = new BufferedReader(isr);
		
				String inputLine;
				StringBuffer sb = new StringBuffer(1000);
				while ((inputLine = in.readLine()) != null){
					sb.append(inputLine+"\n");
				}
				if(printOutputOnFailure) com.cc.util.logging.CCLogger.getLogger().log(Level.SEVERE, sb.toString());
				
				in.close();
				return sb.toString();
			}
			catch(SocketException x)
			{
				retry++;
				if(retry&gt;5) // give up
					throw x;
				CCLogger.getLogger().log(Level.INFO, "Connection reset, retry number "+retry);
			}
		}
		return null;
	}

	// copy method from From E.R. Harold's book "Java I/O"
	private void copy(InputStream in, OutputStream out) throws IOException {

		// do not allow other threads to read from the
		// input or write to the output while copying is
		// taking place

		synchronized (in) {
			synchronized (out) {

				byte[] buffer = new byte[256];
				while (true) {
					int bytesRead = in.read(buffer);
					if (bytesRead == -1)
						break;
					out.write(buffer, 0, bytesRead);
				}
			}
		}

	}
}
</pre><br><br><br>and then you use it like this<br><br><pre class=code>
WebServiceAccess wsa = new WebServiceAccess();
wsa.setServiceAddress(webserviceLocation);
wsa.setServiceName((String)webserviceServices.get(serviceName));
wsa.setNameSpace((String)webserviceServices.get(WS_XMLNS));
		
try {
   	if(hasParameters){
		return wsa.sendParamerterizedSoapRequest(xml, myCookie);
 	}
	return wsa.sendNonParamerterizedSoapRequest(xml,myCookie);
} 
catch (Exception ex1) 
{
ex1.printStackTrace();
return null;
}
</pre><br><br><br>where:<br><br>NameSpace is something like "http://www.foo.com<br>webserviceLocation is something like "http://ws.foo.com/myservice.asmx<br>serviceName is something like GetUserInfo<br>the xml might be something like:<br><br><pre class=code>
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"&gt;
&lt;soap:Body&gt;
&lt;GetUserInfo xmlns="http:\\www.foo.com" /&gt;
&lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</pre> <br><br></td></tr></table><br>
<a name="744190"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Scott Shaver</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> The cookies stuff is only used for piggybacking on an existing session in a .NET app. A somewhat more complete post about this on my web site at:<br><br><a href="http://www.scottshaver2000.com/forum/viewtopic.php?p=695#695" target="_blank">http://www.scottshaver2000.com/forum/viewtopic.php?p=695#695</a> <br><br></td></tr></table><br>
<a name="744544"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Leon Brown</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks a lot for your help guys. I shall certainly take a look at the information provided :-) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
