<!DOCTYPE html><html lang="en" ><head ><title >Lua_PushLightUserData - Intentionally Sending Nil?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Lua_PushLightUserData - Intentionally Sending Nil?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Lua_PushLightUserData - Intentionally Sending Nil?</a><br><br>
<a name="979412"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> When I request a BlitzMax object from lua, I send the integer handle to it as LightUserData and then store it in a table in lua. That table has a bunch of functions added to it in lieu of methods and it is distributed in Lua as an object you can work with. Whenever it does anything in BlitzMax it sends the LightUserData back and BlitzMax finds the object it represents. Easy.<br><br>Except that Lua may occasionally ask for an object that doesn't exist. Up until now I've been using additional functions to check that an object exists before requesting it, but for some operations this effectively doubles the execution time needlessly. So I'd like to be able to shortcircuit this technique at some point.<br><br>So if I request an object which does not exist, I'd like to send userdata that's clearly invalid. Then Lua can check the userdata is nil, and not create the table, returning nil instead. Then the lua scripts can simply check if the "object" they're using is nil or not. But I can't get it to work. If I send a Null Byte Ptr, it is not detected as nil by Lua. Now I remember someone telling me that Null pointers have a specific address, and do not show as NULL in C++,so they probably don't show as nil in Lua either. So I made the lightuserdata equal to Byte Ptr(0) instead but this also isn't detected as nil.<br><br>How can I intentionally send something as lightuserdata that Lua will detect as nil? <br><br></td></tr></table><br>
<a name="979414"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you push a light userdata, it's just going to push an address, so it's not going to push nil in lieu of an address even if it's Null (as it would be in C++ or BlitzMax).  If you want nil, you have to push nil, simple as that.  If you want to push Null as BlitzMax will see it, push something like this:<br><br><pre class=code>Strict

Private
Function p2p:Byte Ptr(p:Byte Ptr) NoDebug
	Return p
End Function

Public
Function ObjToPtr:Byte Ptr(obj:Object)
	Global o2p:Byte Ptr(o:Object)=Byte Ptr(p2p)
	Return o2p(obj)
End Function

Function NullObject:Byte Ptr()
	Return ObjToPtr(Null)
End Function

lua_pushlightuserdata(NullObject())
</pre> <br><br></td></tr></table><br>
<a name="979433"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ack, I didn't realize there was a Lua_PushNil function. The BlitzMax NullObject pushing will come in very handy too. Thanks Noel. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
