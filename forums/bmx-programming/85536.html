<!DOCTYPE html><html lang="en" ><head ><title >Line collision on a grid</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Line collision on a grid</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Line collision on a grid</a><br><br>
<a name="967867"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Drakim</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> <img src="http://img154.imageshack.us/img154/9258/gridp.png"><br><br>I think the image speaks for itself, but, how do I test if a line going from location A to location B collides with any squares that are marked as solid? <br><br></td></tr></table><br>
<a name="967899"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >matibee</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> First option looking at your sketch...<br><br>Look up djekstra's (sp?)  line drawing algorithm.  And plot the line pixel by pixel until it reaches the target point (success) or passes into a cell with a solid tile in it (fail). <br><br></td></tr></table><br>
<a name="967900"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jkrankie</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> there is an example of a* pathfinding in the samples, which looks like it might be what you are after.<br><br>Cheers<br>Charlie <br><br></td></tr></table><br>
<a name="967903"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Arowx</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Matibee's suggestion of using I think means using a  <a href="/codearcs.php?code=1465" target="_blank">line drawing algorith</a> to trace the line on the grid and check for hits.<br><br>This will work very well for fixed square by square movement test or as a quick test before you do a lower level collision test.<br><br>But the core question is in what context are you using it, collision (e.g.) bullets, line of sight, lighting shadow-casting, pathfinding?<br><br>For instance you could want line of sight information, and because your gamespace is grid based and levels are fixed then you could precalculate the visibility of each square from every another.<br><br>Or alternatly you can do somthing similar for pathfinding on fixed levels, where you store the path from every grid square to every other in a lookup table (again best for smaller level designs). <br><br></td></tr></table><br>
<a name="967916"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Drakim</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the replies. The thing I have in mind is indeed stuff like bullets, line of slight and lighting shadow casting. However, not path finding (for this I'd use a* pathfinding, which does as far as I know have no relation to a direct line like this at all. It's more step based)<br><br>Matibee's suggestion would perhaps work, but I still feel it's not what I'm looking for. It seems to be made more for drawing the actual line instead of checking a clear path. Sure, I could check the location of every single pixel as I draw the line, but still, that feels like the wrong way of doing it, unless I've missed something. <br><br></td></tr></table><br>
<a name="967932"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Arowx</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> It depends if your game uses a fixed square grid with integer based movement then that appoach is ideal.<br><br>Lighting and shadow casting is quite expensive although I have come acorss a raster based approach <a href="http://www.gamedev.net/reference/articles/article729.asp" target="_blank">at gamedev.net</a>.<br><br>I've had a play with it so could dig out the code if your looking for something similar?<br><br>For bullets probably best to use a simple <a href="/posts.php?topic=83880#946993" target="_blank">sphere test</a> as a first pass then go to a more detailed rectangle test or pixel based collision detection, both of which BlitzMax provides as CollideImage and CollideRect commands.<br><br>Also this is a good general games programming <a href="http://www-cs-students.stanford.edu/~amitp/gameprog.html" target="_blank">site</a> <br><br></td></tr></table><br>
<a name="967944"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >matibee</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ack!  Djekstra = pathfinding, Bresenham = line drawing :)  It's been a while.<br><br>Another option;<br><br>Compute the angle between the player (in the red square) and his target point.  Take every external corner of the black object, and compute their angles to the player.  If the target angle lies inside the range of object angles it doesn't clear it.<br><br>This method (like many others) will require some spacial division to save you from having to check every single object in the scene every time.   The line drawing doesn't.<br><br>There's a condition that may cause you problems though...<br><br>If you moved the bottom black object one cell across, a line at 45 degrees would still pass between the two objects. <br><br></td></tr></table><br>
<a name="968242"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dabhand</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.foppygames.nl/Downloads/line_of_sight.zip" target="_blank">http://www.foppygames.nl/Downloads/line_of_sight.zip</a><br><br>Auld stylee BlitzBasic, but the meat is there and just what your after me thinks.<br><br>Dabz <br><br></td></tr></table><br>
<a name="969418"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kistjes</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, <br>A while ago I made a 2D version of Portal (tiled bird-eye view).<br>I had to come up with a solution for exactly the same problem you describe.<br>My solution was:<br>1) Describe the contour of the wall-squares as lines and<br>2) Do a GetInsertionPoint() of the line with all the walls. <br>Works perfectly in huge maps with lot's of walls.<br><br>This method (within a TLine type) checks for insertionpoints between two lines:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">	Method GetInsertionPoint:TPoint(oLine:TLine)
		Local x3# = oLine.pfX0
		Local x4# = oLine.pfX1
		Local y3# = oLine.pfY0
		Local y4# = oLine.pfY1
		
		Local d# = (y4 - y3) * (pfX1 - pfX0) - (x4 - x3) * (pfY1 - pfY0)
		If d = 0.0 Then 'Lines ara parallel. No intersection"
			Return Null
		Else
			Local numA# = (x4 - x3) * (pfY0 - y3) - (y4 - y3) * (pfX0 - x3)
			Local numB# = (pfX1 - pfX0) * (pfY0 - y3) - (pfY1 - pfY0) * (pfX0 - x3)
			Local ua# = numA / d
			Local ub# = numB / d

			Local range1% = (ua &gt;= 0.0) &amp; (ua &lt;= 1.0)
			Local range2% = (ub &gt;= 0.0) &amp; (ub &lt;= 1.0)
			If range1 And range2 Then
				Local fx# = pfX0 + ua * (pfX1 - pfX0)
				Local fy# = pfY0 + ua * (pfY1 - pfY0)
				Return Point(fx, fy)
			End If
			Return Null
		End If
	End Method
</textarea><br><br><br>I can send you my Portal code if you want... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
