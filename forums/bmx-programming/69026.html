<!DOCTYPE html><html lang="en" ><head ><title >Ye olde DX mouse lag</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Ye olde DX mouse lag</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Ye olde DX mouse lag</a><br><br>
<a name="771607"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Has anyone noticed the old DX mouse lag problem returning when using Flip 0 (no VSync)?  I have had it a few times now, sort of off an on, weird... <br><br></td></tr></table><br>
<a name="771652"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, I have seen DX in Windows seem to lag when I am letting my app run as fast as possible with no throttling.  It is wierd, because it does it on my PC at work while running about 400fps, but then at home running about 650fps it does not lag.<br><br>Anyway, I switched to the OpenGL driver and everything is fine on both machines and it runs about the same speed. <br><br></td></tr></table><br>
<a name="771896"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> what no one else has noticed this with DX in windowed mode and Flip 0?  Maybe I'll have to make a demo... <br><br></td></tr></table><br>
<a name="771924"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yan</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> It appears that the DX lag fix isn't used in windowed mode with the new DXGraphics module? <br><br></td></tr></table><br>
<a name="771944"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah that's what I'm saying and it's rubbish.  Do you think we can get BRL to fix it? <br><br></td></tr></table><br>
<a name="771951"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yan</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I dunno, it looks pretty deliberate, perhaps there's a reason for it?<br><br>You could always try changing it back yourself to see what happens? <br><br></td></tr></table><br>
<a name="771955"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe it's something to do with not hogging the CPU or something in windowed mode?<br><br>Who else wants the lag fix back in for windowed mode? <br><br></td></tr></table><br>
<a name="772019"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tachyon</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've never seen this fabled mouse lag. Example please! <br><br></td></tr></table><br>
<a name="772022"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Taken from the original posts found using 'mouse lags'<br><pre class=code>
'SetGraphicsDriver GLMax2DDriver()
Graphics 1024,768
While Not KeyHit(KEY_ESCAPE)

	DrawLine MouseX()-5,MouseY()-5,MouseX()+5,MouseY()+5
	DrawLine MouseX()+5,MouseY()-5,MouseX()-5,MouseY()+5

	'Flip 0		' no lag
	 Flip 1		' mouse lags
	'Flip -1	' mouse lags
	Cls
Wend
</pre><br><br>@GA, Just report it as a bug and see what happens. <br><br></td></tr></table><br>
<a name="772068"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> TonyG: Not that's not it.  That's a normal mouse lag which has been in BlitzMax since day one.  It's around 1 frame for DX and 2 for GL (i.e. worse) and is due to the input being read before you see the vsynced flipped buffer.  It goes away with Flip 0 because it updates the screen much more often. Sorry I should have been more clear with my intitial post.<br><br>The problem is a DX rendering issue with the pipeline getting clogged up which causes a major delay to all input. It even messes up graphics drawn with delta time as DX stores up the frames and then just outputs them one after the other with no timing.<br><br>Here is something that will show the issue.  Run it and press z and x randomly then stop pressing them - note how the square MOVES ON ITS OWN as the DX buffer rendering catches up.  Change to OpenGL or full screen and it's fine.<br><br>You may need to adjust the loop size to make it runnable on your PC...<br><br><pre class=code>
'SetGraphicsDriver GLMax2DDriver()
'Graphics 800,600,32
Graphics 800,600,0

x = 300
y = 200

While Not KeyHit(KEY_ESCAPE)
  Cls
   
  If KeyDown(KEY_Z) Then x = x - 10
  If KeyDown(KEY_X) Then x = x + 10
  
  SetScale 8,8
  For i = 0 To 2000
    DrawRect x,y,30,30
  Next
  SetScale 1, 1
   
  Flip 1

Wend
</pre><br><br>If other people get this, then I'll post as a bug because this got fixed a while ago and has now started again with the new DX module. <br><br></td></tr></table><br>
<a name="772115"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmm, I get the problem but how is it related to a 'mouse lag'? <br><br></td></tr></table><br>
<a name="772141"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> no time for testing this morning but try changing dxgraphics.mod/d3d7graphics.bmx[167] to:<br><br><pre class=code>
			_primSurf.Blt( dest,_renderSurf,src,DDBLT_WAIT,Null )
</pre><br><br>and some interesting reading in ddraw.h for some background in to microsofts mental-ity, they seem to have some major confusion with the definition of the numbers three and one...<br><br><div class="quote"> <br>/*<br> * These flags indicate a presentation blt (i.e. a blt<br> * that moves surface contents from an offscreen back buffer to the primary<br> * surface). The driver is not allowed to "queue"  more than three such blts.<br> * The "end" of the presentation blt is indicated, since the<br> * blt may be clipped, in which case the runtime will call the driver with <br> * several blts. All blts (even if not clipped) are tagged with DDBLT_PRESENTATION<br> * and the last (even if not clipped) additionally with DDBLT_LAST_PRESENTATION.<br> * Thus the true rule is that the driver must not schedule a DDBLT_PRESENTATION<br> * blt if there are 3 or more DDBLT_PRESENTLAST blts in the hardware pipe.<br> * If there are such blts in the pipe, the driver should return DDERR_WASSTILLDRAWING<br> * until the oldest queued DDBLT_LAST_PRESENTATION blts has been retired (i.e. the<br> * pixels have been actually written to the primary surface). Once the oldest blt<br> * has been retired, the driver is free to schedule the current blt.<br> * The goal is to provide a mechanism whereby the device's hardware queue never<br> * gets more than 3 frames ahead of the frames being generated by the application.<br> * When excessive queueing occurs, applications become unusable because the application<br> * visibly lags user input, and such problems make windowed interactive applications impossible.<br> * Some drivers may not have sufficient knowledge of their hardware's FIFO to know<br> * when a certain blt has been retired. Such drivers should code cautiously, and <br> * simply not allow any frames to be queued at all. DDBLT_LAST_PRESENTATION should cause<br> * such drivers to return DDERR_WASSTILLDRAWING until the accelerator is completely<br> * finished- exactly as if the application had called Lock on the source surface<br> * before calling Blt. <br> * In other words, the driver is allowed and encouraged to <br> * generate as much latency as it can, but never more than 3 frames worth.<br> * Implementation detail: Drivers should count blts against the SOURCE surface, not<br> * against the primary surface. This enables multiple parallel windowed application<br> * to function more optimally.<br> * This flag is passed only to DX8 or higher drivers.<br> *<br> * APPLICATIONS DO NOT SET THESE FLAGS. THEY ARE SET BY THE DIRECTDRAW RUNTIME.<br> * <br> */<br> <br></div> <br><br></td></tr></table><br>
<a name="772145"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> tonyg: if you are doing a lot of game drawing and you move the mouse cursor round, it will appear to lag because all input lags, and it's the most obvious input (for casual games).<br><br>SkidRacer: great, thanks for the quick response.  I'll try this out.  Interesting reading.  Also it says it's for DX8 yet we are using DX7, no problem there? <br><br></td></tr></table><br>
<a name="772151"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CGV</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> In the code tonyg posted I find I get the mouse lag on Flip 0 and no lag on Flip 1 or -1.<br><br>I recently had to downgrade my graphics card to an old Radeon 7000 card when my 9600 card died so maybe the age of the card is to blame.<br><br>Could someone verify the comments in the code are correct - Flip 0 should have no lag? <br><br></td></tr></table><br>
<a name="772169"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Azathoth</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm. I see a tearing effect in Grey Aliens example, although the tearing isn't in OpenGL or full screen the rectangle moves slower than in DX window. Other than that I don't see any lag or the rectangle moving by itself. <br><br></td></tr></table><br>
<a name="772189"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> It depends on the Video Hardware/Drivers.  My PC at home does not do it.  My PC at work does it.  But, if I set the driver to OpenGL, then it doesn't do it on either machine. <br><br></td></tr></table><br>
<a name="772216"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> CGV: Yeah the comments in tonyg's code are correct, you should see a lag if you move the mouse fast but not with Flip 0.<br><br>Azahoth: weird.  Did you try adjusting the loop size? <br><br></td></tr></table><br>
<a name="772222"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Azathoth</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> I did increase it later but still didn't see much in the way of the rectangle moving on its own. The main thing that caught my eye was in DX window mode it suffered tearing and but moved faster. <br><br></td></tr></table><br>
<a name="772227"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> skidracer: That fix didn't work I'm afraid.  There is still lag. <br><br></td></tr></table><br>
<a name="772538"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >popcade</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think it's better to submit to bug area and post the examples code, I got the lag ,too. <br><br></td></tr></table><br>
<a name="772543"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok will do. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
