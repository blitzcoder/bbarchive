<!DOCTYPE html><html lang="en" ><head ><title >PHP's bcmath in bmax?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >PHP's bcmath in bmax?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >PHP's bcmath in bmax?</a><br><br>
<a name="883077"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kronholm</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey guys, been a while since I posted :) Hope everyone is doing alright!<br><br>I have a problem :p I'm trying to port aochat (found here <a href="http://aocchat.googlecode.com/svn/trunk/AOChat.php)" target="_blank">http://aocchat.googlecode.com/svn/trunk/AOChat.php)</a> which is a php class that makes it possible to communicate with Age of Conan chat servers.<br><br><br><br>Problem is, the class I'm trying to port relies heavily on the bcmath lib that's builtin to php. There's a page here explaining what bcmath is: <a href="http://mgccl.com/2007/01/26/introduction-to-bcmath" target="_blank">http://mgccl.com/2007/01/26/introduction-to-bcmath</a><br><br>Does anyone know if there's libraries available for blitzmax to perform similar operations such as bcadd, bcmod etc.? I'm by no means a math geek, so it's impossible for me to understand the concepts, sadly. <br><br></td></tr></table><br>
<a name="883083"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> How's about : <a href="http://code.google.com/p/maxmods/wiki/MapmModule" target="_blank">MAPM</a>? <br><br></td></tr></table><br>
<a name="883086"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kronholm</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks a bunch Brucey! Time to test that baby out! :D <br><br></td></tr></table><br>
<a name="883095"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kronholm</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ugh, either I'm sleepy or I'm not getting how to use your module properly Brucey.<br><br>The place I'm stuck at is the following:<br><br><pre class=code>
	function generate_login_key($servkey, $username, $password)
	{

                        $dhY = "0x9c32cc23d559ca90fc31be72df817d0e124769e809f936bc14360ff4bed758f260a0d596584eacbbc2b88bdd410416163e11dbf62173393fbc0c6fefb2d855f1a03dec8e9f105bbad91b3437d8eb73fe2f44159597aa4053cf788d2f9d7012fb8d7c4ce3876f7d6cd5d0c31754f4cd96166708641958de54a6def5657b9f2e92";
		$dhN = "0xeca2e8c85d863dcdc26a429a71a9815ad052f6139669dd659f98ae159d313d13c6bf2838e10a69b6478b64a24bd054ba8248e8fa778703b418408249440b2c1edd28853e240d8a7e49540b76d120d3b1ad2878b1b99490eb4a2a5e84caa8a91cecbdb1aa7c816e8be343246f80c637abc653b893fd91686cf8d32d6cfe5f2a6f";
		$dhG = "0x5";
		$dhx = "0x".$this-&gt;get_random_hex_key(256);

		$dhX = $this-&gt;bcmath_powm($dhG, $dhx, $dhN);
		$dhK = $this-&gt;bcmath_powm($dhY, $dhx, $dhN);
</pre><br><br>Basically, I can't figure out how to use tmapm.pow() for this. I've tried a lot of things, but can't seem to wrap my head around it :( I'll go sleep on it, but would really appreciate if you could give me a hint! :D <br><br></td></tr></table><br>
<a name="883100"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> You need to convert the rather large hex number into a looooooong integer representation - just like what AOChat does...<br><br>eg.<br><pre class=code>
...
	function bcmath_powm($base, $exp, $mod)
	{
		$base = $this-&gt;bighexdec($base);
		$exp  = $this-&gt;bighexdec($exp);
		$mod  = $this-&gt;bighexdec($mod);
...
</pre><br>and<br><pre class=code>
	function bighexdec($x)
	{
		if(substr($x, 0, 2) != "0x")
		{
			return $x;
		}
		$r = "0";
		for($p = $q = strlen($x) - 1; $p &gt;= 2; $p--)
		{
			$r = bcadd($r, bcmul(hexdec($x[$p]), bcpow(16, $q - $p)));
		}
		return $r;
	}
</pre><br><br>The rest should be easy to port..<br><br>;-) <br><br></td></tr></table><br>
<a name="883243"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kronholm</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> The thing I'm stuck on, and I mean seriously stuck on, is this:<br><br><pre class=code>$r = bcadd($r, bcmul(hexdec($x[$p]), bcpow(16, $q - $p)));</pre><br><br>How would I even begin to write that with your module? I've tried breaking it up in seperate pieces, but with frustrating results :) I'm sure, again, that I'm missing something basic?<br><br>The bcpow part (bcpow(16, $q - $p)));), as I understand it, should be something like this:<br><pre class=code>
		Local sixteen:TMAPM = New TMAPM.Create("16")
		Local bcpow:TMAPM = New TMAPM
		bcpow = bcpow.pow(sixteen,q-p)
		Print bcpow.tostring()
</pre> <br><br></td></tr></table><br>
<a name="883264"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kronholm</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Two hours later :p Finally got it working, the bighexdec that is :) Thanks again Brucey, your module saved my day!<br><br><pre class=code>
Local key$ = "0xc48840545531b0c3fee627c46f13bc5a36c05e120685150f2fc8aff7a9f50f45"
Print bighexdec(key)

Function bighexdec$(x$)
	If Mid(x,0,3) &lt;&gt; "0x" Print "Start of key aint '0x'." ; Return
	Local r:TMAPM = New TMAPM
	Local q = Len(x)-1
	For Local p = q To 2 Step -1
		Local power:TMAPM = New TMAPM.Create(q-p)
		Local powresult:TMAPM = New TMAPM.Create(16)
		powresult = powresult.pow(power,160)
		Local decresult = hexdec(Chr(x[p]))
		Local mulresult:TMAPM = New TMAPM.Create(decresult)
		mulresult = mulresult.multiply(powresult)
		Local addvalue:TMAPM = New TMAPM.Create(r.tostring())
		r = addvalue.add(mulresult)
	Next
	Local result$ = r.tostring()
	Return Left(result, Len(result)-2)	'return result with no '.0'
EndFunction</pre> <br><br></td></tr></table><br>
<a name="883270"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kronholm</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any reason there's no modulus function in MAPM, Brucey? Could really use it :p <br><br></td></tr></table><br>
<a name="883291"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Glad you got there in the end :-)<br><br>I only implemented the API that MAPM provides... (means I don't have to think too hard!)<br><br>Anyhoo, how's about this for now :<br><pre class=code>
SuperStrict
Framework BaH.MAPM
Import BRL.StandardIO

Function modulo:TMAPM(x:TMAPM, modY:TMAPM)

	Local a:TMAPM = x.IntegerDivide(modY)
	Local b:TMAPM = a.Multiply(modY)
	Return x.Subtract(b)

End Function


Function showMod(x:String, y:String)
	Print x + " mod " + y + " = " + modulo(New TMAPM.Create(x), New TMAPM.Create(y)).ToIntString()
End Function

showMod(20, 7)
showMod(7, 20)
showMod(144, 12)
showMod(360, 17)

</pre><br><br>I suppose we could have a built-in version of it :-) <br><br></td></tr></table><br>
<a name="883507"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kronholm</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Brucey, again :) The modulo definitely works and helped me out greatly! <br><br></td></tr></table><br>
<a name="883588"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kronholm</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey Brucey? Don't suppose you have a ported version of php's pack and unpack for BlitzMax? :p <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
