<!DOCTYPE html><html lang="en" ><head ><title >passing blitzmax object to LUA?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >passing blitzmax object to LUA?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >passing blitzmax object to LUA?</a><br><br>
<a name="943925"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> How would I pass a blitzmax object to a lua function, alter one of the fields and pass it back?<br><br>If I altered one of the fields would the object change in blitzmax without it being passed back? <br><br></td></tr></table><br>
<a name="943947"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can use my wrapper or write your own code to handle passing/receiving objects to/from Lua, beyond that you cannot do this. <br><br></td></tr></table><br>
<a name="943951"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Personally, I send the objects as integer handles using HandleFromObject and HandleToObject.<br><br>I expect it's theoretically possible to use a BlitzMax object and derive the fields and maybe even function pointers and access them from Lua, but it's not a very safe or easy way to do things.<br><br>Much better to create functions in your Types for everything you want to do from Lua and then bind those functions so that Lua can call them.<br><br>Lua isn't an Object Oriented language, as such, but it does allow you to create tables (similar to arrays) which are full of function pointers. You could do that in a "constructor" function in lua, so that all the "methods" are instantiated when you create your "object" (table.) Your table will also need one more "hidden" field which you can _Handle or _Peer or something which holds the integer handle. You'll need to pass that back to BlitzMax whenever you call a method so that BlitzMax knows which object it should use to access the method. If everything is functions, and no methods are required, you won't need to do this.<br><br>It also allows you to use the : operator as syntactic sugar for passing itself as the first parameter.<br><br>EG:<br><br><pre class=code>
DoSomething(A,B)
</pre><br><br>is functionally the same as<br><br><pre class=code>
A:DoSomething(B)
</pre> <br><br></td></tr></table><br>
<a name="943954"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> but it's not a very safe or easy way to do things. <br></div>Not entirely true, considering I did it (and relatively safely, since it's just using the reflection code).<br><br><div class="quote"> Much better to create functions in your Types for everything you want to do from Lua and then bind those functions so that Lua can call them. <br></div>This is true, but only to some degree.  Writing tons of glue functions gives me a headache, so I fixed that issue, more or less, by simply exposing types with their methods and fields accessible (unless a specific method or field is set to be hidden). <br><br></td></tr></table><br>
<a name="943974"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Nilium - do you have an example script to use with your wrapper?<br>I got your wrapper fromn the other thread I think.<br>Just to see it in action.<br>I havent got a clue how to use it.<br><br><br>@gabriel<br>integer handles, solves a lot of the issues I thought would crop up<br>So if I wanted to alter the x field of an object of type car I would have to write a glue function like<br>type car<br>function increase_x(c:car)<br>c.x=c.x+1<br>endfunction<br>endtype<br><br>instead of just doing c.x=c.x+1  in LUA code. <br><br></td></tr></table><br>
<a name="943989"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well yeah, you could do it like that, but I would probably have a function called SetX and a function called GetX and then you could set and get any combination you want, and let Lua do the work.<br><br>EG:<br><br><pre class=code>
Car:SetX(Car:GetX()+1)
</pre><br><br>But you could also have:<br><br><pre class=code>
Car:SetX(Car:GetX()/2)
</pre><br><br>Without binding any new functions. You can send and receive as any variables as you need, so it makes sense to use them if you can. Don't go overboard though, as there's an overhead in using lots of function parameters, same as there is in BlitzMax itself.<br><br>@Noel: Sorry, I'm not at all familiar with your module. I was just answering the question and you can probably see from the post time(s) that I started replying before you finished replying. You're right, of course, binding lots of functions can be a bit of a drag. <br><br></td></tr></table><br>
<a name="943991"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  do you have an example script to use with your wrapper?  <br></div><br><br>Try <a href="http://gist.github.com/80159" target="_blank">http://gist.github.com/80159</a><br><br>This is from the example I have in the code archives (I should remove the code from the archives, it's outdated).  None of the other stuff I've used this for is really suitable for sharing or example right now.  I'll have to work on a more practical use of the code until then. <br><br></td></tr></table><br>
<a name="944387"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> only just got time to check it out now,<br><br>Good example! thanks for the code. <br><br></td></tr></table><br>
<a name="944416"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> im trying to move someone around a map<br><br>Im creating the character with newchar() which was generated by the reflection code, but I need to return the integer handle to blitzmax so it can be put onto the character list which is used to draw the map.<br><br>It says that the char which i created with newchar() is a table and not an integer, how do i get the integer handle? <br><br></td></tr></table><br>
<a name="944444"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well I have no idea how you're doing it, but I guess if you're using reflection, you're using Noel's module. I would assume he puts the BlitzMax object handle in the table somewhere. That's what I do. Isn't there a clue in the newchar() function? <br><br></td></tr></table><br>
<a name="944466"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Objects are stored using Longs inside of a userdata passed to Lua.  I don't use Handle because this doesn't work for passing multiple instances of an object very well (still fiddling with other ideas).<br><br>The structure of a BMax object in Lua is, more or less, a table with two metatables, one for field access and one for garbage collection (the field metatable is assigned to the object table, the GC metatable is assigned to the user data), a userdata containing a long to reference the object, and generic callbacks for each method (which method is called is based on the upvalues pushed with the callback).<br><br>If you need to add the object to a list, I would recommend that you either add a method to it that adds it to the list, or add it to the list in the constructor. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
