<!DOCTYPE html><html lang="en" ><head ><title >BlitzMax x86 OSX Bank problems</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >BlitzMax x86 OSX Bank problems</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >BlitzMax x86 OSX Bank problems</a><br><br>
<a name="696793"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sonic</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok the first problem I've run into besides not being able to Build All Modules (see my bug reports thread) is this:<br><br>My program has a map loader which uses a TBank, and is getting odd values with PeekInt().<br><br>Could this be a problem with endian-ness?  I have tried both endian switches on the bank load line, and though my game seems to run fine under Rosetta (the PPC version of it), the Intel version seems to only be able to Peekbyte successfully, not PeekInt...  <br><br>Hmmm...  Any ideas? <br><br></td></tr></table><br>
<a name="696801"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ozak</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> If PeekByte works but not PeekInt it could be an endianess issue. If you know the value, you could look at the bytes of the integer to see if they are switched. <br><br></td></tr></table><br>
<a name="696804"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any chance that you haven't converted your map from PPC to X86 before trying to load it?<br>Doing so, when I'm not completely wrong can be done by reading it as a PPC endian stream and save it X86 endian.<br>TBank is endian independent and works differently, at least I think someone from BRL mentioned something like that, unlike TStream. <br><br></td></tr></table><br>
<a name="737853"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sonic</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Dreamora, going to resurrect this thread cos I want to do some work on my game on my old PPC laptop while away.<br><br>So how would I convert the endianness of the map files I'm using then? <br><br></td></tr></table><br>
<a name="737855"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Load them and save them with the appropiate flags and headers. I'll suggest you to take a look to the LoadText and SaveText functions of the TTextStream module, to see very easily how to do this kind of stuff. <br><br></td></tr></table><br>
<a name="737859"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sonic</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks I've had a look but I'm none the wiser..!  So I should load the bank as text and save as text to convert? <br><br></td></tr></table><br>
<a name="737894"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sonic</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry Ziggy could you elaborate a little? <br><br></td></tr></table><br>
<a name="737895"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JazzieB</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, I've recently ran into this problem as well.  It is an endianess problem related to how PPC and x86 processors store values greater than a byte.  Basically, PPC processor store their values hi-byte to lo-byte, while x86 store them lo-byte to hi-byte.  You have to take this into account when using the Peek and Poke commands, as the endian settings are used for streams only.  You could use a bank stream, but I chose to simply account for the processor in use when doing my Peek/Poking, thus..<br><br><pre class=code>?x86
lev.timeLimit=PeekShort(bank,offset+ldLimit)
?PPC
lev.timeLimit=PeekByte(bank,offset+ldLimit)+256*PeekByte(bank,offset+ldLimit+1)
?</pre><br>As you can see, there are compiler directives to check which processor is being used.  As the original file was created on a PC (x86) I simply checked if the program was being compiled on a PPC Mac and simply calculated the correct value using PeekByte instead.<br><br>Naturally, this is a little slower, but all my data is transported into an array before the game starts, so speed here is not an issue.<br><br>You would do something similar for ints (4 bytes).<br><br>Hope that points you in the right direction. <br><br></td></tr></table><br>
<a name="737948"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sonic</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Excellent, thanks for the tip, this should solve the problem. <br><br></td></tr></table><br>
<a name="737968"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> You need to SAVE your data using the same endianness that you load it with. That should take care of all issues. If not, you can just read in an Int from the bank and then do byte masking and swapping to turn it into the right format. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
