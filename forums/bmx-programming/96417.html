<!DOCTYPE html><html lang="en" ><head ><title >Banks</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Banks</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Banks</a><br><br>
<a name="1115753"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BLaBZ</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> What are banks? I'm incorporating path finding into my application and I need something fast, would banks be good for this?! <br><br></td></tr></table><br>
<a name="1115754"></a>

<a name="1115755"></a>

<a name="1115756"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Banks are a holdover from the era of Blitz Classic, presumably for compatibility with Blitz3D programs. They expose a non-GC'd block of untyped memory into which you can Poke any binary values you please.<br><br>In other words, they are slow, unsafe (requiring you to break both the type system and the GC), and don't offer any features you can't get from arrays or other container structures. Unless you quickly need to port B3D code without bothering to rewrite it, best not to use them.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1115772"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I say go ahead and use them if you want to. I find them handy sometimes. <br><br></td></tr></table><br>
<a name="1115793"></a>

<a name="1115795"></a>

<a name="1115798"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I disagree with Yasha  in that they are slow.  Used creatively, they are even faster than Bmax arrays.  For an a* algorithm it's a great option in my opinion.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1115839"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Banks can be very handy for other things like byte conversion work, and as Jesse suggested sometimes they can be MUCH faster than standard arrays. <br><br></td></tr></table><br>
<a name="1115863"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Using pointers with banks is fast, I would say avoid the peek/poke stuff although that's supposed to be `safer` for when you `lock` the bank to keep its memory from being reallocated or whatever. <br><br></td></tr></table><br>
<a name="1116409"></a>

<a name="1116410"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mpmxyz</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Banks are faster than arrays?<br>I tested it and also found no significant speed difference between pointers and arrays.<br><br>My times in non-threaded mode without debugger with 100 iterations and 100000000 integers:<br><pre class=code>memalloc: 1 ms
memclear: 12626 ms
new array: 11617 ms
pointer set: 6144 ms
array set: 6243 ms
pointer read: 3833 ms
array read: 3843 ms
pointer copy: 4572 ms
array copy: 4554 ms
pointer resize: 21552 ms
array resize: 18433 ms
pointer free: 3222 ms
array collect: 0 ms</pre><br><br>The same in threaded mode:<br><pre class=code>memalloc: 1 ms
memclear: 12488 ms
new array: 11531 ms
pointer set: 6047 ms
array set: 6084 ms
pointer read: 3835 ms
array read: 3840 ms
pointer copy: 4507 ms
array copy: 4498 ms
pointer resize: 21480 ms
array resize: 15269 ms
pointer free: 3132 ms
array collect: 3217 ms</pre><br><br>Here is my code:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">SuperStrict

Const ITERATIONS:Int=10
Const SIZE:Int=100000000
Local tests:String[]=["memalloc","memclear","new array","pointer set","array set","pointer read","array read","pointer copy","array copy","pointer resize","array resize","pointer free","array collect"]
Local time:Int[]=New Int[tests.length+1]
Local i:Int,j:Int,iteration:Int

For Local iteration:Int=0 Until ITERATIONS
	GCCollect()
	time[0]:+MilliSecs()
	Local pointer:Int Ptr=Int Ptr(MemAlloc(SIZE*4))
	time[1]:+MilliSecs()
	MemClear(pointer,SIZE*4)
	
	time[2]:+MilliSecs()
	Local array:Int[]=New Int[SIZE]
	
	time[3]:+MilliSecs()
	For i=0 Until SIZE
		pointer[i]=i
	Next
	time[4]:+MilliSecs()
	For i=0 Until SIZE
		array[i]=i
	Next
	
	time[5]:+MilliSecs()
	For i=0 Until SIZE
		j=pointer[i]
	Next
	time[6]:+MilliSecs()
	For i=0 Until SIZE
		j=array[i]
	Next
	
	time[7]:+MilliSecs()
	MemCopy(pointer,pointer+SIZE/2,SIZE/2*4)
	time[8]:+MilliSecs()
	MemCopy(Varptr array[0],Varptr array[SIZE/2],SIZE/2*4)
	time[9]:+MilliSecs()
	pointer=Int Ptr(MemExtend(pointer,SIZE*4,SIZE*4+100))
	MemClear(pointer+SIZE,100)
	
	time[10]:+MilliSecs()
	array=array[..SIZE+25]
	GCCollect()	'to be fair: collect the unused aray
	
	time[11]:+MilliSecs()
	MemFree(pointer)
	time[12]:+MilliSecs()
	array=Null
	GCCollect()
	time[13]:+MilliSecs()
	Print GCMemAlloced()+" bytes of memory allocated"
Next

Print "Here come the test results:"

For i=0 Until tests.length
	Print tests[i]+": "+(time[i+1]-time[i])+" ms"
Next</textarea><br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1116417"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> There is a tread a few months back that illustrate that. When I get a chance I'll look for it. Can't now don't have time. <br><br></td></tr></table><br>
<a name="1116418"></a>

<a name="1116419"></a>

<a name="1116420"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> There have been a lot these types of arguments over the 'this is faster than that' command, but in real terms unless you're doing millions and millions of iterations then there is no 'real' conceivable difference.<br><br>I'd start out with makes the code easiest to read and intuitive for you, and of course the code must work :D and don't worry about the tiny nanosecond that you may save by making things awkward for yourself with code thats hard to understand 6 months later.<br><br>EDIT : TBH There is a well known pit-fall called 'Premature Optimization™', and most of these type of arguments qualify. I guess it makes for interesting conversation though :D<br> <br>Multi-threading is for you to write multi-threaded apps, and not for BMax to make your code multi-threaded for you. If that makes sense :/<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1116431"></a>

<a name="1116432"></a>

<a name="1116433"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >mpmxyz</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Multi-threading is for you to write multi-threaded apps, and not for BMax to make your code multi-threaded for you. If that makes sense :/ <br></div><br>BlitzMax uses a different garbage collector when enabling threaded mode.<br>I just wanted to show that it doesn't change much. ;-)<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1116444"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah I see :P<br>I thought you were expecting a significant speed increase when using the multi-thread option as the topic is about speed :D<br><br>I don't use the multi threading option hardly and I've read some forum posts about it being occasionally buggy, although that's not why I don't use it.<br><br>As for speed - of course if you 'DID' use multiple threads then it's a whole new ball game and there's been some heavy work by people here optimising certain 'classic' routines :P <br><br></td></tr></table><br>
<a name="1116507"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I take it back the high level Bank instructions are probably as slow as arrays but when you get to the core of banks all they are is a stream of bytes. and when you access the bank  as byte pointers they are  faster than array: <br><br><a href="http://www.blitzmax.com/Community/posts.php?topic=93727#1072860" target="_blank">http://www.blitzmax.com/Community/posts.php?topic=93727#1072860</a><br><br>just in case you find it useful but I do agree with col not all optimization will give you the needed results and this will probably won't either. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
