<!DOCTYPE html><html lang="en" ><head ><title >How to get around cyclic referencing?!?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >How to get around cyclic referencing?!?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >How to get around cyclic referencing?!?</a><br><br>
<a name="1000278"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DH</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> With Max's lack of multi-pass compiling, I know I cannot over burden the compiler with cyclic referencing, however I enjoy using callbacks to do work between object instances.  How can I accomplish callbacks without cyclic referencing?<br><br>Example:<br>This is used widely in threading unless all the objects needed were created by the thread in question, in which case is only 1 of many uses of threading.  Many times multithreading, one thread creates an object and passes it to another thread for work done on it.  In my case, I need an object created by one thread, worked on by another (just a portion of the object like it's TCP stack), and any data generated by it to be passed back to the first thread for processing when the first thread sees fit to do so.  The object must live in both threads, which isn't the problem, but doing call backs on it with regards to the compile and referencing seems to render an efficient solution useless.<br><br>"ObjectA.bmx"<br><pre class=code>
Import "ObjectB.bmx"
Import "ObjectC.bmx"
Type ObjectA
	Field MightDoWorkWithB:ObjectB
	Field Commonworker:ObjectC
End Type
</pre><br><br>"ObjectB.bmx"<br><pre class=code>
Import "ObjectA.bmx"
Import "ObjectC.bmx"
Type ObjectB
	Field MightDoWorkWithA:ObjectA
	Field Commonworker:ObjectC
End Type
</pre><br><br>"ObjectC.bmx"<br><pre class=code>
Import "ObjectA.bmx"
Import "ObjectB.bmx"
'Common object used by both A and B, Can be created by A or B, work it does it communicates back to whoever created it
Type ObjectC
	Field callBackToA:ObjectA
	Field callBackToB:ObjectB
End Type
</pre><br><br>I know the one answer to the question is "just put it all in one file".  But with the length of what these objects do, it would quickly deem the project unmanageable (and totally counter-productive to the objective behind having imports)<br><br>If I compiled this, it would scream duplicate definitions.  But if I dont have it just as it is, it would claim it can't find definitions.  Other languages use multipass-compiling (first pass to flag definitions that are needed for compiling by the second pass) or declarations saying that a definition will be included in a later part of the compile or even holding the compiled definition with conjunction to the defined file for use when compiling all modules on the tree where needed.  How can I get around this and still use the callbacks? <br><br></td></tr></table><br>
<a name="1000281"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> One common way to solve these kind of A talks to B and B talks to A problems is to use a Messaging system. If you're into design patterns, there are probably a few to look at. If not, it works something like this:<br><br>Currently, you have two objects. Object A and Object B. Object A has a function which is called when Object B does something. Here's what we do instead:<br><br><pre class=code>
Object A tells the messaging system that it wants to register as a listener for events of a certain type ( from Object B if the event is Object specific).

Object B does that event at some point. It sends a message to the messaging system telling the messaging system what happened.

The messaging system looks through the list of receivers for that sort of event (and that object if the event is specific to an object) and sends a message to all of them, telling them that the event took place.

So at this point, Object A gets a message from the Messaging system telling it about the event that happened. It now calls the appropriate function to deal with that response.
</pre><br><br><br>Typically you would implement this with a base class with certain register, and receive methods (possibly abstract) and then have all your game objects inherit from this base class. Then you can override the receive method with a method which deals with the received events and the messaging system only has to know about the base object.<br><br>So your Messaging system needs to know about the base object. The base object doesn't need to know about anything but itself, and all your other objects are (theoretically) self sufficient.<br><br>Since you have circular refs, you will presumably want Object B to listen for an event Object A does, so you would just have that register as a listener too. <br><br></td></tr></table><br>
<a name="1000282"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DH</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> That'll work!  Thanks Gabriel! <br><br></td></tr></table><br>
<a name="1000299"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Arowx</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Another way is to use a hub or core include/import file that ensures all elements are included!<br><br>Include effectivly creates a larger file at the cost of decreased compile speed (not really an issue) so if you have a set of types that cyclicly refer just ensure that they are included into a single file that can then be combined with other code files! <br><br></td></tr></table><br>
<a name="1000311"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DH</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Another way is to use a hub or core include/import file that ensures all elements are included! <br></div><br>Unfortunately this doesn't work when your using the "framework" stuff as the compiler doesn't carry down references into each import, it's like it starts the compile slate clean with every import it goes into. <br><br></td></tr></table><br>
<a name="1000319"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is this allowed in any language?<br><br>I think you just have a design flaw... <br><br></td></tr></table><br>
<a name="1000425"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DH</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> What?  Callbacks/Delegates? <br><br></td></tr></table><br>
<a name="1000439"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cyclic references as you call it, the subject of your post... <br><br></td></tr></table><br>
<a name="1000447"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> The threaded garbage collector handles cyclic references ... or is that something different? <br><br></td></tr></table><br>
<a name="1000462"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>Import "ObjectB.bmx"
Import "ObjectC.bmx"

Type ObjectA
	Field MightDoWorkWithB:ObjectB
	Field Commonworker:ObjectC

Method Free()
Commonworker.MightDoWorkWithA=Null
Commonworker=Null
MightDoWorkWithB.MightDoWorkWithA=Null
MightDoWorkWithB=Null
EndMethod

End Type</pre> <br><br></td></tr></table><br>
<a name="1000504"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> He wants to be able to do this:<br><br>A imports and uses B<br>B imports and uses A<br><br>So, each one depends on the other to compile, but since neither one of them can be compiled first, he has a chicken and egg scenario and it won't work.<br><br>It is a design flaw, IMHO. <br><br></td></tr></table><br>
<a name="1000506"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DH</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> What other compilers suffer the "chicken and egg" scenario? <br><br></td></tr></table><br>
<a name="1000514"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh. Use include. ;-P <br><br></td></tr></table><br>
<a name="1000519"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Muttley</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Dark Half: Well, C++ for a start.  Hence the pre-processor ifndef/define/endif stuff you get in the header files... <br><br></td></tr></table><br>
<a name="1000524"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jur</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe it is a design flaw but it forces me to to maintain a good structure for my code :) <br><br></td></tr></table><br>
<a name="1000538"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DH</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> @Dark Half: Well, C++ for a start. Hence the pre-processor ifndef/define/endif stuff you get in the header files...  <br></div><br><br>But isn't the c++ pre-processor part of the implementation of c++?  I thought all c++ compilers came with the pre-processor.<br><br><div class="quote"> Oh. Use include. ;-P  <br></div><br>How would include be used?  Is it the same as import?<br><br>Perhaps I'll just use a combination of inheritance and uncasted objects as a hacky way to do callbacks.  I was toying with what Gabriel had said however with regards to speed I can't afford to iterate through a list of objects, the messages need to be instantaneous hence the need for a direct link to the object.<br><br>As for design flaw, are you referring to my design?  Although I can honestly say it isn't exactly considered to be on the "good practice" list, it is still a common practice.  However if your referring to it being a design flaw with regards to the limitations of Blitzmax, then yeah, it is however with what I am currently doing it's a design flaw I was hoping would work....  This project's counter-part is in c# (more specifically in Unity using c#). <br><br></td></tr></table><br>
<a name="1000544"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Include -to make it easier to understand- just puts a file inside another.<br><br>If FileA includes FileB, any type declared on FileA can reference FileB types, and any type defined in FileB can reference FilaA types, as efectivily, they are the same file after the include is calculated at compile time.<br><br>Some people here will tell you that any file in a program has to be imported (becouse using include will force a rebuild in case any of the included files is modified). Others will recommend you to ignore import and use only include becouse it allows you to organize your code structure <b>as you wish...</b><br><br>I would recommend you to organize your code into compilation clusters, that is, every program is a collection of imports, but each import can be a single file or a collection of <b>includes</b>. Every import is a compilation cluster -or compilation module in .net talk- and should contain all classes involved on a specific task. That will help you a lot in code re-usability. <br><br></td></tr></table><br>
<a name="1000556"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nate the Great</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> so what if you did this<br><br>main.bmx imports a<br><br>a.bmx includes b which needs to reference a and viceversa <br><br></td></tr></table><br>
<a name="1000587"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> you can do that too, but with more and more things it will become less well maintainable than the cluster / package approach <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
