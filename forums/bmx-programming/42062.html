<!DOCTYPE html><html lang="en" ><head ><title >How many levels are possible?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >How many levels are possible?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >How many levels are possible?</a><br><br>
<a name="471504"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PowerPC603</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>I've completely converted my loading-routines from B3D into BMax.<br><br>This is how I do it now (in BMax):<br><br>I have one type-instance called "Universe", which is a TUniverse type.<br>Inside this TUniverse, I have an array ASectors, which holds all pointers to all TSector type-instances inside the universe.<br>Inside each TSector, there's an array AStations, which holds all pointers to all stations inside this sector.<br><br>So, to get the name of the 3rd station inside sector 2, I simply can do this:<br><br><pre class=code>
Print Universe.ASectors[2].AStations[3].Name$
</pre><br><br>How "deep" can I go with this approach?<br><br>As there need to be some extra "levels" further, because each station can have it's own list of commodities that are for sale there.<br><br>So, for the name of the 5th commodity inside the same station, I would have to do this:<br><br><pre class=code>
Print Universe.ASectors[2].AStations[3].ACommodities[5].Name$
</pre><br><br>If you want the entire code (and try it for yourself to see how it works):<br><a href="http://users.pandora.be/vge/SG/SG.zip" target="_blank">http://users.pandora.be/vge/SG/SG.zip</a> <br><br></td></tr></table><br>
<a name="471509"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >taxlerendiosk</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I doubt I'll convey this very legibly, but - there is no real "depth" to it, you're just bouncing around in memory. Going "deeper" each step is really no more complex than going to the next item in a linked list. (I think.) <br><br></td></tr></table><br>
<a name="471609"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> How "deep" can I go with this approach? <br></div>Until you run out of physical memory. Probably performance is going to take a serious hit after you hit about 1/8th of available memory, as second chance cache misses increase, and the OS starts swapping memory like mad. <br><br></td></tr></table><br>
<a name="471721"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> There is no real limit to how far you can go with this. <br><br></td></tr></table><br>
<a name="471767"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PowerPC603</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks guys.<br><br>This approach is kinda similar to using TLists, but by using arrays, I can always pinpoint the correct type-instance directly, instead of having to loop through all instances inside a TList to find a specific instance, which of course could replace the array.<br><br>Doing it this way, seems to be the easiest way for me to keep my entire universe organised.<br><br>In B3D I used a 1D array for the sector-type instances, a 2D array for all stations and a 3D array for all commodities.<br><br>Now each sector has it's own array of stations, and each station has it's own array for commodities.<br><br>There's no need for moving stuff, because the entire structure of the universe is written inside a datafile (very much like Freelancer).<br><br>I think running out of physical memory won't be much of a problem, because I've got 512Mb on my system and the universe-datafile should not exceed 25Mb or so.<br>This includes keywords for the game to interpret, so it knows which data to store in which type-instance's field.<br><br>As far as I can think ahead, the commodity-level will be the "deepest" level (maybe one more), and I'm not seeing any trouble with the cache right now (everything runs perfectly). <br><br></td></tr></table><br>
<a name="471919"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hotcakes</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well if Mikkel's 1/8th estimation is accurate, don't run your code on anything less than a 256meg machine ;] <br><br></td></tr></table><br>
<a name="471948"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PowerPC603</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Now I've updated my code to include a FlushMem in each function that doesn't return anything (also at the end of each type's method).<br>Is this actually a good approach?<br><br>Would it be best to:<br>- only use FlushMem after loading the entire datafile,<br>- or use FlushMem after each object (type-instance) has been created, to flush local variables that were used inside methods and functions?<br><br>I've checked the MemAlloced before I did this (place FlushMem inside each method) and it used about 200Kb memory (after loading all data about the universe).<br>After using FlushMem once, it reduced to about 15Kb.<br><br>Now I'm loading even more (some extra commodities, for which I also wrote the code today, to load those parameters) into memory and uses only 9Kb after the last FlushMem.<br><br>It seems that if you use FlushMem regularly, the memory is cleaned up much more than using it only once, after doing all stuff in one go. <br><br></td></tr></table><br>
<a name="471988"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> It would be best to use Flushmem only once in your program. Typically either right before, or right after the Flip. <br><br></td></tr></table><br>
<a name="471999"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PowerPC603</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried commenting all FlushMem commands in the entire code.<br><br>Only right before the MemAlloced()-value is printed (just before exiting the program), the FlushMem still exists.<br><br>The value increases to 12484 bytes instead of 9284 bytes (when all FlushMems are in place).<br><br>Here's the entire code, so you can see for yourself, that using multiple FlushMems clean up more than using it only once, after everything has been processed.<br>To do it, comment out all FlushMems in all files, except the last one in the main file (SpaceGame.bmx).<br><br><a href="http://users.pandora.be/vge/SG/SG2.zip" target="_blank">http://users.pandora.be/vge/SG/SG2.zip</a><br><br>I'm not using the Flip yet, because it's only the loading of the datafile that exists in the code.<br>There are no graphics yet, and no main loop. <br><br></td></tr></table><br>
<a name="472000"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Here's to entire code, so you can for yourself, that using multiple FlushMems clean up more than using it only once, after everything has been processed.  <br></div>It certainly shouldn't. Have you checked for cyclic references? I won't have time to check the code until the week-end. <br><br></td></tr></table><br>
<a name="472006"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PowerPC603</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> AFAIK, there are no cyclic references.<br><br>The methods do this (each type's structure in basically the same):<br>- scan for datablocks from the file<br>- analyse them with Select Case statements<br>- if a valid datablock has been found:<br>1) resize the appropriate array (increase size by 1)<br>2) create new type-instance at that last index (that was just created)<br>3) load line by line from the file and analyse it<br>4) store values inside newly created type-instance<br><br>- go back to the start of this list, until EOF is reached<br><br>There are no variables that hold a type-reference, only the indexes of the arrays.<br><br>This is why I find it strange myself why multiple FlushMem's clean up more than only one FlushMem at the end. <br><br></td></tr></table><br>
<a name="472010"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Perhaps resizing an array technically means create one with the new size and copy the old. This way with every resize a unreferenced copy would be left over which might end up in a "clean up hierarchy" for this array so I can't be cleaned with 1 call of flushmem. ( just an idea ... as C doesn't know of dynamic arrays and other implementations follow this way in the background as well )<br><br>Did you check the whole thing using a TList while extending and create a array from it at the end of scan and compare the result? <br><br></td></tr></table><br>
<a name="472114"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PowerPC603</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, I didn't do that.<br>In fact, I didn't use a single TList at all.<br>Everything is put directly inside the array.<br><br>Are you suggesting that I:<br>- 1) create all instances and add them to a TList<br>- 2) calculate the size of the TLists (count the types linked to this TList)<br>- 3) then resize all arrays all at once and then copy the pointers to the array (and eventually clear the Tlists)?<br><br>This would actually kill the approach to simply add a new station to a sector (or a new commodity to a station) later in the game.<br><br>This loading-routine is only executed at the start of the game (and makes it possible to simply add stuff later on), so it really doesn't matter if it takes a little longer to proces with all these FlushMems, because nothing (for now, later on there will be a splashscreen) is animated, so the player will not "see" any slowdowns.<br><br><div class="quote"> <br> Perhaps resizing an array technically means create one with the new size and copy the old.<br> <br></div><br><br>From what I can tell from the docs, that happens to be the case.<br>So actually it would be best to clean up right after the resizing of the array (to erase the old, unreferenced one)? <br><br></td></tr></table><br>
<a name="472123"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> no that wasn't what I mean't<br><br>There is a listtoarray function that simply returns an array with the content of your list.<br><br>You could simply use a list all the time as TList is indexed as well ( only if you use the OO part, not as a "flat function" ). It is not as fast as a static array but if your array is resized often then TList would be faster.<br><br>I can only suggest you that you check out the linkedlist.bmx to see the possibilities of TList :) You will be surprised <br><br></td></tr></table><br>
<a name="472254"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PowerPC603</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've got this working:<br><br><pre class=code>
Type TUniverse
	Field SectorList:TList = CreateList()

	Method AddNewSector(NewName$)
		TempSector:TSector = New TSector
		TempSector.Name$ = NewName$
		ListAddLast SectorList, TempSector
	End Method
End Type

Type TSector
	Field Name$
End Type

Global Universe:TUniverse = New TUniverse

Universe.AddNewSector("Sector 1")
Universe.AddNewSector("Sector 2")
Universe.AddNewSector("Sector 3")
Universe.AddNewSector("Sector 4")

For TempSector:TSector = EachIn Universe.SectorList
	Print TempSector.Name$
Next
</pre><br><br>But I cannot get the indexing in a TList to work.<br>I tried:<br><pre class=code>
Print Universe.SectorList.ValueAtIndex(2)
Print Universe.SectorList.ValueAtIndex(2).Name$
</pre><br><br>The first line gives an error that an object cannot be converted to a string, the second one cannot find the identifier Name$.<br><br>I tried looking at the code inside the linkedlists.bmx module-sourcecode, but couldn't find anything that indicated an index (except the ValueAtIndex).<br><br>And most source-code is still a bit confusing for me (as you can see). <br><br></td></tr></table><br>
<a name="472257"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> print TSector( Universe.SectorList.ValueAtIndex(2) ).name<br><br>TList always returns an instance of type "Object" which is the general basetype. You need to cast it to the type that you want it to be. <br><br></td></tr></table><br>
<a name="472261"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> The first line gives an error that an object cannot be converted to a string <br></div>Print is a bit picky about what input it takes. Make an accessor method in your sector type<pre class=code>Method GetName:String()
  Return Name$
End Method</pre>and invoke that instead of accessing the field directly, that should work (providing it's been cast properly, see below).<br><br><div class="quote"> the second one cannot find the identifier Name$.  <br></div>Yup. You need to make a downcast. ValueAtIndex likely returns an Object object, you need a TSector. Try (untested) <pre class=code>Print TSector(Universe.SectorList.ValueAtIndex(2)).Name$</pre> <br><br></td></tr></table><br>
<a name="472264"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PowerPC603</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Now I don't get an error, but it just prints an empty line, if I use the line from Dreamora.<br><br>The other one works (the one FlameDuck stated):<br><div class="quote"> <br>Print TSector(Universe.SectorList.ValueAtIndex(2)).Name$<br> <br></div><br><br>But doing all stuff this way, isn't that basically the same approach as with using arrays?<br><br>This way, the program is using TLists as arrays, but with a few more conversions (from Object to TSector, for example).<br><br>I'm sorry if I offend you, but I cannot see the difference between using arrays and TLists.<br>All can I see, is that using TLists is a bit more difficult (for me anyways).<br><br>I know the basic principe of a TList (as explained in many tutorials and other sources for Blitz+ and B3D), but using them is a bit harder.<br><br>The speed is not an issue, as the arrays are only resized during the loading-sequence of the game.<br>After the game is loaded and the main-menu appears, nothing happens anymore to these arrays.<br>They remain the same in memory during the entire game.<br><br>Except for some missions perhaps, which could add a temporary commodity to a station for transportation by the player or such things.<br>This would take one more resize of 1 array, which doesn't pose much of a problem, I think.<br><br>But when I'm at that point, I'm sure that I could create just a temporary commodity that is standalone (isn't part of a station), and act on that.<br><br>Or to create an empty station, that's only used when doing missions, which require the player for destroying it (also like Freelancer).<br>You couldn't dock with it and you wouldn't be able to trade with it, it would just be a structure in space, and it's only purpose is to be destroyed by the player, who receives money for blowing it up (money is issued by the person who gives the mission to the player, of course).<br><br>Only then (when accepting a mission), a new station is added to the SectorArray (which will be resized to hold this new station's pointer).<br>Or it could as well be created as a stand-alone station, where it's pointer is only held within a temporary pointer (variable). <br><br></td></tr></table><br>
<a name="472269"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> right, my code was wrong ... sorry<br>at least the explanation why it does not work was right ... :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
