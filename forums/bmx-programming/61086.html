<!DOCTYPE html><html lang="en" ><head ><title >Quickest way to sort list?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Quickest way to sort list?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Quickest way to sort list?</a><br><br>
<a name="682069"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, I've got a TList of types and each type has x and y coords.  I want to sort the list of types in descending y coordinate order (with greatest value first).<br><br>I'm actually converting some old BlitzPlus code that used an array and did a bubble sort on it, which was fine, but bubble sorts aren't that fast.  The list can be between 100-200 items so iterating through it too many times isn't cool.<br><br>I haven't yet investigated the built-in sorting capabilities of TList including the fact that you can supply your own compare function or something.  But I had read somewhere that it was a bit bugged, is this still true?<br><br>Anyway, I was thinking about using this method:  Basically I make a new TList and fill that up.  A single loop through the original list is required, but for each item in the original list I need to loop through the destination list to find the correct place to insert it.  Obviously at the start the destination list won't be very big, but by the end it will contain many items.  So this method sounds a tad slow.  But is it faster than a bubble sort I wonder?<br><br>I could try a binary search + sort but that only works on already sorted lists.  Other weird and wonder method are listed on wikipedia.  What ones have you found easily to implement with good results?<br><br>Oh yes, I'm aware that a TList can be converted into and array and back again, maybe I should do that first?<br><br>Thanks in advance. <br><br></td></tr></table><br>
<a name="682071"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fredborg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>Yes, convert it to an array, sort the array, and convert it back. It's reasonably fast, and saves you the trouble of making your own sorting function. <br><br></td></tr></table><br>
<a name="682073"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK thanks.  Well I still need a sorting function for the array of types because I'm sorting by the types' y coordinates, not the actual types themselves... <br><br></td></tr></table><br>
<a name="682075"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Which of those options have you tried?<br>What didn't you like about them when you actually *tried* them rather than thought about doing them?<br>Is is possible to sort the list first and then insert in the correct place? How often would it need sorting? Can you spread the sort over seperate frames?<br>The quickest way to sort a list might be some hideously complicated, over-the-top, not necessary for what you're trying to do type of process.<br>P.S. I'm not aware of having a problem with the Compare method although SSwift has posted a few times that it messes up findlink and stored links. Maybe, for whatever it is you're doing, that won't be a problem. <br><br></td></tr></table><br>
<a name="682081"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well in my last match-3 game the bubble sorted array worked and was fast but if called a few times a frame due to lots of changes, it could cause a spike in CPU use and result in slowdown on some machines.<br><br>Also I'm asking advice before I embark on the code in case anyone has tried this before (which they will have) and has some useful info.  I think research is important.<br><br>The sort can't be spread over several frames, it may need to occur more than once per frame as several different routines alter the y coords of the types and therefore the list needs to be resorted.  Also some functions depend on the y coords being sorted before they are called.  Why?  Well the types drop down with gravity and the lowest ones must be moved first - this happens each frame but other actions during the frame may alter their y coords.  The list is populated at the level start and can be sorted then with a slow function.  After that, when types are deleted or added (sometimes from the top of the screen, other times in the middle), the items need to be added in the correct place, so bunging them on the end of the list and doing an overall sort seemed attractive if slower...kinda fire and forget.  That's why I was looking for list sorting code. <br><br></td></tr></table><br>
<a name="682086"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you can start with a sorted list then you won't need to sort it all again just have InsertAfterlink using an index on 'Y'. Somebody will mention TMAP but that's beyond me at the momentm although there's a good example somewhere.<br>&lt;edit&gt; p.s. with 100-200 objects on a list you might even be able to use the list commands rather than the link methods.<br>&lt;edit&gt; P.P.S I think the Compare issue was fixed by the extra comparefunc parm. <br><br></td></tr></table><br>
<a name="682092"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes I can start with a sorted list (making the code now) but how do I make an "index on Y"?  Do you mean just loop through checking Y and insert at the correct point?  I guess so.  Deleting is fine as the list will handle that automatically, but what about when the Y coordinate of something changes, I guess I'll have to just loop to find the new position and move the link (can you move a link or is it just a case of backup/delete/insert?).<br><br>Hmm, OK I was going for the brute force approach of sort each time but after thinking a bit more (thanks TonyG) I realise I can be a bit cleverer and just insert or recalc the list position of anything that has moved ... <br><br></td></tr></table><br>
<a name="682094"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> TonyG: The docs say<br><br>[code]Method Sort( ascending=True,compareFunc( o1:Object,o2:Object )=CompareObjects )[/quote]  What's this extra comparefunc param? [edit] It's OK I found this:<br><br><a href="http://www.blitzbasic.com/Community/posts.php?topic=59675#665275" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=59675#665275</a> <br><br></td></tr></table><br>
<a name="682119"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, OK I've implement a full sort using CompareFunc and it's fine and fast too.<br><br>I made this insert method but I'm not convinced it's that fast because doesn't FindLink have to loop through the whole list looking for the matching object?  Is this a dumb way to do it?  Should I be looping through the Links directly instead of the list, and are the links *always* in the same order as the the list (maybe that's a dumb question)?  Heres some code:<br><br><pre class=code>
Type TGemList Extends TList
	Method InsertGem(ins:TGem)		
		'Loop through the already sorted (largest Y first) list checking the Y coord
		'and insert the passed in Gem in the correct place.
		Local added=0
		For Local g:TGem = EachIn Self
			If ins.Y &gt; g.Y Then
				InsertBeforeLink(ins, FindLink(ins))
				Added=1
				Exit 'done
			EndIf
		Next
		'If it wasn't inserted, add on the end
		If Not added Then AddLast(ins)		
	End Method
End Type
</pre> <br><br></td></tr></table><br>
<a name="682122"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> It would probably be quicker to do it by link or via TMAP/Hash 'map'(?) but looping and inserting into 100-200 will be negligable. <br>Try timing it and see what happens.<br>&lt;edit&gt; You might now want to override the Compare method to do your findlink() <br><br></td></tr></table><br>
<a name="682124"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I guess you are right, (it is effectively looping twice though, once to compare, and again to find the correct link) but I could be doing it up to say 20 times a frame.  It's really the idea that if you have a game, this is just one part of the logic and where possible I try to get it all optimised well so that overall it runs well to keep a high FPS. <br><br></td></tr></table><br>
<a name="682126"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why loop twice? Use the Compare override and then Insert <br><br></td></tr></table><br>
<a name="682130"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'll think about that, but I don't fully understand how to implement that...Anyway, surely compare has to loop as well? <br><br></td></tr></table><br>
<a name="682132"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep, compare and insert in the same loop if you're list is already sorted. <br><br></td></tr></table><br>
<a name="682133"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> My compare funciton looks like this:<br><br><pre class=code>
	Function CompareY%(o1:Object, o2:Object)
		If TGem(o1).Y&lt;TGem(o2).Y Then Return 1
		Return 0
	End Function		
</pre><br>Then in TGemList I have this method:<br><pre class=code>
	Method SortAll()
		Sort(True, TGem.CompareY)
	EndMethod	
</pre><br>I'm not sure how I'm supposed to use that function in the InsertGem method I posted...? <br><br></td></tr></table><br>
<a name="682140"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> You should be using your comparefunc to override the sortlist function and compare to override the findlink function. Findlink will return the link which you use in InsertAfterLink or InsertBeforeLink.<br>Alternatively, do it by hand. Check your.y against listobject.y, get the listfindlink using the matching object then InsertAfter/BeforeLink. <br><br></td></tr></table><br>
<a name="682146"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> regretably you've lost me. I can't be to hot on TLists and TLinks oh well...I do understand overriding in derived types though, luckily. <br><br></td></tr></table><br>
<a name="682152"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, last one before Germany vs Argentina.<br>Your list has been sorted using SortList with your CompareFunc method.... OK?<br>That leaves the FindLink method free to use your overridden Compare method. Your custom compare method returns the link of the object 'matching' your 'to-be-inserted' object. <br>This is used to InsertAfterLink (or InsertBeforeLink if required) the new object onto the list. <br><br></td></tr></table><br>
<a name="682162"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> WAH! You just better go and watch the footbal.  Thanks anyway... <br><br></td></tr></table><br>
<a name="682380"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> In the end I changed the Insert method to this:<br><br><pre class=code>
	Method InsertGem(ins:TGem)		
		'Loop through the already sorted (largest Y first) list checking the Y coord
		'and insert the passed in Gem in the correct place.
		Local added=0
		Local L:TLink = FirstLink()
		While True
			Local g:TGem = TGEm(L.Value())
			If ins.Y &gt; g.Y Then
				InsertBeforeLink(ins, L)
				Added=1
				Exit 'done
			EndIf
			L = L.NextLink()
			'Is the end of the list reached?
			If L = Null Then Exit
		Wend
		'If it wasn't inserted, add on the end
		If Not added Then AddLast(ins)		
	End Method

</pre><br>It's just using links so should be faster. <br><br></td></tr></table><br>
<a name="697454"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >computercoder</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> tonyg: <br><br>I totally understand what you are saying! It took me a few hours to absorb what was going on here, but now that I have working code, it makes perfect sense!<br><br>Thanks! <br><br></td></tr></table><br>
<a name="879437"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >doswelk</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ignore I'd forgot too check to see if I was adding the first entry.... <br><br></td></tr></table><br>
<a name="879473"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> You got me excited. I could actually have slightly helped on sorting functions. <br><br></td></tr></table><br>
<a name="879539"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> "TGemList Extends TList<br>	Method InsertGem(ins:TGem)"<br><br>Hey, are you letting on that your new game has gems in it ;-D <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
