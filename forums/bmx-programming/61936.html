<!DOCTYPE html><html lang="en" ><head ><title >timer events</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >timer events</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >timer events</a><br><br>
<a name="692115"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dan_upright</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> i'm trying to handle my game logic independently of frame rate by hooking timer events but it occasionally jerks as if the ticks are being delayed for a second then a bunch of them process at once<br><br>i'm calling PollEvent() in my main loop because it seems to be needed to make the event hook fire - although i thought that using hooks removed the need to use the event queue my hook gets no events unless i poll for them<br><br>am i missing something obvious to do with hooking? and if i should be calling pollevent to make events fire, does it make all the queued events fire their hooks or just the first in the queue? <br><br></td></tr></table><br>
<a name="692117"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >puki</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Welcome back. <br><br></td></tr></table><br>
<a name="692121"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dan_upright</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks <br><br></td></tr></table><br>
<a name="692128"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have you got any sample code?<br>I would think you could use waitevent() and still have events fired. <br><br></td></tr></table><br>
<a name="692130"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dan_upright</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> the source is here (run test.bmx and use wasd to move)<br><a href="http://www.lipteeth.demon.co.uk/downloads/stuff/gamecore.zip" target="_blank">http://www.lipteeth.demon.co.uk/downloads/stuff/gamecore.zip</a><br><br>using that source i get stuttering of the movement - changing<br><pre class=code>PollEvent()</pre><br>to<br><pre class=code>While PeekEvent()
  PollEvent()
Wend</pre><br>lessens the stuttering quite a bit but it's still there and in any case, i fail to see the point in hooks if i have to keep checking the event queue myself, so my guess is i'm missing something (if i remove the pollevent from the loop the program receives no events) <br><br></td></tr></table><br>
<a name="692131"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1721" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1721</a><br><br>With this My program just sits in a <br><pre class=code>While Waitevet()
wend</pre>loop, and I have no jumping <br><br></td></tr></table><br>
<a name="692134"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dan_upright</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> i can't use waitevent because my aim is to have the rendering going on at whatever refresh rate the user has chosen (or as fast as possible) while the game logic updates at a set frequency<br><br>although looking at your entry in the code archives i've realised that changing my "repeat .. forever" loop to a "repeat .. until keyhit(whatever)" one removes the need for pollevent (and reduces the stuttering somewhat) - though that's not exactly useful because long term i won't want the main loop to exit on a single keypress <br><br></td></tr></table><br>
<a name="692136"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well if that is your aim, then think for a moment.<br><br>The gamelogic has to sit in a Time frame, that has already had the rendering done. This means that <b>whenever</b> the Gamelogic is called, the screenrender has to wait while it finishes. Hence you will always get a stutter, because no matter what you do, the Gamelogic is taking time from the framelogic.<br>The framelogic needs to be fast enough so that it has spare time <i>everyframe</i> to do the gameLogic, even if you dont do it every frame.<br>What needs to be done is that the framlogic needs to know that the gamelogic has just had a pass, and posibly as a result the framelogic needs to delibratly "miss" a frame or two <br><br></td></tr></table><br>
<a name="692148"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dan_upright</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> all that test code is doing is getting key input and moving a word around the screen, so i highly doubt the problem is that it's taking too long to process<br><br>if anyone has any example code of using hooks with timers in graphics mode, i'd really appreciate a look to see how it's done <br><br></td></tr></table><br>
<a name="692153"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.blitzbasic.com/Community/posts.php?topic=61428#686821" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=61428#686821</a><br><br>Halfway down. Jim Ts code.<br><br>Edit: From your post below, I see this wanst relevent. Sorry <br><br></td></tr></table><br>
<a name="692168"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dan_upright</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> i can't see anything in that thread about addhook or timers? <br><br></td></tr></table><br>
<a name="692207"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dan_upright</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> well i've been playing about with this and as far as i can tell the problem is just that the timer sometimes seems to stall for a second<br><br>i'm running a graphics mode at 75hz and if i update using timer events (also running at 75hz, just for the sake of easy comparison) i get the odd jerk whereas removing the timer and just calling the update function in the main loop runs super smooth, though obviously isn't much of a solution for supporting multiple refresh rates<br><br>so unless anyone knows anything about how to fix timer events i'll have to do something else <br><br></td></tr></table><br>
<a name="692211"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> The problem with the timer is it's millisecond accurate so a 75hz timer is going to drift .3333 milliseconds every tick. From my calculations without recalibrating the timer yourself regularly you will get a glitch every 40 frames.<br><br>The other problem with graphics card refresh rates is they too have margins of error based on the timing spec of the monitor and the design of the card.<br><br>IMHO If you want super smooth sync lock your updates to your video, keep it simple etc. <br><br></td></tr></table><br>
<a name="692225"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dan_upright</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> i still get the same problem with the timer at 100hz, which should be fine by my reckoning, but meh, i'm doing it differently now before i end up spending days messing about with it for no real reason =]<br><br>thanks for the help <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
