<!DOCTYPE html><html lang="en" ><head ><title >Threading Rules and Condvars</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Threading Rules and Condvars</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Threading Rules and Condvars</a><br><br>
<a name="986497"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Scienthsine</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have a few questions about threading.<br><br>Is it safe and acceptable to read data from multiple threads so long as  I don't write to that data?<br><br>How do the Condvars work? They seem simple enough I guess... but what is the difference between SignalCondVar and BroadcastCondVar? Also, they have mutex parameters on those... so... I don't fully understand.<br><br>Can someone give me a quick explanation on CompareAndSwap, AtomicAdd, and AtomicSwap. I assume that these are threadsafe? What's their advantage and purpose?<br><br>Finally, does anyone know about how much time it takes to use mutexes? I mean, how much work does one need to offload to another thread for it to possibly be worth it?<br>--What I mean, is if I have an collection of data, and a long process involving hundreds of operations per entity in the collection, then using Semaphores would be great. I could have a few threads each processing an entity in parallel and one thread supplying the work. With a single core, this will ofcourse be slower than just doing it with the single thread, but with four cores it would be a great improvement.<br>--On the other hand, if I was doing just a couple operations per entity, even with thousands of threads, this system (with the single entity supply-demand model) would have too much overhead in the thread interaction. It would be faster to just do it all in one thread. Ofcourse there are a few things that could help, such as assigning a range of entities to each thread. I'd still like to have a better understanding of the overhead involved though.<br>--I guess I can setup some benches and try to get an idea of this myself... but I thought I'd ask just incase someone has a quick 'mutexes take a few milliseconds to settle', '5 clock cycles on most processors', 'faster than 3 floating point operations', or whatever.<br><br>Any and all help appreciated. <br><br></td></tr></table><br>
<a name="986543"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I may be wrong about any number of things since most of what I know is self-taught and/or conjecture, so if I say something and it contradicts what someone else said, chances are the other person is right.  Now...<br><br><div class="quote"> Is it safe and acceptable to read data from multiple threads so long as I don't write to that data? <br></div>I think it should be, but I don't know what sort of rules there are off the top of my head.<br><br>Can't comment on condvars, not sure how they work.<br><br><div class="quote"> Can someone give me a quick explanation on CompareAndSwap, AtomicAdd, and AtomicSwap. I assume that these are threadsafe? What's their advantage and purpose? <br></div>CompareAndSwap checks a value, and if it matches the old value, it swaps it with the new value.  AtomicAdd adds a value to something, AtomicSwap exchanges a value for another.  The idea is that these are atomic operations (and so thread safe-ish, I believe), and I'd recommend googling about those for more information.  CompareAndSwap is sort of handy for spin-locks, AtomicAdd and AtomicSwap could probably be used for other things (e.g., incrementing a count variable or exchanging some values for whatever reason).<br><br><div class="quote"> Finally, does anyone know about how much time it takes to use mutexes? I mean, how much work does one need to offload to another thread for it to possibly be worth it? <br></div>Mutexes under Windows are incredibly slow, mutexes under Linux and Mac OS are generally very fast.  I would try to design something to be lock-free if at all possible, though.  This sort of thing came up with the new GC, so Mark or James might be able to comment on it more thoroughly. <br><br></td></tr></table><br>
<a name="986560"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Scienthsine</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Another question. Assuming I can read data from multiple threads at once, as long as one isn't writing. Am I safe to assume that TList traversal through next and previous, aswell as foreach are thread safe? Can I traverse the same TList with multiple threads safely so long as I don't change it? <br><br></td></tr></table><br>
<a name="986586"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Another question. Assuming I can read data from multiple threads at once, as long as one isn't writing. Am I safe to assume that TList traversal through next and previous, aswell as foreach are thread safe? Can I traverse the same TList with multiple threads safely so long as I don't change it? <br></div>This <i>should</i> be safe.  There are probably plenty of people who would disagree with that or call it bad practice, though.  TMap traversal, however.. I think that could possibly be unsafe. <br><br></td></tr></table><br>
<a name="1006798"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kurator</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry for resurrecting this old thread, I stumbled over it while searching for programming with conditional variables. <br><br>Heres a good tutorial about conditionVars <a href="http://www.ibm.com/developerworks/linux/library/l-posix3/index.html?S_TACT=105AGX03&amp;S_CMP=EDU" target="_blank">http://www.ibm.com/developerworks/linux/library/l-posix3/index.html?S_TACT=105AGX03&amp;S_CMP=EDU</a> <br><br></td></tr></table><br>
<a name="1006915"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would say you can read from the same data from as many threads as you like without any problems, so long as the data doesn't need to be written. If you think about it, without changing the data, every thread will read the same value. The only reason I can hypthesize as a possible problem is IF for some reason the resource is MOVED in memory as part of some kind of optimization or something, but I don't know if that's likely. I know we have things like locks for TImage and TBank but I generally assume my memory isn't going to move. <br><br></td></tr></table><br>
<a name="1006922"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Galaxy613</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for that link Kurator, I now understand them. :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
