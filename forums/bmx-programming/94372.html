<!DOCTYPE html><html lang="en" ><head ><title >Exception Access Violation on Vista</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Exception Access Violation on Vista</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Exception Access Violation on Vista</a><br><br>
<a name="1082579"></a>

<a name="1082580"></a>

<a name="1082581"></a>

<a name="1082582"></a>

<a name="1082583"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm trying to somehow get a new image file into the C:\Windows\Web\Wallpaper\ folder, with User Account Control switched on on Vista. I understand the whole UAC thing - turning it off is not an option in this case, nor is using a manifest to get admin rights or using certain filenames, it has to run in user mode not admin.<br><br>I find that at least I can read the folder and open files that are already there without any problem.<br><br>When I try to open a stream to write a file in that folder I get an exception access violation.<br><br>When I use SavePixmapPNG to save a file there it does not throw an exception but the file is not written (there, anyway).<br><br>When I use CopyFile to copy an existing file into the folder it does not get copied (there, anyway) and no exception is thrown.<br><br>What I hope to do is at least try to write or copy the image to the folder and then check if it exists there and if not put it in a personal or public folder instead - I set the wallpaper via the registry.<br><br>My question is, is the above behavior typical/consistent for other people? Do you get no exception window pop up when you do a copyfile or savepixmappng, but you do when writing a stream?<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1082584"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I guess the pixmap and copyfile are working but it's being virtualized...<br><br>From another thread... "Attempting to create or write a file or directory under a folder which does not grant write permission to the process will fail under Windows Vista if the application does not have administrative privileges. If your 32-bit game executable is running in legacy mode, because it did not declare a requested execution level, its write operations will succeed, but they will be subjected to virtualization as described in the section "UAC Compatibility with Older Games" later in this article."<br><br>So long as it does this and I check if the file exists in C:\Windows\Web\Wallpaper\ after I write it, and if it's not in that folder, then I can just write it to common data or personal data folders and go from there.<br><br>I just want to make sure it isn't going to throw an exception violation, or wondering why it does one when you try to make a write stream? <br><br></td></tr></table><br>
<a name="1082607"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> well, you should never be writting to the windows fodler, unless your program is an installer of some kind and has the appropriate permissions. That's not allowed in windows any more. <br><br></td></tr></table><br>
<a name="1082619"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't know about getting an EAV when attempting to create a stream and in all honest I can't be bothered to turn on UAC, reboot, and try it myself - are you just using WriteFile or using Try/Catch etc?<br><br>Programs should never be writing to system folders anyway - its always been that way.  The only difference is that Microsoft really began to insist on that from Vista onwards.  You're much better off complying with standards and using either the user's appdata folder, or common app data.  Code in the code archives to get either. <br><br></td></tr></table><br>
<a name="1082637"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Understood.<br><br>The folder I'm writing to is the one where standard wallpapers are kept - C:\Windows\Web\Wallpaper.<br><br>I know Microsoft's policy but it's a bit strange they would put non-threatening image files in a protected part of the system where you can't even write new images. So when people go to set their wallpaper they're not going to see their wallpaper collection. It's kinda goofy.<br><br>I think what I'll do is try to either SavePixmapPNG or CopyFile to the folder, then read the folder to see if the file was virtualized (ie not there), then if so put the wallpaper in a public/personal folder and refer to it from there. That part is not a problem.<br><br>My only concern is really whether I can rely on there not being an exception access violation message box pop up when I do this. <br><br></td></tr></table><br>
<a name="1082651"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just store the image to be wallpaper in my game's shared data folder then call SystemParametersInfo which sets it.  Don't know if that makes a copy of it in there too.<br><br>btw, have you found a way to set wallpaper on MacOS? <br><br></td></tr></table><br>
<a name="1082654"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> btw, have you found a way to set wallpaper on MacOS? <br></div>Me?  No.  Wanted that feature in Magicville (its in the PC version) but I ended up taking it out for Mac because I had no idea how to do it. <br><br></td></tr></table><br>
<a name="1082657"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>have you found a way to set wallpaper on MacOS?<br> <br></div><br><br>The second post <a href="http://www.cocoabuilder.com/archive/cocoa/226304-scripting-bridge-and-system-events.html" target="_blank">here</a> seems to suggest a way. Don't know the first thing about direct OS X programming or the horrible ObjectiveC! <br><br></td></tr></table><br>
<a name="1082672"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> No idea about OSX wallpaper, yet. <br><br></td></tr></table><br>
<a name="1082718"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Muttley</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> On Windows Vista and 7 you should be storing it in the user's Pictures folder I think:<br><br>%USERPROFILE%\Pictures <br><br></td></tr></table><br>
<a name="1082765"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks James, my OSX programming skills are next to none to so that post doesn't make any sense sadly. <br><br></td></tr></table><br>
<a name="1082779"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, I plan to store it in MyPictures (CSIDL_MYPICTURES?) if it gets virtualized when storing it in Web/Wallpaper. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
