<!DOCTYPE html><html lang="en" ><head ><title >Colorizing a specific area on the screen.</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Colorizing a specific area on the screen.</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Colorizing a specific area on the screen.</a><br><br>
<a name="844335"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Trader3564</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, first of all thanks to all those who have kindly supported/replied on my previous topics. <br>This time I got stuck trying to make a colorizer thigy for my game. Any tips/tricks/examples maybe, are most welcome. Thank you! <br><br></td></tr></table><br>
<a name="844336"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Perhaps you could elaborate a little more on "colorizer thingy"?  :) <br><br></td></tr></table><br>
<a name="844339"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Trader3564</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> haha, okey then. sorry.<br><br>It for an RPG. The screen is build up like this:<br><br>[_|]<br><br>Where on the left i have the tiled map 32x32 tiles, and on the right the game-menu.<br><br>So what is need, is a function, or command, or whatever it is, that allows me to recoller all that is visable on the left. (Includes the map, players, animals, etc...) <br><br></td></tr></table><br>
<a name="844351"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Use SetColor before you draw the objects and set the color to whatever `tint` you want them drawn with? <br><br></td></tr></table><br>
<a name="844354"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Trader3564</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah, i think what i meen is colorizing as in changing the RGB levels.<br><br>R -100% to +100%<br>G -100% to +100%<br>B -100% to +100% <br><br></td></tr></table><br>
<a name="844383"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> do you mean:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Graphics 640, 480, 0, 0

Local testImage:TImage = LoadImage("bmxlogo_small.png")'pm)

SetBlend ALPHABLEND

Local R:Int = 255
Local G:Int = 0
Local B:Int = 0
Local temp:Int

While Not KeyDown(KEY_ESCAPE)
	Cls
		
		DrawText( "test", 10, 10 )
		SetColor(R,G,B)
		DrawImage( testImage, MouseX(), MouseY() )
		SetColor(255,255,255)
		
		If MouseHit(1) Then 
			temp = R
			R = G
			G = B
			B = temp
		EndIf

	Flip
	
Wend

End

</textarea><br><br>? <br><br></td></tr></table><br>
<a name="844388"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Trader3564</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thank you :) but no, this overrides all the colors.<br><br>Here, i made an example:<br>[img]http://www.fantasaar.com/rgbhsl.jpg[/img] <br><br></td></tr></table><br>
<a name="844468"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you only want to colorize specific colors of  the tiles/sprites - dont use it realtime, precompute the sprites.<br><br>How to achieve? Use search function within the blitzmax programming section - I did post it a while ago: ColorizeImage, ColorizeTImage.<br><br><br>bye<br>MB <br><br></td></tr></table><br>
<a name="844475"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CS_TBL</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Like this?<br><br><pre class=code>Graphics 640,480

Type Tsq
	Field x:Int=Rnd(640),y:Int=Rnd(480),xd:Int=Rnd(-4,4),yd:Int=Rnd(-4,4)
	Field r:Int=Rnd(255),g:Int=Rnd(255),b:Int=Rnd(255)
	Method update()
		x:+xd+640;	y:+yd+480;	x:Mod 640;	y:Mod 480
	End Method
	Method draw()
		SetColor r,g,b
		DrawRect x,y,20,20
	End Method
End Type

Local sq:Tsq[40]
For Local t:Int=0 To 39;sq[t]=New Tsq;Next
Local timer:ttimer=CreateTimer(25)
Repeat
	WaitEvent()
	If EventSource()=timer
		Cls	
		SetBlend SOLIDBLEND		
		SetColor 255,255,255		
		For t=0 To 39
			sq[t].update;sq[t].draw
		Next
		
		SetBlend SHADEBLEND
		SetColor 32,32,32
		DrawRect 512,0,128,480
		SetBlend LIGHTBLEND
		SetColor 160,144,128
		DrawRect 512,0,128,480
		
		SetColor 255,255,255
		DrawText "HP : 142/150",530,20
		DrawText "EXP: 045/100",530,30
		DrawText "MP : 005/50",530,40
		
		SetBlend SOLIDBLEND
		SetColor 255,0,0;DrawRect 530,60,24,24
		SetColor 0,255,0;DrawRect 560,60,24,24
		SetColor 0,0,255;DrawRect 590,60,24,24
		Flip		
	EndIf
Until KeyHit(KEY_ESCAPE)

</pre> <br><br></td></tr></table><br>
<a name="844484"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Trader3564</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> CS_TBL, it comes closer, but it is not what i ment.<br><br>Let me try and explain it another time, but written:<br><br>Purple is made out of red and blue.<br>Yellow out of red and green.<br><br>So if i want to make this purple ball yellow, i substract blue, and add green.<br>What i dont want is have this done pre-computed, as i changed it realtime.<br><br>Basicly, i ill use it for effects such as:<br>Nightfall<br>Sunrise<br>Drakredish looking caves<br>Brightblueish looking water<br>etc....<br><br>The SetColor function, only takes the light &amp; darkness, and forces all colors to turn red.<br><br>What i need is (as shown in the picture)<br>[img="http://www.fantasaar.com/rgbhsl.jpg"]<br><br>Is a function that ADDS  or SUBSTRACTS blue, or red, or green, or both TO and FROM an area on the screen, in real-time.<br><br>In addition i would like to know if it is possible to ADD and SUBSTRACT anything at all?<br>Like, if i where on top of the colorization to add a darker layer or effect, like a vail, that only lights up when i have a torch. (which i then would want to have a yellowish looking radius but not make ALL look pure yellow, just by adding a bit green and red for that zone.)<br><br>What i expect, is that i have to render the whole backbuffer, lock it, apply the effects, unlock it, draw the HUD (which will not be effected) and FLIP it.<br><br>Thank you. <br><br></td></tr></table><br>
<a name="844486"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >nawi</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can do it with pixmaps pixel by pixel, but I'm afraid that is too slow for realtime. Precompute them (I don't think the night/day etc changes every frame). <br><br></td></tr></table><br>
<a name="844487"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> In realtime? No not possible.<br>Simply because you have to do it for every pixel manually and you can not use images, only pixmaps / backbuffer.<br><br>The only way having such an effect in realtime is using shaders and let the GPU doing it straight "on the data" instead of working on a RAM replica of it that need to be reuploaded again.<br><br>What you can do thought is not use a 3 channel picture at all :)<br>Use 3 images. One for each channel, filled with grayscale values where the color shall be drawn and by what amount and masked out the rest. Now just draw them and use the SetColor to colorize them with the final color you want them to be drawn.<br>That indeed would work realtime and depending on what you wanted to do, it will even work very good.<br>But you see that your media must be created for this special use. <br><br></td></tr></table><br>
<a name="844513"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Trader3564</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I see. Hmm...<br>Aint it possible to seperate these channels on loading?<br><br>It is odd tough, i thoughd that BMAX would be graphicly more powerfull then Multimedia Fustion of ClickTeam. Their software does actualy all that with a snap. But the core there lays in C++<br>Also i thoughd Visual Basic has no problems with seperating RGB chanels.<br>Isn't BMAX hardware accelerated? <br><br></td></tr></table><br>
<a name="844519"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> This has nothing to do with that. MMF is 2D and does everything through CPU. This is nice but damned slow when you want alpha, rotation and scaling.<br><br>BM does 2D through 3D acceleration. This is very powerfull in above aspects. But on the other hand, you have to drop many of the "2D tricks" as they just don't work anymore on 3D or not on a usefull performance.<br><br>You can seperate the channels on loading if you want to. Load the image as Pixmap and read out the needed data into 3 seperate pixmaps. Thats actually quite simple by just going through all pixels and filter out the 3 colors and write them into a new pixmaps (where you set that color for R, B and G if you want to color it afterwards through SetColor, otherwise its not grayscale)<br><br><br>BM does not do that because its something not done normally, a 3D card takes a 4 component texture so why send 4 single textures if you can send 1 which already contains all 4 channels? It would make it considerably slower, tripple to quadruple the VRAM usage (which is already an issue if you want to target 4-6 year old trash systems ... thought thats near impossible anyway, if you target them, use BlitzPlus which is 2D through DirectX7 DirectDraw and thus has no alpha, realtime scale / rotation therefor) <br><br></td></tr></table><br>
<a name="844535"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I wonder if you could achieve a similar effect by creating alpha masks so that some portions of the image retain their colour when applied over the base colour?<br><br>Some experimentation may be necessary.<br><br>*EDIT*<br>Another alternative would of course be to create different graphics for each scene and have them loaded as TAnimImages, you could then advance through the animation to determine the mood (not great for file size or memory but an alternative nonetheless) <br><br></td></tr></table><br>
<a name="844551"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Trader3564</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hah, some creative ideas :) i see there i lots of tricks to try. ill do my best and i guess post an update when i found the solution.<br><br>@Dreamora "This has nothing to do with that. MMF is 2D and does everything through CPU. This is nice but damned slow when you want alpha, rotation and scaling."<br>Actualy, it is now Hardware Accelerated. I beleive it uses both. 2D todo 2D, and what can be done, or faster in HWA, is done on HWA.<br><br>Thinks i do not really need are: Realtime scaling/Rotation. Alpha, however (like PNG) is really great to have supported.<br>I will look into BlitzPlus. I do question if its powerfull enough. It is after all a very old product. <br><br></td></tr></table><br>
<a name="844554"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PantsOn</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> i think this is what your after...<br>this is a very unoptimised replace olour technique.<br>usage<br><pre class=code>
i:tpixmap = loadpixmap("image.png")

' replace all exact white occurances with bright purple
p:tpixmap = replacecolour(i:tpixamp,$ffffff,$ff00ff)

' replace all nearly white occurances with bright purple
p:tpixmap = replacecolour(i:tpixamp,$ffffff,$ff00ff,10)
</pre><br><br>functions<br><pre class=code>
Function replacecolour:TPixmap(p:TPixmap,old_rgb:Int,new_rgb:Int,threshold:Int)
	Local w:Int = PixmapWidth(p)
	Local h:Int = PixmapHeight(p)
	Local x:Int,y:Int
	Local b1:Byte Ptr
	Local b2:Byte Ptr
	Local n:TPixmap = CreatePixmap(w,h,pf_BGRA8888)
	
	Local r:Int = (old_rgb Shr 16) &amp; 255
	Local g:Int = (old_rgb Shr 8) &amp; 255
	Local b:Int = (old_rgb Shr 0) &amp; 255
	
	Local p1:TPixmap = ConvertPixmap(p,PF_BGRA8888)
	
	' scan through image
	x  =0
	While x &lt; w
		y = 0
		While y &lt; h
			b1 = PixmapPixelPtr(p1,x,y)
			b2 = PixmapPixelPtr(n,x,y)
			
			If threshold_check(r,b1[2],threshold) And threshold_check(g,b1[1],threshold) And threshold_check(b,b1[0],threshold)
				b2[0] = (new_rgb Shr 0) &amp; 255
				b2[1] = (new_rgb Shr 8) &amp; 255
				b2[2] = (new_rgb Shr 16) &amp; 255
				b2[3] = $ff
			Else
				b2[0] = b1[0]
				b2[1] = b1[1]
				b2[2] = b1[2]
				b2[3] = b1[3]
			EndIf
			
			y:+1
		Wend
		x:+1
	Wend
	
	Return n
End Function

Function threshold_check:Int(v1:Int,v2:Int,t:Int)
	If (v1 &gt; v2-t) And (v1 &lt; v2+t+1) Then Return True
	
	Return False
End Function

</pre> <br><br></td></tr></table><br>
<a name="844560"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PantsOn</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> or if you want to dirrectly affect the pixels in the pixmap without creating a new pixmap<br><pre class=code>
Function replacecolour2:Int(p:TPixmap,old_rgb:Int,new_rgb:Int,threshold:Int)
	Local w:Int = PixmapWidth(p)
	Local h:Int = PixmapHeight(p)
	Local x:Int,y:Int
	Local c:Int
	Local r1:Int,g1:Int,b1:Int
		
'	Local n:TPixmap = CreatePixmap(w,h,pf_BGRA8888)
	
	Local r:Int = (old_rgb Shr 16) &amp; 255
	Local g:Int = (old_rgb Shr 8) &amp; 255
	Local b:Int = (old_rgb Shr 0) &amp; 255
	
'	Local p1:TPixmap = ConvertPixmap(p,PF_BGRA8888)
	
	' scan through image
	x  =0
	While x &lt; w
		y = 0
		While y &lt; h
			c = ReadPixel(p,x,y)
			r1 = (c Shr 16) &amp; 255 
			g1 = (c Shr 8) &amp; 255 
			b1 = (c Shr 0) &amp; 255 
			
			If threshold_check(r,r1,threshold) And threshold_check(g,g1,threshold) And threshold_check(b,b1,threshold)
				WritePixel p,x,y,new_rgb
			EndIf
			
			y:+1
		Wend
		x:+1
	Wend

	Return True	
End Function


</pre><br><br>if you have an image you can call the routines with<br><pre class=code>
image.pixmaps[frame]
</pre><br>this gets the pixmap for the relevant frame in the image <br><br></td></tr></table><br>
<a name="844580"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> @PantsOn - thats what my suggestion uses too.<br><br>Instead of using a yellow ball - you make a gray one - then all colorcombinations are possible - and because you have one standard for the sprites (gray parts), you can easily cut the function call down to "new colors" (instead of oldcol and newcol).<br><br>I remember to have grayalien given a code-snippet which also allowed lightness to be modified (so you can use fixed values for color, but dynamical usage of how hard it is melt together and so on).<br><br><br>Depending on how much differently colored sprites of the same base you need the same time you can use precalculated sprites (one dark, one day, one rainy ...).<br><br>Its not suitable for "rainbow-colorchanging balls" - therefor you need to experiment with the SetAlpha-Commands and effectsprites.<br><br><br>bye<br>MB <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
