<!DOCTYPE html><html lang="en" ><head ><title >Detecting keypresses before startup</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Detecting keypresses before startup</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Detecting keypresses before startup</a><br><br>
<a name="656073"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> How can I detect whether a modifier key is being held down while my application starts?<br><br>It seems that with polled input you can only read the keyboard if there is a window or fullscreen open. How can I read if the keyboard is being pressed in a certain way, prior to opening a window/screen, so that that information can be used to decide what window/screen to open?<br><br>Do I have to use events? I tried to use PollEvent() and PeekEvent() but they gave a compiler error, something about not being able to compile mark sibly's folder.<br><br>Is it even possible to sense a key, which is being pressed since before the app even was loaded?<br><br>If this isn't possible I guess I'll have to have a small startup window with buttons to click to give that functionality?<br><br>The aim is to force certain screen modes by pressing a key such as CTRL, or shift or alt/option, as the app begins to run. <br><br></td></tr></table><br>
<a name="656079"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does Blitz do a default flushkeys when it starts up, and can this be removed from somewhere?<br>[EDIT] I tried to remove it from PolledInput.bmx but that didn't help because it looks like the system has to be polled before the keypresses can begin to be registered, so it won't recognize keys that were held down prior to executing? It seems that the hook for the events has to wait for an event, and it wont get an event from a pre-existing keypress? <br><br></td></tr></table><br>
<a name="656088"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Seems caps lock is not known to be switched on at the start of an app, either, if it was pressed prior to starting the app. Can this be added as a future feature, where if you start the app and caps lock is pressed, it puts a caps lock event into the queue so when you do keydown(KEY_CAPSLOCK) it actually starts out in the on position? <br><br></td></tr></table><br>
<a name="656257"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Anyone? <br><br></td></tr></table><br>
<a name="656451"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I guess not then.<br><br>I am thinking I might write to a `success` file, saying "successs=false", before opening a screen, then try to open a screen. If it bombs out and crashes, the next time the game is run it reads the file and if the file says "success=false" that means that last time it ran it couldn't create a screen, ... so then falls into Window mode.<br><br>I suppose that would be one way of doing it.<br><br>But it'd be so nice to have detection of keys already being held down since prior to execution. <br><br></td></tr></table><br>
<a name="656521"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think people are trying to find out if it's possible or not.  I don't think anyone wants to say it's impossible, because just as soon as someone does, they're proven wrong.  However, I'm sure the solution is evading everyone.  When you press a key on the keyboard, Windows sends an EVENT_KEYDOWN to the app in focus.  Since your app isn't running yet, that EVENT_KEYDOWN will be lost.  Basically your app needs to respond to a Windows event before it's even running which it just cannot do.<br>Your best bet would be to create command line switches for your application and have a default window for double-clicks and a person can use the Run dialog if they need to run different modes in your program. <br><br></td></tr></table><br>
<a name="656599"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey TomToad, thanks for the reply. This reminds me actually that although the system might maintain track of whether shift is being pressed or not, and also for the other modifiers including capslock, it doesn't actually sense that the key is being pressed, it only senses that it `was pressed`, and only recorded a state change when the press first began, regardless of whether it is ongoing, and only changes back when the key is released. So yeah, since it actually deals in keypress events rather than looking at the keyboard and sensing if the key is `being pressed`, I guess there's no real way to detect the overal state of these modifiers.<br><br>It would be nice to be able to grab the current state from the system, ie since Windows/Mac/Linux is itself keeping track of whether shift is up or down, etc, if Max could get that information and start out with it as its internal state, that would work. But alas I guess this isn't too likely.<br><br>I think what I will do is my earlier suggestion - write false to a file, try to open fullscreen, if it fails then the next time the app is run it reads the file and finds false there, so it knows to open in a window. I only really need to handle this one situation, even though multiple modifiers would be cool.<br><br>I don't want to use command line arguments because hardly anyone knows that a command line even exists, let alone how to use it.<br><br>Is it possible to have the user shift-click in the desktop, clicking on a file and shift clicking on my game app, then have the path of the dummy file pass into Max? If that would work I'd be able to use the dummy file as a `trigger`, ie say `click the "window mode" icon, hold shift and click the game` to run it in window mode?<br><br>Or, I guess I could distribute two copies of the game, one that runs in a window and one that runs fullscreen? <br><br></td></tr></table><br>
<a name="656603"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> One idea is to use .bat files.  Just have a program default to fullscreen, but if they want windowed, they double click on the .bat file which contains the line<br><pre class=code>AppTitle.exe /w</pre> <br><br></td></tr></table><br>
<a name="656897"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Doesn't work on mac/linux but its a nice idea. But then you would have separate icons, one for window mode and one for fullscreen. I'd prefer a single icon. <br><br></td></tr></table><br>
<a name="657235"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >d-bug</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> My prefered solution for Windows would be to check Virtualkeys via API at startup. Thats exactly what I've done on Blitz3D to get Capslock and Numlock states at startup.<br><br>Hm, thats no solution for Linux or Mav, but a first hint. <br><br></td></tr></table><br>
<a name="657307"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks but I am focussing on cross-platform development. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
