<!DOCTYPE html><html lang="en" ><head ><title >Pass BM function pointers to C/C++ code</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Pass BM function pointers to C/C++ code</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Pass BM function pointers to C/C++ code</a><br><br>
<a name="465146"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TommyBear</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Mark,<br><br>Is it possible to pass BM function pointers into C or C++ code?  I want to write a LUA module for BM but I need to be able to call back into BM.<br><br>Tommy. <br><br></td></tr></table><br>
<a name="465152"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TommyBear</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hats off to Mark.  Here is the answer.  I'll tell everyone something right now... BM is awesome and an extermely powerful GameDev solution.  Okay here it is:<br><br>C Code<br>------<br><br>int (*callback)(const char *);<br><br>void RegisterCallback ( int (*infunc)(const char *) )<br>{<br>	callback = infunc;<br>}<br><br>void CallMe ()<br>{<br>	callback("Hello from C");<br>}<br><br>BM Code<br>-------<br><br>Strict<br><br>Import "test.c"<br><br>Extern<br>	Function RegisterCallback ( functionptr@Ptr )<br>	Function CallMe ()<br>End Extern<br><br>Function Test:Int( char:Byte Ptr )<br>	' OMG I just got a call back<br>	DebugStop<br>End Function<br><br>RegisterCallback( Test )<br>CallMe()<br><br><br>----- END ------<br><br>So what is this good for?  Well I'll be writing a small LUA module for BM.  You'll be able to export your internal BM functions to LUA and have those callable from script.  Makes scripting of bots, AI, missions, save games etc extermely easily.  Well done Mark! <br><br></td></tr></table><br>
<a name="465268"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>That will work because BMX does auto function ptr-&gt;byte ptr casting, but a 'safer' way would be...<br><br>Extern<br>Function RegisterCallback( func( char:byte ptr ) )<br>End Extern<br><br>...which would prevent you from accidentally passing the wrong 'type' of function to RegisterCallback. <br><br></td></tr></table><br>
<a name="465479"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TommyBear</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> One more thing mark, is it possible to get a pointer to something from a c function?  For instance I want to gt a lua_state * from one of the lua functions... is this possible? <br><br></td></tr></table><br>
<a name="465647"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>I tend to just wrap these up in a 'byte ptr', eg:<br><br>Extern<br>Function GetLuaState:Byte Ptr()<br>End Extern<br><br>Local lua_state:Byte Ptr=GetLuaState() <br><br></td></tr></table><br>
<a name="465869"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TommyBear</td><td align="right"><font class=tiny>(Posted 2004)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Easy thanks. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
