<!DOCTYPE html><html lang="en" ><head ><title >XBox360 Controller</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >XBox360 Controller</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >XBox360 Controller</a><br><br>
<a name="1088700"></a>

<a name="1088701"></a>

<a name="1088702"></a>

<a name="1088703"></a>

<a name="1088704"></a>

<a name="1088705"></a>

<a name="1088706"></a>

<a name="1088712"></a>

<a name="1088717"></a>

<a name="1088758"></a>

<a name="1088764"></a>

<a name="1092800"></a>

<a name="1092801"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all,<br><br><strike><b>Download HERE</b></strike><br><a href="http://www.datafilehost.com/download-0e4b8d61.html" target="_blank"><b>DOWNLOAD V2.0 HERE</b></a><br><br>For WIRED XBox360 controllers on Windows :-<br><br>I saw that there were some XBox360 controller code to allow using the controller in BMax. This suffered with a slight flaw in that the thumb buttons would cancel each out when they are both pressed at the same time resulting in incorrect thumb trigger values.<br><br>As I've decided to incorporate the controller as a standard controller in my game engine I decided to share the code.<br><br>I've written a module but for use only with Windows ( XP with SP1 or better ) in Bmax that overcomes the thumb trigger problem so you can use all the stick / triggers / buttons correctly. Unfortunately there's still no support for the X Button in the centre - For some reason Microsoft decided not to expose that button in DirectX.<br><br>How to use :-<br><br>BEFORE USING THIS SOFTWARE PLEASE MAKE SURE YOU HAVE THE LATEST DIRECTX UPDATE - even if you have DirectX 11 this statement still applies.<br><br>Installation-<br><br>Put/copy the folder srs.mod from the above download into your BlitzMax/mod folder, then rebuild your modules to build this module. The controller code is now ready to use.<br><br>Obviously you should plug in your XBox360 controller into a USB port :-)<br><br>To use in your code you need to import the module. Use<br><br><b>Import SRS.Xbox360</b><br><br>Then create an instance of the 'XBox360' Type like so<br><br><b>Global XB:XBox360 = new XBox360</b><br><br>before reading any data from any controllers use<br><br><b>XB.Update</b><br><br>You MUST call this before getting any data from the controllers, once per frame is ok, then use the following methods to get information about the controller. You need to pass in an ID value ranging from 0 to 3 inclusive for the corresponding controller as shown below<br><br>To see if a controller is connected use<br>This returns TRUE is a controller is connected or FALSE otherwise.<br><b>XB.IsConnected( ID )</b><br><br>These return TRUE of FALSE, TRUE if pressed, FALSE otherwise<br><b>XB.A( ID )<br>XB.B( ID )<br>XB.X( ID )<br>XB.Y( ID )<br>XB.Start( ID )<br>XB.Back( ID )<br>XB.LeftShoulder( ID )<br>XB.RightShoulder( ID )<br>XB.LeftThumb( ID )<br>XB.RightThumb( ID )</b><br><br>To get the condition of the D-Pad use a combination of the following<br>These also return TRUE for pressed, FALSE otherwise<br><b>XB.DPadUp( ID )<br>XB.DPadDown( ID )<br>XB.DPadLeft( ID )<br>XB.DPadRight( ID )</b><br><br>The trigger values will return a value between 0 and 255 inclusive. 0 for no action, 255 for fully pressed.<br><b>XB.LeftTriger( ID )<br>XB.RightTrigger( ID )</b><br><br>To retrieve the state of the analogue thumb stick positions, the values will return between 0 and 65535 inclusive. When the stick is centred the value is 32768. To access the thumb stick values use<br><b>XB.LeftStickHorizontal( ID )<br>XB.LeftStickVertical( ID )<br>XB.RightStickHorizontal( ID )<br>XB.RightStickVertical( ID )</b><br><br>To use the rumble features you use the following methods passing in the ID of the controller to set and also a value between 0 and 65535 inclusive. 0 is no vibration, 65535 is full vibration.<br><b>XB.SetSmallVibration( ID , value )<br>XB.SetBigVibration( ID , value )<br></b><br><br>You can also adjust the 'Dead Zone'. This is a zone of movement for the thumb sticks only. Its where you will get no controller response until you move a certain distance from the centre position. The value to set it to is between 0 and 1, 0 is no dead zone ( causing erratic sensitive movement data when the stick is at the centre position ) and 1 would be no stick movement detection. It defaults to 0.25. I advise you NOT to use this method but just in case you want to<br><b>XB.SetDeadZone( ID , value )</b><br><br>I hope some people will find it useful for their games. Please give proper credit to <b>SRS Software</b> if you decide to use it.<br><br>A complete example of how to use is here. In this example you can use the arrow keys to adjust the amount and type of rumble to inflict. Left and Right will adjust the small finer vibration, using Up and Down will adjust the bigger harsher vibration.<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
'Windows Only
?win32

Import SRS.XBox360

AppTitle = "(C) SRS Software 2011 - XBox360 Controller example"
Global X360:XBox360 = New XBox360

Graphics 800,650

Global SmallVib:Int
Global BigVib:Int

While Not ( KeyDown(KEY_ESCAPE) Or AppTerminate() )
	Cls
	RenderX360Status()
		
	'Apply vibration only to ControllerID 0
	If KeyDown( KEY_LEFT ) And SmallVib &gt; 0 SmallVib :- 1024
	If KeyDown( KEY_RIGHT ) And SmallVib &lt; 64000 SmallVib :+ 1024 'Max is 65535
	
	If KeyDown( KEY_DOWN ) And BigVib &gt; 0  BigVib :- 1024
	If KeyDown( KEY_UP ) And BigVib &lt; 64000 BigVib :+ 1024

	X360.SetBigVibration( 0 , BigVib )
	X360.SetSmallVibration( 0 , SmallVib )
	
	If BigVib &gt; 0 Or SmallVib &gt; 0..
		 DrawText "Vibration On" , 240 , 140
		
	Flip 1
Wend

Function RenderX360Status()
	'Update status
	X360.Update()

	For Local Id:Int = 0 Until X360.GetMaxControllers()
		'Connected?
		DrawText "Controller " + Id + " : " , 0 , id * 160
		If Not X360.IsConnected( Id )
			DrawText "Not Connected" , 240 , id * 160
		Else
			DrawText "Connected" , 240 , id * 160

			'Show Buttons	
			Local button:String
			If X360.A( Id ) button :+ "A "
			If X360.B( Id ) button :+ "B "
			If X360.X( Id ) button :+ "X "
			If X360.Y( Id ) button :+ "Y "
			If X360.Start( Id ) button :+ "START "
			If X360.Back( Id ) button :+ "BACK "
			If X360.LeftShoulder( Id ) button :+ "L_SHOULDER "
			If X360.RightShoulder( Id ) button :+ "R_SHOULDER "
			If X360.LeftThumb( Id ) button :+ "L_THUMB "
			If X360.RightThumb( Id ) button :+ "R_THUMB "
	
			DrawText "Buttons pressed : " , 0 , 18 + Id * 160
			DrawText button , 240 , 18 + Id * 160

		'Show DPAD 
			Local dpad:String	
			If X360.DPadUp( Id ) dpad :+ "UP "
			If X360.DPadDown( Id ) dpad :+ "DOWN "
			If X360.DPadLeft( Id ) dpad :+ "LEFT "
			If X360.DPadRight( Id ) dpad :+ "RIGHT "
	
			DrawText "D-Pad position : " , 0 , 36 + Id * 160
			DrawText dpad , 240 , 36 + Id * 360
	
			'Triggers
			DrawText "Left Trigger : " , 0 , 54 + Id * 160 ; DrawText X360.LeftTrigger( Id ) , 240 , 54 + Id * 160
			DrawText "Right Trigger : " , 0 ,66 + id * 160 ; DrawText X360.RightTrigger( Id ) , 240 , 66 + Id * 160
	
			'Sticks
			DrawText "Left Stick Horizontal : " , 0 ,84 + id * 160 ; DrawText X360.LeftStickHorizontal( Id ) , 240 , 84 + id * 160
			DrawText "Left Stick Vertical : " , 0 , 96 + id * 160 ; DrawText X360.LeftStickVertical( Id ), 240 , 96 + Id * 160
	
			DrawText "Right Stick Horizontal : " , 0 , 112 + id * 160 ; DrawText X360.RightStickHorizontal( Id ) , 240 , 112 + Id * 160
			DrawText "Right Stick Vertical : " , 0 , 124 + id * 160 ; DrawText X360.RightStickVertical( Id ) , 240 , 124 + Id * 160
		EndIf
	Next
EndFunction
?
End
</textarea><br><br>Many thanks<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1088707"></a>

<a name="1088708"></a>

<a name="1088709"></a>

<a name="1088711"></a>

<a name="1088713"></a>

<a name="1088714"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I imagine some newbie programmers may need some help with the values for the sticks.<br><br>Once you have received the value of a stick, in the range from 0 to 65535, it would be nice to scale this to the range of -1 to 1 with 0 being the centre. To do this you could use the following snippet to get the result for controller ID 0 -<br><br>For eg<br>To scale between -1 and 1 on the horizontal part of Left Analogue Stick use<br><b>Local ID:int = 0<br>Local mX:Float = Float( XB.LeftStickHorizontal( ID ) ) / 32768.0 - 1.0</b><br><br>mX will contain the value between -1 and 1<br><br>To do scale the thumb trigger values to a range of between 0 and 1, 0 being nothing pressed and 1 being fully pressed, you can use the following snippet<br><b>Local Trigger:float = Float( XB.LeftTrigger( Id ) ) / 255.0</b><br><br>'Trigger' will now be a varying result between 0 and 1 depending on how hard you press the Left Trigger.<br><br>See ya<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1088710"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow, that is very impressive!! Well done :D<br><br>Maybe you could add a second convenience function to return the stick value as a float in your module. <br><br></td></tr></table><br>
<a name="1088718"></a>

<a name="1088719"></a>

<a name="1088759"></a>

<a name="1088760"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Czar Flavius.<br><br>V1.1:<br>Added some methods to return the analogue values as a float number. Its simply a case of the same method names but with an 'F' appended.<br><br>These will return a value between -1.0 and 1.0<br><b>XB.LeftStickHorizontalF( ID )<br>XB.LeftStickVerticalF( ID )<br>XB.RightStickHorizontalF( ID )<br>XB.RightStickVerticalF( ID )</b><br><br>And these will return a value between 0.0 and 1.0<br><b>XB.LeftTriggerF( ID )<br>XB.RightTriggerF( ID )</b><br><br>See ya<br><br>[EDIT]<br>V1.2 : Fixed a small bug that would cause the Float values of the Analogue Sticks to not quite reach the full range of -1.0 to 1.0 - Now they work as they should.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1092065"></a>

<a name="1092067"></a>

<a name="1092071"></a>

<a name="1092072"></a>

<a name="1092073"></a>

<a name="1092075"></a>

<a name="1092077"></a>

<a name="1092078"></a>

<a name="1092080"></a>

<a name="1092085"></a>

<a name="1092086"></a>

<a name="1092088"></a>

<a name="1092096"></a>

<a name="1092097"></a>

<a name="1092099"></a>

<a name="1092100"></a>

<a name="1092120"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.datafilehost.com/download-0e4b8d61.html" target="_blank"><b>DOWNLOAD V2.0 HERE</b></a><br><br>While using this module I noticed that getting the update of the controllers takes a fair amount of CPU time. It was slowing my engine cpu code from an UN-Synced 2500FPS to 400FPS.<br><br>So here I present V2.0 which features multi-threading. This completely eliminates any slow down, bringing the UN-Synced framerate back up to 2500FPS.<br><br>To install it is identical as above in the very first post.<br><br>To use the Multi-Thread feature,  Just select the 'Multi-thread' build option in your editor, and it will auto-magically use the multi-thread version. When using the multi-thread version there's no need for<br><br><b>XB.Update</b><br><br>as this is handled in a different thread.<br><br>Don't forget to 'Rebuild Modules' with both multi-thread SELECTED and UN-SELECTED before using it.<br><br>Have fun.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
