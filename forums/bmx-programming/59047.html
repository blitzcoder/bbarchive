<!DOCTYPE html><html lang="en" ><head ><title >Do I need Delay(1) on AMD?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Do I need Delay(1) on AMD?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Do I need Delay(1) on AMD?</a><br><br>
<a name="657332"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> It was brought to my attention with Easter Bonus and now my new Game Framework demo that if you bring up task manager in full-screen mode, the CPU useage is 100% (ish) on AMDs and only 50%(ish) on Pentiums (well on my Hyperthreading P4 3.2GHz anyway).  This may mean that windows struggles to do background tasks and could be causing/accentuating and stuttering problems on smooth moving graphics.  Someone a while ago suggested using Delay(1) in the main loop.<br><br>So does anyone have more info about this, and is delay(1) enough?  It seems a bit lame to have to give up 1ms per frame, esp if someone is running at 100Hz, you only have 10Ms to play with per frame!  Maybe there is a neater way to do this?<br><br>Also is there a way to detect if the CPU is AMD not Intel and only switch the delay on for AMD CPUs?<br><br>Here's my framework demo to test how it affects your CPU useage in full-screen mode <a href="http://www.greyaliengames.com/aotmg/aotmg.zip" target="_blank">http://www.greyaliengames.com/aotmg/aotmg.zip</a> (3.93Mb)<br><br>I'd really appreciate any feedback people can offer, thanks in advance. <br><br></td></tr></table><br>
<a name="657340"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert Cummings</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> use delay 1000 <br><br></td></tr></table><br>
<a name="657342"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yan</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I not sure if it's a help or a hindrance, but my CPU usage peaks at about 40% when running your framework demo (v4). <br><br></td></tr></table><br>
<a name="657344"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> OEJ: Is that a joke?<br><br>Ian: hmm, thanks, I didn't get reports of that maxing out the CPU though.   Did you press A in full-screen mode to turn on the Anti-lag fix?  Did that change the CPU useage? <br><br></td></tr></table><br>
<a name="657345"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> In fact its the P4 having the problem, not the AMD one :-) Blitz Products don't support HT, so only 50% of the P4 is used, as Blitz does not know of the existance of the full processor (HT are 1 core as well with a virtual cpu ... which simply means: you need a twice as fast HT processor to get the same resultas non HT if you are using any Blitz, unless HT is disabled in bios) <br><br></td></tr></table><br>
<a name="657348"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I need "Delay 1" in most of my projects- the sound struggles otherwise.<br><br>I've not had any problems with your stuff though Grey... <br><br></td></tr></table><br>
<a name="657358"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert Cummings</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes it was a little joke.<br><br>The problem you're having I think, is an illusion. The intel processor has two virtual processors. It isn't multiple core but hyperthreaded intels have two virtual ones to the system. Could this be why?<br><br>I have a dual core so my results are meaningless to you. <br><br></td></tr></table><br>
<a name="657361"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmm OK so only half my CPU use is reported, I did suspect this.  OK, but Daz has said the music pauses in my demo and he gets stutters, he has an AMD and I thought it might be that.  I KNOW my timing is cool, it's just hardware and OS stuff I'm battling against now. <br><br></td></tr></table><br>
<a name="657365"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yan</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> DOH!...You said full screen mode...Yeah, 100% CPU usage here too.<br><br>Sorry about that. :o/ <br><br></td></tr></table><br>
<a name="657372"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> s'OK.  I like to double check stuff but there is a thin line between that and offending someone who has already done it correctly.  So did A have any effect or not?  Anyway looks like we've figured out that really all CPUs *should* show 100% unless they hyperthread.  Wonder what dual cores show, any ideas? <br><br></td></tr></table><br>
<a name="657375"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> To get around the 100% usage:<br>Switch to event based programming, using timers and the input events. You don't need MaxGUI to use events (just if that is a reason not to try it with it :-) )<br><br>Using delay is nice, but it has its drawbacks due to the full app blockage. <br><br></td></tr></table><br>
<a name="657388"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmm, not sure I want to use timers at all, that will screw up everything.  But I understand what you are getting at. <br><br></td></tr></table><br>
<a name="657409"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yan</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I like to double check stuff but there is a thin line between that and offending someone who has already done it correctly. So did A have any effect or not? <br></div>Hmm...I'm not sure how I'm supposed take that?<br><br>In light of my mistake, I didn't see that my results would be any different to the ones you already had, and therefore, relevant.<br><br>Anyway...<br><br>Enabling or disabling the lag fix had no effect on CPU usage in windowed or full screen mode. <br><br></td></tr></table><br>
<a name="657434"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >smilertoo</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> the hyperthreading is a gimmick thats being dropped anyway, it didnt really give 2x speed, it let things runs smoother and a bit faster if the processes were different. <br><br></td></tr></table><br>
<a name="657448"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you use timer + event based, this is not the same like waittimer.<br><br>But you can call rendering time based (as if you would do it by time differences). The main difference on that approach is, that if nothing happens and nothing has to be rendered, then the program has 0% cpu usage! (and if you do it intelligently, you will get up to 300k mainloop runs at 60FPS and that on a 1,5ghz with radeon 9700) *ok not much going on, but just to show the difference we are talking of here*<br><br>Side effect of this technique is as well, that you don't have the so called mouse lag problem which just happens because of 300+ frames actually drawed although its totally pointless (just wastes a lot of cpu time with rendering instead of a more dynamic world) <br><br></td></tr></table><br>
<a name="657481"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ian: I wasn't trying to say anything about you, hope you didn't take offence.  I was just saying I like to double check, but in my experience, some people don't like being asked to double check, esp. when they think they've done it correctly anway.  You DID double check and got back to me which is great thanks.  Shame the test made no difference.  Oh well. <br><br></td></tr></table><br>
<a name="657488"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kuron</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> It was brought to my attention with Easter Bonus <br></div>FWIW, In B+, when using "graphics mode", whether windowed or full-screen, it is best to still use the event stuff to keep your game from hogging the CPU. <br><br></td></tr></table><br>
<a name="657490"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thing is, if you are going to make an action game that scrolls every frame, and redraws everything that's moving, it's going to hog a lot anyway.  But I guess you are saying that any gaps at all can be used by windows then.  Regretably, my whole game structure is NOT using events, just a loop doing logic, input (KeyDown, MouseHit etc) and drawing. <br><br></td></tr></table><br>
<a name="657494"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >boomboom</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> [edit - removed. Sorry I am insanely Tired] <br><br></td></tr></table><br>
<a name="657590"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yan</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hehe...No probs GA, the most innocent of remarks can be easily interpreted in the wrong way. It's the nature of text only communication. :o) <br><br></td></tr></table><br>
<a name="657645"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ian: yeah I know it can make you quite paranoid at times. <br><br></td></tr></table><br>
<a name="657648"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> With VSync off, the app used about 95% of the CPU.  With VSync on, I use about 2%.  pressing A makes no noticable difference.  CPU is an AMD XP2400+ <br><br></td></tr></table><br>
<a name="657649"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Regretably, my whole game structure is NOT using events, just a loop doing logic, input (KeyDown, MouseHit etc) and drawing. <br></div>You may want to rethink that. Event/Hook based programming is more difficult, but it is the 'correct' way to go, seeing as it's the one that's most 'modern OS' friendly. <br><br></td></tr></table><br>
<a name="657654"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the info TomToad. "A" is not programmed into this demo which is why it did nothing :-)<br><br><div class="quote"> you may want to rethink that <br></div> Yeah, seems like a bummer though, sigh, we'll see. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
