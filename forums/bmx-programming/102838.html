<!DOCTYPE html><html lang="en" ><head ><title >Any known issues with LoadImage on Linux?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Any known issues with LoadImage on Linux?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Any known issues with LoadImage on Linux?</a><br><br>
<a name="1233484"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dan_upright</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm using the BLIde FontMachine code with an incbinned font - it works fine on windows but on linux it crashes. I've checked and it <i>is</i> finding the file and opening it successfully but when it tries to use LoadImage on the open stream, it returns null.<br><br>Given that it's the exact same file and code as on windows, does anyone know what could be causing this? <br><br></td></tr></table><br>
<a name="1233486"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> It may depend what other dependencies you are using in your project.<br>Have you tried a basic test with a minimal set of code/modules ? <br><br></td></tr></table><br>
<a name="1233532"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dan_upright</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not yet, I posted that on my way out the door this morning, so it's first on the list now that I'm home. Do you have any particular dependencies in mind when you say that? <br><br></td></tr></table><br>
<a name="1233534"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Brucey surely means something like:<br><br>SuperStrict<br>Framework Brl.Standardio<br>Import Brl.Image<br>Import Brl.Stream<br>Import Brl.PNGLoader<br>...<br><br>a minimal example just using the barely needed things.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1233537"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dan_upright</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I actually seem to be unable to load anything via "incbin::" on linux - if the file wasn't found, it wouldn't compile, right? It's still slightly mystifying because the original crash is after the TStream is checked against null and inside a "While myStream.Eof() = false" loop, so that is definitely being found.<br><br>I'm trying to do some testing with just a basic incbinned image file and I can't open it as a stream <i>or</i> pass it to loadimage, it's bizarre. <br><br></td></tr></table><br>
<a name="1233539"></a>

<a name="1233540"></a>

<a name="1233541"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Remember to add<br><pre class=code>Import BRL.RamStream</pre><br>if you are using Framework. <br><br></td></tr></table><br>
<a name="1233542"></a>

<a name="1233543"></a>

<a name="1233544"></a>

<a name="1233545"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah, you're using Linux.  Have you tried standing on your head in the corner while whistling "O Lord our God of the Swazi" backwards, in the "lounge" style?<br><br>Sometimes you have to go the extra mile to get Linux to graft. <br><br></td></tr></table><br>
<a name="1233546"></a>

<a name="1233549"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dan_upright</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, I cut this right down and it's actually just LoadImage and has nothing to do with incbin.<br><pre class=code>
SuperStrict

Import "-ldl"
Import brl.pngloader

Local imagePath:String = "pointer.png"
Local fhnd:TStream = OpenStream(imagePath)
If fhnd Then
	Print("Stream opened")
	Local myImage:TImage = LoadImage(fhnd)
	If myImage = Null Then Print("Image did not load")
	CloseStream(fhnd)
EndIf

Local myImage:TImage = LoadImage(imagePath)
If myImage = Null Then Print("Image did not load")
</pre><br>This will fail to load the image both times if the image is a png but work fine with a jpeg. Am I missing something obvious or should that not just work the same way as it does under windows?<br><br>Edit - even this fails:<br><pre class=code>
Local myPixmap:TPixmap = LoadPixmapPNG(imagePath)
If myPixmap = Null Then Print("Pixmap did not load")
</pre> <br><br></td></tr></table><br>
<a name="1233550"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I do take it that the file names match exactly. Linux is case sensitive. A file name such as Pointer.png would be not be loaded by using a command to load a file named "pointer.png".<br><br>When writing for cross platform. It's best to use lower case and underscores for where the is white space. <br><br></td></tr></table><br>
<a name="1233551"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >degac</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why did you use OpenStream AND LoadImage?<br><br>*maybe* OpenStream 'lock' the file under Linux for some reason? (I dont' really know... just ideas) <br><br></td></tr></table><br>
<a name="1233555"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dan_upright</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Linux is case sensitive. <br></div><br>I know linux is case sensitive, that's not the issue - running that code will print "Stream opened" then "Image did not load" twice (assuming it's a png and not a jpeg), so OpenStream can find the file but LoadImage cannot.<br><br><div class="quote"> Why did you use OpenStream AND LoadImage?<br><br>*maybe* OpenStream 'lock' the file under Linux for some reason? <br></div><br>I used OpenStream and LoadImage because that's what the FontMachine code does and I was trying to reproduce that issue. I know OpenStream doesn't lock the image because with a jpeg, that code loads the image both times.<br><br>Is it possible that my linux install is missing a library which means that not only will pngs fail to load but they'll do so silently with no compile issues? That seems highly unlikely to me but I'm sure if LoadImage just didn't work on Linux someone would've spotted it before now, right? <br><br></td></tr></table><br>
<a name="1233557"></a>

<a name="1233559"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you using the default (the one that comes with BlitzMax) pub.libpng ?<br><br><br>There are more up-to-date PUB and BRL modules available <b><a href="https://github.com/maxmods" target="_blank">here</a></b>.<br>Note, the newer libpng libraries are better at checking for correctly formatted files, colour profiles, etc. <br><br></td></tr></table><br>
<a name="1233558"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try executing that test code via a command line terminal. If you are lucky you may get some information from libpng complaining. <br><br></td></tr></table><br>
<a name="1233560"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dan_upright</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Are you using the default (the one that comes with BlitzMax) pub.libpng ? <br></div>That was it mate, I'd downloaded from your github on windows but not on linux, works fine now. Cheers. <br><br></td></tr></table><br>
<a name="1233563"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dan_upright</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> And just like that my game is running on linux. \o/<br><br>It segfaults when you quit out but whatever, at least I know cross-platform support is more than a pipe-dream. <br><br></td></tr></table><br>
<a name="1233619"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Segfaults: null access.<br><br>If the vanilla bmx modules fail to load your PNG: what software was used to save the png? Did you try loading that PNG with GIMP and export it again? <br><br>Think the new PNG libs will print some complaints about "ICMP profiles" which were not printed with the vanilla ones.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1233620"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dan_upright</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Segfaults: null access. <br></div>So basically the linux version of "Exception Access Violation"?<br><br>In any case, the segfault went away once I'd applied Skidracer's freejoy fix from <a href="http://www.blitzbasic.co.nz/Community/posts.php?topic=63811#712426" target="_blank">this thread</a>, so I think it was FlushJoy that was causing it. I suspect it might happen again if I was to unplug my joypads before running the game but that didn't occur to me until I'd booted back into windows so I'll have to check another time.<br><br><div class="quote"> If the vanilla bmx modules fail to load your PNG: what software was used to save the png? Did you try loading that PNG with GIMP and export it again? <br></div>The original crash was stuff saved by FontMachine but I use GIMP for editing stuff, so most if not all of the others had been exported from there. The windows version though, not that it should matter. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
