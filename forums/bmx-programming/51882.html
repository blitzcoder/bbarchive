<!DOCTYPE html><html lang="en" ><head ><title >BACKBUFFER ACCESS (MAX2d)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >BACKBUFFER ACCESS (MAX2d)</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >BACKBUFFER ACCESS (MAX2d)</a><br><br>
<a name="579069"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Canali</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br>I'm curious about how to access to the backbuffer in BlitzMax+Max2d before we call the FLIP command.<br><br>I'm interested in implementig effect on the backbuffer drawings.<br><br>Anyone has tryed yet?<br><br>Any sample?<br><br>Thx <br><br></td></tr></table><br>
<a name="579073"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> These functions are already in Bmax but are called something else - LOL and they are not very well documented.<br><br>GrabPixmap - Grabs pixels directly from the backbuffer<br>DrawPixmap - Draws pixeld directly to the backbuffer<br><br>You can't draw a portion of an image to the buffer YET, but It would be simple to write a method to do that. <br><br></td></tr></table><br>
<a name="579076"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Canali</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thx Indie,<br>that's right what I was looking for.<br><br>For filters programming I mostly need per-pixel manipulation.<br><br>Thx again. <br><br></td></tr></table><br>
<a name="579081"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> No problem, now please someone help me with Vertex Buffers. <br><br></td></tr></table><br>
<a name="579107"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Azathoth</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is it possible to get a pointer to the back buffer like in purebasic? <br><br></td></tr></table><br>
<a name="579113"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes it is. <br><br></td></tr></table><br>
<a name="579153"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Azathoth</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Um. Ok, how? <br><br></td></tr></table><br>
<a name="579157"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> have a delve into the directx modules. If you have a look at the commands I mentioned earlier they are using a pointer to the back buffer to get and send information. <br><br></td></tr></table><br>
<a name="579160"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Azathoth</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does it work with OpenGL? <br><br></td></tr></table><br>
<a name="579167"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> good question.<br><br>I don't think you need it in openGl since you just need to read and write pixels, here's the BlitzMax Code :<br><pre class=code>
Method DrawPixmap( p:TPixmap,x,y )
		Local blend=state_blend
		DisableTex
		SetBlend SOLIDBLEND
		
		Local t:TPixmap=YFlipPixmap(p)
		If t.format&lt;&gt;PF_RGBA8888 t=ConvertPixmap( t,PF_RGBA8888 )
		glRasterPos2i 0,0
		glBitmap 0,0,0,0,x,-y-t.height,Null
		glDrawPixels t.width,t.height,GL_RGBA,GL_UNSIGNED_BYTE,t.pixels
		
		SetBlend blend
	End Method

	Method GrabPixmap:TPixmap( x,y,w,h )
		Local blend=state_blend
		SetBlend SOLIDBLEND
	
		Local p:TPixmap=CreatePixmap( w,h,PF_RGBA8888 )
		glReadPixels x,graphics_height-h-y,w,h,GL_RGBA,GL_UNSIGNED_BYTE,p.pixels
		p=YFlipPixmap(p)

		SetBlend blend
		Return p
	End Method
	</pre> <br><br></td></tr></table><br>
<a name="579199"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Filax</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> It is possible to add screen effect like blur or glow ? i have try but ... <br><br></td></tr></table><br>
<a name="579209"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I suppose you could grab the backbuffer and apply that to a quad using the GRabImage function, then do some nice stuff with that image like creating some mipmapps and displaying those full screen - like a quick and dirty blur.<br><br>I wonder if GrabImage keeps the stuff in video memory? that would be nice and quick if it did. <br><br></td></tr></table><br>
<a name="579291"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Eikon</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> How do you GrabImage/GrabPixMap if the image is drawn off screen? This would be helpful for a realtime grab without the need to Cls. <br><br></td></tr></table><br>
<a name="579362"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> GrabPixMap grabs from the backbuffer. GrabIMages uses this function also but puts the pixmap that is returned by this function into a texture.<br><br><pre class=code>Method GrabPixmap:TPixmap( x,y,width,height )
		If islost Return
		Local pixmap:TPixmap
		pixmap=TPixmap.Create(width,height,PF_BGR888)
		Local sdesc:DDSurfaceDesc2=New DDSurfaceDesc2
		sdesc.dwSize=SizeOf(sdesc)
		Local res=PrimaryDevice.backbuffer.Lock(Null,sdesc,DDLOCK_WAIT|DDLOCK_SURFACEMEMORYPTR|DDLOCK_READONLY,Null)
		If res&lt;&gt;DD_OK Return	
		Select sdesc.ddpf_BitCount
		Case 16
			Local s16:Short Ptr=Short Ptr(sdesc.lpSurface+y*sdesc.lPitch+x*2)
			Local d8:Byte Ptr=pixmap.pixels
			For Local i=0 Until height
				For Local j=0 Until width
					Local p=s16[j]
					d8[0]=p Shl 3
					d8[1]=(p Shr 5) Shl 2
					d8[2]=(p Shr 11) Shl 3
					d8:+3
				Next
				d8:+(pixmap.pitch-pixmap.width*3)
				s16:+sdesc.lPitch/2
			Next		
		Case 24
			Local s8:Byte Ptr=sdesc.lpSurface+y*sdesc.lPitch+x*4
			Local d8:Byte Ptr=pixmap.pixels
			For Local i=0 Until height
				memcpy_ d8,s8,pixmap.width*3
				s8:+pixmap.pitch
				d8:+sdesc.lPitch
			Next		
		Case 32
			Local s8:Byte Ptr=sdesc.lpSurface+y*sdesc.lPitch+x*4
			Local d8:Byte Ptr=pixmap.pixels
			For Local i=0 Until height
				For Local j=0 Until width
					d8[0]=s8[0]
					d8[1]=s8[1]
					d8[2]=s8[2]
					d8:+3
					s8:+4
				Next
				d8:+(pixmap.pitch-width*3)
				s8:+sdesc.lPitch-width*4
			Next		
		End Select
		PrimaryDevice.backbuffer.Unlock Null	
		Return pixmap	
	End Method

End Type
</pre> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
