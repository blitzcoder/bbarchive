<!DOCTYPE html><html lang="en" ><head ><title >Blending Mode?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Blending Mode?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Blending Mode?</a><br><br>
<a name="1124556"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi All,<br><br>I am trying to create a fire effect, but the LIGHTBLEND blend  makes it too "white" and seethru...<br><br>Is there a better blend to "add" the colours together (to make them "glow") but not create the image with so much alpha?<br><br>Ta! <br><br></td></tr></table><br>
<a name="1124576"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know that Oddball add a new Blending mode called <b>MOD2XBLEND</b> with Odd2D.mod<br><a href="http://blitzmax.com/Community/posts.php?topic=90436" target="_blank">http://blitzmax.com/Community/posts.php?topic=90436</a><br><br>It's something quite easy to add yourself really.<br>This new Blending mode allow you to choose the amount of light blending.<br><br>128 Red, 128 Green and 128 Blue is considered as neutral and transparent.<br>Going over these values will give you custom Lightblend.<br><br>I'm using this to do simple lightening effect in dark level of my game :<br><a href="https://picasaweb.google.com/118027744236209794583/MetagolfScreenshots#5678572035698158514" target="_blank">https://picasaweb.google.com/118027744236209794583/MetagolfScreenshots#5678572035698158514</a> <br><br></td></tr></table><br>
<a name="1124618"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for that, I actually did add MOD2XBLEND, but not sure how to use it.<br><br>I've just created an image with a grey background(128,128,128) and my fire image (light grey/white), but when I apply a colour via SetColor and draw it I get a square image instead of the fire image. Also SetAlpha doesnt seem to work with it? <br><br></td></tr></table><br>
<a name="1124632"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes that's probably the drawback of using Mox2XBlend... :(<br><br>Sadly, I don't know any other solutions currently. <br><br></td></tr></table><br>
<a name="1124634"></a>

<a name="1124637"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for trying to help anyway :)<br><br>Any chance you could show me a quick example on how you used mod2x? Your fire effect does look cool :)<br><br>I've been looking at blending tutorials and it looks like most of them use additive which I guess is LIGHTBLEND.<br><br><a href="http://blog.martincrownover.com/examples-tutorials/particle-example-fire/" target="_blank">http://blog.martincrownover.com/examples-tutorials/particle-example-fire/</a><br><br>I can nearly make them look good on a black background, but as soon as I use them on an image background they go to white/see-thru.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1124720"></a>

<a name="1124721"></a>

<a name="1124722"></a>

<a name="1124723"></a>

<a name="1124724"></a>

<a name="1124725"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've put together this example, so you can see the issue:<br><br><a href="http://pastebin.com/vwWngCzM" target="_blank">http://pastebin.com/vwWngCzM</a><br><br>(Edit I broke code box :()<br><br>As soon as the Cls Colour changes to a bright background, the effect is ruined :(<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1124732"></a>

<a name="1124733"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oddball</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have you tried laying down an ALPHABLEND base and then layering a subtle LIGHTBLEND glow over the top. I've tried a quick 5 minute hack of your pastebin code. With a little refinement and maybe a changed LIGHTBLEND sprite it might be what you are after.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">'Fire particle Test
' NB: Bitmaps in DefData by matibee
SuperStrict

SeedRnd MilliSecs()

Graphics 800, 600

AutoMidHandle(True)

RestoreData Cloud001_png
Global smoke:TImage = DataToImage()

RestoreData Flame_png
Global flame:TImage = DataToImage()

RestoreData Particle005_png
Global ember:TImage = DataToImage()

Global intervalSmoke# = 4
Global intervalSmokeCounter# = intervalSmoke

Global intervalEmber# = 20
Global intervalEmberCounter# = intervalEmber

Global intervalClsColor# = 200
Global intervalClsColorCounter% = intervalClsColor

Global fps_counter% = 0
Global update_frequency% = 5
Global fps_milli% = MilliSecs()
Global fps%

SetClsColor (0, 0, 0)

Repeat
	Update()
	Render()
	Delay(1)
Until AppTerminate() Or KeyHit(KEY_ESCAPE)

Function Update()
	If intervalClsColorCounter&gt; 0
		intervalClsColorCounter:-1
		If intervalClsColorCounter &lt;= 0
			SetClsColor (Rand(255), Rand(255), Rand(255))
			intervalClsColorCounter = intervalClsColor
		EndIf
	EndIf

	Local x# = 400 + Rand(-100,100)
	Local y# = 550
	
	For Local i% = 0 To 1
		CreateFlameParticle(x, y)
	Next
	CreateSmokeParticle(x, y - 140)
	CreateEmberParticle(x, y - 150)

	TParticle.UpdateAll()
End Function

Function Render()
	Cls
		TParticle.DrawAll()
		SetColor 255, 255, 255
		SetAlpha 1
		SetBlend ALPHABLEND
		SetScale 1, 1
		SetRotation 0
		Local tx%, ty% = 10
		Local gap% = 15
		DrawText "FPS:"+fps, tx, ty
		ty:+gap
		DrawText "No. of Particles = " + TParticle.list.Count(), tx, ty
		ty:+gap
		DrawText "Changing Cls Colour in = "+ intervalClsColorCounter, tx, ty
		
		
		' FPS counter
		fps_counter:+1
		If fps_counter = update_frequency
		     fps = 1000 / Float(((MilliSecs() - fps_milli)) / update_frequency)
		     fps_milli = MilliSecs()
		     fps_counter = 0
		EndIf
	Flip 1
End Function


Function CreateEmberParticle(x#, y#)
	If intervalEmberCounter&gt; 0
		intervalEmberCounter:-1
		If intervalEmberCounter&lt;= 0
			Local p:TParticle = TParticle.Create(ember, x, y, 1)
			p.SetRGB(255, 128, 0)
			p.dy = Rnd(-2, -1)
			p.rotationSpeed = Rnd(-.5, .5)
			p.gravityY = 0.01
			p.scale = Rnd(0.03, 0.05)
			p.SetFade(10, 60, 40)
			p.rotation = Rnd(360)
			p.blend = LIGHTBLEND
			
			intervalEmberCounter = intervalEmber
		EndIf
	EndIf
End Function

Function CreateSmokeParticle(x#, y#)
	If intervalSmokeCounter &gt; 0
		intervalSmokeCounter:-1
		If intervalSmokeCounter &lt;= 0
			Local p:TParticle = TParticle.Create(smoke, x, y, 1)
			p.SetRGB(128, 128, 128)
			p.dy = Rnd(-1, 0)
			p.rotationSpeed = Rnd(-.5, .5)
			p.gravityY = -0.02
			p.scale = 1 + Rnd(.25)
			p.SetFade(80, 10, 80)
			p.maxAlpha = .1
			p.rotation = Rnd(360)
			p.blend = ALPHABLEND
			
			intervalSmokeCounter = intervalSmoke
		EndIf
	EndIf
End Function

Function CreateFlameParticle(x#, y#)
	Local z%=Rand(0,3)
	Local p:TParticle = TParticle.Create(flame, x, y, Not z)
	p.SetRGB(255, 80, 0)
	p.dy = Rnd(-1, 0)
	p.rotationSpeed = Rnd(-1, 1)
	p.gravityY = -0.02
	p.scaleSpeed = -0.001
	p.scale = .35
	p.SetFade(30, 30, 35)
	p.rotation = Rnd(360)
	If z
		p.blend = ALPHABLEND
	Else
		p.blend = LIGHTBLEND
	EndIf
End Function

Type TParticle
	Field x#, y#
	Field dx#, dy#
	Field gravityX#, gravityY#
	Field rotation#
	Field rotationSpeed#
	Field scale# = 1
	Field scaleSpeed#
	Field alpha# = 1
	Field maxAlpha# = 1
	Field image:TImage
	Field blend% = ALPHABLEND
	Field r% = 255, g% = 255, b% = 255
	Field fadeIn# = 0
	Field fadeSustainCounter# = 0
	Field fadeCounter# = 0	
	Field fadeInLength# = 0
	Field fadeLength#=0

	Global list:TList
	
	Function Create:TParticle(image:TImage, x#, y#, z%)
		If list = Null Then list = New TList
		Local p:TParticle = New TParticle
		p.image = image
		p.x = x
		p.y = y
		If z
			list.AddLast p
		Else
			list.Addfirst p
		EndIf
		Return p
	End Function
	
	Function DrawAll()
		If Not list Return
		For Local p:TParticle = EachIn list
			p.Draw()
		Next
	End Function
	
	Function UpdateAll()
		If Not list Return
		For Local p:TParticle = EachIn list
			p.Update()
		Next
	End Function
	
	Method SetFade(theFadeInLength%, theSustain%, theFadeLength%)  
		If theFadeInLength &gt; 0 Then
			fadeIn = 1
			alpha = 0
		Else
			fadeIn = 0
		EndIf	
		fadeInLength = theFadeInLength
		fadeSustainCounter = theSustain
		fadeLength = theFadeLength

		If fadeIn = 0 Then
			fadeCounter = fadeLength
		Else
			fadeCounter = 0
		EndIf
	End Method	
	
	Method Update()
		x :+ dx
		y :+ dy
		If gravityY &lt;&gt; 0
			dy :+ gravityY
		EndIf
		If gravityX &lt;&gt; 0
			dx :+ gravityX
		EndIf
		If rotationSpeed &lt;&gt; 0
			rotation :+ rotationSpeed
		EndIf
		If scaleSpeed &lt;&gt; 0
			scale :+ scaleSpeed
			If scale &lt; 0 Then scale = 0
		EndIf

		If fadeIn
			fadeCounter:+1
			If fadeCounter &gt;= fadeInLength
				fadeCounter = fadeLength
				fadeIn = 0
				alpha = maxAlpha
			End If
		Else If fadeSustainCounter &gt; 0
			fadeSustainCounter:-1
			If fadeSustainCounter &lt;= 0 Then
				fadeSustainCounter = 0
				fadeCounter = fadeLength
			End If
		Else If fadeCounter &gt; 0 Then
			fadeCounter:-1
			If fadeCounter &lt;= 0 Then
				alpha = 0
				Kill()
			EndIf 
		EndIf
	End Method
	
	Method Kill()
		list.Remove(Self)
	End Method
	
	Method Draw()
		SetBlend blend
		If fadeCounter &gt; 0 Then
			If fadeIn Then
				alpha = fadeCounter / fadeInLength
				If alpha &gt; maxAlpha Then alpha = maxAlpha
			Else
				alpha = fadeCounter / fadeLength
				If alpha &gt; maxAlpha Then alpha = maxAlpha
			EndIf
		EndIf
		SetAlpha alpha
		SetColor r, g, b
		SetScale scale, scale
		SetRotation rotation
		DrawImage image, x, y
	End Method
	
	Method SetRGB(r%, g%, b%)
		Self.r = r
		Self.g = g
		Self.b = b
	End Method
	
End Type

'graphics

Function DataToImage:TImage( flags:Int = -1 )
	Local myhex$ = "0123456789ABCDEF"
	Local w:Int, h:Int, line$
	ReadData w
	ReadData h
	Local img:TImage = CreateImage( w, h, 1, flags )
	Local tp:TPixmap = LockImage( img )
	For Local y:Int = 0 To h - 1
		ReadData line$
		For Local x:Int = 0 To w - 1
			Local word$ = Mid$( line$, x * 8 + 1, 8 )
			Local pixel:Int = 0
			Local shift:Int = 28
			For Local i:Int = 1 To 8 
				pixel :+ (Instr( myhex$, Mid$(word$, i, 1) ) - 1) Shl shift
				shift :- 4
			Next 
			WritePixel( tp, x, y, pixel )
		Next 
	Next 
	UnlockImage( img )
	Return img
End Function 
</textarea><br>Use the DataDefs from the pastebin as they break the codebox.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1124738"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for trying Oddball, yep thats okay and I have tried it, but it still doesnt look as nice.... I'm thinking of just bloody creating an image animation now :(<br><br>I've been doing some research:<br><br><a href="http://gamedev.stackexchange.com/questions/22989/how-can-i-achieve-a-good-fire-effect-with-alpha-blending-and-particles" target="_blank">http://gamedev.stackexchange.com/questions/22989/how-can-i-achieve-a-good-fire-effect-with-alpha-blending-and-particles</a><br><br>So this post's solution is rendering to a texture, which is a bit slow in BlitzMax... <br><br>The last post also suggests premultiplied alpha... which I couldnt get to work, I tried:<br><pre class=code>  glBlendFunc GL_ONE, GL_ONE_MINUS_SRC_ALPHA</pre><br>Which I thought was what they were talking about here:<br><br><a href="http://blogs.msdn.com/b/shawnhar/archive/2009/11/06/premultiplied-alpha.aspx" target="_blank">http://blogs.msdn.com/b/shawnhar/archive/2009/11/06/premultiplied-alpha.aspx</a> <br><br></td></tr></table><br>
<a name="1124760"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hiya guys.<br><br>Not sure if this blend table can help you decide the correct blend mode to use to get your desired effect......<br><br><img src="http://jhbmadvocacia.com.br/wp-content/themes/Hermes/images/skins/glblendfunc-i1.jpg"> <br><br></td></tr></table><br>
<a name="1124903"></a>

<a name="1124904"></a>

<a name="1124905"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ta Dave... sometimes when I mess with the blend functions I totally lose the alpha in the background, so I end up drawing squares...<br><br>Samah has suggested that I use a sort of masking function:<br><br>* Draw the particle as a mask with ALPHABLEND<br>* Draw the particle normally with LIGHTBLEND<br><br>Of course this means you are doing twice as much drawing as normal... but it kindof works:<br><br><a href="http://pastebin.com/wEQMDR8d" target="_blank">http://pastebin.com/wEQMDR8d</a><br><br><font class="tiny">Last edited 2012</font><br><br>And heres a few images of it:<br><br>On a black background... looking good:<br><img src="https://lh5.googleusercontent.com/-3R8cTmbvwGQ/TyyswSkv9eI/AAAAAAAAAIY/cU70lBGimBY/s806/Fire.png"><br><br>On a pink background with no masking... <b>not</b> looking good:<br><img src="https://lh3.googleusercontent.com/-HFO4g97SZAM/TyyswdctF2I/AAAAAAAAAIU/miajXxuhho0/s806/fire_pink_1.png"><br><br>On a pink background with with masking... looking decent:<br><img src="https://lh5.googleusercontent.com/-8rM_nDwXqfc/TyyswTMrVaI/AAAAAAAAAIc/5HZUcB_L7oc/s806/fire_pink.png"><br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1124922"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice :)<br><br>The blending/masking works well there! <br><br></td></tr></table><br>
<a name="1125053"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> The mask method is pretty cool but indeed require a second pass.<br>That's mainly why I was searching a more efficient way to draw more sprites on the screen in batch mode for example.<br>This is really important with particles because the Max2D isn't focus on speed but on ease of use. Rendering is currently the only slow part in my game and particles is barely ok with 5 "viewport" rendering (with all game "stuff" included, 4 players split screens and another floating camera, you can eventually reach something like 1024 particles pool x 5 without too much slow down and you can certainly improve this in many ways ;).<br><br>I will think about it for my next engine (full openGL or not ?).<br>Currently my fire effect only work great on dark areas like you said before (fire is visible thanks to color and shadows after all no ?). I'm only using Mod2xBlend for the bright effect around my fire and like it's discussed in another topic the disadvantage is that everything rendered before is affected like parallax, etc. But well, it is superfluous to fix this detail in my case so :D<br><br>Is fire a dynamic object in your game ?<br>Cause sometimes you can reach a better look'n'feel with animated images of a real fire (or pre-rendered fire with alpha in TimelineFx for example, you may also take a look at the realtime module of it, great particles engine !). With nowadays RAM it's another alternative. <br>Particles releasing particles give impressive results visually but consume a lot of processing time if not very optimized. <br><br></td></tr></table><br>
<a name="1125056"></a>

<a name="1125059"></a>

<a name="1125062"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Is fire a dynamic object in your game ? <br></div><br><br>Yeah I did want it to be...<br><br><div class="quote"> or pre-rendered fire with alpha in TimelineFx <br></div><br><br>I didnt know that TimelineFX can output to a pre-rendered files... <strike>I guess it's disabled in the demo, I can't even see an option for it. How do you do it?</strike> Found it! Right-click on the effect in the library and select Animation Properties, then click the "record" icon...<br><br><font class="tiny">Last edited 2012</font><br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1125076"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> blend modes are tough to fiddle and get it exact.<br><br>To do this dynamically, you could try to render to an FBO texture (color 0,0,0 with alpha 0) and just draw the texture quad. <br><br></td></tr></table><br>
<a name="1125078"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> True, but don't forget that FBO cannot be achieved on many GMA card (notebook, old system, etc.) because GL_EXT_framebuffer_object is missing from the OpenGL extensions. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
