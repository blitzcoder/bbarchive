<!DOCTYPE html><html lang="en" ><head ><title >WriteBytes ?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >WriteBytes ?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >WriteBytes ?</a><br><br>
<a name="511474"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Filax</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi :)<br><br>I'm looking under module code stream and i see a writebytes()<br>method, the question is :<br><br>It is possible to use bank with this method ? because when i try<br>to do this with bank my output file are corrupted ?<br><br>Is see in the code<br><br>WriteBytes( buf:Byte Ptr,count )<br><br>The forst arg is Byte ? not TBank ? it is normal ?<br><br>exemple don"t work :<br><br>Local CurrentPakFile:TStream=ReadStream(Pakname)<br>Local Tmp_CompressSize:Int=200000<br>Local SourceBank:TBank<br><br>SourceBank=TBank.Create(Tmp_CompressSize)<br>CurrentPakFile.Writebytes(SourceBank,Tmp_CompressSize)<br><br>If i want do do the same, wihout bug, i must use my hown writebytes function  :<br><br>Function MPK_WriteBytes(File:TStream,Bank:TBank)<br>	For Local I=0 To BankSize(Bank)-1<br>		WriteByte(File,PeekByte(Bank,i))<br>	Next<br>End Function <br><br></td></tr></table><br>
<a name="511487"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> WriteBytes spect a pointer, so you have to pass a TBank.buf instead of the TBank object itself.<br><br>CurrentPakFile.Writebytes(SourceBank<b>.buf()</b>,Tmp_CompressSize)<br><br>this way you're passing the bank buffer, and not the bank buffer object. <br><br></td></tr></table><br>
<a name="511502"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Filax</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok ok !!! many thanks ziggy <br><br></td></tr></table><br>
<a name="511773"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I usually use stream.write(), you pass it the buffer address of the bank and how many bytes to write. <br><br></td></tr></table><br>
<a name="511804"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> be carefull doing stream.write. Some streams uses a CString pointer, so any null byte (byte zero) could corrupt the output data. This doesn't happens with WriteBytes. And this doesn't happens with all streams, just text oriented streams (such as standardiostream). And there's one thing else, your bytes, when using write, all characters greater than 127 will be written in UTF8 format (because this is the default and most compatible cross platform format in BlitzMax) so this conversion to UTF8 will make bytes greater than 127 be represented in a 16 bit format (so the lenght of the streamed data could be greater than the original, and some BYES will be changed unless they're currently representin an UTF8 value).<br>So, as a suggestion, I recomand you to use WRITE for TEXT, and WRITEBYTES for Bytes.<br><br>:)<br>It was only a suggestion... <br><br></td></tr></table><br>
<a name="511832"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting. I didn't find any of the above problems with using stream.write(). I drew images on the backbuffer and then grabbed then with glReadPixels into a bank, then simply used stream.write with the bank's buffer pointer and the size of the bank in bytes. The resulting byte size was as expected (width*height*bytesperpixel), and when reading this into a graphics application as RAW format showed onscreen the same as the original. The image being saved had all values ranging from 0 through 255. <br><br></td></tr></table><br>
<a name="511837"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Gey, notice that This may only happen when using TEXT oriented STREAMS. And I'm not sure if the UTF8 conversion happens when the stream contens is sent to the standardiostream (and displayed in console), or when it is written. For what you say, it may happens when it's sent to the standardiostream, so coping them won't make any change to the data. and in addition, if the lenght parameter is ok, it should skip the zero termination mark, but take in cosideration that, even if it's working, you're accessing 'out of bounds' data, and I'm not sure if it can produce any unspected memory exception.<br>Anyway, it was only a suggestion.<br>:)<br>happy coding! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
