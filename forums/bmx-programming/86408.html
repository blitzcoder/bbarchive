<!DOCTYPE html><html lang="en" ><head ><title >Threading performance hit</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Threading performance hit</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Threading performance hit</a><br><br>
<a name="979638"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> After compiling my game as a threaded app it runs very poorly (jerky). I didn't actually create any threads in the code at all, just changed the compiling option. I'm using BlitzMax 1.33, not SVN. <br><br>I read somewhere that the threaded GC slows things down. Is this still the case? I don't actually want to run any threads during gameplay, just for checking online gameservers during menu screens. Is there anything I can do to get my performance back whilst keeping threading? <br><br></td></tr></table><br>
<a name="979640"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wait until the next version which may (or may not) be a bit better. <br><br></td></tr></table><br>
<a name="979656"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> What that means also is it's showing up the areas of your app that are not constructed well with garbage collection in mind. Before, you got by with the collector working differently, now you need to optimize for the new one. <br><br></td></tr></table><br>
<a name="979669"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, I basically let the GC do it's own thing. <br><br></td></tr></table><br>
<a name="979670"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Can you suspend the Threaded GC like the non-threaded one?<br><br>If you suspend it and not turn it on, does it run as fast as if you compiled with the normal GC?<br><br>I know you can't run like that normally, as the memory usage will just climb, but I am curious if there is something else going on in threaded mode that makes it run slower as well? <br><br></td></tr></table><br>
<a name="979717"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can GCSuspend as normal, but as you say, eventually there's going to be an increase in memory usage dependong on what you're doing. <br><br></td></tr></table><br>
<a name="979718"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> You may also consider manually garbage collecting more often, which may result in less chance of jumping caused by the GC collecting lots of objects at one time. <br><br></td></tr></table><br>
<a name="979727"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, so you can suspend the GC.  Let's say you took the first posters app and compiled it threaded but with the GC suspended.  Would it run as fast as a non-threaded compile with GC suspended?  I am just curious if maybe there isn't some other performance hit as well as the GC one. <br><br></td></tr></table><br>
<a name="979754"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, I just compiled one of my ifsoGUI example apps with threading on and off and with GCSuspend and not, and there was no change in performance for any of them.  Hmmm... <br><br></td></tr></table><br>
<a name="979780"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shambler</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried a simple rotating cube in Leadwerks Engine and found that with a threaded app...<br><br>with GCSetMode(1) 'auto' frames per second were 42fps<br><br>with GCSetMode(2) 'manual' and importantly no call to GCCollect() in the loop fps was still 42fps<br><br>Compiled without the threading option I always get 222fps.<br><br>The only way I could get fps=222 in the threaded mode was to use GCSuspend() before the loop and GCResume()+GCCollect() after.<br><br>Throughout the loop GCMemAlloced() always returned 0.<br><br>It seems there is a huge performance hit in threaded mode just with the GC being active even if no call is made to GCCollect().<br><br>As it is you are better suspending the GC in areas of the program where no garbage is being created and resuming after that area is left.<br><br>Or you could suspend the GC and only resume/collect when GCMemAlloced() returns a high enough value for you to bother about. <br><br></td></tr></table><br>
<a name="979839"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mahan</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> You Bmax gurus out there: Is it possible to mitigate this by compiling a threaded DLL, but having a non-threaded main program? <br><br>Example: Let's say you have a loggning/recording system in a game. You might want to thread the actual writing of the logfile to disk so it won't in any way affect main-loop performance. Can it be done to write a dll (with all synchronization bells and whistles) that can accept a call like logMsg(msg:String) from the main-program, but in the background it places logged lines in a list that are slowly written to disk by an background thread as necessary? <br><br></td></tr></table><br>
<a name="980132"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why even use threaded apps in Blitzmax games? Seriously, I just don't get it except to brag that your game uses it? <br><br></td></tr></table><br>
<a name="980133"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_Skully</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> because on multi-core processors you can get a lot more done in a shorter time span... a non-threaded app can't utilize any parallel processing at all, only time share... I'm hoping to have my network stuff running in a thread among other things. <br><br></td></tr></table><br>
<a name="980134"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mahan</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Why even use threaded apps in Blitzmax games?<br> <br></div><br><br>So how heavy stuff can you possibly add to the mainloop without getting visible breaks? everything above 100ms(50 even?) will be very visible and ugly.<br><br>If you wanna do anything against the filesystem or a database connection it's not a good idea to place it in the mainloop. Many games mitigate this by displaying a "Loading"- screen and loading a full level at a time, but if your game is of any size and you intend to make it seamless (without visible loading), threading could preload resources in the background and make the resources available to the mainthread when the loading is done.<br><br>(Check the slowload-demo in the thread-demo folder in the bmx1.33, to see it in action)<br><br>Imho it's not merely a buzzword, but rather something that most developers will find good use for if they add it to their "skill toolbox". <br><br></td></tr></table><br>
<a name="980161"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Still seems like something to tinker with for techies. I seriously doubt any shareware/commercial coder writing a game for the pc/mac market using Blitzmax is even remotely thinking of ways to add threading to their game. <br><br></td></tr></table><br>
<a name="980166"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mahan</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>I seriously doubt any shareware/commercial coder writing a game for the pc/mac<b>(a)</b> market using Blitzmax<b>b</b> [...]<br> <br></div><br><br>Note how this sentence could be used (changing a and b) for many techniques that are today mainstream among indies. It could be:<br><br>* 3D graphics in the early 90s.<br>* Full 3D models for chars (instead of sprites) in the mid 90ties<br>* Shaders just a few years ago.<br>* Realtime pixel-perfect 2D collisions without specific hardware support.<br><br>etc.etc.<br><br>As the big software houses release new "top of the line" titles, presenting new features, indies (generally) slowly follow and the techniques become mainstream over time.<br><br>Threading is now used in most commercial top titles to utilize the additional CPU-cores available on most machines. It's only logical that the indies follow (slowly after) this development too, imho.<br><br>Besides in many languages (bmx included) the threading is completely optional, so any developer that does not need this can simply just ignore checking the flag in the IDE and just continue live his/her life as it was. Win-Win :-) <br><br></td></tr></table><br>
<a name="980188"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >beanage</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> @MGE<br>I hate it, when someone is talking about blitzmax as a little indie developer langauage. blitzmax is a hll. i'm sure, if everybody talked like you, MGE, there wont be major titles done with bmax never at all indeed. thats how to kill visions. fortunately, not everyone does.<br><br>why are you actually using bmax? why would any indie developer need to utilise the graphics card? does any indie developer actually need 3d? and oop.. isnt that something we also dont realy need?<br><br>(edited to remove harshness)<br><br>sorry. just a little outraged about this. <br><br></td></tr></table><br>
<a name="980195"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Still seems like something to tinker with for techies. <br></div><br><br>As I mentioned in the first thread, I'm trying to add online multiplayer to my racing game New Star GP. The lobby needs to check an sql database on my website every few seconds to see what game servers are available. Without putting this check in a separate thread there is a regular half second pause while it receives the data. Sure, it's not the end of the world but it's not ideal. <br><br></td></tr></table><br>
<a name="980206"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mahan</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you want it easy, no threads, dbs, and stuff and to just focus on making games by point-and-click, try Game Maker:<br><a href="http://www.yoyogames.com/" target="_blank">http://www.yoyogames.com/</a><br><br>BlitzMax on the other hand is a full blown modern OOP-language with a 2D lib.<br><br>(disclaimer: I'm not affiliated with game maker in any way.) <br><br></td></tr></table><br>
<a name="980207"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Without putting this check in a separate thread there is a regular half second pause while it receives the data <br></div><br>Why don't you use a non-blocking request to the server? <br><br></td></tr></table><br>
<a name="980209"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_Skully</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Whoa, Joseph @ BeAnAge, thats harsh... chill out<br><br>An indie developer is just basically a single developer... there is no shame in being an indie developers language of choice... Yes, BMax has the ability to produce bigger and better things, and may be the choice of a professional development team in the future, but it would need to mature before that happens.  The docs are weak for the moment, and there are still tweaks being done to the language core such as the GC.  <br><br>Glad to see your so passionate about the language, I love it too! but using words like "{edit: removed harshness}" is over the top.<br><br>Back on topic...<br>Threading is the way of the future... parallel processing is where everything is headed.. there even talking about network based cloud computing as well.  So ignoring threaded operations would be a mistake in my mind.  indie or not, threaded operations are here and won't be going anywhere.  <br><br>Utilizing the untapped power in multi-cores is an indie developers best friend since we don't have programming teams to concentrate on every little bit of code to best optimize it...  IMHO <br><br></td></tr></table><br>
<a name="980214"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >beanage</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> @mge: sorry. i edited it.<br><br>@skully: multicore usage is inevitable, indeed. but imo, theres even better, and more powerful ways to utilise multiple cores, than plain multithreading! I was impressed when i read about <a href="http://jpaulmorrison.com/fbp/" target="_blank">FBP</a>. Fascinating.<br><br>Yet have a rough version of an implementation of this in work, with cross-platform shared memory, simple tcp synchronization, and even low-level multicontext-rendering support.. might showcase that within the next 2 weeks.<br><br>(And.. btw.. its plain bmax^^) <br><br></td></tr></table><br>
<a name="980224"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_Skully</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, you will still need threading for flow based processing if you want it to utilize more than one core anyway.. otherwise its just time shared monitoring while you wait for "black box's" to finish their transformations. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
