<!DOCTYPE html><html lang="en" ><head ><title >Collision point</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Collision point</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Collision point</a><br><br>
<a name="989797"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I figure a diagram is in order for this:<br><br><img src="http://www.desktopgaming.net/junk/halp.jpg"><br><br>I know the position of the ship, and the position of the enemy.  I also know the vector, shown in red.<br><br>I can detect a laser-to-ship collision.  What I need is exact x/y coordinates of the point of impact.<br><br>Ideas? <br><br></td></tr></table><br>
<a name="989800"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wiebo</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could do a simple line intersection calculation. check all four rectangle list against the vector. <br><br></td></tr></table><br>
<a name="989803"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, the rectangle was just for illustration.  The enemy won't necessarily be rectangular. <br><br></td></tr></table><br>
<a name="989808"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Amon</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could store the pixel locations of the target in a lookup table and check collision on that??? <br><br></td></tr></table><br>
<a name="989811"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nate the Great</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> there is a lines intersect function somewhere in the code arcs... Make a rough outline for each enemy and use those as collision "meshes" <br><br></td></tr></table><br>
<a name="989812"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tommo</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> there is a lines intersect function somewhere in the code arcs...  <br></div><br>It seems to be this one:<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1676" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1676</a> <br><br></td></tr></table><br>
<a name="989835"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> The way I am doing it is with ImagesCollide But it doesn't return a exact point of collision. I was thinking of creating a single pixel image and testing it against the image. If and when the collision occurred then I know that is a close point of collision(speed error), move back one pixel at a time in the direction of the laser until it no longer collide. I seen it done before in some demo code but I really don't know how bad it will be as far as processing speed goes. <br><br></td></tr></table><br>
<a name="989868"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> This might be affected by how you're detecting the collision at the moment, but assuming you can construct a line of some sort from where the laser starts, here's what I would at least try (completely untested, of course, and probably trickier than it sounds)...<br><br> Calculate the slope of the (laser's) line in terms of x-offset and y-offset;<br><br> Use a <a href="/posts.php?topic=83890#947110" target="_blank">line/rect intersect</a> function to find where the laser enters the spaceship's bounding image rectangle;<br><br> Start at the intersection point (translated from the image on the screen to the image's pixmap), reading the pixel value from the pixmap, moving along if it matches the mask colour:<br><br><pre class=code>
While pixmap_pixel_value = mask_color 

    x = x + x_offset
    y = y + y_offset

    ' Check still inside pixmap boundaries, Exit if not!

Wend

' If a non mask_color pixel was found, then collision_x = x; collision_y = y
</pre><br><br> When pixel_value &lt;&gt; mask_color, collision has occurred. In theory.<br><br>Although it sounds involved, I bet it'd be pretty quick in reality. Of course it might be utter twaddle. <br><br></td></tr></table><br>
<a name="989869"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> That sounds feasible... thanks.  I'd probably need to check for non-alpha pixels though to get the right result (I'm using PNGs).<br><br>I'll give that a crack tomorrow. <br><br></td></tr></table><br>
<a name="989987"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was curious enough to have a quick hack at this. I've only dealt with the 'inside pixmap' part of my theory, and assumed the laser starts at 0, 0 with the image also at 0, 0, no scaling, etc, but it gives an idea of how this could work. It's quick enough here, anyway.<br><br>IMPORTANT: Save this code into the <i>BlitzMax\samples\hitoro</i> folder so that the image meets the needs of the hacky demo code:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

' Needs better stepping algorithm to avoid missing narrow image features, especially
' with very steep or shallow lines...

Graphics 640, 480

SetClsColor 64, 128, 255

SetMaskColor 255, 0, 255
SetBlend MASKBLEND

pix:TPixmap = LoadPixmap ("gfx/boing.png")
image:TImage = LoadImage (pix)

mask = ReadPixel (pix, 0, 0) ' Quick hack! Assumes top-left pixel is mask colour!
pmw = PixmapWidth (pix)
pmh = PixmapHeight (pix)

Repeat

	mx = MouseX ()
	my = MouseY ()
	
	Cls

	SetColor 255, 255, 255
		
	DrawImage image, 0, 0

	SetColor 0, 255, 0
	DrawLine 0, 0, mx, my
	
	If MouseHit (1) ' Try MouseDown for speed test!
		
		originx# = 0
		originy# = 0
		
		laser_length# = Dist (originx, originy, mx, my)
		
		xdist# = mx - originx
		ydist# = my - originy

		ystep# = laser_length / xdist
		xstep# = laser_length / ydist

		x# = originx
		y# = originy		

		While x &lt; pmw And y &lt; pmh

			x = x + xstep
			y = y + ystep

			' Just a quick hack to keep within pixmap boundaries (ReadPixel not happy)...
			
			If x &lt; 0 Then x = 0
			If y &lt; 0 Then y = 0
			If x &gt; pmw - 1 Then x = pmw - 1; Exit
			If y &gt; pmh - 1 Then y = pmh - 1; Exit
		
			If ReadPixel (pix, x, y) &lt;&gt; mask
				Particle.Explode x, y, -ystep, -xstep, 10
				Exit
			EndIf
			
		Wend
		
	EndIf

	Particle.DrawAll
		
	Flip

Until KeyHit (KEY_ESCAPE)

End

Function Dist# (x0#, y0#, x1#, y1#)
         Return Sqr (((x1 - x0) * (x1 - x0)) + ((y1 - y0) * (y1 - y0)))
End Function

Type Particle

	Global gravity# = 0.2
	Global plist:TList
	
	Field x:Float, y:Float
	Field xs:Float, ys:Float
	
	Field r, g, b
	
	Field size = Rand (2, 8)
	
	Function Explode (x#, y#, xstep#, ystep#, count)
		If Not plist Then plist = CreateList ()
		For a = 0 Until count / 2

			p:Particle = New Particle
			p.x = x
			p.y = y
			p.xs = (1.0 / xstep) * Rnd (2, 5)
			p.ys = (1.0 / ystep) * Rnd (2, 5)
			p.r = Rnd (240, 255)
			p.g = Rnd (240, 255)
			p.b = 0

			ListAddLast plist, p
			p:Particle = New Particle
			p.x = x
			p.y = y
			p.xs = (1.0 / xstep) * Rnd (2, 5)
			p.ys = (1.0 / ystep) * Rnd (2, 5)
			p.r = 255
			p.g = 255
			p.b = 255
			ListAddLast plist, p

			p:Particle = New Particle
			p.x = x
			p.y = y
			p.xs = (1.0 / xstep) * Rnd (2, 5)
			p.ys = (1.0 / ystep) * Rnd (2, 5)
			p.r = Rand (200, 255)
			p.g = Rand (0, 200)
			p.b = 0
			ListAddLast plist, p

		Next
	End Function

	Function DrawAll ()
		If plist
			For p:Particle = EachIn plist
				p.x = p.x + p.xs
				p.ys = p.ys + Particle.gravity
				p.y = p.y + p.ys
				SetColor p.r, p.g, p.b
				DrawRect p.x - p.size / 2, p.y - p.size / 2, p.size, p.size
				If p.x &lt; 0 Or p.x &gt; GraphicsWidth () Or p.y &lt; 0 Or p.y &gt; GraphicsHeight ()
					ListRemove plist, p
				EndIf
			Next
		EndIf
	End Function
		
End Type

</textarea><br><br>To truly see the awesome power of this demo, change MouseHit to MouseDown! <br><br></td></tr></table><br>
<a name="989998"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Whenever you code without Strict, a little baby rabbit dies. Even hacky demo code :'( <br><br></td></tr></table><br>
<a name="990004"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >beanage</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd suggest (sry for ugly pseudocode):<br><br><pre class=code>
'for each model outline
   'get intersection
      'if ship.distance( intersection )&lt; ship.distance( previous intersection )
         'previous intersection:= intersection
'return previous intersection
</pre> <br><br></td></tr></table><br>
<a name="990007"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GaryV</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Well, the rectangle was just for illustration. The enemy won't necessarily be rectangular. <br></div><br><br>No Borg War game? :( <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
