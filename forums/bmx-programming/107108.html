<!DOCTYPE html><html lang="en" ><head ><title >Render to Texture</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Render to Texture</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Render to Texture</a><br><br>
<a name="1324217"></a>

<a name="1324219"></a>

<a name="1324220"></a>

<a name="1324223"></a>

<a name="1324224"></a>

<a name="1324246"></a>

<a name="1324250"></a>

<a name="1324251"></a>

<a name="1324252"></a>

<a name="1324253"></a>

<a name="1324254"></a>

<a name="1324438"></a>

<a name="1324527"></a>

<a name="1324528"></a>

<a name="1325046"></a>

<a name="1325097"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Source code: <a href="https://github.com/davecamp/Render2Texture" target="_blank">Render 2 Texture</a><br><br>Hi all,<br><br>As a result of a request for a 'render to texture' feature for BlitzMax I've made an initial effort just to get the ball rolling to see how it develops. Consider this an early alpha test just to get some initial feedback on if it works for your setup, and if you like the code that you need to write to get it working, or if anything drastic needs to be changed etc then to know at this stage would be better to know now than later.<br><br><br>The main goals behind this effort are...<br>1. Create a unified single command set to allow creating and rendering to a texture for the GLMax2D, D3D9Max2D and D3D11Max2D graphics drivers. This is to aid keeping the underlying technique as transparent to the user as possible. D3D7Max2D is considered too old for todays current hardware so there will be little interest in writing code for this driver. Other drivers, for example the SDL driver for MaxNG, will be considered when the time arises.<br><br>2. The command set should be as small as possible, down to some simple create and use functions. The less the coder does means it will be easier and less confusing to use.<br><br>3. Operate seemlessly with all of the current Max2D drawing commands with as little impact on any code changes as possible.<br><br>4. Work with both the legacy BlitzMax compiler and Bruceys MaxNG compiler.<br><br><br><br>Current development will be using the legacy compiler before writing the code for the MaxNG compiler.<br><br>There are some module tweaks that I know will be needed for this to be finalised but just for now I'll save them for later. I'd prefer at this early stage for people not to mess with modules just yet and they are only a small tweaks, but do have a major impact on functionality. As it is things are working on my set up but YMMV.<br><br><br>Issues that will be fixed with the module updates are...<br>1. <strike>Currently, for Dx9 you will get EAVs if you switch from full screen to windowed and visa-versa.</strike> Fixed with a modification to d3d9graphics.bmx<br>2. <strike>The Dx11 driver Cls isn't working. I know why this is and have a fix, but again it will need a module tweak.</strike> Fixed with a modification to d3d11max2d.bmx and d3d11graphics.bmx<br>3. <strike>Switching graphics drivers... I haven't tested this just yet however I'm pretty much 100% certain will not work properly at this stage.</strike> Updated and fixed.<br><br>So all in if you wouldn't mind having an initial play that would great just to see how things are initially.<br><br>Cheers!<br><br>ps In the source code there are some example files. These are little demo apps just to get something up and running on screen. Feel free to change the Max2DDriver to see if its initially working on your setup. All feedback is very welcome. <br><br></td></tr></table><br>
<a name="1324225"></a>

<a name="1324226"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> A working 'render to texture' in Blitzmax has existed for almost a decade btw.  Searching the forums and code archives will yield working versions. <br><br></td></tr></table><br>
<a name="1324235"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> There existed solutions but they were only OGL or DX...with different commsndsets and no interchangeability<br><br><br>Also it is good to have this done by someone who did a dx11 mod...<br><br><br>Will try to test the code tomorrow when at my computer again.<br><br>Bye<br>Ron <br><br></td></tr></table><br>
<a name="1324247"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, I should have outlined the main reasons behind why this little project popped up, thanks Derron.<br><br>I've edited the first post accordingly. <br><br></td></tr></table><br>
<a name="1324288"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is a another simple sample:<br><br><pre class=code>

Strict

Import "renderimage.bmx"

SetGraphicsDriver GLMax2DDriver()
'SetGraphicsDriver D3D9Max2DDriver()
Local gc:TGraphics = Graphics(800, 600)

SetBlend AlphaBlend

Local rt:TRenderImage = CreateRenderImage(gc, 800, 600)
SetRenderImage(rt)
Cls
SetRenderImage(Null)

MidHandleImage(rt)

local currentRotation:int = 0
While Not KeyDown(KEY_ESCAPE)
	' render into the texture
	SetRenderImage(rt)
		SetRotation currentRotation
		SetScale 0.90, 0.90
		DrawImage(rt, GraphicsWidth()/2, GraphicsHeight()/2)
		currentRotation = (currentRotation + 5) mod 360
		SetScale 1.0, 1.0

		SetRotation 0
		DrawOval(0,0, 10,10)

	' switch back to render to the original backbuffer
	SetRenderImage(Null)
	Cls
	SetColor 255,255,255
	DrawImage(rt, GraphicsWidth()/2, GraphicsHeight()/2)

	DrawText "Render 2 texture: " + GetGraphicsDriver().ToString(), 0, 0
	Flip
Wend
End
</pre><br><br><br>PS: wonder why your<br>DrawImage(rt), MouseX(), MouseY()<br>works (see main.bmx) ... I mean the closing bracket after "(rt".<br><br><br>Maybe "DW" could come up with some nice samples (as he enjoys the single-buffer-approaches).<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1324304"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> PS: wonder why your<br>DrawImage(rt), MouseX(), MouseY()<br>works (see main.bmx) ... I mean the closing bracket after "(rt". <br></div><br><br>That's actually a typo and should have been DrawImage(rt, MouseX(), MouseY())<br>I'm in a transitional period of putting parenthesis around the outer function parameters for all functions, not the individual parameters themselves but in the same way as a C language variant requires them.<br><br>The reason it works in that each of the parameters are expressions so (rt) is just a normal expression. All blitz languages have the feature of only requiring the outer most parenthesis when you want the value returned from the function, if you don't want the return value then you don't need them. In this case it works according to that feature. <br><br></td></tr></table><br>
<a name="1324305"></a>

<a name="1324306"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Regarding DX7<br><br>Is it that much "work" or just a slight lazyness (its weekend!)? Just asking because DX7 is an "official module" of BlitzMax.<br><br>So if one wants to "support" DX7 they could not just use that r2t.<br><br><br>But I assume this would be the same for some kind of generic "shader support" (which is another "wish" - for some effects many casual games have - like blurred/desaturated backgrounds when a menu is open).<br><br>So if no means no ... I will accept that ;-)<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1324321"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> So if no means no ... I will accept that ;-) <br></div><br>Heh, It's open source feel free to implement Dx7 if you want to and we'll include it in but yeah I personally can't be bothered to support it at this time due to a number of reasons. I never say 'never' though :D<br><br>A similar style of functions for a unified shader set could be created in due course. <br><br></td></tr></table><br>
<a name="1324328"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Seeing <a href="/post.php?topic=73223&amp;post=834797" target="_blank">this</a> does not really look similar to yours.<br><br>Maybe DX7 needs a bit more "done" to make it work.<br><br>According to <a href="http://www.gamasutra.com/view/feature/131806/rendering_to_texture_surfaces_.php" target="_blank">that gamasutra article</a> there are multiple ways to achieve that render-to-texture functionality with DX7.<br><br><br>I dumbfully thought of an easy transition (replacing D3D9*** with D3D7***) ... but hey if that was so easy, you would already have done it :-)<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1324352"></a>

<a name="1324353"></a>

<a name="1324356"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> What's your thoughts on handling this scenario?<br><br>The Dx9 render targets need to be destroyed and recreated when transitioning using alt-tab when in fullscreen mode.<br><br>The problem is that any data that's in a render texture will be lost when the texture is destroyed. The destruction and recreation code is done and automatic but what's on my mind is handling any existing texture data.<br><br>So I was thinking of having these 2 options<br><br>1. to have a callback function that will allow the coder to put texture data back into the image if they want any specific data in it at that time of the transition.<br>2. have a convenience function that when called would take a 'snapshot' of the current texture data, this would be used to automatically recreate the texture so that it survives the destruction and reconstruction phase. A side effect of this would require another function if a coder then wanted to change their mind and send the texture to option 1.<br><br>The 'snapshot' feature may turn out slow and may not be suitable for every frame due to the nature of pulling data from the gpu being an inherently slow process anyway.<br><br>What's your thoughts on this?<br><br>EDIT<br>As it happens I think I have a way to handle this completely automatically so that the texture survives the transition every time... time for some sleep though. <br><br></td></tr></table><br>
<a name="1324371"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Re Scenario<br>If you talk about the multiple approaches: I would try to use the most simple one even if it wont work on all HW.<br><br><br>@ Destroying textures<br>How do you intend to inform each texture about the "onDestroy" and "onRecreate" (or similar?<br>Shouldn't this need some kind of event system or "texture manager" which knows every texture?<br><br>Without that I can only imagine a "if myG &lt;&gt; GetGraphics() then RecreateMyself()"-approach.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1324426"></a>

<a name="1324429"></a>

<a name="1324430"></a>

<a name="1324431"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> .double post <br><br></td></tr></table><br>
<a name="1324432"></a>

<a name="1324433"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Texture management<br>One of the reasons I created the TRenderImageContext was in case any kind of regular 'boiler-plate' code crept in, which it did almost immediately. It also serves as a nice place for texture management :O)<br><br>I've updated the repo to include the dx9 render-texture persistance through the alt-tab scenario.<br><br>If you wouldn't mind testing when you get some time, that would be cool.<br>Cheers.<br><br>Still more to do for dx11 :p <br><br></td></tr></table><br>
<a name="1325047"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've upped the modifications required for dx11 to the repo in my sig.<br><br>I noticed that in your example you're binding a render target and then rendering the texture of the render target into itself. I know that this is a No-No in Dx11 and will not work. <br><br></td></tr></table><br>
<a name="1325099"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Also just upped a fix to allow changing graphics drivers while the code is running. <br><br></td></tr></table><br>
<a name="1325169"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ drawing rt into rt<br><br>How to tackle this then?<br>How to have something like that "Mirror in a mirror in a mirror ..." thing?<br><br>With defeault you have to copy an image first because you else modify the source when writing to the target. Another classic approach (single buffer) is <br>Draw<br>- grabpixmap<br>- draw grabbed<br>Flip<br>Draw<br>...<br><br><br>PS: did not have had time for DX9-tests, preparing next main-release of my game and some users brought up "need!!!"-features ;-)<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1325195"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> How to tackle this then? <br></div><br>You would normally have 2 textures. The one that you want to render, and the one that you want to render into, except that don't clear the render-texture between frames? <br><br></td></tr></table><br>
<a name="1325199"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> But this would add another draw each loop (the one of the "non-render-target-texture")?!<br><br>switchActiveTex(tex1, tex2)<br>drawOnActiveTex( inactiveTex )<br>drawOnActiveTex( the added stuff )<br>flip<br><br><br>Hmm, that should work. Glad I would use it more for bringing together "components" of an composite image (eg. skinnable GUI-widgets) .<br><br><br>Wonder where DW is once we need him to test this properly with his effect-demos :-)<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1325202"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bobysait</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can swap the textures between two renders (the one to happen and the one to render to)<br><br>CurT = T1; T1 = T2; T2=CurT<br>Render on T1 buffer with T2 drawn inside<br>CurT = T1; T1 = T2; T2=CurT<br>Render on T1 buffer with T2 drawn inside<br>etc ...<br><br>You'll maybe notice the current frame showing the previous frame so it may feel laggy or not. <br><br></td></tr></table><br>
<a name="1325204"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Glad I would use it more for bringing together "components" of an composite image <br></div><br>That's the main idea behind it with the ability to do that in the main loop if you choose to.<br><br>'render-to-texture' came about initially for reasons such as rendering a scene into car mirrors, rendering a video to a texture that's used for a tv screen, viewing through a 'warp portal' and other fun stuff :o)<br><br>There will always be 1 extra draw call to draw the texture itself after rendering into it. <br><br></td></tr></table><br>
<a name="1326664"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello. Yep, I'm still here. With questions - always. :)<br><br>I just need a simple example, preferably, without calling a library.<br><br>I have the working code for the example HERE:<br><br><a href="http://www.blitzbasic.com/Community/posts.php?topic=107224" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=107224</a><br><br>Which is almost perfect. I just need to be able to have BLACK $000000 show through as transparent instead of opaque as it is now, and anything brighter than $000000 such as $010101 to show as black opaque.<br><br>If I can get someone to make a fix in the code 107224 to do that, then that will be fine for me, answers my question, and opens up the easy ability to write directly to TIMAGES as screen objects. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
