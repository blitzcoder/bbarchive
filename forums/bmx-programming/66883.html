<!DOCTYPE html><html lang="en" ><head ><title >Procedurally generated foliage distribution</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Procedurally generated foliage distribution</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Procedurally generated foliage distribution</a><br><br>
<a name="746897"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was reading about deco layers in the Unreal engine:<br><a href="http://udn.epicgames.com/Two/CreatingDecoLayers" target="_blank">http://udn.epicgames.com/Two/CreatingDecoLayers</a><br><br>It looks like they use a "density map" to indicate where the foliage is.  This is better than storing 10,000 instances of a mesh on the terrain.  Presumably, you just input the player position on the terrain and generate a somewhat random distribution of foliage around them.<br><br>Any ideas on how I can procedurally a circle of foliage positions around the player?  The foliage would be the same if the player left and came back, but I want to do this without storing 10,000 instances of foliage...I just want to be able to input a random seed or something, and have all the foliage instances get generated.<br><br>I supposed you could treat each pixel as a discreet area, and input the x and y pixel coordinates as the random seed, then use that to generate some number of foliage instances distributed across the area of that pixel...but I have a feeling there is a better way to do this.<br><br>Also, I'll need to z-sort the instances, so keep that in mind...maybe there is a way of generating the positions "radially"? <br><br></td></tr></table><br>
<a name="746918"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >impixi</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Banshee and/or jfk EO-11110 might be able to help you. They briefly discuss such issues in this thread:<br><br><a href="/posts.php?topic=63948#713769" target="_blank"> Overlord (Terrain System) </a> <br><br></td></tr></table><br>
<a name="746921"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SoggyP</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello.<br><br>What about the use of fractals or some such bizarro maths thingymubob?  At a very basic level using a sine wave would work in one dimension, eg, where the value of sin(x_pos) is above a certain level plant a tree.  Obviously, this would be far too regular (and single dimensioned, obviously) but with a more complex formula would allow you the functionality you're after.<br><br>Goodbye. <br><br></td></tr></table><br>
<a name="746928"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >impixi</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> For one of my prototype B3D landscape systems, I was dividing the terrain into a grid, and then pre-generating and storing the following information for each cell: <br><br>	* Central coordinates <br>	* Random coordinate offset values for each foliage item <br>	* Foliage type for each set of offset values <br>	* Foliage scaling, rotation and tilting for each instance <br><br>I used a pre-generated heightmap to determine the type of foliage (if any) that existed in a cell. A different heightmap was used to determine foliage density. <br><br>This method, while probably not the most optimal, constructed a reasonably realistic landscape. It also had the added benefit of a ‘built-in’ LOD system – for the immediate cells around the player’s position I created the relevant sprites/meshes, the rest, beyond the player’s visibility, I destroyed.<br><br>My biggest problem was performance. All the creating and deleting of entities reduced the frame-rate considerably. On its own it was acceptable, but when I factored in the other calculations that must be done in the main loop (enemy AI, collisions, etc) it was just too slow.<br><br>I tried another technique, based on Banshee’s suggestions, I think, whereby the foliage instances were hidden, rather than destroyed, when they moved out of the player’s visibility range. They were later ‘shifted’ into a new position and unhidden if a foliage item of the same type came into the player’s view. I can’t remember why, but I hit a barrier with this technique. At that point I more or less gave up on B3D, due to the size my project had attained.<br><br>Incidentally, if you want heightmap generating code for your experiments, see my sig…<br><br><b>EDIT</b>: Clarification: When I mention foliage ‘type’, I mean a byte or integer ID number. NOT a sprite/mesh instance. <br><br></td></tr></table><br>
<a name="746965"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think you have the right idea halo.  <br><br>First, decide on the granularity of your grid.  Ie, all locations where a plant could be.  Then for each location within the player's view, using floating point locations if you need to to make your grid fine enough, multiply the Y by the width, and then add the X and use that as your unique random number seed.  <br><br>Then, for each location, after you set the random number seed, do rnd(0, 1) and multiply this by the foliage density map's color divided by 255.0.  This will produce a number from 0..1 with 0 wherever the foliage density map is black, and a random ditribution within it.<br><br>Then, if your result is say, &gt; 0.9, randomly select, scale, and rotate a plant, or randomly generate a plant using however many random numbers you need.  <br><br>This will ensure that plants appear at the same locatons, and look the same every time.  And it will still allow you to generate only those numbers for the region surrounding the player, and adjust the foliage density for each area according to your density map! <br><br></td></tr></table><br>
<a name="746967"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SoggyP</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello.<br><br>I still say go for the bizarro maths thingymubob because it means you don't have to store anything apart from a formula.  So nyaah.  :o)<br><br>Goodbye. <br><br></td></tr></table><br>
<a name="747016"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, I am thinking bizarro maths is the way to go.<br><br>There's no "entities" to create and destroy, I just need a list of positions, and then I'll render however many instances of my mesh I need.  I'd prefer not to generate any stored data, because the sheer numbers of things to sift through will slow it down.<br><br>So the player's xz position, rounded to the nearest pixel of the density map or heightmap, is input as the random seed...<br><br>It would be nice to be able to generate a circular shape around the player, instead of generating a square shape and distance-culling and z-ordering the instances.  It would also be nice to be able to generate an arbitrary circle for any float position, instead of having to generate the data for all the "nearby" tiles.<br><br>hmmmm...<br><br>Maybe it would work to start by generating a grid of plant positions with a circle...use sin and cos to generate the grid, starting from the furthest out, and working your way inwards.  Then you can add some randomness to the positions (but not enough that you would need to change the z-order).<br><br>So the first step would be to write an algorithm to generate points with a circle, in the order of distance from the center:<br><img src="http://www.leadwerks.com/post/diag.png"> <br><br></td></tr></table><br>
<a name="747075"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SoggyP</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello.<br><br>Hurrah!  I've managed to help Halo - perhaps he'll forgive me for pi55ing him off all those years ago by explaining that a plane was a thing that flew in the sky, but was different to a bird because it didn't have feathers, ask any chemist.<br><br>Though he's probably forgotten, of course, it's weighed terribly on me, I can tell you.  Night after night of sheer worry I've had, never believing I could be so cruel.  But that's all over now, of course.  Because I'VE helped.  So just watch it.<br><br>Ahem.<br><br>:o)<br><br>Goodbye. <br><br></td></tr></table><br>
<a name="747171"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >impixi</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Yeah, I am thinking bizarro maths is the way to go.<br> <br></div><br><br>I agree! The only reason I did not go that route myself is because I’m useless at trigonometry. I’d be very interested to see what you come up with. <br><br></td></tr></table><br>
<a name="747204"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> The method I outlined does not require you to generate any stored data.  Other than that foliage density map you wanted.  I only suggested that you COULD generate unique foliage for each location using that method.  You could simply choose one  of four static meshes and not even rotate or scale them at all.<br><br>If you don't want a density map, you don't need to use it with that method.  But then your foliage will be of uniform density everywhere.  But it will be randomly placed, yet remain the same when you come back.  <br><br>If you don't want to use a density map and you don't want it uniform everywhere, you could use some kind of equation, but  why go to all that trouble finding one that looks okay?  YOu could just procedurally generate a small perlin noise map and use that as your density map if you must and you can make a unique one for each level by storing a single random number seed. <br><br></td></tr></table><br>
<a name="747217"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Look and see how speedtree is doing it.  Shouldn't be too hard to find.  Plus I seem to remember reading about how they were doing foilage. <br><br></td></tr></table><br>
<a name="747258"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >impixi</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> LOD/Performance-related article:<br><br><a href="http://www.cg.tuwien.ac.at/research/publications/2006/G_P_06_RFS/G_P_06_RFS-Report.pdf" target="_blank">Rendering of Forest Scenes</a> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
