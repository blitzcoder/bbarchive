<!DOCTYPE html><html lang="en" ><head ><title >Audio Saving problem (and clicks on Mac)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Audio Saving problem (and clicks on Mac)</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Audio Saving problem (and clicks on Mac)</a><br><br>
<a name="1297669"></a>

<a name="1297677"></a>

<a name="1297680"></a>

<a name="1297681"></a>

<a name="1297682"></a>

<a name="1297689"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> So I got the strength and some time to sit down to code and I thought I'll try learn Bmax some more.<br>I found some nice examples here in the different forums.<br><br>Got something running, but the save does not work for me on Mac.<br>I get a 44 bytes file and this error message:<br>2016-03-01 16:30:05.342 record[6725:348438] -[NSColorSpaceColor _boolForRegID:]: unrecognized selector sent to instance 0x38a250<br>2016-03-01 16:30:05.343 record[6725:348438] -[NSColorSpaceColor _boolForRegID:]: unrecognized selector sent To instance 0x38a250<br><br>Also another and perhaps bigger problem;<br>While using other examples (not this one, this one works perfectly except saving..<br>I discovered clicks on Mac (Windows does not has this issue at all, but OSX does). And I finally bumped into this; <a href="http://www.blitzbasic.com/Community/posts.php?topic=87431" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=87431</a><br>It might be the same issue I앐 not sure. If so are this thread still relevant or is it incorporated in the newest Bmax download by now?<br><br>If it's still relevant, I앐 really not that savvy grasping those steps mentioned in the thread so how would I do that exactly? <br><br>* RES renamed properly into BYTES in all occasions now.<br>* Wrappable timer check.<br><br><pre class=code>
EnableOpenALAudio; SetAudioDriver "OpenAL" ; Graphics 800,600
Global Device% ; Device=alcOpenDevice(Null) ; Global CapDev%
CapDev = alcCaptureOpenDevice(Null,44100,AL_FORMAT_MONO16,44100*2*1*5) ; alcCaptureStart CapDev
Global Num% , Sum% , RecTime% , RecordNow%=1 , Channels%=1 , Bytes%=2 , Space%= 44100 * Channels * Bytes% * 240 , music:TSound
Global TestSample:TAudioSample=CreateAudioSample(Space,44100,SF_MONO16LE)

Repeat
    If RecTime - MilliSecs() &lt; 0 ' Wrappable MillSec (was If RecTime &lt; MilliSecs() )
       RecTime = MilliSecs() +500 ;alcGetIntegerv(CapDev,ALC_CAPTURE_SAMPLES,4,Varptr(Num))
       If (Sum + (Num*Channels*Bytes)) &lt; Space Then alcCaptureSamples(CapDev,TestSample.Samples+Sum,Num) ; Sum = Sum + (Num * Channels* Bytes)
    EndIf
    If KeyHit(Key_R) And RecordNow = 0 Then RecordNow = 1 ; alcCaptureStart(CapDev) ; Sum = 0 ' Record from mic
    If KeyHit(Key_P) And RecordNow = 0 Then Music = LoadSound(TestSample) ; PlaySound Music    ' Playback
    If KeyHit(Key_S) And RecordNow = 1 Then RecordNow = 0 ; alcCaptureStop CapDev                   ' Stop
    Flip 0
Until KeyHit(Key_Escape)
alcCloseDevice CapDev ; alcCloseDevice Device
SaveWAV
End

Function SaveWAV()
   Local name$ = RequestFile$("Filename...","Audio:wav",True) , SndBank:TBank,FileStream:TStream , Bits = 16
   SndBank = CreateStaticBank(TestSample.samples,Sum) ; FileStream = WriteStream(name$)
      If FileStream Then
         fileStream.WriteString "RIFF"                               ' Fixed header (always 4 bytes)
         fileStream.WriteInt Sum + 40                              ' File size
         fileStream.WriteString "WAVE"                             ' Fixed header (always 4 bytes)
         fileStream.WriteString "fmt "                                ' Fixed header (always 4 bytes)
         fileStream.WriteInt 16                                         ' Size of WAVE section chunk
         fileStream.WriteShort 1                                       ' WAVE type format 
         fileStream.WriteShort Channels                            ' Mono/stereo 
         fileStream.WriteInt Testsample.Hertz                    ' Sample-Rate 44100
         fileStream.WriteInt Testsample.Hertz * Channels * Bytes ' Bytes/sec
         fileStream.WriteShort Channels * Bytes                ' Bytes/sample
         fileStream.WriteShort Bits                                    ' 8 or 16 bits
         fileStream.WriteString "data"                               ' Fixed header (always 4 bytes)
         fileStream.WriteInt Sum                                      ' Size of sample data
         SndBank.Write FileStream,0,Sum ; CloseStream FileStream
   EndIf
End Function
</pre> <br><br></td></tr></table><br>
<a name="1297671"></a>

<a name="1297674"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just guessing here, but all of those fileStream.Write commands write a total of 44 bytes. <br>That means the final SndBank.Write is not writing anything. Is Sum zero?<br><br>As a reality check you could add one line of code to SaveWAV()<br><pre class=code>         Print "Sum = " + Sum
         SndBank.Write FileStream,0,Sum ; CloseStream FileStream
</pre><br>If Sum is zero then you have to figure out why. One possible source of trouble is Millisecs(), which may have wrapped around to a negative value if your computer has not been rebooted in a very long time.<br><br>You are doing <br><br><pre class=code>If RecTime &lt; MilliSecs()</pre><br>which can fail if MilliSec() is negative. The right way to test is<br><pre class=code>If RecTime - MilliSecs() &lt; 0</pre>That will work even if MilliSecs() has wrapped around. <br><br></td></tr></table><br>
<a name="1297673"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Res doesnt exist, so it will be 0, thus the line <pre class=code>Sum = Sum + (Num * Channels* Res)
</pre> Will always be zero too.<br><br>You should get into the habit of at least using Strict so this kinda thing never happens ;) <br><br></td></tr></table><br>
<a name="1297676"></a>

<a name="1297684"></a>

<a name="1297686"></a>

<a name="1297687"></a>

<a name="1297690"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Floyd I did exactly that before posting and ya that's the 44 bytes yup.  I didn't come much longer though with that. I got that nasty error message and it's all new to me what it means.<br><br>@Grable Ah thanks for making me notice that, ya, I renamed res into bytes, that's why,I did several versions and somewhere the mix of the two made into this one. Thats certainly one bit of the puzzle. I edited the source now to be true to each variables name. I앐 in the process of learning to use SUPERSTRICT and see how that feels.<br><br>Still the same error, but it saved 11MB this time. I could play it in VLC.<br>BMax still gives this error on exit<br>2016-03-01 18:45:04.938 untitled10[7018:369474] -[NSColorSpaceColor _boolForRegID:]: unrecognized selector sent to instance 0x273270<br>2016-03-01 18:45:04.938 untitled10[7018:369474] -[NSColorSpaceColor _boolForRegID:]: unrecognized selector sent to instance 0x273270<br><br>I narrowed the error down to these, but have no clue what it is<br>   Local name$ = RequestFile$("Filename...","Audio:wav",True) , SndBank:TBank,FileStream:TStream , Bits = 16<br>   SndBank = CreateStaticBank(TestSample.samples,Sum) ; FileStream = WriteStream(name$) <br><br></td></tr></table><br>
<a name="1297694"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I narrowed it down further, it was the requestfile, how to fix that? <br><br></td></tr></table><br>
<a name="1297696"></a>

<a name="1297697"></a>

<a name="1297698"></a>

<a name="1297699"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I must say that I았e had alot od errors with GUI alot with Mac<br>either they appear in the background,a and does not  really distrurb the exits, <br>or they mess everything up all together.<br><br>But I았e had alot of issues with BMax GUI + Mac . I think the GUI is unstable somehow. Or I았e missed something vital. <br><br>How about that update procdure that fixes glitches on Mac? <br>I'm ready to try  that now if someone wants to guide me I'll do my best. <br><br></td></tr></table><br>
<a name="1297701"></a>

<a name="1297704"></a>

<a name="1297705"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> There is no usage of NSColorSpaceColor in any of the *.m files though, so i dont know where that comes from.<br>And looking at the class <a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/ApplicationKit/Classes/NSColorSpace_Class/index.html" target="_blank">here</a>, it doesnt have this method (and never did, as far i can tell).<br>EDIT: Not the same class name i noticed, but i cant find anything on NSColorSpaceColor, only NSColorSpace.<br><br>I guess it boils down to what version of BlitzMax your running and on which OSX version.<br>Try getting hold of Brucey, he also uses a mac and im sure he would know if its related to that. Even though hes more focused on bmx-ng these days, he still tries to be compatible with vanilla. <br><br></td></tr></table><br>
<a name="1297706"></a>

<a name="1297710"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay ya, I won앖 bother him as bmx-ng is sounds like the better thing to work on. I don앖 need GUI.<br><br>I use the latest version of Bmax that comes precompiled v6.1 I think? <br>It says 1.50 in the aboutbox but i know its higher. I did that misstake once already. I got that latest "Mac fixed version".<br><br>I think sincerly think BMax is faulty there somewhere when it comes to GUI. Alot to fix. This is not the the 1st weird error.<br><br>EDIT for the record I use Yosemite 10.10.5 right now. And the latest Bmax that's downloadable from blitzbasic.com accounts. <br><br></td></tr></table><br>
<a name="1297707"></a>

<a name="1297708"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I should probably add that it's only Mac this happens on. Windows haven't had those errors.  <br><br>Though they share odd behaviours..  such as the restore button which always stops working suddenly as it should.<br>This happens both on Mac and PC in all the demos I았e tried. I havn't been able to rule it our as a bug yet. <br>It works, it works, and then.. it doesn't. That's the pattern.  It might stretch the window vertically but not horisontally, or not at all. <br><br></td></tr></table><br>
<a name="1297718"></a>

<a name="1297719"></a>

<a name="1297720"></a>

<a name="1297721"></a>

<a name="1297722"></a>

<a name="1297723"></a>

<a name="1297724"></a>

<a name="1297725"></a>

<a name="1297727"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> About the click, this is what I use as a try bed now. I think you need a Mac to hear the clicking, or else its the buffersize that needs to be increase.<br>With Mac's it does not matter if you increase the buffers, you get regular clicking at each buffer swap. Somethings terribly wrong.<br><br><pre class=code>

' List all audiodrivers on the system
' For Local a$=EachIn AudioDrivers() ; Print a ; Next

Rem This is what I get on the Mac for example
OpenAL Default
OpenAL Built-in Output
OpenAL
FreeAudio
FreeAudio CoreAudio
EndRem

SuperStrict
Graphics w,h ; EnableOpenALAudio ; SetAudioDriver "OpenAL"
Const s:Int = 1024 , w:Int = 1280 , h:Int = 800 ' If something clicks, try increase buffersize (s)
Global src:Int , b:Int[3] , al:Short[s] , format:Int = AL_FORMAT_MONO16 , buf:Byte Ptr = Byte Ptr al , hz:Double = 1.0
Global a:Double = 0.0 , buffer:Int , val:Int,d:Int , c:Int , vol:Double = 0.0 , i:Int

' Init OpenAl (Tripple buffering, queue buffers and start playing)
' Samplerate = 44.1Khz, bits = 16, Channels = Mono, Buffersize = 1024 samples

d=alcOpenDevice(Null) ; C=alcCreateContext(d,Null) ; alcMakeContextCurrent C ; alGenBuffers 3,b ; alGenSources 1,Varptr src
alBufferData b[0],format,buf,s*2,44100 ; alBufferData b[1],format,buf,s*2,44100 ; alBufferData b[2],format,buf,s*2,44100
alSourceQueueBuffers src,1,Varptr b[0] ; alSourceQueueBuffers src,1,Varptr b[1] ; alSourceQueueBuffers src,1,Varptr b[2] ; alSourcePlay src

' Clear buffer
For Local i:Int = 0 Until s ; AL[i] = 0 ; Next

Repeat
Cls
' -------------------------------------------------------------------------
alGetSourcei src,AL_BUFFERS_PROCESSED,Varptr val
	While val 
		alSourceUnqueueBuffers src,1,Varptr buffer
		For i = 0 Until s ; AL[i] = vol*Sin(a)*$7fff ; hz:+((0.5*2^(MouseX()/(0.125*w)))-hz)*0.0002 ; a:+hz ; vol:+((1.0-(Double(MouseY())/h))-vol)*0.0002 ; Next
		alBufferData buffer,format,buf,s*2,44100 ; alSourceQueueBuffers src,1,Varptr buffer ; val:-1
	Wend
alGetSourcei src,AL_SOURCE_STATE,Varptr val ; If val &lt;&gt; AL_PLAYING Then alSourcePlay src
' -------------------------------------------------------------------------

SetColor 0,255,0 ; For i = 0 Until s Step 2 ; Plot i,10+700*(Float((AL[i]+$7fff) Mod $ffff)/$ffff) ; Next
Flip 1
Until KeyHit(KEY_ESCAPE) Or AppTerminate()
alcDestroyContext C ; alcCloseDevice d
</pre> <br><br></td></tr></table><br>
<a name="1297726"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting program, Casaber. Sounds like something out of Star Trek. <br><br>Are you trying to achieve a pure tone ? <br><br></td></tr></table><br>
<a name="1297728"></a>

<a name="1297729"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> @dw817  I found lots of examples on the forum and one was one of those Russian exotic instruments what's the name? Theremins.<br>Those where always used for those old Horror movies and ya Star trek, so  you couldn't be more right.<br><br>I앐 trying to have pure tone (any tone really) without the glitching happening. It's the glitching that's the problem, <br>It's pretty intense how deep it seem to go. I hope it's possible to fix. Becuase BMax would be so nice to use for crossplatforms.<br><br>You didn앖 hear any cracks on Windows did you? <br><br></td></tr></table><br>
<a name="1297733"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Lots of clicking. I'm beginning to wonder if going the route of building a sound this way is different on each PC.<br><br>I've got some book chapters to write (every Tuesday) but once I finish w that I'm going to look to see how a .WAV file is formed and see if I can't build something in there. <br><br></td></tr></table><br>
<a name="1297741"></a>

<a name="1297742"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzMan</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> @dw817 can not wait to see your book guy.It will be Biblical im sure. <br><br></td></tr></table><br>
<a name="1297743"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Heh, it's already done. Well several books actually, science fiction story, Future Barrier (completing 2nd book), The Dream Machine (done), and Nancy Principle, 2 books complete. On Tuesdays I work on Dream Diary though which is not a book per se.<br><br>You can find that here.<br><br><a href="http://www.writerscafe.org/writing/dw817/1228821/" target="_blank"><b>READING LINK</b></a>. <br><br></td></tr></table><br>
<a name="1297748"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzMan</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> See the link.It is more small thought`s than story.Everyone has a book in them.Mine is everyone dies on this planet ,and i start again with EVE.ie:MEGAN FOX <br><br></td></tr></table><br>
<a name="1297753"></a>

<a name="1297754"></a>

<a name="1297755"></a>

<a name="1297756"></a>

<a name="1297757"></a>

<a name="1297758"></a>

<a name="1297759"></a>

<a name="1297760"></a>

<a name="1297761"></a>

<a name="1297762"></a>

<a name="1297764"></a>

<a name="1297765"></a>

<a name="1297766"></a>

<a name="1297767"></a>

<a name="1297768"></a>

<a name="1297769"></a>

<a name="1297770"></a>

<a name="1297771"></a>

<a name="1297772"></a>

<a name="1297773"></a>

<a name="1297774"></a>

<a name="1297775"></a>

<a name="1297777"></a>

<a name="1297778"></a>

<a name="1297781"></a>

<a name="1297782"></a>

<a name="1297783"></a>

<a name="1297789"></a>

<a name="1297791"></a>

<a name="1297792"></a>

<a name="1297793"></a>

<a name="1297794"></a>

<a name="1297795"></a>

<a name="1297796"></a>

<a name="1297805"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> @dw817 I can give you a boost learning wav, lemme get down the code just as a guide for the contents of the header, sorry about the layout at the right... I tried, I never got the hang of tabs.<br><br><pre class=code>
Function SaveWAV()
   Local name$ = RequestFile$("Filename...","Audio:wav",True) , SndBank:TBank,FileStream:TStream , Bits = 16
   SndBank = CreateStaticBank(TestSample.samples,Sum) ; FileStream = WriteStream(name$)
      If FileStream Then
         fileStream.WriteString "RIFF"                                            ' Fixed header (12 bytes total chunk)
       * fileStream.WriteInt Sum + 40                                             ' Chunk size (Overall)
         fileStream.WriteString "WAVE"                                            ' Fixed header
         ' ----------------------------------------------------------------------------------------
         fileStream.WriteString "fmt "                                            ' Fixed header (always 4 bytes) (24 bytes total chunk) 
         fileStream.WriteInt 16                                                   ' Chunk size
         fileStream.WriteShort 1                                                  ' PCM aka WAVE audio format = 1 (change to 3 for WAVE_FORMAT_IEEE_FLOAT)
    &gt;  * fileStream.WriteShort Channels                                           ' 1=Mono/2=stereo (number of channels)
    &gt;  * fileStream.WriteInt Testsample.Hertz                                     ' e.g. 44100 / 48000 / 96000 / 192000 / anything (samplerate) (samples per second) 
       * fileStream.WriteInt Testsample.Hertz * Channels * Bytes                  ' Bytes/sec aka (also called Byterate) You calculate this one, using two of the other fields:  samplerate * blockalign.
       * fileStream.WriteShort Channels * Bytes                                   ' Bytes/sample (also called blockalign) You calculate this one, using two of the other fields:  channels * (bitspersample / 8)
    &gt;  * fileStream.WriteShort Bits                                               ' Bits per sample (8/16/32) (bit depth)    
         ' ----------------------------------------------------------------------------------------
         fileStream.WriteString "data"                                            ' Fixed header (always 4 bytes) (8 bytes + actual wave total chunk)
       * fileStream.WriteInt Sum                                                  ' Bytes of sample data which is about to come
         SndBank.Write FileStream,0,Sum ; CloseStream FileStream ' Audiodata
   EndIf
</pre><br><br>This is the common wav model it uses 3 chunks (44 bytes in total) + data<br>You can have inbetween extra chunks but its EXTREMELY rare, you can safely ignore those.<br><br>Everything is pretty static, I pointed out the 7 things (3 really as the rest are calculated and not interesting, but I marked them as they do change) The rest in the 44 byte header are just.. static info no need to know or change.<br><br>And to create waves, we want to look at the end of course, the actual data.<br><br>How data is stored:<br>8-bit audio are stored as -128 to 127 as unsigned bytes 0-255. <br>16-bit audio are stored as -32768 to 32767 but actually -32760 to 32760 (this is the only one that are concerned with endianness)<br>32-bit audio are stored as -1.0f to 1.0f (32bit floats) (this one needs one extra step to be activated using the field in the fmt chunk to 3 (WAVE_FORMAT_IEEE_FLOAT)<br>                                                                             Without it you get instead 32bit integers with similiar properties of 16bit as you would think, including Endianess. Integers are always better quality than floats when you use bits to the fullest.<br><br><br>If stereo is used then right ones are stored, then left ones.<br><br>Hope that helps !! <br><br></td></tr></table><br>
<a name="1297776"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow I got the tabs just right, that was a world first. Pure accident. <br><br></td></tr></table><br>
<a name="1297884"></a>

<a name="1297885"></a>

<a name="1297887"></a>

<a name="1297888"></a>

<a name="1297889"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried today with 3 buffers, and with 8 buffers, to see if it should fix the clicking by adding a multitude of buffers, neither the size or the number changes the fact that it makes Macs into a click factory.<br><br>I tell you this is what complexity gives you. OS and everything inbetween stops you from moving 90KB lousy bytes per second.<br>Right now using 44100 * 2 bytes which comes just below 90KB per second.<br><br>Actually MIDI showed it even better, it needs only 4KB per second to reach proffessional timing quality which has been okay in studios since 1983 and ya still is by todays standards in many respects. <br>It압 nice when its working. Very nice. But it's not easy to move even 4KBytes evenly through the system, It's just barely managable, nothing obviously easy about it.<br><br>Now the next goal; moving 90KB per second through the system and allowing a base for realtime synthesis. <br>OpenAL is not absolutely ideal for this but I know it's well good enough to manage it by experience. <br><br>So I'm starting to think there's something missing, but I don앖 know where. OS or Bmax, or something inbetween.<br><br>I changed this back to 3 buffers as that seem about ideal. And 2048byte buffers is abit large but it seem needed right now till things got fixed.<br><br><pre class=code>

SuperStrict ; SetGraphicsDriver GLMax2DDriver()
Const s:Int = 1024*2 , w:Int = 1280 , h:Int = 800
Global src:Int , buffers:Int[3] , AL:Short[s] , format:Int = AL_FORMAT_MONO16 , buf:Byte Ptr = Byte Ptr AL , hz:Double = 1.0
Global  a:Double = 0.0 , buffer:Int , val:Int,ALDev:Int , C:Int , st:Float , v:Float , cntr:Double , vol:Double = 0.0
GLGraphics w,h,0 ; glewInit ; glFlush ; glOrtho 0,w,h,0,-100,100 ; glEnable GL_ALPHA_TEST ; glAlphaFunc GL_NOTEQUAL,0 ; glEnable GL_BLEND

' Init OpenAl (Open device, create context, and activate it, add 3 buffers, and 1 src)
ALDev=alcOpenDevice(Null) ; C=alcCreateContext(ALDev,Null) ; alcMakeContextCurrent C ; alGenBuffers 3,buffers ; alGenSources 1,Varptr src

' Clear buffer
For Local i:Int = 0 Until s ; AL[i] = 0 ; Next

' Create 3 buffers and queue them and start playing
alBufferData buffers[0],format,buf,s*2,44100 ; alBufferData buffers[1],format,buf,s*2,44100 ; alBufferData buffers[2],format,buf,s*2,44100
alSourceQueueBuffers src,1,Varptr buffers[0] ; alSourceQueueBuffers src,1,Varptr buffers[1] ; alSourceQueueBuffers src,1,Varptr buffers[2] ; alSourcePlay src

Repeat
	glClear GL_COLOR_BUFFER_BIT
	alGetSourcei src,AL_BUFFERS_PROCESSED,Varptr val ' Get val
	While val
		alSourceUnqueueBuffers src,1,Varptr buffer ' Change buffer queue

		' Create waveform in buffer
		For Local i:Int = 0 Until s ; AL[i] = vol*Sin(a)*$7fff ; cntr = 0.5 * 2 ^ (MouseX() / (0.125*w)) ; hz:+(cntr-hz)*0.0002 ; a:+hz ; vol:+((1.0 - (Double(MouseY()) / h))-vol) * 0.0002 ; Next

		alBufferData buffer,format,buf,s*2,44100 ; alSourceQueueBuffers src,1,Varptr buffer ; val:-1 ' 
	Wend
If val =&lt; 0 Then alGetSourcei src,AL_SOURCE_STATE,Varptr val ; If val &lt;&gt; AL_PLAYING Then alSourcePlay src ' 
st = Float(w)/8 ; For Local i:Int = 0 Until s ; v = Float((AL[i]+$7fff) Mod $ffff)/$ffff ; glBegin GL_POINTS ; glVertex2d i,10+700*v ; glEnd ; Next ' Draw 

Flip 1
Until KeyHit(KEY_ESCAPE) Or AppTerminate()
alcDestroyContext C ; alcCloseDevice ALDev
</pre> <br><br></td></tr></table><br>
<a name="1297894"></a>

<a name="1297895"></a>

<a name="1297896"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think I changed my mind I think the best bet would be to code directly to the OS underlaying. Because not much are needed. Under 10 calls per OS of those you<br>would want to support. And you can direct to a common and ideal one for each system then. That would be the best strategy. Even if this one works, one would get picky<br>and would want to reach one step further. And that would probably spell the word problems. <br><br></td></tr></table><br>
<a name="1297933"></a>

<a name="1297934"></a>

<a name="1297935"></a>

<a name="1297936"></a>

<a name="1297937"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> If anyone wants a example that almost works. <br>A datatype other than SHORT (unsigned 16bit) and INT (signed 32bit) is needed<br>like a 16bit signed. But that's for another day. It kinda works without it. strangely enough. <br><br>Instructions:<br>Select some wave you want with the mouse, and then press right mouse button to stamp out a 10 seconds wav of that very waveform of your fine selection.<br><br><pre class=code>
' Create waveform and save it (WAV 16 bit, 44100, mono)

Graphics 800,600
Local samplerate:Int = 44100             ' Samplerate = 44.1Khz, we want 44100 samples To pass To the ears per second.
Local seconds:Double = 10                ' 10 seconds long.
Local SAMPLES:Int = samplerate * seconds ' How many samples would that take, not bytes though, it's samples, we take account to actual bytes per sample later.
Local waveform:Int[SAMPLES]              ' Create a suiting buffer to hold the samples.
Local t:Double , i:Int                   ' Some variables To work with.

' Parameters we'd want to be able to change
Local hz:Double = 440.0      '  Hz aka pitch aka frequency, this could be anything, 20 - 20000 is human normal perception. 
Local volume:Int = 32000     ' Volume aka amplitude, this could be anything that bitdepth allows. Use close max values for best quality, think "big shapes", you want things big.

Repeat
Cls

hz = MouseX()*10

' Create the waveform
For i = 0 Until SAMPLES
    t = Double(i) / Double(samplerate)
      waveform[i] = volume * Sin(hz * t * 360.0) ' 360 degrees instead of 2 * pi radians.
Next

' Draw the waveform, fit it on the screen
For i = 0 Until 44100
Plot i/(44100/800),300 + (waveform[i]/(32000.0/300.0)) ' 800 and 300 (half of 600) is what we want to fit the entire wave inside.
Next

Flip 1
Until MouseDown(2)

Local name$ = "sound.wav", SndBank:TBank,FileStream:TStream , Bits = 16 , Bytes = 2 , Channels = 1 , Sum = Samples * 2 ' 16 bit each sample is 2 bytes in size then
SndBank = CreateStaticBank(waveform,sum) ; FileStream = WriteStream(name$)

      If FileStream Then
         fileStream.WriteString "RIFF"                                            ' -
         fileStream.WriteInt Sum + 40                                             ' Manipulates size
         fileStream.WriteString "WAVE"                                            ' -
         ' ----------------------------------------------------------------------------------------
         fileStream.WriteString "fmt "                                            ' -
         fileStream.WriteInt 16                                                   ' -
         fileStream.WriteShort 1                                                  ' 1 for integer WAV (bit choices are then 8/16/32/any), or 3 for float WAV (bit choices are then 32/64).
         fileStream.WriteShort Channels                                           ' Number of channels
         fileStream.WriteInt Samplerate                                           ' Samplerate
         fileStream.WriteInt Samplerate * Channels * Bytes                        ' Byterate
         fileStream.WriteShort Channels * Bytes                                   ' Bytes per sample "Block align"
         fileStream.WriteShort Bits                                               ' Bitdepth (avoid 24bit etc try use those above instead, nothing wrong with wasting space for effeciency and quality)
         ' ----------------------------------------------------------------------------------------
         fileStream.WriteString "data"                                            ' -
         fileStream.WriteInt Sum                                                  ' Manipulates size
         SndBank.Write FileStream,0,sum ; CloseStream FileStream                  ' Audiodata
EndIf
End
</pre> <br><br></td></tr></table><br>
<a name="1297939"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> VLC did not eat the 32bit out of the box, I can't remember if that's whats' expected.<br><br>But it does play 32bit float out of the box.<br>I warn you, put the volume down before, I mean it. <br><br><br><pre class=code>
' Create waveform and save it (WAV 32 bit, 44100, mono)

Graphics 800,600
Local samplerate:Int = 44100             ' Samplerate = 44.1Khz, we want 44100 samples To pass To the ears per second.
Local seconds:Double = 10                ' 10 seconds long.
Local SAMPLES:Int = samplerate * seconds ' How many samples would that take, not bytes though, it's samples, we take account to actual bytes per sample later.
Local waveform:Float[SAMPLES]              ' Create a suiting buffer to hold the samples.
Local t:Double , i:Int                   ' Some variables To work with.

' Parameters we'd want to be able to change
Local hz:Double = 440.0      '  Hz aka pitch aka frequency, this could be anything, 20 - 20000 is human normal perception. 
Local volume:Int = 32000     ' Volume aka amplitude, this could be anything that bitdepth allows. Use close max values for best quality, think "big shapes", you want things big.

Repeat
Cls

hz = MouseX()*10

' Create the waveform
For i = 0 Until SAMPLES
    t = Double(i) / Double(samplerate)
      waveform[i] = volume * Sin(hz * t * 360.0) ' 360 degrees instead of 2 * pi radians.
Next

' Draw the waveform, fit it on the screen
For i = 0 Until 44100
Plot i/(44100/800),300 + (waveform[i]/(32000.0/300.0)) ' 800 and 300 (half of 600) is what we want to fit the entire wave inside.
Next

Flip 1
Until MouseDown(2)

Local Bits = 32
Local name$ = "sound.wav", SndBank:TBank,FileStream:TStream , Bytes = Bits/8 , Channels = 1 , Sum = Samples * Bytes
SndBank = CreateStaticBank(waveform,sum) ; FileStream = WriteStream(name$)

      If FileStream Then
         fileStream.WriteString "RIFF"                                            ' -
         fileStream.WriteInt Sum + 40                                             ' Manipulates size
         fileStream.WriteString "WAVE"                                            ' -
         ' ----------------------------------------------------------------------------------------
         fileStream.WriteString "fmt "                                            ' -
         fileStream.WriteInt 16                                                   ' -
         fileStream.WriteShort 3                                                  ' 1 for integer WAV (bit choices are then 8/16/32/any), or 3 for float WAV (bit choices are then 32/64).
         fileStream.WriteShort Channels                                           ' Number of channels
         fileStream.WriteInt Samplerate                                           ' Samplerate
         fileStream.WriteInt Samplerate * Channels * Bytes                        ' Byterate
         fileStream.WriteShort Channels * Bytes                                   ' Bytes per sample "Block align"
         fileStream.WriteShort Bits                                               ' Bitdepth (avoid 24bit etc try use those above instead, nothing wrong with wasting space for effeciency and quality)
         ' ----------------------------------------------------------------------------------------
         fileStream.WriteString "data"                                            ' -
         fileStream.WriteInt Sum                                                  ' Manipulates size
         SndBank.Write FileStream,0,sum ; CloseStream FileStream                  ' Audiodata
EndIf
End
</pre> <br><br></td></tr></table><br>
<a name="1297940"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> I앐 not trying 64bit before I get my headphones and heraing back. <br><br></td></tr></table><br>
<a name="1297942"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Casaber. This is some good work here. If you want, have a CONSTANT variable or something in the beginning to allow the person trying this to adjust the volume in the code.<br><br>Say, "Const Volume=10" from a scale of 1-255. <br><br></td></tr></table><br>
<a name="1297944"></a>

<a name="1297945"></a>

<a name="1297946"></a>

<a name="1297947"></a>

<a name="1297948"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> repost repost <br><br></td></tr></table><br>
<a name="1297949"></a>

<a name="1297950"></a>

<a name="1297951"></a>

<a name="1298028"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks. What about this, I skipped the 16bit version becuase it needs conversion (a one liner but my brain needs to work for that one liner)<br><br>Here's a retake on the 32bit one, a m ore friendly one. EXCEPT on the ears. <br>Sinewaves have never been kind to ears.<br><br>Added on earprotector constant.- To save mankind. I앐 nice today. <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
'
' Parameters we'd want to be able to change

const earprotector:double = 0.1 ' Use 10% max volume change to what you want. This is also visible on the screen as we watch the true wave.

Local hz:Double = 440.0      '  Hz aka pitch aka frequency, this could be anything, 20 - 20000 is human normal perception. 
Local volume:Int = 32000 * earprotector   ' Volume aka amplitude, this could be anything that bitdepth allows. Use close max values for best quality, think "big shapes", you want things big.

' Note that we'll change hz usin the mouse in this example though.

Rem
                  .::           .::  
.:: .::   .:::.:  .::       .:  .::  
    .::  .:    .: .::         .:.: .:
 .::         .::  .:: .::  .::  .::  
    ::.    .::    .::   .::.::  .::  
     :::..::      .::   .::.::  .::  
.::::::  .::::::: .:: .::  .::   .:: 
                                     
.::        .::      .:       .::         .::
.::        .::     .: ::      .::       .:: 
.::   .:   .::    .:  .::      .::     .::  
.::  .::   .::   .::   .::      .::   .::   
.:: .: .:: .::  .:::::: .::      .:: .::    
.: .:    .:::: .::       .::      .::::     
.::        .::.::         .::      .::      

Create waveform and save it as a .WAV (32 bit, 44100, mono)
------------------------------------------------------------                                
EndRem 

Graphics 800,600

'
' Try change these aswell, for instance samplerate into 48000 or 192000 for 48Khz or 192Khz sample qulity
' Also the length of the wave in seconds is set here
'
Local samplerate:Int = 44100             ' Samplerate = 44.1Khz, we want 44100 samples To pass To the ears per second.
Local seconds:Double = 10                ' 10 seconds long.
Local SAMPLES:Int = samplerate * seconds ' How many samples would that take, not bytes though, it's samples, we take account to actual bytes per sample later.
Local waveform:Float[SAMPLES]              ' Create a suiting buffer to hold the samples.
Local t:Double , i:Int                   ' Some variables To work with.

Repeat
Cls

hz = MouseX() * 10
SetColor 255,255,255 ; DrawText "Hz = " + hz,0,0
' Create the waveform
For i = 0 Until SAMPLES
    t = Double(i) / Double(samplerate)
      waveform[i] = volume * Sin(hz * t * 360.0) ' 360 degrees instead of 2 * pi radians.
Next

SetColor 0,255,0
DrawLine 0,300,799,300
' Draw the waveform, fit it on the screen
For i = 0 Until 44100
Plot i/(44100/800),300 + (waveform[i]/(32000.0/300.0)*0.9) ' 800 and 300 (half of 600) is what we want to fit the entire wave inside.
Next

Flip 1
Until MouseDown(2)

Local Bits = 32
Local name$ = "sound.wav", SndBank:TBank,FileStream:TStream , Bytes = Bits/8 , Channels = 1 , Sum = Samples * Bytes
SndBank = CreateStaticBank(waveform,sum) ; FileStream = WriteStream(name$)

      If FileStream Then
         fileStream.WriteString "RIFF"                                            ' -
         fileStream.WriteInt Sum + 36                                             ' Manipulates size
         fileStream.WriteString "WAVE"                                            ' -
         ' ----------------------------------------------------------------------------------------
         fileStream.WriteString "fmt "                                            ' -
         fileStream.WriteInt 16                                                   ' -
         fileStream.WriteShort 3                                                  ' 1 for integer WAV (bit choices are then 8/16/32/any), or 3 for float WAV (bit choices are then 32/64).
         fileStream.WriteShort Channels                                           ' Number of channels
         fileStream.WriteInt Samplerate                                           ' Samplerate
         fileStream.WriteInt Samplerate * Channels * Bytes                        ' Byterate
         fileStream.WriteShort Channels * Bytes                                   ' Bytes per sample "Block align"
         fileStream.WriteShort Bits                                               ' Bitdepth (avoid 24bit etc try use those above instead, nothing wrong with wasting space for effeciency and quality)
         ' ----------------------------------------------------------------------------------------
         fileStream.WriteString "data"                                            ' -
         fileStream.WriteInt Sum                                                  ' Manipulates size
         SndBank.Write FileStream,0,sum ; CloseStream FileStream                  ' Audiodata
EndIf
End

</textarea> <br><br></td></tr></table><br>
<a name="1297952"></a>

<a name="1297953"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> That volume protection helps a little, Casaber. Unfortunately it is also bending the .WAV pitch a little. Just a tiny bit.<br><br>You can see this with frequency: 2450. Try 10% max volume, then 100% max volume and listen closely to the difference. And yes, adjust the volume so it does not hurt your ears.<br><br>I have very thick headphones I wear most of the time while working so you want to be especially careful if you have some similar method of listening to audio on the computer.<br><br>Additionally you might add CTRL-P keystroke that plays the sound.<br><br>To test to make sure it doesn't CLICK, have the sound play like 3 times in a row, and at a length of less than half a second. This might help you debug any glitches in it too instead of having to manually play the .WAV each time w a separate program. <br><br></td></tr></table><br>
<a name="1297954"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> To make the volume really help I took it away and replace it with *100.<br>I'm all flabbergized why it does not work. Becuase it shaves 90% off still sounds the same.<br><br>*100 worked though so.. that's a relief. It's me, I just can't see why it didn't work that well. (It diminshes the visuals WAY before it diminishes the audiable).<br><br>Some stupid bug. But it's not part of the code, it does not make it unstable or anything.<br>A very isolated bug. Hate those kind of things but at least.. it's isolated.<br><br>I won앖 do a amazing demo out of this, I just wanted to show off the mechanics how to make a wave. <br><br></td></tr></table><br>
<a name="1297957"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> The fun part would be to do some useful soundeffects. <br>I won앖 probably be  happening just yet, I have a stackful of work before coding again.<br><br>But I앐 already visualising all kinds of things, I앐 thinking.. something modular, something so that anyone with.or-without-audio-knowledge can try out different things on their leasure. Just toying around.<br><br>Like adding different waves (and samples from the outside world), and getting the feel of things, adding vibrato, tremolo pitchbends, animated filters. Learn what those are. Just to create some small but still.. very alive sound effects that could be used inside games and such..<br><br>That would be fun. <br><br></td></tr></table><br>
<a name="1297961"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> @dw817 I wonder how you do your stuff with graphics. You know.. Imagine.. If you could do the same with sounds..<br>I wonder what would help to aid you (or anyone) to do something like that. Designing sounds in a new intuitive way or something. <br><br></td></tr></table><br>
<a name="1297990"></a>

<a name="1297997"></a>

<a name="1297998"></a>

<a name="1298000"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> So I did the one liner during breakfast as it really bugged me, but it seem like I did the conversion all for nothing as it works just using short as is (I found out later).<br><br><pre class=code>
Local temp:Int
Local b:Short = 0
Local c:Short = 0

For temp=-32768 To 32767 Step 10

' Convert signed 32bit into unsigned 16bit using sweat and blood
' b = (65536 - ( (temp ~ $0000ffff) + 1 )) &amp; $ffff ' The last &amp; is not needed, it just looks good. 
b = 65536 - ( (temp ~ $0000ffff) + 1 )
Print b

' Without effort
c=temp
Print c

Delay 1

If c&lt;&gt;b Then End
Next

WaitKey
End

</pre> <br><br></td></tr></table><br>
<a name="1297994"></a>

<a name="1297995"></a>

<a name="1297996"></a>

<a name="1298012"></a>

<a name="1298014"></a>

<a name="1298019"></a>

<a name="1298027"></a>

<a name="1298029"></a>

<a name="1298090"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> In Bmax could you somehow cast a whole array of ints into a whole array of shorts before sending them to the bank/stream?<br><br>or would you need to create an additional array of type short?<br><br>That would happen here in that case somewhere:<br>SndBank = CreateStaticBank(waveform,sum<br><br>In case there is not such thing. Here's the 16bit wav, fixed the other away. Nothing fancy, it's just a working 16bit example aswell.<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
' Create waveform and save it (WAV 16 bit, 44100, mono)

Graphics 800,600
Local samplerate:Int = 44100             ' Samplerate = 44.1Khz, we want 44100 samples To pass To the ears per second.
Local seconds:Double = 10                ' 10 seconds long.
Local SAMPLES:Int = samplerate * seconds ' How many samples would that take, not bytes though, it's samples, we take account to actual bytes per sample later.
Local waveform:Int[SAMPLES]              ' Create a suiting buffer to hold the samples.
Local t:Double , i:Int                   ' Some variables To work with.

Local waveform2:Short[samples] ' unsigned 16bit (for saving signed 16bit in before sending them away) Using unsigned to store signed (2nd complement style)

' Parameters we'd want to be able to change
Local hz:Double = 440.0      '  Hz aka pitch aka frequency, this could be anything, 20 - 20000 is human normal perception. 
Local volume:Int = 32000     ' Volume aka amplitude, this could be anything that bitdepth allows. Use close max values for best quality, think "big shapes", you want things big.

Repeat
Cls

hz = MouseX()*10

' Create the waveform
For i = 0 Until SAMPLES
    t = Double(i) / Double(samplerate)
      waveform[i] = volume * Sin(hz * t * 360.0) ' 360 degrees instead of 2 * pi radians.
Next

' Draw the waveform, fit it on the screen
For i = 0 Until 44100
Plot i/(44100/800),300 + (waveform[i]/(32000.0/300.0)) ' 800 and 300 (half of 600) is what we want to fit the entire wave inside.
Next

Flip 1
Until MouseDown(2)

For temp=0 Until samples ; waveform2[temp] = waveform[temp] ; Next
Local name$ = "sound.wav", SndBank:TBank,FileStream:TStream , Bits = 16 , Bytes = Bits / 8 , Channels = 1 , Sum = Samples * Bytes ' 16 bit, each sample is 2 bytes in size then
SndBank = CreateStaticBank(waveform2,sum) ; FileStream = WriteStream(name$)

      If FileStream Then
         fileStream.WriteString "RIFF"                                            ' -
         fileStream.WriteInt Sum + 36                                             ' Manipulates size
         fileStream.WriteString "WAVE"                                            ' -
         ' ----------------------------------------------------------------------------------------
         fileStream.WriteString "fmt "                                            ' -
         fileStream.WriteInt 16                                                   ' -
         fileStream.WriteShort 1                                                  ' 1 for integer WAV (bit choices are then 8/16/32/any), or 3 for float WAV (bit choices are then 32/64).
         fileStream.WriteShort Channels                                           ' Number of channels
         fileStream.WriteInt Samplerate                                           ' Samplerate
         fileStream.WriteInt Samplerate * Channels * Bytes                        ' Byterate
         fileStream.WriteShort Channels * Bytes                                   ' Bytes per sample "Block align"
         fileStream.WriteShort Bits                                               ' Bitdepth (avoid 24bit etc try use those above instead, nothing wrong with wasting space for effeciency and quality)
         ' ----------------------------------------------------------------------------------------
         fileStream.WriteString "data"                                            ' -
         fileStream.WriteInt Sum                                                  ' Manipulates size
         SndBank.Write FileStream,0,sum ; CloseStream FileStream                  ' Audiodata
EndIf
End
</textarea> <br><br></td></tr></table><br>
<a name="1298025"></a>

<a name="1298026"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> One thing about wav (generally, not a particular code)<br><br>In the structure there is this<br>fileStream.WriteInt Sum + 40                                             ' Manipulates size<br><br>The problem is some says the actual 4 bytecounter should not be included in the length, some says. It's an easy misstake.<br><br>From the offical WAV:<br>"A 32-bit unsigned value identifying the size of ckData. This size value does<br>not include the size of the ckID or ckSize fields or the pad byte at the end of ckData."<br><br>Minimal wav header is 44bytes. So total filesize - 8 would be the correct one. (it's filesize - 4 now when adding 40, as header is itself 44 bytes. <br>Meaning all wav examples above with +40 should be +36. Nasty bug to find as all players work either way.<br><br>The correct one would be<br>fileStream.WriteInt Sum + 36<br><br>I will change at least the two latest sources accordingly. So there will be a 16 &amp; a 32bit example in good condition. <br><br></td></tr></table><br>
<a name="1298039"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> I did a function out of this but it got ugly because of the 8bit 16bit 32bit and 64bit handling. Very ugly code I앐 not pleased with it at all. <br>It's mostly about the barrier of handling multiple datatypes (or arrays of them) elegantly using a single function. It exploded.. like..several lines that should no <br>be needed really. Very messy. I'll have a look what I can do about it later. I think right now; nothing. <br><br></td></tr></table><br>
<a name="1298041"></a>

<a name="1298042"></a>

<a name="1298043"></a>

<a name="1298044"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> Don't use the 32bit before I've fixed it, it has an datatype issue, that is what makes it overly loud aswell.<br><br>The 16bit is THE one to use. Most ppl won앖 be needing 32bit and 64bit anyways. <br><br>If you by chance wants to use 8 bit, you need to remember one thing, and that is to pad it at the very end if datasize happens to be odd. This padbyte should not be included anywhere in the header so it's nothing to think about, it's just a matter of putting an extra 0 byte at the end if your samplelength is odd). It's just that WAV hates odd filesizes. <br><br></td></tr></table><br>
<a name="1298066"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looks good, or perhaps I should say, sounds good. :)As mentioned, Casaber, to test the click, maybe have the audio shortened to a half second or smaller, then play it 3 times consecutively with a slight pause between to see if there are any clicks. <br><br></td></tr></table><br>
<a name="1298085"></a>

<a name="1298086"></a>

<a name="1298087"></a>

<a name="1298091"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good thinking. I got a few ideas to try out now, lets see how those work out. I guess it will take some time to test thing throughly first. I really want to get back on<br> track with the graphics library as there is where BMax shines right out of the box, but I forgot something, you COULD play samples (already rendered)<br> very quickly when using the right methods right out of the box, and it works on both platforms. Without any clicky problems. It's just realtime changes in the buffering that clicks and that could be fixed later on separatly.<br><br>It handles samples actually very quickly. OpenAL is wonderful there. So a Soundfontplayer is still on.<br><br>But implemmenting this wav was no mistake it's nice to have a solid short and sweet wav loader/saver implemented before doing soundfonts, or if I could find a better public domain format but I don앖 think there is one. <br><br></td></tr></table><br>
<a name="1298131"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midimaster</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> ...or if I could find a better public domain format but I don앖 think there is one.  <br></div><br><br>There is an OGG-Saver:<br><br><pre class=code>Import axe.oggsaver
Local Sample:TAudioSample
....
SaveOGG(Sample, SampleName + ".ogg")
 
</pre> <br><br></td></tr></table><br>
<a name="1298154"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> MIDImaster Thanks, but Ogg does not support all the features I need, I really need something with more than multiple loop points.<br>I could add loop info chunks to wav to get that aswell, but I thought I shall split the sound usage into two groups;<br><br>One for as a raw medium of storage. (wav and ogg would fit here)<br><br>And then pick a more flexible format for instruments to avoid to need to grow an fileformat of my own.<br><br>EMU added alot of overkill features in SF2 but It's nice as instrumentholders. Multisamples could be held easly in one etc. I will certainly not use all the features before realtime synthesis works but that's no problem. <br><a href="http://freepats.zenvoid.org/sf2/sfspec24.pdf" target="_blank">http://freepats.zenvoid.org/sf2/sfspec24.pdf</a><br><br>In my eyes Ogg is more on pair with WAV. Does Bmax handles FLACs inside OGGs? <br><br></td></tr></table><br>
<a name="1298277"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midimaster</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> I did not know, that WAV can save more informations than sample values. Never heard about multiple loop points.<br><br>Bmax uses the Ogg Vorbis format, which compresses with losses. But you can define compression rate/quality in OGG format. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
