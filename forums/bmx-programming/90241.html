<!DOCTYPE html><html lang="en" ><head ><title >Exception Access Violation when closing  via [X]</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Exception Access Violation when closing  via [X]</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Exception Access Violation when closing  via [X]</a><br><br>
<a name="1025550"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Pickford</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> When I close my game by clicking on the X icon in the corner of the window I get:<br><br>Windows Exception<br><br>EXCEPTION_ACCESS_VIOLATION<br><br><br>If I close may application normally there's no error.   I've recently switched to multi threaded if that's any help but the error occurs even if I don't create any threads. <br><br></td></tr></table><br>
<a name="1025563"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Pickford</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Modified the game so it compiles in non threaded mode and the error still happens so I don't think it's related to threading.<br><br>Anyone have any ideas? <br><br></td></tr></table><br>
<a name="1025577"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Since it's crashing, you might find a GDB backtrace could help determine the location of the issue.<br><br>:-) <br><br></td></tr></table><br>
<a name="1025591"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you calling AppTerminate () in your loop? This is needed to detect the Close [X] gadget hit. I'm a bit surprised it's crashing though -- it normally just gets ignored without AppTerminate.<br><br>(By closing the appplication normally, do you mean via End?) <br><br></td></tr></table><br>
<a name="1025600"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Pickford</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah I mean end.<br><br>No I'm not calling AppTerminate.  Never heard of it!<br><br>I'll try that.   So far it seems to be related to the sound commands.   If I make the game hang (infinite loop) and use [X] to terminate it crashes after the first sound command but not before.   I'm using the B3D SDK but I recently switched to the Bmax sound commands so I don't know if that's an issue.<br><br>Could it be the SDK that's detecting the [X]?  Hence it working without Appterminate?<br><br>JP <br><br></td></tr></table><br>
<a name="1025617"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah, AppTerminate probably won't count, then, if you're using the Blitz3D SDK to open/handle the window.<br><br>An infinite loop followed by [X] click would probably cause Windows to shut the program down (after a few clicks with no response from the program anyway). Not sure if that would trigger the Blitz exception thing, but it would be how Windows normally deals with a program not responding to a Close hit. <br><br></td></tr></table><br>
<a name="1025626"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Pickford</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't mean a 'not responding' type of loop.   I mean just make the program stop progressing so I know exactly how far it's progressed when I click [X]<br><br>I think it was something like:<br><br>local x=0; while x=0;clscolor rnd(255),0,0;cls;flip(0);delay(1);wend.<br><br>This just gives some old 8-but style loading bars.<br><br>Just a convenient way of making the game 'hang' so I could test what the [X] did.   If I placed that line before any sound commands the game exits normally.  If I placed it after the first sound command I get the exception. <br><br></td></tr></table><br>
<a name="1025632"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm. I don't think AppTerminate () will work with the B3D SDK, but this works in plain BlitzMax:<br><br><pre class=code>
Graphics 640, 480

Local x=0

While x=0
	
	SetClsColor Rnd(255),0,0;Cls;Flip(0);Delay(1)
		
	If AppTerminate ()
		Print "Hello"
		End
	EndIf
	
Wend
</pre><br><br>You could try something like this, but I suspect it'll fail since the B3D SDK will be handling the window input/updates, etc.<br><br>Have you tried working with bbSetBlitz3DTitle? This can throw up a requester when the [X] gadget is hit, allowing you to catch the hit, though the user then chooses whether to exit or cancel (resume). <br><br></td></tr></table><br>
<a name="1025644"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Pickford</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> It looks like Appterminate is irrelevant as you suspected.<br><br>Adding the bbsetBlitz3DTitle command does inded bring up the confirmation box.  But if you click OK the exception appears.<br><br>There's obviously some difference between clicking [X} and END.   If I add an  OnEnd command the cleanup function gets called by both methods of ending but the [X] still triggers the exception. <br><br></td></tr></table><br>
<a name="1025647"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I guess the BlitzMax audio playback routine doesn't like being interrupted 'externally' (ie. by the SDK input stuff). I kind of suspect all this might be work-around-able with the SDK's event callbacks, but that's all a little outside my grasp, I'm afraid...<br><br>How about going back to the Blitz3D SDK audio commands? I don't think there's much real benefit to using the BlitzMax-native audio if you're just using the basics. Does the problem still occur there?<br><br>You might consider dropping Mark an email if that doesn't help, as the low-level interactions between the SDK's window handling and BlitzMax (or BlitzMax's audio) would be way outside of my understanding, sorry!<br><br>BTW 'End' means the program itself is deciding to call it a day, and that can be handled nicely. Clicking [X] means Windows just sends a 'quit' message to the program's window (handled by the SDK DLL in this case), so what happens is dependent on how that quit message is handled by the app. It can easily be ignored by the app (nothing happens), mis-handled, or not even received by the main program, so they're certainly different. <br><br></td></tr></table><br>
<a name="1025662"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Pickford</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, I'll try going back to the old commands.   Or just removing all audio temporarily.<br><br>I think I switched because I wanted to load the audio on a separate thread to  increase boot up times (which worked) and thought it prudent to not use SDK commands in a thread.   The blitzmax commands seemed better too once I'd re-written everything.<br><br>Sounds like I may end up back to square one and ditch the multi threading. <br><br></td></tr></table><br>
<a name="1025736"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >John Pickford</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well I've ditched the thread thing and switched back to SDK sounds.<br><br>All fine apart from music.  The bbplaymusic command doesn't seem to work at all.   In fact it returns a channel even if you try to play a non existent file.   And silence even if the file exists.   I'm using .ogg files which work with loadsound. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
