<!DOCTYPE html><html lang="en" ><head ><title >ZLib</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >ZLib</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >ZLib</a><br><br>
<a name="1109875"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tricky</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've been trying to play around with the Pub.ZLib module for my next project, but something appears wrong here.<br><br><br><pre class=code>Global Bank1:TBank = LoadBank("/Volumes/AZIELLA/TricFAQ/HTML/wild arms 5 - Walkthrough.html")
'Global Bank2:TBank  ' If it all worked this would be my Bank to store the result in.
Global Pointer1:Byte Ptr = BankBuf(Bank1)
Global Pointer2:Byte Ptr
Global DestSize = Bank1.Size()*2     ' Making sure the compress buffer is big enough

Print compress(Pointer2,DestSize,Pointer1,Bank1.Size())</pre><br><br>The used file is a walkthrough for 'Wild Arms 5' I wrote in HTML, but that's not relevant, the routine has been used on multiple files with the same result. This program resulted to me always into giving the error code -2. I've been digging through the ZLib mode (as the BMax documentation on this mod is ... shall we say... poor) and -2 appears to mean that ZLib doesn't understand the compression method. Now I wonder, is this a bug in ZLib, in the BMax Mod or am I doing something wrong here?<br><br>Of course, this has now only been tested on a MacMini PPC, I haven't yet tried any other platforms, but I don't expect much difference there.<br><br>Any ideas? <br><br></td></tr></table><br>
<a name="1109876"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Noobody</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Zlib is not going to allocate the destination buffer for you - you're supposed to do that. Pointer2 should contain the already allocated destination buffer in this case, and DestSize should contain the amount of bytes you allocated for the destination buffer.<br>Also, you should pass <i>VarPtr DestSize</i>, not <i>DestSize</i> - compress is going to overwrite the value in DestSize with the actual size of the compressed data, but that's only possible if you pass the pointer of the variable and not the value of it.<br><br>How many bytes you should allocate for the destination buffer is up to you - the compressed data is never going to be (much) bigger than the source data, so if you allocate a buffer of the same size as the source buffer, you're probably going to be fine. If that is not an option (let's say your source buffer is really big), you could try wrapping the compressBound function from Zlib, which will tell you how many bytes it's going to need at most for the compressed data. <br><br></td></tr></table><br>
<a name="1109877"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tricky</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey thanks.... it worked! :) <br><br></td></tr></table><br>
<a name="1109915"></a>

<a name="1109916"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try using LZMA, it's faster and compresses better. There's a module in the code archives.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
