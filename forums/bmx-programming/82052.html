<!DOCTYPE html><html lang="en" ><head ><title >screen doesn't redraw when cpu in control!</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >screen doesn't redraw when cpu in control!</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >screen doesn't redraw when cpu in control!</a><br><br>
<a name="924348"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kaiserpc</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>I'm writing a turn based strategy game for the Retro Remakes comp - deadline midnight gmt tonight!!<br><br>Anyway occasionally when the cpu is moving the enemy units, the screen isn't getting re-drawn - a hourglass appears and the screen remains static. <br><br>The game is still working because you can hear the movement sound effects, when it finally goes back to the player's move - the screen draw start working again!<br><br>This is in windowed mode by the way - haven't tested if it does the same full screen.<br><br>It only happens very occasionally but all my testers think the game has crashed and they ctrl-alt-del out<br><br>Any ideas? has anyone seen this before? <br><br></td></tr></table><br>
<a name="924351"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You might want to split your "action" code over several cycles, rather than trying to do it all in the same frame.<br>Not difficult to do. I used the same method for some path-finding AI, when I had *many* bots trying to recalculate paths over a large, changing map. The closest ones (to the terrain change) would be processed first, while those further away would be processed several cycles later - therefore spreading the load out and stopping stutter/hangs. <br><br></td></tr></table><br>
<a name="924356"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kaiserpc</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> thx Brucey.<br><br>I'm afraid I'm a bit of a newbie (this is my 1st Blitzmax game) so not sure what you mean (my enemy moves one unit at a time - going through a tlist, so I don't have loads of units moving at the same time) or if this is the same scenario as I'm trying to explain.<br><br>to try and explain again the moves are happening (it's not a fps problem and there's no stuttering) because I can hear them, and the units are being moved - but the whole screen is frozen at the point it stop working and then a hour glass appear at this point and stays on the screen until the player takes control again <br><br></td></tr></table><br>
<a name="924360"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try a small delay (Delay(10)) in your mainloop.<br>It's common for games to *get stuck* because it does more logic than rendering (or- doing logic so much as to mess with windows). <br><br></td></tr></table><br>
<a name="924386"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Doesn't the Flip cause the screen display to be updated, regardless what else is going on?<br>(Assuming we are talking about a graphics context, rather than say a GUI Canvas) <br><br></td></tr></table><br>
<a name="924418"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kaiserpc</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> no, thats just it the "flip" is there but it's just not redrawing in windowed mode - very bizarre.  Also, it you click on the screen while the cpu is moving one of their units -  it always freezes.<br><br>The window says "Blitzmax Application not responding" at the top and the hour glass appears. <br><br></td></tr></table><br>
<a name="924426"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> "hourglass" ? ? ? I've never heard of this at all. Are you using MaxGui or a 3rd party gui? Or anything on standard that could be affecting the rendering pipeline? <br><br></td></tr></table><br>
<a name="924446"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kaiserpc</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> just using the standard build - no addons<br><br>the cursor changes to a hourglass until it's the player's turn - then everything is fine again <br><br></td></tr></table><br>
<a name="924458"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> @MGE: He is talking about the windows 'loading' cursor (which usually comes up when the application with focus is using alot of CPU power).<br><br><div class="quote"> Also, it you click on the screen while the cpu is moving one of their units - it always freezes. <br></div>I've seen that alot with other applications/games when my CPU is being used heavily.<br><br>How long does it usually take for the calculations before it is the players turn? <br><br></td></tr></table><br>
<a name="924506"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> ahh... ok..thanks Plash. Even with Plash's suggestion to put a Delay(10) in there it still happens?<br><br>As as last resort, post your code or an exe here so we can test it on our machines. <br><br></td></tr></table><br>
<a name="924594"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kaiserpc</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> To be honest, I'm not sure where this extra delay would go.  Just before the flip?<br><br>Anyway, here is a link to the game (just download, and unzip everything to a new folder)<br><br><a href="http://kaiserpc.co.uk/games/SorcererLord.zip" target="_blank">http://kaiserpc.co.uk/games/SorcererLord.zip</a> (13mb)<br><br>I've uploaded the source to the same location:<br><a href="http://kaiserpc.co.uk/games/SLGame.bmx" target="_blank">http://kaiserpc.co.uk/games/SLGame.bmx</a><br><a href="http://kaiserpc.co.uk/games/SLClasses.bmx" target="_blank">http://kaiserpc.co.uk/games/SLClasses.bmx</a><br><br>The "bug" happens intermittently so you might not see it to begin with <br><br></td></tr></table><br>
<a name="924598"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kaiserpc</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Should have said the "flip" is in the "drawEverything" function, and the main game loop function is called "mainGameLoop" <br><br></td></tr></table><br>
<a name="924609"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Eh.. after hardship with the menu/gui system (mouse clicks take a while to get noticed, and it crashed once), I finally got it to start a game.<br><br>I think it's because your doing alot of stuff in between rendering a single frame, really hard to say for sure.<br>You definitely have a major issue with event/key handling though. <br><br></td></tr></table><br>
<a name="924936"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kaiserpc</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> yep, I know about the lag in the menu - will be fixed in the next version (never had it crash before though - where did it crash, and what were you doing?)<br><br>- As for my real issue with the app not responding when the enemy is moving, I don't think I'm doing a lot different to when the player moves - there is probably more things for the cpu to check when the player moves.  So I don't understand why it only happens when the cpu is moving - plus it only happens intermittently - very confused :-( <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
