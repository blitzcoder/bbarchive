<!DOCTYPE html><html lang="en" ><head ><title >Possible bug with OpenGL Screenshots</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Possible bug with OpenGL Screenshots</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Possible bug with OpenGL Screenshots</a><br><br>
<a name="906217"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi all, I often take screenshots of my game to send to the artists and today I noticed something weird...<br><br>Previously I've been using DX and the screenshots were fine, like this one of a dialog with an alpha shadow over a background:<br><br><img src="http://www.greyaliengames.com/misc/DX_screenshot.png"><br><br>But recently I started using OpenGL instead (long story) and I noticed that the alpha shadow is not being captured properly in the screenshot (it looks fine on-screen).  If you download this png and view it in a paint program you'll see that the shadow is actually partially transparent i.e. you can see the checkered background in the paint package which you should not be able to because the background image is solid!<br><br><img src="http://www.greyaliengames.com/misc/OGL_screenshot.png"><br><br>Here's my code that saves screenshots:<br><br><pre class=code>
		Local gfxGrab:TPixmap
		gfxGrab = GrabPixmap(0,0,ScreenWidth, ScreenHeight) 
		SavePixmapPNG(gfxGrab, filename, 9)

</pre><br><br>Note that it's possible it's a problem with my new graphics card, but I wondered if anyone has noticed this before or has an app/game with an alpha shadow that they can run in OpenGL and take a screenshot of with the above code.  (Grey Alien Framework users simply press G to run your game in OpenGL mode then press F12 to take a screenshot which will be saved in your dynamic data folder).<br><br>[edit]The problem occurs in full-screen and windowed mode.<br><br>Thanks for any feedback.  If this is a BMax bug then I'll post it in the bug forum after more investigation. <br><br></td></tr></table><br>
<a name="906256"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I guess it's possible that with your OpenGL driver the alpha values of the graphics you draw to the backbuffer are getting stored in the backbuffer's alpha channel, and then your screen grab is getting alpha channel data rather than all empty alpha data? That wouldn't really be a bug, if it's what's happening, it may be just the way your driver grabs screenshots, or how GL works? <br><br></td></tr></table><br>
<a name="906263"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah I just need someone else to try out a similar thing on their PC to verify if it's a bug or not (or I could try a new video card but that's a hassle). <br><br></td></tr></table><br>
<a name="906389"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hotcakes</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm not sure if this is an adequate test, but I took two screenshots showing the debug dialog which has that alphashaded area and the images screenshotted identically.<br><br>I use an nVidia 9600 and my image quality settings in the control panel are all set to highest possible quality, so this is the behaviour I would expect to see.<br><br>You use ATI which is not known for its OpenGL functionality, so I'd say this is not a Max thing, rather a drivers thing.  I'm sure it is cheaper for the hardware to only touch every second pixel than it is to alter every pixel where the alphablend is necessary, although if you say it only happens in screenshots then that is a bit strange. <br><br></td></tr></table><br>
<a name="906555"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> So did you take the screenshot with code or just the PrtScn key (I haven't tried that key with this card in OGL, will do now...)<br><br>OK the Print Screen key DOES take screenshots in OGL CORRECTLY.  This then may suggest an issue with Bmax.  Correct?<br><br>I suppose I need a test app, but I thought someone might have something setup already they could quickly test... <br><br></td></tr></table><br>
<a name="906566"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jamesmintram</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, not entirely sure if this is even a valid answer but it seems logical to me.<br><br>In glMax2D you have this at line 461 - you could experiment by changing the PF_RGBA8888 to PF_RGB888 and GL_RGBA to GL_RGB and seeing if that works. If the problem is solved then it looks like you will either have to use a modified Module or write your own GrabPixmap function for use with OpenGL.<br><br>Local p:TPixmap=CreatePixmap( w,h,PF_RGBA8888 )<br><br>glReadPixels ,GraphicsHeight()-h-,w,h,GL_RGBA,GL_UNSIGNED_BYTE,p.pixels <br><br></td></tr></table><br>
<a name="906633"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Volker</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> @hotcake<br>Just to inform you; maybe a false alert:<br>clicking on the link in your sig<br>   <a href="http://ff-fan.com/" target="_blank">http://ff-fan.com/</a><br>my virusprotection (Avira Antivir Personal)<br>gives me a trojan warning: <br>Name: HTML/Infected.WebPage.Gen <br><br></td></tr></table><br>
<a name="906733"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmm.. I did tests a while back for screenshots in both ogl and dx modes and I didn't notice anything. I'll test an exe on 3 machines if someone wants to write it. ;) <br><br></td></tr></table><br>
<a name="906745"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hotcakes</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> OK the Print Screen key DOES take screenshots in OGL CORRECTLY. This then may suggest an issue with Bmax. Correct? <br></div><br>I used F12 fyi and you may be right. <br><br></td></tr></table><br>
<a name="907022"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> @jamesmintram: OK thanks for that, now to find the time to test it...<br><br>@MGE: I could make a test exe but it's not a big issue for me personally at all, more for BMax (if the problem is with Bmax and not my video card).  I'm going to change to another video card later this week and if the problem is still there then I'll post it as an official bug.<br><br>@Hotcakes: OK thx for the info. <br><br></td></tr></table><br>
<a name="907054"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yan</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just convert the pixmap to a non alpha format, which is what the DX Max2D driver spits out BTW, and get on with it...<pre class=code>SavePixmapPNG(gfxGrab.Convert(PF_RGB888), filename, 9)</pre>;op<br><br>[edit]<br>Err...Which is what James already said...Sorta... ;o)<br>[/edit] <br><br></td></tr></table><br>
<a name="907059"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Yan: That totally works thx. So should I report it as a bug that the GL driver doesn't output the same format as the DX driver? <br><br></td></tr></table><br>
<a name="907062"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yan</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's probably worth pointing out as it *is* inconsistent, at the very least.<br><br>I'm just not sure which driver is as intended. ;o)<br><br>I have to agree that the way the alpha is handled in your case is just weird. I haven't been able to reproduce it here. <br><br></td></tr></table><br>
<a name="907064"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> weird that you haven't been able to duplicate it.<br><br>Anyway posted as a bug:<br><br><a href="http://www.blitzbasic.com/Community/posts.php?topic=80611" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=80611</a> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
