<!DOCTYPE html><html lang="en" ><head ><title >DX Vertex Buffers - Made Easy - REALLY!</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >DX Vertex Buffers - Made Easy - REALLY!</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >DX Vertex Buffers - Made Easy - REALLY!</a><br><br>
<a name="579831"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Still needs optimising and considering 2 days ago I had no idea what a vertex buffer was I think this is pretty damn fast. One way to speed this up would be to use indexedVB, basically you re-use the same vertices multiple times in the same model - I've no idea how to use them :(<br><br>I've constructed this in such a way that you can use all of the Flexible Vertex Formats, ie. Transformed, Lit, Specular lighting etc. Transformed vertices are great for HUD's since the matrix calculations don't touch them - They stay just where you put them. You can also choose to store the buffer in vidmem or sysmem, you will need to enable TnL to take advantage of vidmem storage otherwise it'll just slow things  down.<br><br>The enclosed code will allow you to create a buffer of any size (2000 verts is optimum) and will allow you to rotate,scale and translate the vertices with simple commands. I have also created some quad functions so that you can replace your normal DrawImage commands with Vertex Buffer commands. Quads are not much faster since they are only 4 vertexes and use very little bandwidth<br><br>One very good application for this would be a tile map. You could use this code and part of my single surface code to cache a whole tilemap to a buffer. Now when you want to display the tilemap you just draw the buffer, move it all with one command, rotate it and scale it. Now that would be very fast. Objects rendered from the buffer will be clipped by clip-planes, unless you turn that feature off.<br><br>Before you download this code you need to be aware that some small changes will have to be made to the d3d7.bmx file in the DirectX Mod. These changes are necessary as the existing declarations for the VertexBuffer Functions are incomplete.<br><br>Locate : <pre class=code>Type IDirect3D7 Extends IUnknown</pre><br>Add/Replace the Method : <pre class=code>Method CreateVertexBuffer(vbdesc:Byte Ptr ,d3dvertexbuffer:IDirect3DVertexBuffer7 Var,dword)</pre><br>Locate : <pre class=code>Type IDirect3DDevice7 Extends IUnknown</pre><br>Add/Replace the Method : <pre class=code>Method DrawPrimitiveVB(primtypem,d3dvertexbuffer:Byte Ptr,startvert,numverts,flags)</pre><br>Locate : <pre class=code>IDirect3DVertexBuffer7 Extends IUnknown</pre><br>Add the Methods : <pre class=code>Method Lock(Flags,lplpData:Byte Ptr Var,Size)
Method Unlock()
Method Optimize(lpD3DDevice:Byte Ptr,dwFlags)
Method ProcessVertices(dwVertexOp,dwDestIndex,dwCount,lpSrcBuffer,dwSrcIndex,lpD3DDevice,dwFlags)
Method GetVertexBufferDesc(lpVBDesc:Byte Ptr Var)</pre><br>I think that's all. I've tried to make this as stand-alone as possible.<br><br>The code : <a href="http://www.indiepath.com/tim/vertex_buffers.zip" target="_blank">http://www.indiepath.com/tim/vertex_buffers.zip</a> (don't steal the image it's licenced to me not you!)<br><br>If you want to enable TnL features then you need to go here :- <a href="http://www.blitzbasic.com/Community/posts.php?topic=51795" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=51795</a><br><br>Have fun. <br><br></td></tr></table><br>
<a name="579934"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Steve Elliott</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tim you really need to be talking to Mark about integrating your optimizations into an official update when they are 100% complete and tested (you still seem to be experimenting). <br><br></td></tr></table><br>
<a name="579938"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Steve, I have no interest in that. <br><br>And yeah I'm experimenting, how else are we going to get fixes and extra functionality?<br><br>Anyway I'm tired of playing now, vertex buffers don't make money. <br><br></td></tr></table><br>
<a name="579946"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Steve Elliott</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's a shame because having used an optimization of yours my program then refused to "create a surface" when trying to set a graphics mode - the only solution was to uninstall and re-install Max.<br><br>I'm not saying this will happen everytime - but this is the sort of thing that can happen if you play about with the internal workings of Max.  So a complete and tested module would prevent this sort of user error?  Perhaps BRL can complete the work.  ;-)<br><br>Just to be clear, your experimenting and sharing code is welcome so thanks - even if we end up messing things up somehow.  ;-)<br><br><div class="quote"> <br>Anyway I'm tired of playing now, vertex buffers don't make money.<br> <br></div><br><br>But Blitz Max Modules do.  ;-) <br><br></td></tr></table><br>
<a name="579949"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> That's a shame because having used an optimization of yours my program then refused to "create a surface" when trying to set a graphics mode - the only solution was to uninstall and re-install Max. <br></div><br>Yeah that's why I'm *now* trying to build this stuff on top of the modules instead of inside them. <br><br><div class="quote"> I'm not saying this will happen everytime - but this is the sort of thing that can happen if you play about with the internal workings of Max so a complete and tested version would be great - perhaps BRL can complete the work. ;-) <br></div><br>ROFL, Ummn the reason I am making these changes is because BRL did not complete the work. I don't think BRL are really focussed on 2d do you?<br><br><div class="quote"> Just to be clear, your experimenting and sharing code is welcome so thanks - even if we end up messing things up somehow. ;-) <br></div><br>Yeah I know. Just make sure that when you finish all these great games that Indiepath gets first refusal for publishing. :P<br><br><div class="quote"> But Blitz Max Modules do. ;-) <br></div><br>Yeah but developers are tight fisted so and so's.... <br><br></td></tr></table><br>
<a name="579951"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Steve Elliott</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Yeah that's why I'm *now* trying to build this stuff on top of the modules instead of inside them.<br> <br></div><br>Sounds good.<br><br><div class="quote"> <br>ROFL, Ummn the reason I am making these changes is because BRL did not complete the work. I don't think BRL are really focussed on 2d do you?<br> <br></div><br>:-D<br><br>To be fair, reading Mark's comments in one of the DirectX modules he does say it's work in progress.  But if they're not focused on 2d they should be because it's actually 2d in 3d which opens-up all sorts of possiblities.<br><br><div class="quote"> <br>Yeah but developers are tight fisted so and so's....<br> <br></div><br>Can't speak for other's but if a (stable) graphics module doubled the speed of my program I'd pay for it. <br><br></td></tr></table><br>
<a name="579972"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Can't speak for other's but if a (stable) graphics module doubled the speed of my program I'd pay for it.  <br></div><br><br>Granted, I would too. However due to the nature of such a beast it is necessary to directly access the graphics drivers, the majority of the DirectX commands for instance have already  been declared in the DirectX mods, in some cases, like vertex buffers they were not correctly declared. So, if you want all these nice features you are going to have to tweak the official mods to get them. <br><br></td></tr></table><br>
<a name="579977"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yan</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> We shall have to wait and see what Simon gets up to after the GUI stuff is out.<br><br>Good stuff Tim, thanks for sharing! :o) <br><br></td></tr></table><br>
<a name="580134"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Did anyone else get this to work? <br>I recieve a mav on the line:<br>myVertexBuffer.lock(DDLOCK_WAIT|DDLOCK_WRITEONLY|DDLOCK_NOOVERWRITE) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
