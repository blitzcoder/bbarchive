<!DOCTYPE html><html lang="en" ><head ><title >How to create an under water effect in blitzmax?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >How to create an under water effect in blitzmax?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >How to create an under water effect in blitzmax?</a><br><br>
<a name="1281757"></a>

<a name="1317810"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello my friends,<br><br>I am progressing my game very well.<br>Look some videos and screenshots at : <br><br><a href="https://facebook.com/darklordbeholder" target="_blank">https://facebook.com/darklordbeholder</a><br><br><br>Now I am looking some way to make an underwater effect.<br>I found in the forums this: <br><br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1693" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1693</a><br><br>My game will have some underwater levels and I would like to do the same effect but the code was written in blitz3d.<br><br>Is it possible the effect being implemented not in full screen but only in rectangular area of a 2D screen, but there are not 3D objects and camera.  <br>For example the dungeon viewport. (A part of a 2D screen).<br><br>Any nice idea?<br><br>Thank you very much. <br><br></td></tr></table><br>
<a name="1281789"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> A simple load the images as pixel  high slices as a animimage then use a sine wave with a little randomness applied to the radius. <br><br></td></tr></table><br>
<a name="1281794"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> AnimImage slices the image into various textures. So you better use a custom "drawSubImageRect"-thing to avoid texture-switches.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1281797"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>A simple load the images as pixel high slices as a animimage then use a sine wave with a little randomness applied to the radius.<br> <br></div><br><br>What you mean saying high slices? Would you like to give me an example.<br><br>Something like 1 long pixel vertical Marquez in advertisement signs? <br><br></td></tr></table><br>
<a name="1281799"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> He talks about this:<br>If your image is 100x50 pixels, you load it as an anim image with 100 frames, each 1x50 pixels.<br><br>Now when you draw your "wave" you draw it in a loop, advancing "x" by 1 for each frame. The y is then displaced with a sin() (whose param is containing "x").<br><br><br>With "drawsubimageract" you do something similar, but instead of using "frames" you advance the subimage-rect by 1 pixel (so you draw the same image 100 times, but each time the "rect" advances by 1 pixel. the rect is of course also 1x50 in size).<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1281804"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Do I need to capture the image in real time? Because this image is not a static image is the viewport of the dungeon which always changes when players moving.<br><br>How do I will capture a portion of the screen to create this image.<br><br>My image will be , 352x240. So the sub images will be 1x240 according to your example. But the image must be captured on runtime.<br><br>I will try to experiment with this idea. <br><br></td></tr></table><br>
<a name="1281807"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> For such effects you should consider some "render to texture" approach.<br><br>Also have a look for "GLSL" / shaders with BlitzMax ... think easiest way is with Bruceys SDL-wrapper - and/or BMX-NG + Mojo2.  Or do things on your own with OGL.<br><br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1281810"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK Now I will try to implement the effect.<br><br>First I will use the function GrabPixmap.<br><br><br><pre class=code>
Global Underwater_image:TPixmap

Underwater_image = GrabPixmap(23, 68, 352, 240)

DrawPixmap(Underwater_image, 23, 68)

</pre><br><br><br>This just copy whole image.<br><br>Or do I need to create an array of images<br><br><br><pre class=code>
Global Underwater_image:TPixmap[352]

For x=1 to 352
     Underwater_image[x] = GrabPixmap(22+x, 68, 1+x, 240)
next

DrawPixmap(Underwater_image, 22+x, 68)
</pre><br><br>I tried to copy the pixmap image and the image was black. <br><br></td></tr></table><br>
<a name="1281811"></a>

<a name="1281812"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just try and find out on your own.<br><br>local img:TImage = LoadImage( GrabPixmap(...) )<br><br>For local x:int = 1 to 352<br>  DrawSubDrawSubImageRect( image, 22 + x, 68 + amplitudeScaling * sin(x * waveLengthScaling), 1, 240, 1, 240, x, 0, 1, 240)<br>Next<br><br>(above is untested, so params might need adjustment)<br><br><br>PS: if you did not buy the licence for "Eye of the beholder" I would strongly suggest to rename the game  ... and not to provide copyrighted assets with your binaries.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1281815"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have already asked Wizards of the Coast and they don't care about , because the game is not Magic the Gathering. The name Eye of the Beholder is very generic. Is something similar to say , the leg of the chair for example. So there are no special words which need to be registered.<br>The engine is created from scratch so I have the copyrights , the graphics program I use is Corel Paint Shop pro which is genuine (I have purchased it)  The programming language is blitzmax which is genuine too. Some of musics were created with keyboard and from music composers and the sound effects were created with microphone.<br><br>About the graphics , have changed them a lot and more new graphics were created. Also graphics designers design and new graphics too. :) and when my indiegogo campaign will finish , I will hire more graphics designers who will create more new graphics. Even if I will change the title from "Eye of the Beholder" to "The Eye of the Beholder" this changes the title too. But Wizards they don't care.<br><br>I will try your code and I will tell you if the effect was successful.<br>Thank you :) <br><br></td></tr></table><br>
<a name="1281819"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> yeah eye of the beholder is a common phrase, the original game uses a trademark to keep the images etc of the game separate from everyone elses.<br><br>One thing you cant draw from is linking it to the old one that is a no-no unless you get permission from them. <br><br></td></tr></table><br>
<a name="1281832"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> The last house on the left ... is also a common phrase, but you might get into trouble bringing a movie with this title to the cinemas.<br><br><br>If you asked them ... less things to worry, albeit there might be someone else claiming ownership of the "title" (if it is registered). <br><br>It does not matter to me what kind of programme you used - if you have done the gfx, then there shouldn't be problems lurking around.<br>Same for sfx.<br><br><br>If you use OGL instead of DX there are less cpu-hungry approaches to your water effect (shaders / render2texture) ...<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1281893"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I did something:<br><br><pre class=code>

	Underwater_image = LoadImage("some_image.png", MASKEDIMAGE)


	If (Current_time &gt;= Underwater_Effect.Deadline_time) Then
	Underwater_Effect.Time_Delay = 80
	Underwater_Effect.Deadline_time = Current_time + Underwater_Effect.Time_Delay
		
	amplitudeScaling = Rnd(1, 2)
	waveLengthScaling = Rnd(3, 6)
		
	EndIf

	For Water_x = 1 To 352
	DrawSubImageRect(Underwater_image, 322 + Water_x + amplitudeScaling * Sin(Water_x * waveLengthScaling), 268, 20 + amplitudeScaling * Sin(Water_x * waveLengthScaling), 240, 1 + Water_x, 1, 20, 240, 1, 1, 0)
	Next


</pre><br><br><br>The code above loads some image and does the water wave effect.<br>The only problem is , how to capture the image on run time.<br>The grabpixmap is very slow.<br><br>I am looking how to capture a rectangular area of the screen and store it to an image but with fast way. <br><br></td></tr></table><br>
<a name="1281896"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> You aren't the first requesting a fast "manipulate whats drawn on screen" approach:<br><br>- use a shader<br>- render your scenery to a texture and manipulate the texture then<br>- use some kind of overlay (slight blueish, some "bubbles" moving from bottom to top ...)<br><br>The last one is some "circumvention" as it just tries to avoid the advanced things.<br>Having "shaders" allows for blurring the the screen, tinting ... and of course rippling water fx. But this is then something I do not know. If there comes one up with a "dx + opengl" solution for blitzmax - I will listen.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1281903"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't know nothing about shaders and how to draw graphics over textures :( <br><br></td></tr></table><br>
<a name="1281914"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any Idea where do I will find Brucey's SDL-wrapper or how to use shaders? <br><br></td></tr></table><br>
<a name="1281916"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> shaders: forum search<br>sdl: bmx-ng - <a href="https://github.com/bmx-ng" target="_blank">https://github.com/bmx-ng</a>  (brucey also has a subforum here in this forum).<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1281927"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Did anyone have errors when tried to compile the mod?<br>I put the mod in the mods directory in blitzmax with sdl.mod directory<br><br>I use Blide to compile the new mods and I have compiled lots of mods without problem.<br>This one generates compile errors.<br><br>&amp;#9658;&amp;#9658;&amp;#9658;ERRORsdl.d3d9sdlgraphics was not built<br>Compile Error: Can't find interface for module 'sdl.sdlgraphics'<br>[C:/BlitzMax/mod/sdl.mod/d3d9sdlgraphics.mod/d3d9sdlgraphics.bmx;8;1]<br>Build Error: failed to compile C:/BlitzMax/mod/sdl.mod/d3d9sdlgraphics.mod/d3d9sdlgraphics.bmx<br><br>And other similar errors in 13 mod files. <br><br></td></tr></table><br>
<a name="1281928"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hallo. I don't recommend trying to integrate your large project with NG and SDL.<br>Stick with the stuff you are currently using and don't get side tracked... <br><br></td></tr></table><br>
<a name="1281936"></a>

<a name="1281939"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello Brucey,<br><br>I had the same thought. I just want to implement an underwater effect and then , Derron kindly suggested shaders and other stuff , I don't understand. I have seen shaders and are nice , but I don't know how to program them and I don't know how to render them in blitzmax.<br><br>My project is huge and converting everything to SDL is a huge work (Your mod doesn't compiles),and my project is more than 120.000 lines of code and I need to break lots of things and change my whole engine.<br><br>I found one code from code archives about ccCopyImageRect() function which copies portion of one image to another to do faster image captures because the default  GrabPixmap() function is veryyyyyyyy slowwwwwwwwwwww. But the copyimagerect() is faster , but it destroys all of my transparent images. <br><br>This one:<br><pre class=code>
Function ccCopyImageRect(Source:TImage, SX:Int, SY:Int, SWidth:Int, SHeight:Int, Dest:TImage, DX:Int, DY:Int)
	
	'get the pixmap for the images
	Local SourcePix:TPixmap = LockImage(Source)
	Local DestPix:TPixmap = LockImage(Dest)
	
	'find the dimentions
	Local SourceWidth:Int = PixmapWidth(SourcePix)
	Local SourceHeight:Int = PixmapHeight(SourcePix)
	Local DestWidth:Int = PixmapWidth(DestPix)
	Local DestHeight:Int = PixmapHeight(DestPix)
	
	If SX &lt; SourceWidth And SY &lt; SourceHeight And DX &lt; DestWidth And DY &lt; DestHeight 'make sure rects are on image
		If SX+SWidth &gt; SourceWidth Then SWidth = SourceWidth - SX 'bound the coordinates to the image area
		If SY+SHeight &gt; SourceHeight Then SHeight = SourceHeight - SY
		If DX+SWidth &gt; DestWidth Then SWidth = DestWidth - DX 'Make sure coordinates will fit into the destination
		If DY+SHeight &gt; DestHeight Then SHeight = DestHeight - DY
		
		'find the pitch
		Local SourcePitch:Int = PixmapPitch(SourcePix)
		Local DestPitch:Int = PixmapPitch(DestPix)
	
		'pointers To the first pixel of pixmaps
		Local SourcePtr:Byte Ptr = PixmapPixelPtr(SourcePix) + SY * SourcePitch + SX * 4
		Local DestPtr:Byte Ptr = PixmapPixelPtr(DestPix) + DY * DestPitch + DX * 4
		
		'copy pixels over one line at a time
		For Local i:Int = 1 To SHeight
			MemCopy(DestPtr,SourcePtr,SWidth*4)
			SourcePtr :+ SourcePitch
			DestPtr :+ DestPitch
		Next
	End If
	
	'unlock the buffers
	UnlockImage(Source)
	UnlockImage(Dest)
End Function
</pre><br><br><br>The SetMaskColor(255, 0, 255) is not working anymore and even if I will make the image transparent , it replaces all transparent pixels to white.<br><br>If you have some nice idea how to grab a portion of image fast and paste it on the screen or on other image buffer without destroying the transparency. <br><br></td></tr></table><br>
<a name="1281941"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Galdy</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't know if this would work at all, but Is memory at such a premium you couldn't just make a water distortion animation series of images at 352x240 and use transparency? You're talking what, maybe around 5 megs for say 15 frames? You could break up the images into smaller blocks to try to reduce memory usage. <br><br></td></tr></table><br>
<a name="1281965"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have sliced the images to 1x240<br>352 images of 1x240<br><br>But the problem is not pasting the images , is the grabbing the portion of screen<br>to update always the viewport of the dungeon when players walking and the water effect always render. <br><br></td></tr></table><br>
<a name="1282015"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Galdy</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> So you are trying to use one image i take it, but manipulate it with code to create the distortion. Thus  slicing the one image up as others have suggested to manipulate it. I don't understand your grab image technique or why that is necessary. Something to do with pixmaps I take it?  Something I've never played with.   Why not just pre-crop the image into slices and load in the slices? Wouldn't that do away with all that pixmap/copy code? Just a curious amateur here. <br><br></td></tr></table><br>
<a name="1282027"></a>

<a name="1282028"></a>

<a name="1282034"></a>

<a name="1282052"></a>

<a name="1282053"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Takis76<br><br>Try something like this : <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">


SuperStrict

AutoImageFlags( DYNAMICIMAGE )

Function GrabImageRect:TImage(img:TImage, sx:Int, sy:Int, sw:Int, sh:Int)

	Local old:TPixmap = LockImage(img)
	
	Local argb:Int[] = New Int[sw*sh]
	
	For Local x:Int = 0 Until sw
	For Local y:Int = 0 Until sh
	
		argb[x + y * sw] = ReadPixel(old, x + sx, y + sy)
	
	Next
	Next
	
	UnlockImage(img)
	
	Local new_img:TImage = CreateImage(sw, sh)
	
	Local pix:TPixmap = LockImage(new_img)
	
	For Local x:Int = 0 Until sw
	For Local y:Int = 0 Until sh
	
		WritePixel pix, x, y, argb[x + y * sw]
	
	Next
	Next

	UnlockImage(new_img)
	
	Return new_img

End Function

Graphics 640,480

Global img:TImage = LoadImage("tiles16c.png")

While Not KeyHit(KEY_ESCAPE)

	SetClsColor(255,255,255)

	Cls
	
		DrawImage(GrabImageRect(img, Rnd(20) / 16, Rnd(20) / 16, 16, 16), 32, 32)
	
	Flip

Wend

	EndGraphics

End

</textarea><br><br>Edit : Here is the modification needed to make it remove color mask.<br><br><pre class=code>

	For Local x:Int = 0 Until sw
	For Local y:Int = 0 Until sh
	
		If argb[x + y * sw] &lt;&gt; 255 Shl 24 | 255 Shl 16 | 0 Shl 8 | 255
	
		WritePixel pix, x, y, argb[x + y * sw]
		
		EndIf
	
	Next
	Next

</pre><br><br>I'm not sure if this is what you are trying to do, but it works for the things I do, and it has changed over time, but you can modify it for what you are trying to do.  Look at the function, and see if you are able to modify it for what you are trying to do.<br><br>Here is another form of what you might be trying to do:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

Function GrabScreen:TImage(sx:Int, sy:Int, sw:Int, sh:Int)
	
	Local argb:Int[] = New Int[sw*sh]
	Local r:Byte, g:Byte, b:Byte, a:Byte
		
	For Local x:Int = 0 Until sw
	For Local y:Int = 0 Until sh
				
		GetPixel(x + sx, y + sy, r, g, b, a)
						
		argb[x + y * sw] = (a Shl 24 | r Shl 16 | g Shl 8 | b)
				
	Next
	Next
	
	Local new_img:TImage = CreateImage(sw, sh)
	
	Local pix:TPixmap = LockImage(new_img)
	
	For Local x:Int = 0 Until sw
	For Local y:Int = 0 Until sh
	
		WritePixel pix, x, y, argb[x + y * sw]
		
	Next
	Next

	UnlockImage(new_img)
	
	Return new_img

End Function

Function GetPixel:Int(x:Int, y:Int, r:Byte Var, g:Byte Var, b:Byte Var, a:Byte Var)

	Local pix:TPixmap = GrabPixmap(x,y,1,1)
	
	Local i_ptr:Byte Ptr = PixmapPixelPtr(pix)
	
	GlReadPixels(x, y, 1, 1, GL_RGBA, GL_UNSIGNED_BYTE, i_ptr)
	
	If i_ptr[0] = 0 And i_ptr[1] = 0 And i_ptr[2] = 0
	
		a = 0

	Else
	
		a = i_ptr[3]			
	
	EndIf
	
	r = i_ptr[2]
	g = i_ptr[1]
	b = i_ptr[0]
			
End Function

</textarea><br><br>FBEpyon <br><br></td></tr></table><br>
<a name="1282056"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> When I want to update my underwater effect , I just want to grab a portion rectangle of the screen and I store it to an image TImage and then draw it again , in the same position.<br><br>This updates the dungeon viewport with the underwater effect.<br>The grabbing with grabpixmap is very slow.<br><br>The grabscreen code you gave freezes my program.<br><br>The GrabImageRect code you gave is nice , but grabs a portion of loaded image from file not screen. I like this code , but is for another use. Is nice for cut sprites from a sprite sheet.<br><br>I just want to cut the portion of screen , store it to an image buffer, no file and re paste this grabbed image again fast.<br><br>:) <br><br></td></tr></table><br>
<a name="1282058"></a>

<a name="1282061"></a>

<a name="1282062"></a>

<a name="1282068"></a>

<a name="1282070"></a>

<a name="1282073"></a>

<a name="1282074"></a>

<a name="1282076"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah I wasn't sure how good the second one was going to be.  Glreadpixel is good for what you are doing, but not sure how to help without having it like u have it.<br><br>Can you post a quick sample code of how you are using my grabscreen code? <br><br></td></tr></table><br>
<a name="1282104"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes.<br><br>In my game I present whole interface with the dungeon viewport.<br><br>In my old code first I have one function which initializes this image. I used the<br>GrabPixmap() function.<br><br>First I prepare all global variables somewhere at the beginning of the program.<br><br><pre class=code>
Global Water_x:Int
Global amplitudeScaling:Int
Global waveLengthScaling:Int
Global Underwater_pixmap:TPixmap
</pre><br><br>Then I was created an empty pixmap and I was run the initialization function, just<br>after all game data was loaded.<br><br><pre class=code>
Function Init_Underwater_Effect()

Underwater_pixmap = GrabPixmap(23, 68, 352, 240)
End Function
</pre><br><br>This initialization creates an empty pixmap with name Underwater_pixmap.<br><br>After this in the main game loop which the dungeon was rendered I call this function<br>continuously.<br><br><pre class=code>
Function Draw_Underwater_Effect()

	Underwater_pixmap = GrabPixmap(23, 68, 352, 240)
	Underwater_image = LoadImage(Underwater_pixmap, MASKEDIMAGE)

	
	If (Current_time &gt;= Underwater_Effect.Deadline_time) Then
	Underwater_Effect.Time_Delay = 80
	Underwater_Effect.Deadline_time = Current_time + Underwater_Effect.Time_Delay
	
	
			
	amplitudeScaling = Rnd(1, 4)
	waveLengthScaling = Rnd(4, 8)
		
	EndIf

	For Water_x = 1 To 352
	DrawSubImageRect(Underwater_image, 423 + Water_x + amplitudeScaling * Sin(Water_x * waveLengthScaling), 69, 20 + amplitudeScaling * Sin(Water_x * waveLengthScaling), 240 + amplitudeScaling * Sin(waveLengthScaling), 1 + Water_x, 1, 20, 240, 1, 1, 0)
	Next


End function
</pre><br><br>Grabbing the pixmap and load the image from the pixmap in the main game loop and do this continuously slows down the game.<br><br>The new grabbed image draws on the screen with DrawSubImageRect() function to make the underwater effect.<br><br>After this , I have only 5 Frames Per Second.<br><br>Try to load your own image on the screen and run my code to see the effect. <br><br></td></tr></table><br>
<a name="1282112"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have posted a quick example to see the effect.<br><br><br><pre class=code>
SuperStrict

Import brl.PNGLoader

Global graph:TGraphics = Graphics(640, 480, 0, 120)
Global Underwater_pixmap:TPixmap
Global Water_x:Int
Global amplitudeScaling:Int
Global waveLengthScaling:Int

Global Sample_Image:TImage
Global Underwater_image:TImage
Global Current_time:Int

Type My_Underwater_Effect

	Field Time_Delay:Int
	Field Deadline_time:Int
	

End Type
Global Underwater_Effect:My_Underwater_Effect
Underwater_Effect = New My_Underwater_Effect



Sample_Image = LoadImage("your_image.png", MASKEDIMAGE)

Init_Underwater_Effect()

While Not AppTerminate()

	Current_time = MilliSecs()

DrawImage(Sample_Image, 0, 0, 0)

	If KeyHit(KEY_ESCAPE) Then End

Draw_Underwater_Effect()
	
		
	Flip - 1

Wend

Function Init_Underwater_Effect()
	Underwater_pixmap = GrabPixmap(23, 68, 352, 240)
	SetAlpha(1)

End Function
	

Function Draw_Underwater_Effect()
	

	
	Underwater_pixmap = GrabPixmap(23, 68, 352, 240)
	Underwater_image = LoadImage(Underwater_pixmap, MASKEDIMAGE)
	
	SetAlpha(1)
	
	If (Current_time &gt;= Underwater_Effect.Deadline_time) Then
	Underwater_Effect.Time_Delay = 80
	Underwater_Effect.Deadline_time = Current_time + Underwater_Effect.Time_Delay
	
	
			
	amplitudeScaling = Rnd(1, 4)
	waveLengthScaling = Rnd(4, 8)
		
	EndIf

	For Water_x = 0 To 350 Step 2
	'DrawSubImageRect(Underwater_image, 423 + Water_x + amplitudeScaling * Sin(Water_x * waveLengthScaling), 69, 20 + amplitudeScaling * Sin(Water_x * waveLengthScaling), 240 + amplitudeScaling * Sin(waveLengthScaling), 1 + Water_x, 1, 20, 240, 1, 1, 0)
	DrawSubImageRect(Underwater_image, 423 + Water_x + amplitudeScaling * Sin(Water_x * waveLengthScaling), 69, 20 + amplitudeScaling * Sin(Water_x * waveLengthScaling), 240 + amplitudeScaling * Sin(waveLengthScaling), 0 + Water_x, 0, 20, 240, 0, 0, 0)
	Next
	
		
End Function
</pre> <br><br></td></tr></table><br>
<a name="1282131"></a>

<a name="1282134"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe you should add some (very subtle) vertical movement too (like in waves).<br><br>Also think of reorganizing your code (too many globals):<br>Global Water_x:Int<br><br>could be replaced with<br><br>For local Water_x:int = 0 To 350 Step 2<br>Next<br><br><br>also I suggest to _not_ hardcode coordinates. <br><br>Another thing: You calc Sin(waveLengthScaling) 175 times per "Draw_underwater_effect()" - just do it once and store it in a local variable.<br><br><br>Underwater_pixmap = GrabPixmap(23, 68, 352, 240)<br>Underwater_image = LoadImage(Underwater_pixmap, MASKEDIMAGE)<br>-&gt;<br>underwater_image = LoadImage( GrabPixmap(23, 68, 352, 240) )<br><br><br>Global Underwater_Effect:My_Underwater_Effect<br>Underwater_Effect = New My_Underwater_Effect<br>-&gt;<br>Global Underwater_Effect:My_Underwater_Effect = New My_Underwater_Effect<br><br><br>BTW: if you already created a type for the effect, you could have a "Method Init()" and "Method Draw()" replacing the "draw_underwater_effect" etc.<br><br><br><br>"Optimizing" (re-layouting) your code will surely get rid of a bunch of your 120.000 LOCs.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1282140"></a>

<a name="1282141"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> What is the difference between:<br><br><pre class=code>
Underwater_pixmap = GrabPixmap(23, 68, 352, 240)
Underwater_image = LoadImage(Underwater_pixmap, MASKEDIMAGE)
</pre><br><br>and<br><br><pre class=code>
underwater_image = LoadImage( GrabPixmap(23, 68, 352, 240) )
</pre><br><br>The same with this too.<br><br><pre class=code>
Global Underwater_Effect:My_Underwater_Effect
Underwater_Effect = New My_Underwater_Effect
</pre><br><br>And<br><br><pre class=code>
Global Underwater_Effect:My_Underwater_Effect = New My_Underwater_Effect
</pre><br><br>Except of 2 lines of code less.<br><br><br>In my code I change the water_x variable and I made it as local.<br>And I added and water_y variable and I changed the code little , making the wave<br>waving and vertically too. Little better effect.<br><br>My code after the completion of the game it will be expected to be more than 500.000 lines. And after completion I will remove some duplicated lines about loading animation with lots of images which I have added them to image arrays.<br><br><div class="quote"> <br>Another thing: You calc Sin(waveLengthScaling) 175 times per "Draw_underwater_effect()" - just do it once and store it in a local variable.<br> <br></div><br><br>Making the variable amplitudeScaling and waveLengthScaling local the program forgets the variables and the effect doesn't updates.<br><br>This increases the speed by 2 frames per second.<br><br>The new code which animate the wave horizontally and vertically too.<br><br><pre class=code>
	For Water_y = 0 To 240
		For Water_x = 0 To 352
		DrawSubImageRect(Underwater_image, 423 + Water_x + amplitudeScaling * Sin(Water_x * waveLengthScaling), 68 + Water_y + amplitudeScaling * Sin(Water_y * waveLengthScaling), 20 + amplitudeScaling * Sin(Water_x * waveLengthScaling), 140, 1 + Water_x, 1 + Water_y, 20, 240, 1, 1, 0)
		Next
	Next
</pre><br><br>The only thing which will increase the speed is some fast grabscreen function. <br><br></td></tr></table><br>
<a name="1282150"></a>

<a name="1282151"></a>

<a name="1282153"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> @sin(wavelengthscaling)<br><br>It is a constant value from the POV of "within the for-next-loop"<br><br>So just have a<br><br><pre class=code>
local variableName:Float = sin(wavelengthscaling)
For Water_y = 0 to 240
  DrawSubImageRect( ... , variableName, )
Next
</pre><br><br>compared to<br><br><pre class=code>
For Water_y = 0 to 240
  DrawSubImageRect( ... , sin(wavelengthscaling), )
Next
</pre><br><br><br>@LoadImage( GrabPixmap() )<br><br>It save the need for another variable you are using. In the case of your code it even decreases usage of "globals" (which is always good).<br><br>@ bla:Effect = new Effect<br>Dunno if things get optimized or not - it just saves a line and there is (imho) no need to do this on 2 lines.<br><br>It is similar to writing:<br><br>local x:int<br>x = 10<br><br>compared to<br><br>local x:int = 10<br><br><br><br>Edit: just saw your for loop<br><br>You are drawing 240*352 single images _each_ frame !<br><br>I would go back to draw only 1*height-sized Sprites. You might scale the height of that sprites to enable a "waviness" look.<br><br>-&gt; replace "water_y" with something depending on the water_x value and sinus ... so it "wavy" offsets the y-coordinate by -1 to 1 (or more, if you prefer a heavier wave).<br><br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1282156"></a>

<a name="1282157"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm not sure if this is really going to speed things up...<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

SuperStrict

Import brl.PNGLoader

Global graph:TGraphics = Graphics(640, 480, 0, 120)
Global Underwater_pixmap:TPixmap
Global Water_x:Int
Global Water_y:Int
Global amplitudeScaling:Int
Global waveLengthScaling:Int

Global Sample_Image:TImage
Global Underwater_image:TImage
Global Current_time:Int

Type My_Underwater_Effect

	Field Time_Delay:Int
	Field Deadline_time:Int
	Field Image:TImage

End Type

AutoImageFlags( DYNAMICIMAGE | MASKEDIMAGE )

Global Underwater_Effect:My_Underwater_Effect
Underwater_Effect = New My_Underwater_Effect

Sample_Image = LoadImage("tiles16c.png")

Init_Underwater_Effect()

While Not AppTerminate()

	Current_time = MilliSecs()
	
	SetClsColor 255, 255, 255
	
	If KeyHit(KEY_ESCAPE) Then End
	
	Cls
	
		DrawImage(Sample_Image, 0, 0, 0)
	
		Underwater_Effect.Image = GrabScreen(0, 0, 352, 240)

	Cls
	
		Draw_Underwater_Effect()
		
	Flip - 1

Wend

Function Init_Underwater_Effect()

	Underwater_pixmap = GrabPixmap(23, 68, 352, 240)
	SetAlpha(1)

End Function

Function GetPixels:Byte Ptr(x:Int, y:Int, w:Int, h:Int)

	Local pix:TPixmap = GrabPixmap(x,y,w,h)

	Local i_ptr:Byte Ptr = PixmapPixelPtr(pix)
	
	GlReadPixels(x, y, w, h, GL_RGBA, GL_UNSIGNED_BYTE, i_ptr)

	Return i_ptr
			
End Function
	
Function GrabScreen:TImage(sx:Int, sy:Int, sw:Int, sh:Int)
	
	Local pix:TPixmap = CreatePixmap(sw, sh, PF_RGBA8888)
	Local pitch:Int = PixmapPitch(pix)
	
	ClearPixels pix
		
	Local s_ptr:Byte Ptr = GetPixels(sx, sy, sw, sh)
	
	For Local x:Int = 0 Until sw
	For Local y:Int = 0 Until sh
	
		Local p:Byte Ptr = s_ptr + y * pitch + x * 4
		
		WritePixel pix, x, y, (p[3] Shl 24 | p[2] Shl 16 | p[1] Shl 8 | p[0])
		
	Next
	Next
		
	Local img:TImage = LoadImage(pix)
	
	Return img

End Function

Function Draw_Underwater_Effect()

	'Underwater_image = GrabScreen(0, 0, 352, 240)

	If (Current_time &gt;= Underwater_Effect.Deadline_time) Then
		Underwater_Effect.Time_Delay = 80
		Underwater_Effect.Deadline_time = Current_time + Underwater_Effect.Time_Delay	
				
		amplitudeScaling = Rnd(1, 4)
		waveLengthScaling = Rnd(4, 8)
	EndIf
		
	For Water_y = 0 To 240
		For Water_x = 0 To 352
		DrawSubImageRect(Underwater_Effect.Image, Water_x + amplitudeScaling * Sin(Water_x * waveLengthScaling), Water_y + amplitudeScaling * Sin(Water_y * waveLengthScaling), 20 + amplitudeScaling * Sin(Water_x * waveLengthScaling), 140, 1 + Water_x, 1 + Water_y, 20, 240)
		Next
	Next	
		
End Function

</textarea> <br><br></td></tr></table><br>
<a name="1282168"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> The above code above is very slow too 8 frames per second. :(<br><br>Is it possible with the first function above ccCopyImageRect when you pasting the image have the transparent color not present?<br><br>I will try to use ccCopyImageRect function. It does the copy fast. <br><br></td></tr></table><br>
<a name="1282187"></a>

<a name="1282188"></a>

<a name="1282189"></a>

<a name="1282190"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah,<br><br>I have a power house computer, so things I do on it never translate very well to low end system.. Sorry<br><br><br>:EDIT:<br><br>Hey I was talking with my friend here at work about this and he is a EOTB expert.  <br><br>He says that you should use Floor effects for reference to being under water.<br><br>He said to check out EOTB 2: DARK MOON (CASTLE DARK MOON) Floor effects.<br><br>Example would be just having bubbles floating to the top of the screen every few seconds, and blue halo around the screen (overlay).<br><br>Thanks,<br><br>FBEpyon <br><br></td></tr></table><br>
<a name="1282194"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have played Eye of the Beholder 2 - The Legend of Darkmoon.<br>Eob2 Doesn't have any underwater level.<br>Eob3 had one.<br><br>What floor effects? Eob didn't have any special floor effect.<br>About bubble , I will add them when I will finish the grabbing problem. If I will not use the pixmap grab the game goes fast. In window mode I have 50 fps and in full screen I have 70 fps. In some more powerful computers I have 120 fps. But after grabbing everything goes very very slow.<br><br>I like my game to be played in older computers too.<br><br><br>Now I am working on Projectile Traps , Fireball and spell launchers.<br><br>I tested most of possible functions how to grab a part from the screen in realtime and all are slow then.<br><br>I will not add underwater effect for now in my game. <br><br></td></tr></table><br>
<a name="1282196"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> Floor Effect : Spell effects that start from the bottom and rise to the top.  Sorry that was the way it was explained to me.<br><br>And yes EOTB 2 did not have any underwater but used effects that would work well for making it look like someone was underwater being that the entire game was confined to one area.<br><br>I will still see what I can do to come up with something with shaders for you, but if I do that it won't be able to work with DirectX. <br><br></td></tr></table><br>
<a name="1282197"></a>

<a name="1282198"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> How other programmers use shaders and work with Direct X?<br>I don't know nothing about shaders.<br>Why it will not able to run with DirectX? Even if I use open GL , Do I will need to change whole code?<br><br>I can make underwater effect elsewhere , but it will not be wavy like under water distortion.<br>Just adding a translucent cyan overlay doesn't do very realistic effect.<br>But the underwater distortion animation is much better.<br><br>About underwater bubbles and other stuff is fast. They are just sprites or particles. <br><br></td></tr></table><br>
<a name="1282201"></a>

<a name="1282203"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> Direct X uses another shader (HSLS?) language than OpenGL, and I no nothing of the raw Direct X.<br><br>OpenGL uses GLSL for Shaders, which I'm able to program in.  Because of that shader effects would be gone to anyone that wants to run the game in DirectX.<br><br>I would say for the distortion animation, you could look into doing random perlin noise overlay maybe, but wouldn't distort the game screen itself. <br><br>If you are trying to maintain the original feel of EOTB then I would say go with overlays, you could come up with some cool effects like a gradient teal overlay where its dark on the bottom, and lighter on the top for being under water. <br><br></td></tr></table><br>
<a name="1282202"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> OpenGL and Direct3D work differently with shaders, so you have to write the same shader twice, oncee in GLSL (the shader language used by OpenGL) and in HLSL as well (Direct3D).<br><br>Ideally you want to stay away from dealing with these APIs directly and want to do it through some game engine: most of them abstract the visual properties of a surface as a "material", which includes, among several visual settings, shader programs.<br><br>You're interested in getting the special effect in your game, not learning how the APIs work. Use a tool that suits your needs. <br><br></td></tr></table><br>
<a name="1282205"></a>

<a name="1282208"></a>

<a name="1282209"></a>

<a name="1282210"></a>

<a name="1282211"></a>

<a name="1282212"></a>

<a name="1282213"></a>

<a name="1282214"></a>

<a name="1282215"></a>

<a name="1282216"></a>

<a name="1282217"></a>

<a name="1282218"></a>

<a name="1282219"></a>

<a name="1282221"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> Removed - Code did not work... <br><br></td></tr></table><br>
<a name="1282296"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> What is your opinion?<br>If I will use GLGL does my game will work in other operating systems?<br>Do I need to change the graphic mode? (Now I am in directX mode)<br>Do I will need to change lot of code in my gem?<br><br>Where do I will find this GLGL module?<br>The copy of the screen is slow and I will use overlays but open GL would be nice.<br>Regardless I don't know how to program shaders. Or if I will find some ready made shader and load it.<br>But how do I will able to render a shader in Blitzmax?<br><br>:) <br><br></td></tr></table><br>
<a name="1282333"></a>

<a name="1282334"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have been playing around with screen capturing and I was able to get screen capturing to work if you only loaded the screen once, and then loaded it again once you did some sort of action.<br><br>I can get about 60fps with my new code I finished last night, but once you put in the DrawImageRect then it drops to 13 to 15 fps.  This seems to the what is limiting you from being able to use the grabscreen function I made (I have an improved version).<br><br>If you are just grabbing the screen once every time you move then it would be fine, but then monsters would need to be draw on as a overlay.<br><br>I will have to look through my shader module I made for Max2d, and see if it will help. <br><br></td></tr></table><br>
<a name="1282339"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> Everytime players move in the dungeon , I must capture the new update.<br>But as you said , there are lots of animated things which needs to be updated underwater , like doors , traps , monsters , spells and other decorating stuff , so all of these things need to be updated constantly even if the players are idle or not move.<br>That's why I have so few fps. All of those things are behind the water effect.<br>Or in one word , after everything was drawn I capture the screen , but because things always changes , I keep recapture the screen again , regardless if the players are moving.<br><br>May I check your code? In my computer when I am drawing something with DrawImageRect I don't have so few frames. When I capture the frames reduces.<br><br>I need to give you a demo of my game to see what I say. <br><br></td></tr></table><br>
<a name="1282340"></a>

<a name="1282341"></a>

<a name="1282342"></a>

<a name="1282343"></a>

<a name="1282344"></a>

<a name="1282345"></a>

<a name="1282346"></a>

<a name="1282347"></a>

<a name="1282348"></a>

<a name="1282349"></a>

<a name="1282350"></a>

<a name="1282351"></a>

<a name="1282352"></a>

<a name="1282353"></a>

<a name="1282354"></a>

<a name="1282355"></a>

<a name="1282356"></a>

<a name="1282357"></a>

<a name="1282358"></a>

<a name="1282359"></a>

<a name="1282360"></a>

<a name="1282375"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you were able to capture the frames once per move, and then if an enemy moves into frame then you would then recapture, so you would need a Boolean that says IsCaptured?, once this is done the capturing function is stopped, and you would just draw the new capture, and do what you need with the DrawImageRect.<br><br>This would work well I would hope..<br><br>I'm work right now, and would need to send you the new code, contact me through my email, if need be fbepyon (a) gmail.com ..<br><br>BTW : GrabPixmap is faster than GrabImage, and using PixmapPixelPtr(pix) you can modify the pixels pointers, also using PF_RGB888 as your format will maintain the MaskColor from my understanding which is how my new code is done.<br><br>BUT!!<br><br>I think I found your answer : <a href="http://www.blitzmax.com/Community/posts.php?topic=85478" target="_blank">http://www.blitzmax.com/Community/posts.php?topic=85478</a><br><br>Also any operation that requires this kind of processing would take up frame rates, but if you perform most of your operations once they are quick, but once you start repeating them in a loop it will slow things down a lot. <br><br>Make sure you keep your logics separated from your drawing operations as well this will help. That being said anything to do with Pixmaps are Logical Operations, and so they need to be done once, or limited.. <br><br></td></tr></table><br>
<a name="1282432"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> About capturing things not constantly, but after some action finish ,might will be a nice idea , I don't know might not work. I will need to add lots of code everywhere.<br>For example when doors are open, each frame, each door will need to capture the screen , or when some monster moves, will need to capture the screen , or when some spell will cast , for each frame of the spell animation or everything that animates it will need to call the capture screen function. I don't know if this fast things up or maybe will be exactly the same.<br><br>The only difference is , now I am capturing the portion of the screen immediately in fraction of milliseconds, but the animations (There are lots of them) have a small time interval between each frame and might will not slowdown the program because they are not so fast.<br><br>I will do some example when the player moves and slowly I will add capture option and to other actions. If the program will start to be slow I will remove it.<br><br>I saw the code in the link you gave.<br>The DrawImageArea() function draws over an image not on the screen directly.<br>So I will need to draw everything on an image buffer and then flip this image buffer to the screen.<br>I haven't tested this function yet , but I would like to ask , does this function paste the graphics with transparent color? Or do I will have the same problem with ccCopyImageRect() function example I found above in previously posts.<br><br>Even the ccCopyImageRect() function slow down the capture and it didn't support transparent colors too.<br><br>I will test the new code first and then I will try to make the trick with IsCaptured boolean , or add some variable to see if something is captured or capture immediately once after each action is over (For Example all animations).<br><br>Sometime I will send you an email to see how the game is looks like and how fast it is. <br><br></td></tr></table><br>
<a name="1282434"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can still keep the color mask as long as you are maintaing the correct pixmap format when use loadimage.<br><br>Loadimage(convertpixmap(pixmap, pf_rgb888))<br><br>Let me know what you come up with. <br><br></td></tr></table><br>
<a name="1282441"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's something I tried.  Using Viewport and setorigin, you can control what gets drawn where and create a nice effect.<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">SuperStrict

Type TDraw
	Method Draw() Abstract
End Type

Type TRect Extends TDraw
	Field X:Float
	Field Y:Float
	Field Width:Float
	Field Height:Float
	Field Color:Int
	
	Method Draw()
		SetColor (Color Shr 16) &amp; $FF,(Color Shr 8) &amp; $FF, Color &amp; $FF
		DrawRect x,y,width,height
	End Method
End Type

Type TEnemy Extends TDraw
	Field X:Float = 0
	Field Y:Float = 0
	Field DX:Float = 1
	Field DY:Float = 1
	Field Image:TImage
	
	Method Draw()
		SetColor 255,255,255
		DrawImage Image,x,y
	End Method
End Type

' a list for each scanline.  All objects that will be drawn on that line will be included
Local ScanList:TList[600]
For Local i:Int = 0 Until 600
	ScanList[i] = CreateList()
Next

Graphics 800,600

'Lets create a bunch of rectangles that will represent the background.  Then we will add them to the lists
Local Colors:Int[] = [$FFFFFF,$FFFF00,$FF00FF,$FF0000,$00FFFF,$00FF00,$0000FF]
For Local i:Int = 1 To 20
	Local Rect:TRect = New TRect
	Rect.X = Rand(0,800)
	Rect.Y = Rand(0,600)
	Rect.Width = Rand(50,100)
	Rect.Height = Rand(50,100)
	Rect.Color = Colors[Rand(0,6)]
	
	For Local j:Int = Rect.Y Until Rect.Y + Rect.Height
		ScanList[j].AddLast(Rect)
	Next
Next

'now to create the enemy and place it into the scanlist
Local Enemy:TEnemy = New TEnemy
Enemy.Image = CreateImage(32,32)
Cls
SetColor 255,128,128
DrawOval 8,0,16,16
SetColor 128,255,128
DrawOval 14,16,4,16
GrabImage(Enemy.Image,0,0)

For Local i:Int = 0 Until 32
	ScanList[i].AddLAst(Enemy)
Next


Local ST:Int = MilliSecs()

While Not KeyHit(KEY_ESCAPE) And Not AppTerminate()

	Local t:Int = (((MilliSecs()-st)/20) Mod 360)
	SetViewport 0,0,800,600
	Cls
	'loop through each scanline
	For Local i:Int = 0 Until 600
		SetViewport 0,i,800,1 'set the drawing viewport to the scanline
		SetOrigin Sin(t+i)*20,0 'shift the origin based on sine
		For Local Draw:TDraw = EachIn ScanList[i] 'draw all objects on this scanline
			Draw.Draw
		Next
	Next
	Flip
	
	For Local i:Int = Enemy.Y Until Enemy.Y+32 'Remove the enemy object from the ScanList
		ScanList[i].Remove(Enemy)
	Next
	
	Enemy.X :+ Enemy.DX 'Move the enemy
	If Enemy.X &gt;= 800-32 Then Enemy.DX = -1
	If Enemy.X &lt;= 0 Then Enemy.DX = 1
	
	Enemy.Y :+ Enemy.DY
	If Enemy.Y &gt;= 600-32 Then Enemy.DY = -1
	If Enemy.Y &lt;= 0 Then Enemy.DY = 1
	
	For Local i:Int = Enemy.Y Until Enemy.Y+32 'Add the object to the scanlines
		ScanList[i].AddLast(Enemy)
	Next
Wend
</textarea> <br><br></td></tr></table><br>
<a name="1282443"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> And a version which doesn't require ViewPort<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">SuperStrict

Type TDraw
	Method Draw(ScanLine:Int, Offset:Float) Abstract
End Type

Type TRect Extends TDraw
	Field X:Float
	Field Y:Float
	Field Width:Float
	Field Height:Float
	Field Color:Int
	
	Method Draw(ScanLine:Int, Offset:Float)
		SetColor (Color Shr 16) &amp; $FF,(Color Shr 8) &amp; $FF, Color &amp; $FF
		DrawRect x+OffSet,ScanLine,width,1
	End Method
End Type

Type TEnemy Extends TDraw
	Field X:Float = 0
	Field Y:Float = 0
	Field DX:Float = 1
	Field DY:Float = 1
	Field Image:TImage
	
	Method Draw(ScanLine:Int, Offset:Float)
		SetColor 255,255,255
		DrawSubImageRect Image,X+Offset,ScanLine,Image.Width,1,0,ScanLine-y,Image.Width,1
	End Method
End Type

' a list for each scanline.  All objects that will be drawn on that line will be included
Local ScanList:TList[600]
For Local i:Int = 0 Until 600
	ScanList[i] = CreateList()
Next

Graphics 800,600

'Lets create a bunch of rectangles that will represent the background.  Then we will add them to the lists
Local Colors:Int[] = [$FFFFFF,$FFFF00,$FF00FF,$FF0000,$00FFFF,$00FF00,$0000FF]
For Local i:Int = 1 To 20
	Local Rect:TRect = New TRect
	Rect.X = Rand(0,800)
	Rect.Y = Rand(0,600)
	Rect.Width = Rand(50,100)
	Rect.Height = Rand(50,100)
	Rect.Color = Colors[Rand(0,6)]
	
	For Local j:Int = Rect.Y Until Rect.Y + Rect.Height
		ScanList[j].AddLast(Rect)
	Next
Next

'now to create the enemy and place it into the scanlist
Local Enemy:TEnemy = New TEnemy
Enemy.Image = CreateImage(32,32)
Cls
SetColor 255,128,128
DrawOval 8,0,16,16
SetColor 128,255,128
DrawOval 14,16,4,16
GrabImage(Enemy.Image,0,0)

For Local i:Int = 0 Until 32
	ScanList[i].AddLAst(Enemy)
Next


Local ST:Int = MilliSecs()

While Not KeyHit(KEY_ESCAPE) And Not AppTerminate()

	Local t:Int = (((MilliSecs()-st)/20) Mod 360)
	SetViewport 0,0,800,600
	Cls
	'loop through each scanline
	For Local i:Int = 0 Until 600
		For Local Draw:TDraw = EachIn ScanList[i] 'draw all objects on this scanline
			Draw.Draw(i,Sin(i+t)*20)
		Next
	Next
	Flip
	
	For Local i:Int = Enemy.Y Until Enemy.Y+32 'Remove the enemy object from the ScanList
		ScanList[i].Remove(Enemy)
	Next
	
	Enemy.X :+ Enemy.DX 'Move the enemy
	If Enemy.X &gt;= 800-32 Then Enemy.DX = -1
	If Enemy.X &lt;= 0 Then Enemy.DX = 1
	
	Enemy.Y :+ Enemy.DY
	If Enemy.Y &gt;= 600-32 Then Enemy.DY = -1
	If Enemy.Y &lt;= 0 Then Enemy.DY = 1
	
	For Local i:Int = Enemy.Y Until Enemy.Y+32 'Add the object to the scanlines
		ScanList[i].AddLast(Enemy)
	Next
Wend
</textarea> <br><br></td></tr></table><br>
<a name="1282444"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#49">[#49]</a></td></tr></table></td></tr><tr ><td class="posttext"> This effect is nice , but it doesn't look like underwater , more like tv jam effect.<br>Maybe if the waves are horizontal and vertical too.<br><br>Is not bad , but the problem now is not the effect. There are some code about objects and inheritance like Abstract and methods which I don't understand them much. <br><br></td></tr></table><br>
<a name="1282562"></a>

<a name="1282565"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#50">[#50]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would say study each area you don't understand in turn until you do, max is a good language which has load's of potential but can be more difficult than most due to poor documentation. <br><br></td></tr></table><br>
<a name="1282571"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#51">[#51]</a></td></tr></table></td></tr><tr ><td class="posttext"> You mean almost no documentation at all.<br>Everything I have learn was from some very few ebooks very very basic and with the help of people here.<br>There is no book or lessons which teaches Blitzmax in depth. <br><br></td></tr></table><br>
<a name="1282591"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#52">[#52]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yup its the one bugbear everyone had with Max there are a few sites dotted around with code snippets on them but not many unfortunately. <br><br></td></tr></table><br>
<a name="1282610"></a>

<a name="1282611"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#53">[#53]</a></td></tr></table></td></tr><tr ><td class="posttext"> I started writing a book on Blitzmax a while ago, but never finished it.<br><br>As far as not knowing Max very well, its a matter of breaking your code down into smaller projects, and learning how it works.  <br><br>I ask for help a lot as well when I'm not sure how something works, but then I figure out most of it myself.<br><br>MiniB3d was good learning experience when trying to figure things out that I didn't understand about 3d, and now most of the things I do are hand written by myself from asking questions, and figuring things out by searching the forums.<br><br>If you have any questions you can always hit me up.<br><br>*EDIT*<br><br>Another useful things to have is a notebook, and write down what you are trying to do, and see if you can figure it out in paper before committing to code.<br><br>Thanks,<br><br>FBEpyon <br><br></td></tr></table><br>
<a name="1282625"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Takis76</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#54">[#54]</a></td></tr></table></td></tr><tr ><td class="posttext"> FBEpyon Did you receive my email? <br><br></td></tr></table><br>
<a name="1282650"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FBEpyon</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#55">[#55]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep I just replied to it. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
