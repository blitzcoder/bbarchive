<!DOCTYPE html><html lang="en" ><head ><title >Single copy of BlitzMax program</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Single copy of BlitzMax program</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Single copy of BlitzMax program</a><br><br>
<a name="887916"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mik1e</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi everybody,<br><br>I want to forbid running more than one copy of my game at the same time. As I understand, the direct way is to get the list of running processes and quit the program if the process with the same name is found.<br><br>But it seems that this will not work because people report problems with PSAPI.dll and I absolutely don't know how to do this on Mac.<br><br>Can some kind soul share a piece of code which can solve this problem (or at least provide some suggestions)?<br><br>Thanks in advance!<br><br>Mikle. <br><br></td></tr></table><br>
<a name="887917"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> By default, Mac only allows one copy of the same app to run at a time. <br><br></td></tr></table><br>
<a name="887921"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mik1e</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> This makes things easier. But what's about Win XP/Vista? <br><br></td></tr></table><br>
<a name="887922"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Vertex</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> The catchword is Mutual exclusion (Mutex) <br><br></td></tr></table><br>
<a name="887925"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mik1e</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry? Pls explain for dummy :) <br><br></td></tr></table><br>
<a name="887929"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> have the first program create a file which gets deleted when it exits, all other attempts to run the program looks for that file and if its present it also exits (without deleting the file of course ;) )<br><br>This way your program will only run once and the concurrent attempts to run it will just make them quit without problem. <br><br></td></tr></table><br>
<a name="887932"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> have the first program create a file which gets deleted when it exits, all other attempts to run the program looks for that file and if its present it also exits (without deleting the file of course ;) )<br><br>This way your program will only run once and the concurrent attempts to run it will just make them quit without problem.  <br></div><br>And if your program ever crashes, or is forced to close by the user, or in any way terminates unexpectedly, your program will never run again.<br><br>A Mutex is the way to go.<br><br><div class="quote"> Sorry? Pls explain for dummy :)  <br></div><br><a href="http://msdn.microsoft.com/en-us/library/ms684266(VS.85).aspx" target="_blank">http://msdn.microsoft.com/en-us/library/ms684266(VS.85).aspx</a><br><br>Plus the forum has a search function. If you use it, you'll find that the use of a Mutex has been discussed and explained before. <br><br></td></tr></table><br>
<a name="887933"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mik1e</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Very nice idea! Thanks!<br><br>But if the program for sime reason quits without deleting this file, it will not run anymore! <br><br></td></tr></table><br>
<a name="887940"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fredborg</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1937#comments" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1937#comments</a> <br><br></td></tr></table><br>
<a name="887942"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://blitzmax-ide.svn.sourceforge.net/viewvc/blitzmax-ide/singleinstance.bmx?revision=3&amp;view=markup" target="_blank">http://blitzmax-ide.svn.sourceforge.net/viewvc/blitzmax-ide/singleinstance.bmx?revision=3&amp;view=markup</a> <br><br></td></tr></table><br>
<a name="887959"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mik1e</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks a lot everybody!<br><br>I've finished with this simple function:<br><br>Function CheckAnotherInstance()<br>	Local fname$ = "cai"<br>	DeleteFile(fname)<br>	If FileType(fname)&lt;&gt;0<br>		End<br>	Else<br>		WriteFile(fname)<br>	EndIf<br>End Function<br><br>I run it at the beginning of the program and everything works fine. <br><br></td></tr></table><br>
<a name="887972"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bremer</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>
Const ERROR_ALREADY_EXISTS:Int = 183

Extern "win32"
	
	Function CreateMutex:Int(lpMutexAttributes :Byte Ptr, bInitialOwner:Int, lpName : Byte Ptr) = "CreateMutexA@12" 
	Function GetLastError:Int() = "GetLastError@0"
		
End Extern

Local ret:Int = CreateMutex(Null,Null ,"ProgName".ToCstring())

If getlasterror () = ERROR_ALREADY_EXISTS
	End
EndIf
</pre> <br><br></td></tr></table><br>
<a name="888039"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> So have a file which you keep all the time but whose content changes to `log` how many times the app started and how many times it correctly `shut down` and if those numbers are odd or even you can tell what state it's in? Or maybe you need a double-buffered system? <br><br></td></tr></table><br>
<a name="888043"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mik1e</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, the idea is very simple -- I open an empty file for writing and keep it while the program is working. If an instance of the program is already running, I cannot delete it. So, if I try to delete the file and can't (FileType(fname)&lt;&gt;0), this means that one instance is already working, so I quit. If I can delete the file, this means that I'm running for the first time, so, I reopen the file for writing and start the program. This works even if the program crashes or shuts down unexpectedly. <br><br></td></tr></table><br>
<a name="888069"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you sure that works?  A crash could easily leave that file "hung open" by the operating system.  So, I still believe that using a file like that is not fool proof. <br><br></td></tr></table><br>
<a name="888090"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why is it so bad if two copies are open at once? <br><br></td></tr></table><br>
<a name="888102"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> The file idea is rather crude, why aren't you going to use Mutex?<br><br>BTW there could be user-rights issues with the file creation/deletion and cause corruption in the information your game is receiving. <br><br></td></tr></table><br>
<a name="888104"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jhans0n</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> As for the Mac, it will let you run 2 copies of the same program if you actually copy the app, and rename one copy.  So, a user wouldn't be able to *accidentally* run two copies, but they could force it if they wanted to.  So it really depends on what you're trying to protect against.<br><br>At least that's how it worked in Tiger - I haven't tried with Leopard. <br><br></td></tr></table><br>
<a name="888121"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Retimer</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> There's really nothing you can do if people 'really' want to run two copies.<br><br>A simple idea would be to have the application write to a temp file the current millisecs of the app, and then check &amp; update every random amount of time that the file still contains the same number. If two apps do this, they will write different numbers and detect that the number has changed.<br><br>Not the best way to do it, but simple. It wouldn't stop someone from being able to hex edit it to write to a different file though, just as it isn't <u>really</u> possible to prevent people from opening 2 of the same app on the same machine.<br><br>There's virtual machines, nada you can do!. What advantage will people get from running multiple processes of your app anyways? Maybe it's those advantages you should be more worried about toning down; that's probobly the best thing you could do. <br><br></td></tr></table><br>
<a name="888127"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mik1e</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ya, I cannot protect my app from running two copies if the user wants to. But I don't attempt to do this. I simply want to protect the user (and myself) from occational running of the second copy of my game engine.  If this happen, the engine slows down and becomes buggy. Under normal conditions the engine should not crash or, even if it crashes, it shuts down and frees the file. I think that the system will keep the file open only when serious error happen, but this anyway will need reboot.<br><br>I decided not to use Mutex because it works only under Windows, though this method generally is more correct. <br><br></td></tr></table><br>
<a name="888229"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why do you feel that you need to do this for the user?<br><br>Most games go to crap if you run two of them.  Run any serious FPS game and then start it a second time.  It will run slow.<br><br>Why do you feel you need to protect the user from him/her self in this instance? <br><br></td></tr></table><br>
<a name="888231"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would have thought opening a socket and broadcasting something on it to secondary instances was much more effective and less prone to errors than something with a file. <br><br></td></tr></table><br>
<a name="888237"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I would have thought opening a socket and broadcasting something on it to secondary instances was much more effective and less prone to errors than something with a file. <br></div>That's brilliant, popup a windows firewall warning for a game that isn't online, perfect way to make your customers happy.<br><br>And what if they don't have a network card? (I know highly unlikely, but you never know.. overparanoid parents?) <br><br></td></tr></table><br>
<a name="888268"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mik1e</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> 2 TaskMaster:<br> <br>It is very irritating when the mouse slows down and you can't shut down unnecessary copy of the  program for 20-40 sec. And I do know that nobody in healthy mind will run second copy of my game. So it is mostly for my (customer’s) convenience and for protection from mistakes, not from intentional action. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
