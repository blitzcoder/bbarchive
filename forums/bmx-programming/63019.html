<!DOCTYPE html><html lang="en" ><head ><title >Declaring Local and Global in a function</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Declaring Local and Global in a function</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Declaring Local and Global in a function</a><br><br>
<a name="703924"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Take this example:<br><br><pre class=code>
Strict
Do()

Function DO()
	Global x
	Do2()
	Print x
	
	Function Do2()
		x:+1
	End Function
End Function
</pre><br><br>If I declare x as local, it won't compile as the x in Do2() won't be recognised.  However, does it make much different to speed if x is declared as global *in a function* and then used a lot?  I appreciate that if x was declared global *outside of the function* i.e. global to the whole app, it would be held in memory and not a CPU register and thus a lot slower.<br><br>Also what happens when the app runs out of registers in a function (due to a lot of local vars), does it push and pop using a stack and is this the same speed as storing/retrieving from memory or does the CPU cache it somehow?<br><br>Any techie answers appreciated... <br><br></td></tr></table><br>
<a name="703934"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Curtastic</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I believe functions inside functions are messed up. I would like them to be supported.<br><br>But this:<br><pre class=code>Function DO()
	Global x[9]
EndFunction</pre><br><br>is faster than this becuase the array doesn't need to be reallocated every time.<br><pre class=code>Function DO()
	Local x[9]
EndFunction</pre> <br><br></td></tr></table><br>
<a name="703947"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> messed up hey, that could explain a bug I just posted in the bug forum.<br><br>So global in a function means it's not reallocated each time, hmm dodgy but worth knowing.  What about if it was a Type and not an array? <br><br></td></tr></table><br>
<a name="703972"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> does not change anything. Global within function means static -&gt; no reallocation after first init. <br><br></td></tr></table><br>
<a name="703974"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wasnt it posted somewhere that the bug was that the compiler didnt throw an error when you tried to declare a function within a function<br><br>ie You're not allowed to do it, but it doesnt tell you so yet <br><br></td></tr></table><br>
<a name="703984"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Function within a Function is a valid construct in BM.<br>Even BRL core modules use that and I use it very often for local functions that I otherwise would inline etc.<br><br>The only thing you have to take care of is that even a function within a function is its own variable space and only knows of application / module globals and stuff it was given on calling. <br><br></td></tr></table><br>
<a name="704047"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Function within a Function is a valid construct in BM. <br></div>Absolutely, the code I posted at the top works fine.  It's a very useful facility to avoid huge amounts of inlining in some cases.  <br><br><div class="quote"> The only thing you have to take care of is that even a function within a function is its own variable space and only knows of application / module globals and stuff it was given on calling.  <br></div> AND as I proved above it knows of globals within the parent function, but not locals within the parent function. <br><br></td></tr></table><br>
<a name="704075"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> jupp, and parent function globals which makes sense as they are global to that scope.<br><br>Locals is the same with base app and functions btw. Functions called from "base app" don't know of locals defined in the base app. <br><br></td></tr></table><br>
<a name="704202"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >(tu) ENAY</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, I didn't realise you could declare globals inside a function. That's quite unusuaul.<br><br>Has anyone else noticed you can create 'Const' variables inside a type that aren't global? I wonder if they're created for each  instance for a type or are simply just replaced as numbers because you can't access them globally outside the type.<br><br>PS Grey Alien, NEVER make a function inside a function, that is just plain wrong :) <br><br></td></tr></table><br>
<a name="704203"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Const exist on type level as globals do.<br>And you can access them globally outside, many here use that approach to fake enumeration.<br><br><pre class=code>
type TEnum
  const up:int = 100
  const left:int = 100
end Type

print TEnum.up + "," + TEnum.left
</pre> <br><br></td></tr></table><br>
<a name="704210"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> ENAY: Functions inside Functions are vital as we've said so you can avoid typing the same piece of code multiple times.  I use them all the time in Delphi data handling routines. <br><br></td></tr></table><br>
<a name="704216"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> grey:<br>Global in a function means if you set X to some value, the next time you enter the function, X will still have that value you set.<br><br>It should be accessable to that function inside the function.  But it's not, for whatever reason, either because of a bug or because functions in functions aren't fully supported.<br><br>Enay:<br>"Hmm, I didn't realise you could declare globals inside a function. That's quite unusuaul."<br><br>They're not accessable from outside the function if you were wondering that.  They're just like static vars in C.  I'm not sure why Mark chose to use the term Global.  That doesn't really indicate the nature of them not being freed when the function exits.  And if they're not accessable within functions in a function then function globals are even less like regular globals. <br><br></td></tr></table><br>
<a name="704246"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> swift: OK I get it, the global is persistant.  btw, you *CAN* access the global in the function inside the function, that was the point of the post (my code example above works you see) and to find out how slow globals were compared to locals when the globals are declared in a function instead of in the main app. <br><br></td></tr></table><br>
<a name="704259"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh I thought you were saying it didn't work.  I must have read global when you wrote local. <br><br></td></tr></table><br>
<a name="704260"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> well you leant something wrong and have now unlearned it, so that's OK :-) <br><br></td></tr></table><br>
<a name="704271"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SoggyP</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello.<br><br>Grey, oh ye inna tutu, you mentioned above that there's a speed hit using the global vs local declaration.  What kind of impact are we talking here - mayfly pee on the ocean or fat bugger off the top diving board?<br><br>Goodbye. <br><br></td></tr></table><br>
<a name="704305"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> well it's simply that the CPU has "registers" which can store say a loop variable and other local variables (only a limited number) and it can access them way quicker than variables stored in RAM.  I was trying to figure out if modern CPUs have a quick way of transfering stuff from the registers (when they get full and a new variable is needed) to the stack (temp area of ram for variables).  Hey surely you know all this anyway right? <br><br></td></tr></table><br>
<a name="704309"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Isn't the CPU cache used before the RAM? And today systems have 2MB of Cache ... which theoretically should be more than enough for "regular stuff" :-) (I know 4 apps that are able to "overfill" my cache, 2 of them are cpu overclocking stability testapps ^^) <br><br></td></tr></table><br>
<a name="704318"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> yeah you are probably right, I suppose there's special CPU commands for using a stack in the cache as well instead of reading from RAM = slow. <br><br></td></tr></table><br>
<a name="704323"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> So, what kind of impact does the use of locals vs globals have? <br><br></td></tr></table><br>
<a name="704327"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sometimes none, but it does make a difference. Its one of theose things that you either do all the time or dont, so you dont realy notice.<br><br>For example I used to "Global Loop" and then use that for all my for loops in the program, now, (Thanks to anther thread like this), I would "For Local Loop", I dont notice the difference obviously, but my understanding is that over the long run it will <br><br></td></tr></table><br>
<a name="704330"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> globals have a little slower access time, which might make a difference for some stuff and not for other things. Its never an intelligent idea to use "calculation variables" of type int / float globals if you perform math operations on them, as this is the situation with the worst impact. <br><br></td></tr></table><br>
<a name="704500"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hotcakes</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> what kind of impact does the use of locals vs globals have? <br></div><br>As has been said, Ram usage vs internal CPU caches and registers...  In B3D/B+, all variables (Local or Global) were stored in RAM.<br><br>Max is much smarter in that it will store as many Local variables in the CPU registers as possible...  which means Global variables are the same speed as they have always been, but Local variables are the fastest a variable can possibly be. <br><br></td></tr></table><br>
<a name="704605"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Has anybody got code which will show the difference between using globals vs locals? <br><br></td></tr></table><br>
<a name="704617"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Core Duo T2500<br><br>Time needed for global ops: 2491<br>Time needed for local ops: 1412<br><br><pre class=code>
SuperStrict

Global gFloat:Float = 1.25

Delay 500
Print "Time needed for global ops: " + gFloatF()
Delay 500
Print "Time needed for local ops: " + lFloatF()

End 

Function gFloatF:Int()
	
	Local t1:Int = MilliSecs()
	For Local i:Int = 1 To 10000000
		gFloat :* gFloat
	Next
	t1 = MilliSecs() - t1
	Return t1
End Function

Function lFloatF:Int()
	Local lFloat:Float	= 1.25
	Local t2:Int = MilliSecs()
	For Local i:Int = 1 To 10000000
		lFloat :* lFloat
	Next
	t2 = MilliSecs() - t2
	Return t2
End Function</pre><br><br>EDIT: Reordered the code to look cleaner and perhaps make more sense. <br><br></td></tr></table><br>
<a name="704619"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> &lt;edit&gt; Actually, I don't see. <br>If you take out the function global gfloat assignment the difference isn't much... or have I missed something?<br>&lt;ano-edit&gt; Still getting very similar results for each. Could it be machine specific differences? I'm using PIII laptop with S3 <br><br></td></tr></table><br>
<a name="704622"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> I reordered the code.<br>Yes potentially you are right.<br><br>main problem is that there isn't enough stuff going on to really compare those 2 because unless there is enough stuff to handle, BM does not seem to push globals to RAM (ie as long as local and global fit in cache, it seems like BM or my CPU is doing this) <br><br></td></tr></table><br>
<a name="704652"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> Also, Ive said this before, but no one ever pays any attention to it, If you allocate them wrong you actualy make variables slower than B3d <br><br></td></tr></table><br>
<a name="704659"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry if you've been ignored H&amp;K. Have you got any code that shows what you mean?<br>How do you mean 'allocate them wrong'? <br><br></td></tr></table><br>
<a name="704664"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.blitzbasic.com/Community/posts.php?topic=59361#661382" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=59361#661382</a><br><br>But any way tony have you read this <br><div class="quote"> you should NOT be able to call a method from within a function <br></div> Its from the copy thread of this one that grey posted in the bug section<br><a href="http://www.blitzbasic.com/Community/posts.php?topic=63020" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=63020</a><br><br>That must be a mistake mustnt it? <br><br></td></tr></table><br>
<a name="704670"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep, I nearly posted a response. I *think* Mark means you should *not* be able to call a method from a function within a method as there is no 'self'.<br>&lt;edit&gt; to add the all important 'not'. <br><br></td></tr></table><br>
<a name="704671"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> H&amp;K, I think he meant in a specific situation (i.e. no Type prefix before the method), not the way you are using them. <br><br></td></tr></table><br>
<a name="704682"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok lets say he ment that, and I allocal a global inside the method<br><pre class=code>Strict

Global Grid[10,10]

Type TA
	Method do()
	GLobal Temp:Ta = self
		do2()
		
		Function do2()
			Local G=Grid[0,0]
			Temp.do3()
		End Function
	End Method 
	
	Method do3()
		Print "OK"
	End Method 
EndType

Global A:TA = New TA
A.do()</pre><br>Now this works yes?<br><br>But mark said "Woops, it's a compiler bug - you should NOT be able to call a method from within a function!"<br><br>Which seems very over the top when all grey needed to to was create one little global.<br><br>I agree with what you have both posted, but until mark or skid says that the post was in error we cannot be sure <br><br></td></tr></table><br>
<a name="704683"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> Double post <br><br></td></tr></table><br>
<a name="704685"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> H&amp;K: No its no error.<br>A function exists only on type level. A method only on instance level. So if you want to call a method from a function, you must give the type instance to the function as well (Event Handlers work that way for example) so the function then can use this type instance to execute the method on it.<br><br>I've never even tried to call a method from function ... didn't make much sense as a function does not know where it was called from or should (as mark said, its a bug) <br><br></td></tr></table><br>
<a name="704686"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> Dream, I think you are wrong. I think Mark madde a mistake. If you look I ave made Greys code work just by letting the fuction know what "Self" is<br><br>"Woops, it's a compiler bug - you should NOT be able to call a method from within a function! "<br><br>Is simply either not true, or somthing we should worry about <br><br></td></tr></table><br>
<a name="704687"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nope definitely not.<br>Functions are clearly declared as beeing NOT instance bound. But a method needs to be executed on an instance -&gt; function has no self so calling a method is called on null which normally should result in "can't be called on null" error.<br><br>If you need something thats executed on an instance, use a method. if you want it to be calleable as SomeType.Function then use a function but that one does not know what an instance of type it has to use unless you specify it.<br><br>If the compiler would react correctly, doing something like<br><br>someTypeInstance.SomeFunction would result in an error that there is no method with that name. <br><br></td></tr></table><br>
<a name="704689"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know they are not instance bound. Please stop trying to tell me what you know, and tell me why you should NOT be able to call a method from within a function.<br><br>Look at the change Ive made to Greys code, the Function now knows about self, and calls a method. So it works. So why Is mark telling me that its a compiler error?<br><br>Im not even saying I would do this, Im just saying if all I need to do was let the function know which instace it is to work on, why has mark said "Woops, it's a compiler bug - you should NOT be able to call a method from within a function!" <br><br></td></tr></table><br>
<a name="704691"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> What mark means is that this is a bug:<br><br><pre class=code>
Type TTest
   field name:String

   method myName:string()
      return name
   end method

   function Test()
      print myName()
   end function
end Type

local test:TTest = new TTest
test.Test()
</pre><br><br>Reason: Function has no self, so calling myName is done on Null which logically can't work, but currently does due to a compiler error.<br>The correct code that is not bugged would look like this:<br><br><br><pre class=code>
Type TTest
   field name:String

   method myName:string()
      return name
   end method

   function Test(obj:TTest)
      print obj.myName()
   end function
end Type

local test:TTest = new TTest
TTest.Test(test)
</pre><br><br>Currently you could even use:<br><br>test.Test(test) instead of TTest. But I think such a usage (function on type instance) is extremely missleading and confusing. <br><br></td></tr></table><br>
<a name="704694"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Dream,<br><br>I Also know what I think Mark ment<br><br>BUT he said this<br><br>Woops, it's a compiler bug - you should NOT be able to call a method from within a function! <br><br>So telling me "No its no error." Is wrong.<br><br>Stop right now, dont post with another example. Is marks statement right or wrong. Dont try and decide what he ment just look at what he said. <br><br></td></tr></table><br>
<a name="704696"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> His statement is right.<br>The way greys code (which does it similar as example 1) called the method is a compiler bug.<br><br>And thats exactly what he said, as he answered Grey's posting with that code. <br><br></td></tr></table><br>
<a name="704699"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Woops, it's a compiler bug - you should NOT be able to call a method from within a function! <br></div><br><br>So eventhough I have made Greys code work. You think that the compiler should tell me that I CANNOT call a method from within a function?<br><br><pre class=code>Strict

Global Grid[10,10]

Type TA
	Method do()
	GLobal Temp:Ta = self
		do2()
		
		Function do2()
			Local G=Grid[0,0]
			Temp.do3()
		End Function
	End Method 
	
	Method do3()
		Print "OK"
	End Method 
EndType

Global A:TA = New TA
A.do()</pre><br>Before you post "but he ment....." ALL my post have been to mark to clarify what he ment, and you posting is not doing that.<br><br>If it was a mistake (Which I think it was), then mark needs to say so. If he really is going to change the compiler so that you cannot call method from within a function then he needs to say so. <br><br></td></tr></table><br>
<a name="704707"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> The problem is it was a mistake, but the compiler didn't catch it and even worked.<br>I think what mark meant with its "woops that a compiler error" was that the compiler shouldn't have been able to call do3 from within the function without a specified instance. Normally if no instance is specified, self is used, but as we all know, a function has no self and thus a "tried to call Do3 on null" error should appear but the compiler currently seems to accept the calling object instance as self even on functions.<br>So that would be a compiler bug.<br><br>I thought it would be quite obvious what compiler error he meant as there was a quite obvious one in that code (function calling method without an existing object without getting a compiler error) <br><br></td></tr></table><br>
<a name="704712"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> So right at the very start of this exchange why did you say that I was wrong in thinking mark had said the wrong thing?<br>You are now saying "what mark meant"<br><br>Can you not see that its not a problem or either you or I being able to program correctly but that the statment<br><br>"Woops, it's a compiler bug - you should NOT be able to call a method from within a function!" Is very definitive. Mark made a misstake in this statment. Thats it full stop. All you have posted since then has been all the things that we also thought he ment to say. All I wanted, and still want is for Mark to clarify that it was an error, or to state thit it isnt an error and that the compiler will be changed to stop Method calls from within a Function.<br><br>You have made the statment that Woops, it's a compiler bug - you should NOT be able to call a method from within a function! is not an error, becuase he MENT to say..... Thats politic speak.<br><br>Go back through your posts and see how every time you have said, no it wasnt a mistake he ment to say.... And then look at my posts where I also say I think he ment something else, yet your first statment to me was that I was wrong to assume he ment something else. <br><br></td></tr></table><br>
<a name="704729"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> stop warring.<br><br>It's all about context.  I understand what Mark meant in that context.  There's no point mega deconstructing it, wait until Mark gets up again (he's probably asleep right now.)<br><br>********<br>However, I think that, within a type, a Function and a sub-function should *NOT* be treated the same.  Sure you shouldn't be able to call a method from a Type's Function because self doesn't exist, unless you do AType.Method() of course.  HOWEVER, if a sub-function is inside a method, treating it like a normal type function totally limits it's usefulness as an inlining tool.  It's already inside a method, so banning the sub-function from calling other methods where self is implicit seems unneccessary.  I hope that as a result of this finding the langauge can be expanded not limited :-)<br>********<br><br>I'll post the same in the other thread. <br><br></td></tr></table><br>
<a name="704733"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> There's no point mega deconstructing it, <br></div><br><div class="quote">  However, I think that  <br></div><br><br>Classic :) <br><br></td></tr></table><br>
<a name="704736"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> haha :-) I wasn't deconstructing what Mark said (like the others), just what I thought would be nice about how it could work in the future. <br><br></td></tr></table><br>
<a name="704995"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fabian.</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>This topic's first post shows:<div class="quote"> <pre class=code>Strict
Do()

Function DO()
	Global x
	Do2()
	Print x
	
	Function Do2()
		x:+1
	End Function
End Function</pre>If I declare x as local, it won't compile as the x in Do2() won't be recognised. <br></div>Imagine this:<pre class=code>'code

Function F1 ( )
  Local L
  'code

  Function F2 ( )
    'code
  EndFunction
EndFunction</pre>Imagine your main programme calls F1 and F1 calls F1 a second time, so L exists twice, one time for each instance of F1. And if now F2 get's called it doesn't know which L to use, that's why this is simply impossible.<br><br>It depends on how the variable's are stored in memory:<br>Globals are stored at a constant position in the process's memory, so each function instance can access them; locals in contrast are stored on the stack, that means every function instance only knows the position of its own locals, there's no way to get the locals of other function instances.<br><br>You could work around this by using a global to store the position of the local, so if F1 gets called you store the position of the local in the global: "globalvar=varptr localvar" and inside F2 you can access to it using: "globalvar[0]"<br>Another way to do this would be that you pass the local variable as "by reference" variable to the sub function.<br><br>This problem isn't compiler specific, it's just a question about how the stack actually works. <br><br></td></tr></table><br>
<a name="704998"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#49">[#49]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> F2 get's called it doesn't know which L to use <br></div><br><br>But F2 can only be called from F1, and so it uses the instance of L attatched to the F1 that called it. If we had gosub Grey could use that, and the problem you have just mentioned wouldnt exist, so why should it exist with functions? <br><br></td></tr></table><br>
<a name="705074"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#50">[#50]</a></td></tr></table></td></tr><tr ><td class="posttext"> Fabian, yeah I see what you are saying but I'm saying (like H&amp;K) because F2 is in F1 it's a shame it can't just use the L from within it's F1, or rather that the function just gets inlined instead, perhaps it needs a different keyword line Inline and End Inline... <br><br></td></tr></table><br>
<a name="705089"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fabian.</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#51">[#51]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> But F2 can only be called from F1 <br></div>I know it really looks like this but the problem is that the user can hack around this and call the function from anywhere in the code.<br>It's because functions are also glabal (stored at a constant position), so you could make a global variable store the function's address and then call the function from everywhere:<pre class=code>Global F3 ( )
F1
F3

Function F1 ( )
  F3 = F2

  Function F2 ( )
    'Do anything
  EndFunction
EndFunction</pre>The problem is that the only thing which is actually only accessable from F1 is the symbol F2, the function itself in contrast is accessable from everywhere.<br>I know it would be nice to have it, I'd use it, too, but it's not possible, locals are only accessable from the function they belong to, except you do something like passing the variable's address to sub functions -&gt; by reference parameters.<div class="quote"> perhaps it needs a different keyword line Inline and End Inline <br></div>Yes this would be a solution... <br><br></td></tr></table><br>
<a name="705106"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#52">[#52]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> global variable store the function's address and then call the function from everywhere <br></div>aha I see, yes. Yeah some new keywords would be cool. <br><br></td></tr></table><br>
<a name="705157"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#53">[#53]</a></td></tr></table></td></tr><tr ><td class="posttext"> Gosub could solve it <br><br></td></tr></table><br>
<a name="705160"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#54">[#54]</a></td></tr></table></td></tr><tr ><td class="posttext"> Goto does not work with Strict / SuperStrict. It seems to be in for compatibility with old blitz as many non-strict things are (that don't work the same way with strict / superstrict)<br><br>Labels within Strict only serve 2 purposes:<br>- DefData statements<br>- Loop labels for Continue looplabel / Exit looplabel <br><br></td></tr></table><br>
<a name="705181"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#55">[#55]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Dream Thats nice.<br><br>Anyway<br>Gosub could solve this <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
