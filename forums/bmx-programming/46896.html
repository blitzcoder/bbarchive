<!DOCTYPE html><html lang="en" ><head ><title >Using .NET class from BMAX</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Using .NET class from BMAX</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Using .NET class from BMAX</a><br><br>
<a name="521655"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JPL</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi !<br><br>I've written a library in C# and I would like to call some functions of this library from BMAX (and ideally map my C# classes to BMAX classes).<br>Is it possible ? If so, how do I declare my functions or classes in C# to make them visible from BMAX ?<br><br>I've successfully called C# function from BMAX with a Bridge dll written in Managed C++, but it's pretty heavy and unefficient.<br>(To TeraBit : I've seen you already done this (at least call functions), and I like to have details about the method you've used if possible.)<br><br>Best Regards,<br>JPL <br><br></td></tr></table><br>
<a name="521662"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> he's posted source here: <a href="http://www.blitzbasic.com/Community/posts.php?topic=44412" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=44412</a> <br><br></td></tr></table><br>
<a name="521702"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JPL</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, I've downloaded the source before posting on the forum, but the package only contains the BMAX source (the caller) but not the C# source of the DLL.<br>I'd like to know how to define my functions and classes IN C# to export them and make them visible by BMAX.<br><br>Thanks, <br><br></td></tr></table><br>
<a name="521703"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> You'd probably be best <a href="/Account/showuser.php?id=396" target="_blank">emailing terabit</a>, he doesn't seem to hang around here much these days. <br><br></td></tr></table><br>
<a name="522980"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TeraBit</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi All,<br><br>Life has been pretty busy recently and I've had to shelve my personal programming projects for the moment. <br><br>It's simple enough to do the DLL. Simply make a class and use all static functions. You will then need to run another program to fix it into a standard DLL<br><br>The class for the DLL in my demo:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Imports System.Windows.Forms
Imports System.Drawing
Public Class Class1
    Inherits System.Windows.Forms.Form
    Structure eStack
        Dim Gadget As Integer
        Dim EventType As Integer
        Dim EventASC As Integer
        Dim EventScan As Integer
    End Structure
    Structure ControlInfo
        Dim repaintme As Integer
    End Structure

    Shared Gadget(1) As Object 'Control
    Shared stat(1) As ControlInfo
    Shared GadgetCount As Integer
    Shared EventStack(1000) As eStack
    Shared EventPointer As Integer
    Shared Function FreeG() As Integer
        Dim ind As Integer
        For ind = 1 To UBound(Gadget)
            If Gadget(ind) Is Nothing Then
                Return ind
            End If
        Next
        ReDim Preserve Gadget(UBound(Gadget) + 1) : ReDim Preserve stat(UBound(stat) + 1)
        Return UBound(Gadget)
    End Function
    Shared Function GetHandle(ByVal gad As Integer) As Integer
        Dim c As Control
        Dim i As Int32
        c = Gadget(gad)
        i = c.Handle.ToInt32
        Return i
    End Function

    Shared Sub HideGUI(ByVal gad As Integer)
        Dim holdc As Control
        Dim holdm As MenuItem

        If Gadget(gad) Is Nothing Then Exit Sub
        Dim ListType As String
        ListType = Gadget(gad).GetType.Name
        Select Case ListType
            Case "MyMenuItem"
                holdm = Gadget(gad)
                holdm.Visible = False
            Case Else
                holdc = Gadget(gad)
                holdc.Visible = False
        End Select
    End Sub

    Shared Sub ShowGUI(ByVal gad As Integer)
        Dim holdc As Control
        Dim holdm As MenuItem

        If Gadget(gad) Is Nothing Then Exit Sub
        Dim ListType As String
        ListType = Gadget(gad).GetType.Name
        Select Case ListType
            Case "MyMenuItem"
                holdm = Gadget(gad)
                holdm.Visible = True
            Case Else
                holdc = Gadget(gad)
                holdc.Visible = True
        End Select
    End Sub

    Shared Sub SetAnchor(ByVal gad As Integer, ByVal Left As Integer, ByVal right As Integer, ByVal top As Integer, ByVal bottom As Integer)
        Dim ank As Integer
        If Left &lt;&gt; 0 Then ank += AnchorStyles.Left
        If right &lt;&gt; 0 Then ank += AnchorStyles.Right
        If top &lt;&gt; 0 Then ank += AnchorStyles.Top
        If bottom &lt;&gt; 0 Then ank += AnchorStyles.Bottom
        Gadget(gad).Anchor = ank
    End Sub

    Shared Sub DockLeft(ByVal gad As Integer)
        Gadget(gad).Dock = DockStyle.Left
    End Sub
    Shared Sub DockTop(ByVal gad As Integer)
        Gadget(gad).Dock = DockStyle.Top
    End Sub
    Shared Sub DockRight(ByVal gad As Integer)
        Gadget(gad).Dock = DockStyle.Right
    End Sub
    Shared Sub DockBottom(ByVal gad As Integer)
        Gadget(gad).Dock = DockStyle.Bottom
    End Sub
    Shared Sub DockFill(ByVal gad As Integer)
        Gadget(gad).Dock = DockStyle.Fill
    End Sub
    Shared Sub DockNone(ByVal gad As Integer)
        Gadget(gad).Dock = DockStyle.None
    End Sub

    Shared Function GetIndex(ByVal Gad As Integer) As Integer
        If Gadget(Gad) Is Nothing Then Exit Function
        Dim ListType As String
        ListType = Gadget(Gad).GetType.Name
        Select Case ListType
            Case "ListBox"
                Dim list As ListBox
                list = Gadget(Gad)
                Return list.SelectedIndex
            Case "CheckedListBox"
                Dim list As CheckedListBox
                list = Gadget(Gad)
                Return list.SelectedIndex
            Case "ComboBox"
                Dim list As ComboBox
                list = Gadget(Gad)
                Return list.SelectedIndex
        End Select
    End Function

    Shared Sub SetIndex(ByVal Gad As Integer, ByVal index As Integer)
        If Gadget(Gad) Is Nothing Then Exit Sub
        Dim ListType As String
        ListType = Gadget(Gad).GetType.Name
        Select Case ListType
            Case "ListBox"
                Dim list As ListBox
                list = Gadget(Gad)
                list.SelectedIndex = index
            Case "CheckedListBox"
                Dim list As CheckedListBox
                list = Gadget(Gad)
                list.SelectedIndex = index
            Case "ComboBox"
                Dim list As ComboBox
                list = Gadget(Gad)
                list.SelectedIndex = index
        End Select
    End Sub

    Shared Function AddItem(ByVal list As Integer, ByVal item As String) As Integer
        If Gadget(list) Is Nothing Then Exit Function
        Dim ListType As String
        ListType = Gadget(list).GetType.Name
        Select Case ListType
            Case "ListBox"
                Dim L As ListBox
                L = Gadget(list)
                L.Items.Add(item)
                Return L.Items.Count - 1
            Case "CheckedListBox"
                Dim L As CheckedListBox
                L = Gadget(list)
                L.Items.Add(item)
                Return L.Items.Count - 1
            Case "ComboBox"
                Dim L As ComboBox
                L = Gadget(list)
                L.Items.Add(item)
                Return L.Items.Count - 1
        End Select
    End Function
    Shared Sub RemoveItem(ByVal list As Integer, ByVal index As Integer)
        If Gadget(list) Is Nothing Then Exit Sub
        Dim ListType As String
        ListType = Gadget(list).GetType.Name
        Select Case ListType
            Case "ListBox"
                Dim L As ListBox
                L = Gadget(list)
                If index &lt; -1 Or index &gt; l.Items.Count - 1 Or l.Items.Count &lt; 1 Then Exit Sub
                If index = -1 Then
                    If l.SelectedIndex &lt; 0 Then Exit Sub
                    L.Items.removeat(l.Selectedindex)
                Else
                    L.Items.removeat(index)
                End If
            Case "CheckedListBox"
                Dim L As CheckedListBox
                L = Gadget(list)
                If index &lt; -1 Or index &gt; l.Items.Count - 1 Or l.Items.Count &lt; 1 Then Exit Sub
                If index = -1 Then
                    If l.SelectedIndex &lt; 0 Then Exit Sub
                    L.Items.removeat(l.Selectedindex)
                Else
                    L.Items.removeat(index)
                End If
        End Select
    End Sub
    Shared Sub SetGadgetBorder(ByVal gad As Integer, ByVal bord As Integer)
        If Gadget(gad) Is Nothing Then Exit Sub
        Dim ListType As String
        ListType = Gadget(gad).GetType.Name
        Select Case ListType
            Case "PictureBox"
                If bord &lt; 0 Or bord &gt; 2 Then Exit Sub
                Dim L As PictureBox
                L = Gadget(gad)
                L.BorderStyle = bord
            Case "Panel"
                If bord &lt; 0 Or bord &gt; 2 Then Exit Sub
                Dim L As Panel
                L = Gadget(gad)
                L.BorderStyle = bord
            Case "Form"
                If bord &lt; 0 Or bord &gt; 6 Then Exit Sub
                Dim L As Form
                L = Gadget(gad)
                L.FormBorderStyle = bord
        End Select
    End Sub
    Shared Sub fclose(ByVal sender As Object, ByVal e As System.ComponentModel.CancelEventArgs)
        Dim o As Control
        o = sender
        AddEvent(o, 9, 0, 0) ' Closing form
        e.Cancel = True
    End Sub
    Shared Sub MyKeyPress(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyPressEventArgs)
        Dim o As Control
        o = sender
        AddEvent(o, 2, Asc(e.KeyChar), 0) ' 1 - Keypress
    End Sub
    Shared Sub MyKeyDown(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs)
        Dim o As Control
        o = sender
        AddEvent(o, 1, 0, e.KeyCode)  ' 5 - KeyDown
    End Sub
    Shared Sub MyKeyUP(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs)
        Dim o As Control
        o = sender
        AddEvent(o, 3, 0, e.KeyCode) ' 6 - KeyUp
    End Sub
    Shared Sub MyClick(ByVal sender As Object, ByVal e As System.EventArgs)
        Dim o As Object
        o = sender
        AddEvent(o, 4, 0, 0)
    End Sub
    Shared Sub MyMouseIn(ByVal sender As Object, ByVal e As System.EventArgs)
        Dim o As Control
        o = sender
        AddEvent(o, 6, 0, 0)
    End Sub
    Shared Sub MyListChanged(ByVal sender As Object, ByVal e As System.EventArgs)
        Dim o As Control
        o = sender
        AddEvent(o, 10, 0, 0)
    End Sub
    Shared Sub MyMouseMove(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs)
        Dim o As Control
        o = sender
        AddEvent(o, 7, e.X, e.Y)
    End Sub

    Shared Sub MyMouseup(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs)
        Dim o As Control
        o = sender
        AddEvent(o, 11, e.X, e.Y)
    End Sub

    Shared Sub MyMouseDown(ByVal sender As Object, ByVal e As System.Windows.Forms.MouseEventArgs)
        Dim o As Control
        o = sender
        AddEvent(o, 12, e.X, e.Y)
    End Sub

    Shared Sub MyMouseOut(ByVal sender As Object, ByVal e As System.EventArgs)
        Dim o As Control
        o = sender
        AddEvent(o, 8, 0, 0)
    End Sub
    Shared Sub MyDoubleClick(ByVal sender As Object, ByVal e As System.EventArgs)
        Dim o As Control
        o = sender
        AddEvent(o, 5, 0, 0) '4 ' Double Click
    End Sub
    Shared Sub MoveGadget(ByVal GNO As Integer, ByVal x As Integer, ByVal y As Integer)
        Gadget(GNO).Left = x
        Gadget(GNO).Top = y
    End Sub
    Shared Sub SizeGadget(ByVal GNO As Integer, ByVal w As Integer, ByVal h As Integer)
        Gadget(GNO).Width = w
        Gadget(GNO).Height = h
    End Sub
    Shared Function GetGadgetX(ByVal gad As Integer) As Integer
        Return Gadget(gad).Left
    End Function
    Shared Function GetGadgetY(ByVal gad As Integer) As Integer
        Return Gadget(gad).Top
    End Function
    Shared Function GetGadgetW(ByVal gad As Integer) As Integer
        Return Gadget(gad).Width
    End Function
    Shared Function GetGadgetH(ByVal gad As Integer) As Integer
        Return Gadget(gad).Height
    End Function

    Shared Sub SetBackColor(ByVal gad As Integer, ByVal r As Integer, ByVal g As Integer, ByVal b As Integer)
        Dim c As Control
        Dim clr As New System.Drawing.Color
        clr = Color.FromArgb(r, g, b)
        c = Gadget(gad)
        c.BackColor = clr
    End Sub

    Shared Sub SetForeColor(ByVal gad As Integer, ByVal r As Integer, ByVal g As Integer, ByVal b As Integer)
        Dim c As Control
        Dim clr As New System.Drawing.Color
        clr = Color.FromArgb(r, g, b)
        c = Gadget(gad)
        c.ForeColor = clr
    End Sub

    Shared Function Message(ByVal tex As String, ByVal caption As String, ByVal buts As Integer) As Integer
        Return MessageBox.Show(tex, caption, buts)
    End Function

    Shared Function GetEvent(ByRef x As eStack) As Integer
        Dim r As Integer
        If EventPointer &gt; 0 Then
            x.Gadget = EventStack(1).Gadget
            x.EventType = EventStack(1).EventType
            x.EventASC = EventStack(1).EventASC
            x.EventScan = EventStack(1).EventScan
            'EventStack(0) = Nothing
            For r = 0 To EventPointer
                EventStack(r) = EventStack(r + 1)
            Next
            'EventStack(EventPointer) = Nothing
            EventPointer -= 1
            Application.DoEvents()
            Return 1
        Else
            x.Gadget = 0
            x.EventType = 0
            x.EventASC = 0
            x.EventScan = 0
            Application.DoEvents()
            Return 0
        End If
    End Function

    'Shared Function GetEvent(ByRef gadget As Integer, ByRef EventType As Integer, ByRef EventASC As Integer, ByRef EventScan As Integer) As Integer
    '    Dim r As Integer
    '    Application.DoEvents()

    '    If EventPointer &gt; 0 Then
    '        gadget = EventStack(1).Gadget
    '        EventType = EventStack(1).EventType
    '        EventASC = EventStack(1).EventASC
    '        EventScan = EventStack(1).EventScan
    '        'EventStack(0) = Nothing
    '        For r = 0 To EventPointer
    '            EventStack(r) = EventStack(r + 1)
    '        Next
    '        'EventStack(EventPointer) = Nothing
    '        EventPointer -= 1
    '        Application.DoEvents()
    '        Return 1
    '    Else
    '        Return 0
    '        Application.DoEvents()
    '    End If
    'End Function

    Shared Sub AddEvent(ByVal o As Object, ByVal Etype As Integer, ByVal EASC As Integer, ByVal ESCAN As Integer)
        If EventPointer &gt;= 1000 Then Exit Sub
        EventPointer += 1
        EventStack(EventPointer).Gadget = CInt(Val(o.Name))
        EventStack(EventPointer).EventType = Etype
        EventStack(EventPointer).EventASC = EASC
        EventStack(EventPointer).EventScan = ESCAN
    End Sub
    Shared Function AddForm(ByVal tex As String, ByVal X As Integer, ByVal Y As Integer, ByVal W As Integer, ByVal H As Integer, ByVal parent As Integer, ByVal Border As Integer) As Integer
        Dim HoldForm As Form
        GadgetCount = FreeG()
        Gadget(GadgetCount) = New Form
        If parent &lt;&gt; 0 Then HoldForm.Parent = Gadget(parent)
        HoldForm = Gadget(GadgetCount)
        HoldForm.SuspendLayout()
        HoldForm.Top = -1000
        HoldForm.Left = -1000
        HoldForm.Show()
        HoldForm.Visible = False
        HoldForm.AutoScaleBaseSize = New System.Drawing.Size(W, H)
        HoldForm.ClientSize = New System.Drawing.Size(W, H)
        HoldForm.Name = CStr(GadgetCount)
        HoldForm.Text = tex
        HoldForm.Visible = True
        HoldForm.Top = Y
        HoldForm.Left = X
        HoldForm.FormBorderStyle = Border
        HoldForm.ResumeLayout()
        AddHandler HoldForm.KeyDown, AddressOf MyKeyDown
        AddHandler HoldForm.MouseEnter, AddressOf MyMouseIn
        AddHandler HoldForm.MouseLeave, AddressOf MyMouseOut
        AddHandler HoldForm.MouseMove, AddressOf MyMouseMove
        AddHandler HoldForm.KeyUp, AddressOf MyKeyUP
        AddHandler HoldForm.Closing, AddressOf fclose
        AddHandler HoldForm.Click, AddressOf MyClick
        AddHandler HoldForm.DoubleClick, AddressOf MyDoubleClick
        Return GadgetCount
    End Function
    Shared Function AddListBox(ByVal X As Integer, ByVal Y As Integer, ByVal W As Integer, ByVal H As Integer, ByVal parent As Integer) As Integer
        Dim HoldTB As ListBox
        GadgetCount = FreeG()
        Gadget(GadgetCount) = New ListBox
        HoldTB = Gadget(GadgetCount)
        HoldTB.Top = -1000
        HoldTB.Left = -1000
        HoldTB.SuspendLayout()
        HoldTB.Show()
        HoldTB.Visible = False
        If parent &lt;&gt; 0 Then HoldTB.Parent = Gadget(parent)
        HoldTB.ClientSize = New System.Drawing.Size(W, H)
        HoldTB.Name = CStr(GadgetCount)
        HoldTB.Visible = True
        HoldTB.Top = Y
        HoldTB.Left = X
        AddHandler HoldTB.SelectedIndexChanged, AddressOf MyListChanged
        AddHandler HoldTB.MouseEnter, AddressOf MyMouseIn
        AddHandler HoldTB.MouseLeave, AddressOf MyMouseOut
        AddHandler HoldTB.MouseMove, AddressOf MyMouseMove
        AddHandler HoldTB.KeyDown, AddressOf MyKeyDown
        AddHandler HoldTB.KeyUp, AddressOf MyKeyUP
        AddHandler HoldTB.KeyPress, AddressOf MyKeyPress
        AddHandler HoldTB.Click, AddressOf MyClick
        AddHandler HoldTB.DoubleClick, AddressOf MyDoubleClick
        HoldTB.ResumeLayout()
        Return GadgetCount
    End Function

    Shared Function AddCheckListBox(ByVal X As Integer, ByVal Y As Integer, ByVal W As Integer, ByVal H As Integer, ByVal parent As Integer) As Integer
        Dim HoldTB As CheckedListBox
        GadgetCount = FreeG()
        Gadget(GadgetCount) = New CheckedListBox
        HoldTB = Gadget(GadgetCount)
        HoldTB.Top = -1000
        HoldTB.Left = -1000
        HoldTB.SuspendLayout()
        HoldTB.Show()
        HoldTB.Visible = False
        If parent &lt;&gt; 0 Then HoldTB.Parent = Gadget(parent)
        HoldTB.ClientSize = New System.Drawing.Size(W, H)
        HoldTB.Name = CStr(GadgetCount)
        HoldTB.Visible = True
        HoldTB.Top = Y
        HoldTB.Left = X
        AddHandler HoldTB.SelectedIndexChanged, AddressOf MyListChanged
        AddHandler HoldTB.MouseEnter, AddressOf MyMouseIn
        AddHandler HoldTB.MouseLeave, AddressOf MyMouseOut
        AddHandler HoldTB.MouseMove, AddressOf MyMouseMove
        AddHandler HoldTB.KeyDown, AddressOf MyKeyDown
        AddHandler HoldTB.KeyUp, AddressOf MyKeyUP
        AddHandler HoldTB.KeyPress, AddressOf MyKeyPress
        AddHandler HoldTB.Click, AddressOf MyClick
        AddHandler HoldTB.DoubleClick, AddressOf MyDoubleClick
        HoldTB.ResumeLayout()
        Return GadgetCount
    End Function
    Shared Sub DeleteGadget(ByVal g As Integer)
        If Gadget(g) Is Nothing Then Exit Sub
        Gadget(g).Dispose()
        Gadget(g) = Nothing
    End Sub
    Shared Sub SetGadgetTxt(ByVal gad As Integer, ByVal tex As String)
        Gadget(gad).Text = tex
    End Sub
    Shared Function GetGadgetTxt(ByVal gad As Integer) As String
        Return Gadget(gad).Text
    End Function
    Shared Function AddTextBox(ByVal tex As String, ByVal X As Integer, ByVal Y As Integer, ByVal W As Integer, ByVal H As Integer, ByVal parent As Integer, ByVal multi As Integer) As Integer
        Dim HoldTB As TextBox
        GadgetCount = FreeG()
        Gadget(GadgetCount) = New TextBox
        HoldTB = Gadget(GadgetCount)
        HoldTB.Top = -1000
        HoldTB.Left = -1000
        HoldTB.SuspendLayout()
        HoldTB.Show()
        HoldTB.Visible = False
        If parent &lt;&gt; 0 Then HoldTB.Parent = Gadget(parent)
        HoldTB.ClientSize = New System.Drawing.Size(W, H)
        HoldTB.Name = CStr(GadgetCount)
        HoldTB.Text = tex
        HoldTB.Multiline = multi
        HoldTB.Visible = True
        HoldTB.Top = Y
        HoldTB.Left = X
        AddHandler HoldTB.MouseEnter, AddressOf MyMouseIn
        AddHandler HoldTB.MouseLeave, AddressOf MyMouseOut
        AddHandler HoldTB.MouseMove, AddressOf MyMouseMove
        AddHandler HoldTB.KeyPress, AddressOf MyKeyPress
        AddHandler HoldTB.KeyDown, AddressOf MyKeyDown
        AddHandler HoldTB.KeyUp, AddressOf MyKeyUP
        AddHandler HoldTB.Click, AddressOf MyClick
        HoldTB.ResumeLayout()
        Return GadgetCount
    End Function
    Shared Function AddLabel(ByVal tex As String, ByVal X As Integer, ByVal Y As Integer, ByVal W As Integer, ByVal H As Integer, ByVal parent As Integer) As Integer
        Dim HoldTB As Label
        GadgetCount = FreeG()
        Gadget(GadgetCount) = New Label
        HoldTB = Gadget(GadgetCount)
        HoldTB.Top = -1000
        HoldTB.Left = -1000
        HoldTB.SuspendLayout()
        HoldTB.Show()
        HoldTB.Visible = False
        If parent &lt;&gt; 0 Then HoldTB.Parent = Gadget(parent)
        HoldTB.ClientSize = New System.Drawing.Size(W, H)
        HoldTB.Name = CStr(GadgetCount)
        HoldTB.Text = tex
        HoldTB.Visible = True
        HoldTB.Top = Y
        HoldTB.Left = X
        HoldTB.FlatStyle = FlatStyle.System
        HoldTB.ResumeLayout()
        AddHandler HoldTB.MouseEnter, AddressOf MyMouseIn
        AddHandler HoldTB.MouseLeave, AddressOf MyMouseOut
        AddHandler HoldTB.MouseMove, AddressOf MyMouseMove
        AddHandler HoldTB.KeyDown, AddressOf MyKeyDown
        AddHandler HoldTB.KeyUp, AddressOf MyKeyUP
        AddHandler HoldTB.KeyPress, AddressOf MyKeyPress
        AddHandler HoldTB.Click, AddressOf MyClick
        AddHandler HoldTB.DoubleClick, AddressOf MyDoubleClick
        Return GadgetCount
    End Function
    Shared Function AddButton(ByVal tex As String, ByVal X As Integer, ByVal Y As Integer, ByVal W As Integer, ByVal H As Integer, ByVal parent As Integer) As Integer
        Dim HoldTB As Button
        GadgetCount = FreeG()
        Gadget(GadgetCount) = New Button
        HoldTB = Gadget(GadgetCount)
        HoldTB.Top = -1000
        HoldTB.Left = -1000
        HoldTB.SuspendLayout()
        HoldTB.Show()
        HoldTB.Visible = False
        If parent &lt;&gt; 0 Then HoldTB.Parent = Gadget(parent)
        HoldTB.ClientSize = New System.Drawing.Size(W, H)
        HoldTB.Name = CStr(GadgetCount)
        HoldTB.Text = tex
        HoldTB.Visible = True
        HoldTB.Top = Y
        HoldTB.Left = X
        HoldTB.FlatStyle = FlatStyle.System
        HoldTB.ResumeLayout()
        AddHandler HoldTB.MouseEnter, AddressOf MyMouseIn
        AddHandler HoldTB.MouseLeave, AddressOf MyMouseOut
        AddHandler HoldTB.MouseMove, AddressOf MyMouseMove
        AddHandler HoldTB.KeyDown, AddressOf MyKeyDown
        AddHandler HoldTB.KeyUp, AddressOf MyKeyUP
        AddHandler HoldTB.KeyPress, AddressOf MyKeyPress
        AddHandler HoldTB.Click, AddressOf MyClick
        Return GadgetCount
    End Function
    Shared Function AddCheckBox(ByVal tex As String, ByVal X As Integer, ByVal Y As Integer, ByVal W As Integer, ByVal H As Integer, ByVal parent As Integer) As Integer
        Dim HoldTB As CheckBox
        GadgetCount = FreeG()
        Gadget(GadgetCount) = New CheckBox
        HoldTB = Gadget(GadgetCount)
        HoldTB.Top = -1000
        HoldTB.Left = -1000
        HoldTB.SuspendLayout()
        HoldTB.Show()
        HoldTB.Visible = False
        If parent &lt;&gt; 0 Then HoldTB.Parent = Gadget(parent)
        HoldTB.ClientSize = New System.Drawing.Size(W, H)
        HoldTB.Name = CStr(GadgetCount)
        HoldTB.Text = tex
        HoldTB.Visible = True
        HoldTB.Top = Y
        HoldTB.Left = X
        AddHandler HoldTB.MouseEnter, AddressOf MyMouseIn
        AddHandler HoldTB.MouseLeave, AddressOf MyMouseOut
        AddHandler HoldTB.MouseMove, AddressOf MyMouseMove
        AddHandler HoldTB.KeyDown, AddressOf MyKeyDown
        AddHandler HoldTB.KeyUp, AddressOf MyKeyUP
        AddHandler HoldTB.KeyPress, AddressOf MyKeyPress
        AddHandler HoldTB.CheckStateChanged, AddressOf MyClick
        HoldTB.ResumeLayout()
        Return GadgetCount
    End Function
    Shared Function AddGroupBox(ByVal tex As String, ByVal X As Integer, ByVal Y As Integer, ByVal W As Integer, ByVal H As Integer, ByVal parent As Integer) As Integer
        Dim HoldTB As GroupBox
        GadgetCount = FreeG()
        Gadget(GadgetCount) = New GroupBox
        HoldTB = Gadget(GadgetCount)
        HoldTB.Top = -1000
        HoldTB.Left = -1000
        HoldTB.SuspendLayout()
        HoldTB.Show()
        HoldTB.Visible = False
        If parent &lt;&gt; 0 Then HoldTB.Parent = Gadget(parent)
        HoldTB.ClientSize = New System.Drawing.Size(W, H)
        HoldTB.Name = CStr(GadgetCount)
        HoldTB.Text = tex
        HoldTB.Visible = True
        HoldTB.Top = Y
        HoldTB.Left = X
        HoldTB.FlatStyle = FlatStyle.System
        AddHandler HoldTB.MouseEnter, AddressOf MyMouseIn
        AddHandler HoldTB.MouseLeave, AddressOf MyMouseOut
        AddHandler HoldTB.MouseMove, AddressOf MyMouseMove
        AddHandler HoldTB.KeyDown, AddressOf MyKeyDown
        AddHandler HoldTB.KeyUp, AddressOf MyKeyUP
        AddHandler HoldTB.KeyPress, AddressOf MyKeyPress
        HoldTB.ResumeLayout()
        Return GadgetCount
    End Function
    Shared Function AddImageBox(ByVal img As String, ByVal mode As Integer, ByVal X As Integer, ByVal Y As Integer, ByVal W As Integer, ByVal H As Integer, ByVal parent As Integer) As Integer
        Dim HoldTB As PictureBox
        GadgetCount = FreeG()
        Gadget(GadgetCount) = New PictureBox
        HoldTB = Gadget(GadgetCount)
        HoldTB.Top = -1000
        HoldTB.Left = -1000
        HoldTB.SuspendLayout()
        HoldTB.Show()
        HoldTB.Visible = False
        If parent &lt;&gt; 0 Then HoldTB.Parent = Gadget(parent)
        HoldTB.ClientSize = New System.Drawing.Size(W, H)
        HoldTB.Name = CStr(GadgetCount)
        HoldTB.Visible = True
        HoldTB.Top = Y
        HoldTB.Left = X
        If img &lt;&gt; "" Then
            If Dir(img) &lt;&gt; "" Then
                HoldTB.Image = New Bitmap(img)
            End If
        End If
        HoldTB.SizeMode = mode
        AddHandler HoldTB.MouseEnter, AddressOf MyMouseIn
        AddHandler HoldTB.MouseLeave, AddressOf MyMouseOut
        AddHandler HoldTB.MouseMove, AddressOf MyMouseMove
        AddHandler HoldTB.KeyDown, AddressOf MyKeyDown
        AddHandler HoldTB.KeyUp, AddressOf MyKeyUP
        AddHandler HoldTB.KeyPress, AddressOf MyKeyPress
        AddHandler HoldTB.Click, AddressOf MyClick
        AddHandler HoldTB.DoubleClick, AddressOf MyDoubleClick
        AddHandler HoldTB.Paint, AddressOf MyPaint
        AddHandler HoldTB.MouseDown, AddressOf MyMouseDown
        AddHandler HoldTB.MouseUp, AddressOf MyMouseup
        HoldTB.ResumeLayout()
        Return GadgetCount
    End Function
    Shared Function Repaint(ByVal gad As Integer) As Integer
        Dim i As Integer
        i = stat(gad).repaintme
        stat(gad).repaintme = 0
        Return i
    End Function
    Shared Sub MyPaint(ByVal sender As Object, ByVal e As System.Windows.Forms.PaintEventArgs) '.
        stat(CInt(Val(sender.Name))).repaintme = 1
    End Sub

    Shared Function AddPanel(ByVal X As Integer, ByVal Y As Integer, ByVal W As Integer, ByVal H As Integer, ByVal parent As Integer) As Integer
        Dim HoldTB As Panel
        GadgetCount = FreeG()
        Gadget(GadgetCount) = New Panel
        HoldTB = Gadget(GadgetCount)
        HoldTB.Top = -1000
        HoldTB.Left = -1000
        HoldTB.SuspendLayout()
        HoldTB.Show()
        HoldTB.Visible = False
        If parent &lt;&gt; 0 Then HoldTB.Parent = Gadget(parent)
        HoldTB.ClientSize = New System.Drawing.Size(W, H)
        HoldTB.Name = CStr(GadgetCount)
        HoldTB.Visible = True
        HoldTB.Top = Y
        HoldTB.Left = X
        AddHandler HoldTB.MouseEnter, AddressOf MyMouseIn
        AddHandler HoldTB.MouseLeave, AddressOf MyMouseOut
        AddHandler HoldTB.MouseMove, AddressOf MyMouseMove
        AddHandler HoldTB.KeyDown, AddressOf MyKeyDown
        AddHandler HoldTB.KeyUp, AddressOf MyKeyUP
        AddHandler HoldTB.KeyPress, AddressOf MyKeyPress
        AddHandler HoldTB.Click, AddressOf MyClick
        AddHandler HoldTB.DoubleClick, AddressOf MyDoubleClick
        HoldTB.ResumeLayout()
        Return GadgetCount
    End Function

    Shared Function AddDropDown(ByVal X As Integer, ByVal Y As Integer, ByVal W As Integer, ByVal H As Integer, ByVal parent As Integer) As Integer
        Dim HoldTB As ComboBox
        GadgetCount = FreeG()
        Gadget(GadgetCount) = New ComboBox
        HoldTB = Gadget(GadgetCount)
        HoldTB.Top = -1000
        HoldTB.Left = -1000
        HoldTB.SuspendLayout()
        HoldTB.Show()
        HoldTB.Visible = False
        If parent &lt;&gt; 0 Then HoldTB.Parent = Gadget(parent)
        HoldTB.ClientSize = New System.Drawing.Size(W, H)
        HoldTB.Name = CStr(GadgetCount)
        HoldTB.Visible = True
        HoldTB.Top = Y
        HoldTB.Left = X
        HoldTB.DropDownStyle = ComboBoxStyle.DropDownList
        HoldTB.ResumeLayout()
        AddHandler HoldTB.MouseEnter, AddressOf MyMouseIn
        AddHandler HoldTB.MouseLeave, AddressOf MyMouseOut
        AddHandler HoldTB.MouseMove, AddressOf MyMouseMove
        AddHandler HoldTB.KeyDown, AddressOf MyKeyDown
        AddHandler HoldTB.KeyUp, AddressOf MyKeyUP
        AddHandler HoldTB.KeyPress, AddressOf MyKeyPress
        AddHandler HoldTB.Click, AddressOf MyClick
        AddHandler HoldTB.DoubleClick, AddressOf MyDoubleClick
        AddHandler HoldTB.SelectedIndexChanged, AddressOf MyListChanged
        Return GadgetCount
    End Function
    Shared Function AddSplitter(ByVal X As Integer, ByVal Y As Integer, ByVal W As Integer, ByVal H As Integer, ByVal parent As Integer) As Integer
        Dim HoldTB As Splitter
        GadgetCount = FreeG()
        Gadget(GadgetCount) = New Splitter
        HoldTB = Gadget(GadgetCount)
        HoldTB.SuspendLayout()
        HoldTB.ClientSize = New System.Drawing.Size(W, H)
        HoldTB.Location = New System.Drawing.Point(X, Y)
        HoldTB.Show()
        If parent &lt;&gt; 0 Then HoldTB.Parent = Gadget(parent)
        HoldTB.Name = CStr(GadgetCount)
        HoldTB.Visible = True
        HoldTB.ResumeLayout()
        AddHandler HoldTB.MouseEnter, AddressOf MyMouseIn
        AddHandler HoldTB.MouseLeave, AddressOf MyMouseOut
        AddHandler HoldTB.MouseMove, AddressOf MyMouseMove
        AddHandler HoldTB.KeyDown, AddressOf MyKeyDown
        AddHandler HoldTB.KeyUp, AddressOf MyKeyUP
        AddHandler HoldTB.KeyPress, AddressOf MyKeyPress
        AddHandler HoldTB.Click, AddressOf MyClick
        AddHandler HoldTB.DoubleClick, AddressOf MyDoubleClick
        Return GadgetCount
    End Function

    Shared Function AddMainMenu(ByVal parent As Integer) As Integer
        Dim HoldTB As MyMainMenu
        Dim ParForm As Form
        GadgetCount = FreeG()
        Gadget(GadgetCount) = New MyMainMenu
        HoldTB = Gadget(GadgetCount)
        HoldTB.Name = CStr(GadgetCount)
        ParForm = Gadget(parent)
        ParForm.Menu = HoldTB
        Return GadgetCount
    End Function

    Shared Function AddContextMenu(ByVal parent As Integer) As Integer
        Dim HoldTB As MyContextMenu
        Dim ParForm As Control
        GadgetCount = FreeG()
        Gadget(GadgetCount) = New MyContextMenu
        HoldTB = Gadget(GadgetCount)
        HoldTB.Name = CStr(GadgetCount)
        ParForm = Gadget(parent)
        ParForm.ContextMenu = HoldTB
        Return GadgetCount
    End Function

    Shared Function AddMenuItem(ByVal txt As String, ByVal parent As Integer) As Integer
        Dim HoldTB As MyMenuItem
        Dim parmen As Menu
        GadgetCount = FreeG()
        Gadget(GadgetCount) = New MyMenuItem
        HoldTB = Gadget(GadgetCount)
        HoldTB.Name = CStr(GadgetCount)
        HoldTB.Text = txt
        parmen = Gadget(parent)
        parmen.MenuItems.Add(HoldTB)
        AddHandler HoldTB.Click, AddressOf MyClick
        AddHandler HoldTB.Popup, AddressOf MyClick
        Return GadgetCount
    End Function

    Shared Function OpenFileDialog(ByVal Caption As String, ByVal InitialPath As String, ByVal Filter As String) As String
        Dim FileDial As New OpenFileDialog
        FileDial.Title = Caption
        FileDial.InitialDirectory = InitialPath
        FileDial.Filter = Filter
        FileDial.RestoreDirectory = True
        FileDial.ShowDialog()
        Return FileDial.FileName
    End Function

    Shared Function SaveFileDialog(ByVal Caption As String, ByVal InitialPath As String, ByVal Filter As String) As String
        Dim FileDial As New SaveFileDialog
        FileDial.Title = Caption
        FileDial.InitialDirectory = InitialPath
        FileDial.Filter = Filter
        FileDial.RestoreDirectory = True
        FileDial.ShowDialog()
        Return FileDial.FileName
    End Function
    Shared Function BrowseFolderDialog(ByVal Caption As String, ByVal InitialPath As String) As String
        Dim FileDial As New FolderBrowserDialog
        FileDial.Description = Caption
        FileDial.SelectedPath = InitialPath
        FileDial.ShowNewFolderButton = True
        FileDial.ShowDialog()
        Application.DoEvents()
        Return FileDial.SelectedPath
    End Function

End Class
</textarea><br><br>and a short BlitzPlus program to do the conversion of the DLL into a standard Blitzable DLL:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Dim meth$(1000)

If CommandLine$()="" Then
	file$ = ExecuteOpendialog("Select .NET DLL to Convert","","","Dynamic Link Libraries|*.DLL|All Files|*.*")
Else
	file$ = CommandLine$()
EndIf
If file$="" Then End

ChangeDir("C:\NetProjects\DLLTEST\")

ExecFile ("ILDASM.EXE /OUT:MYIL.IL "+file$)

Delay 1000

parseIL()

;ExecFile ("ILASM.EXE /OUT:"+file$+" MYIL2.IL /DLL")

ExecFile ("ILASM.EXE /OUT:TeraGUI.DLL MYIL2.IL /DLL")
Notify ""
CopyFile "C:\NetProjects\DLLTEST\TeraGUI.DLL","C:\MaxProjects\TeraGUI\TeraGUI.DLL"
End

Function ParseIL()

rd = ReadFile("MYIL.IL")
If rd = 0 Then End

While Eof(rd)=False

in$ = ReadLine$(rd)
det$ = Upper$(Trim$(in$))

If Left$(det$,7)=".METHOD" Then
If getname$(in$)&lt;&gt;"" Then
	methodcount = methodcount + 1
	meth$(methodcount)=GetName$(in$)
	;Notify "Method: "+methodcount+" - "+GetName$(in$)
EndIf
EndIf

Wend
CloseFile rd

rd = ReadFile("MYIL.IL")
If rd = 0 Then End

wt = WriteFile("MYIL2.IL")

While Eof(rd)=False

Pass = 0

in$ = ReadLine$(rd)
det$ = Upper$(Trim$(in$))

If det$=".CORFLAGS 0X00000001" Then
	WriteLine wt,".corflags 0x00000002"
    For mct = 1 To methodcount
		WriteLine wt,".vtfixup [1] int32 fromunmanaged at VT_"+mct
	Next

    For mct = 1 To methodcount
		WriteLine wt,".data VT_"+mct+" = int32(0)"
	Next
	Pass = 1
EndIf


If Left$(det$,7)=".METHOD" Then
	If getname$(in$)&lt;&gt;"" Then
		mcount = mcount + 1
		dname$ = GetName$(in$)
		
		WriteLine wt,in$
		
		Repeat
		og$ = Trim$(ReadLine$(rd))
		If og$&lt;&gt;"{" Then WriteLine wt, String$(" ",Instr(in$,"("))+og$
		Until og$="{"
		

		
		WriteLine wt,"{"
		WriteLine wt,".vtentry "+mcount+" : 1" ;mcount
		WriteLine wt,".export ["+mcount+"] as "+dname$
		ReadLine$(rd)
		pass = 1
	EndIf
EndIf

If pass = 0 Then WriteLine wt,in$


Wend

CloseFile rd
CloseFile wt

End Function


Function GetName$(my$)
ept = Instr(my$,"(")-1
For a = ept To 1 Step -1
If Mid$(my$,a,1)=" " Then Return Mid$(my$,a+1,ept-a)
Next
Return ""

End Function
</textarea><br><br>It's a bit rough around the edges, but it does the job. <br><br></td></tr></table><br>
<a name="523653"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JPL</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Really good job Lee, Thanks a lot. <br><br></td></tr></table><br>
<a name="525060"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >demonsource</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> terabit, this is a very practical solution<br><br>i like it, but it is not the way for me<br><br>i have explored another way, with some managed c++ and explicit/dynamic loading of libraries upon the windows platform<br><br>understanding why it works is arcane (ms proprietary)<br>but programmers who understand what they are using, why and how it works are cool (any kids around?)<br><br>by the way, my prototype was for purebasic, i did not recompile for bmx<br><br>i am not an expert at blitzmax but have enough brains to be an owner of this software<br><br>i have done some benchmarks of bmx against others (using the "framework" statement to limit and compare exe size) and am impressed <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
