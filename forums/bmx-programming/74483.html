<!DOCTYPE html><html lang="en" ><head ><title >Mac: Why can't data be found when it's in a .dmg?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Mac: Why can't data be found when it's in a .dmg?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Mac: Why can't data be found when it's in a .dmg?</a><br><br>
<a name="832023"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hiya.  I recently altered my AOTMG game demo so that I've put all the data in the app folder (specifically in Contents/Resources).  This means that I can distribute a .dmg with what appears to be a single file in it that users can drag onto their Macs and run.  This works fine.  <br><br>However, if you click the game INSIDE the compressed dmg it does not run because it can't find the data properly (one of my own error messages says it can't load the bitmap at AOTMG.app/Contents/Resources/Data/PortalLogo.jpg)  This is weird. I'm not a Mac expert (at all) so does anyone know why it runs on the desktop but not in the DMG.  Is it something to do with the DMG being compressed or just tat apps in a dmg can't query their own path?  Or maybe I'm doing something wrtong with my code.  Thanks!<br>  <br>Test app here:<br><br>Intel Mac Only: <a href="http://www.greyaliengames.com/aotmg/AOTMG045D.dmg" target="_blank">http://www.greyaliengames.com/aotmg/AOTMG045D.dmg</a> (5Mb ish)<br><br>You'll notice that the test app has some other improvements:  All dynamic data is written to Users/Shared and also the mouse cursor now moves smoothly in and out of the window in windowed mode.  This is compiled with BMax 1.28 so the full-screen/windowed mode changing no longer corrupts the graphics.  Also it has a proper Mac icon.  It's basically got all the techie stuff I want in a professional Mac game now although I still want to get a minimise icon in windowed mode and work out how to set the desktop wallpaper. <br><br></td></tr></table><br>
<a name="832053"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >unlikely</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm not sure exactly what the problem is, as I am able to run the game from the mounted disk image (.dmg) straight away without "copying" to my hard drive. <br><br></td></tr></table><br>
<a name="832054"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JazzieB</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've just tested it and it works just fine!  I downloaded the file, double-clicked the file to mount it and ran it from the mounted disk.  Worked without any problems.<br><br>Not really sure what to suggest. <br><br></td></tr></table><br>
<a name="832058"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh, well it's supposed to work fine :-) so that's good news. But it doesn't work when I double click it on my Macbook pro inside the mounted disk.  How strange! <br><br></td></tr></table><br>
<a name="832060"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >unlikely</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, I'm still on Tiger and it looks as if JazzieB is too. I don't know if that has anything to do with it... <br><br></td></tr></table><br>
<a name="832067"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> could be a problem on my end due to my ini file. Will look into it.  Hey if you go into users/shared/grey alien games/aotmg/aotmg.ini and change PORTAL SPLASH= from 0 to 1, does it still run in the dmg?  It doesn't on mine.  It's also true that the file it's looking for doesn't exist, however I have code in place to look for a png first and if that fails to look for a jpg so it's weird!... <br><br></td></tr></table><br>
<a name="832071"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >unlikely</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I get the error message where is says that it can't load the bitmap at AOTMG.app/Contents/Resources/Data/portallogo.jpg...<br><br>It seems like it's not properly looking for the .png I guess. <br><br></td></tr></table><br>
<a name="832080"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm found out something odd.  I'm doing this:<br><br>- Using disk utlity I make a 10Mb disk image called AOTMG045D.<br>- I open it by double clicking it and it mounts a new volume.<br>- I place my working app in that.<br>- If I run it in there it runs fine.<br>- back in disk utility I select the AOTMG045D dmg and make a compressed one with the same name but it won't let me as it says it's in use (even if I eject the disk first).  So I have to enter another name like AOTMG045D_2<br>- When I open the compressed dmg it mounts a volume with the ORIGNAL dmg name i.e. AOTMG045D.  This is strange...<br>- Then when I go into the mounted volume and run the app, it fails to load that PortalLogo.jpg file!<br>- However, if I drag the app out it's fine.<br>- What is going on?  I'm confused now.<br><br>Did some more tests and if I simply make a copy of the first disk image, I can run the app OK in there.  So it must be something with the compressed one but crap knows what... <br><br></td></tr></table><br>
<a name="832082"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> ChromeFly: Thanks for testing.  Yeah it's weird as I know the code that looks for the png works as you can see by dragging the app onto the desktop.  All I do is this:<br><br><pre class=code>
	'try a png and if that doesn't exist, try a jpg.
	If ccFileExists(prefix+"data/portallogo.png") Then
		splash.Init(prefix+""data/portallogo.png")
	Else
		splash.Init(prefix+""data/portallogo.jpg")
	EndIf
[code]

Where ccFileExists is this:

[code]
' -----------------------------------------------------------------------------
' ccFileExists: See if a file exists or not
' -----------------------------------------------------------------------------
Function ccFileExists%(filename$)
	Local file:TStream=OpenFile(filename)
	If file Then
		CloseStream file
		Return 1
	Else
		Return 0
	EndIf
End Function
</pre> <br><br></td></tr></table><br>
<a name="832088"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Doesn't FileType(filename) return 0 when a file doesn't exist?<br><br>Or is it better to try to open a stream instead? <br><br></td></tr></table><br>
<a name="832092"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TMK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh yes, I think Brucey is right. I had the same problem, for some reason OpenFile didn't work when I ran it from a mounted DMG, so I had to use FileType to check for existing files instead. <br><br></td></tr></table><br>
<a name="832093"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Aha good tip! in fact GREAT tip.  testing now thx! <br><br></td></tr></table><br>
<a name="832110"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Did you try to use OpenFile but set Write to false.<br><br>Would assume that it fails otherwise as it should not be able to write straight to the DMG. (readfile would be the "straight" solution :) ) <br><br></td></tr></table><br>
<a name="832116"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep I suddently realised that when it was pointed out as OpenFile must request read/write access by default.  Anyway this fix will be in the next framework update. <br><br></td></tr></table><br>
<a name="832117"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just to confirm this was indeed the problem. <br><br></td></tr></table><br>
<a name="832123"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JazzieB</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh yes, I remember having a similar problem when testing something else (between accounts I think).  Suddenly realised that I had one of my functions using OpenFile when all I wanted to do was read the file only.<br><br>We probably all tested under an admin account, which might not exhibit the problem you were having if you were testing under a different type of account. <br><br></td></tr></table><br>
<a name="832744"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tricky</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> You were speaking on a compressed .dmg file right?<br>I see that you used "OpenFile"....<br><br>Both "OpenFile" and "OpenStream" can be allergic to Read-Only environments which compressed .dmg files fall under.<br><br>Could you try the same thing in an uncompressed .dmg file and see if it still happens.... <br><br></td></tr></table><br>
<a name="832797"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> yes it worked in an uncompressed one.  It's the readonly thing that failed due to OpenStream. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
