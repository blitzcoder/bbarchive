<!DOCTYPE html><html lang="en" ><head ><title >Can BlitzMax call a function from a pointer?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Can BlitzMax call a function from a pointer?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Can BlitzMax call a function from a pointer?</a><br><br>
<a name="624390"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> If I get an address to an external function with wglGetProcAddress, can BlitzMax then call that function, and pass an arbitrary number of parameters onto it? <br><br></td></tr></table><br>
<a name="624411"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Turn the address into a Byte Pointer<br><br>Turn the Byte Pointer into a Function Pointer, ie Local myfptr()=Byte Ptr(functionaddress)<br><br>Set up your function pointer so that it has the same parameters as that function you want to call e.g. Local myfptr(param1:Int,param2:Float)=Byte Ptr(functionaddress)<br><br>Then call your function pointer() <br><br></td></tr></table><br>
<a name="624648"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think it works.<br><br>Declare an OpenGL function to get the pointer to an extension function:<br><pre class=code>Extern "Win32"
Function wglGetProcAddress:Byte Ptr(lpszProc$z)
EndExtern</pre><br>Get the pointer to the GL extension function:<br><pre class=code>Local POINTER_wglSwapInterval : Byte Ptr
POINTER_wglSwapInterval=wglGetProcAddress("wglSwapIntervalEXT")</pre><br>Declare a function out of the pointer:<br><pre class=code>Local wglSwapInterval(interval)=Byte Ptr(POINTER_wglSwapInterval)
wglSwapInterval 0</pre><br>Should the function be declared global so that I can use it anywhere? <br><br></td></tr></table><br>
<a name="624683"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> up to you <br><br></td></tr></table><br>
<a name="624715"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> But it has to be global in order to be called anywhere?  The BlitzMax method of calling functions is even better than PureBasic. <br><br></td></tr></table><br>
<a name="625181"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Damn.  If I don't build in debug mode I get an unhandled memory exception error when I try to call the function.  The pointer is valid, and I can call the function when running in debug mode, and I can see the effect.  If it's not in debug mode, it crashes.<br><pre class=code>Building test
Compiling:test.bmx
flat assembler  version 1.64
3 passes, 13288 bytes.
Linking:test.exe
Executing:test.exe
Unhandled Memory Exception Error
Process complete</pre> <br><br></td></tr></table><br>
<a name="625188"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> You probably need to specify the "win32" calling convention on the pointer, or else when calling through the function pointer the wrong calling convention is used, and the stack is not cleaned up properly.<br>Something like that is worth a try, and is very likely to correct your problem:<pre class=code>Local wglSwapInterval(interval) "win32" = Byte Ptr(POINTER_wglSwapInterval)</pre> <br><br></td></tr></table><br>
<a name="625193"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> That did it.<br><br>I actually have the function declared globally, so I just have to set it up once:<br><br><pre class=code>Global wglSwapInterval:Int(interval) "Win32"</pre><br><br>Thanks! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
