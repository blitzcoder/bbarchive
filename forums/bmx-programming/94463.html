<!DOCTYPE html><html lang="en" ><head ><title >Using Grabimage to make a Mirror</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Using Grabimage to make a Mirror</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Using Grabimage to make a Mirror</a><br><br>
<a name="1083725"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rico</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi i made a mirror in my 2D platform game by using grabimage to grab the area in front of the mirror and then using DrawImage and flipping the image to superimpose this image over the mirror sprite. This works fine but seems to slow the program a bit. i presume it's because it is doing grabimage every frame. is there a faster way of doing this at all? Thank you :) <br><br></td></tr></table><br>
<a name="1083726"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> To draw everything upside down:<br><pre class=code>SetScale 1,-1</pre> <br><br></td></tr></table><br>
<a name="1083733"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rico</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> thank you, yes i was doing that to flip the image though i was doing it horizontally (its a side on mirror) . i realise now though  that i have to flip any of the graphics drawn by the mirror and draw and confine them to the mirror rectangle.  its a bit annoying because i have to do it for any sprites than move near it, whereas before with grabimage it was so easy! oh well lol <br><br></td></tr></table><br>
<a name="1083747"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rico</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> btw is there a command to copy a section of the screen to another place on the screen? <br><br></td></tr></table><br>
<a name="1083749"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rico</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok well i tried it using grabpixmap but that slowed things as much as grabimage :( <br><br></td></tr></table><br>
<a name="1083753"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rico</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I did a speed test and it takes about 40 milliseconds to do grabimage or grabpixmap. but only 1 millisec to draw the image. should it be this slow? <br><br></td></tr></table><br>
<a name="1083766"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> If there's that much difference then you should stick to rendering everything twice but in a flipped fashion the second time. Then you can mask this content or frame it so it looks like a reflection from a mirror, draw a border around it etc. <br><br></td></tr></table><br>
<a name="1083827"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rico</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks Kryzon, yes that is what i was planning to do. i was going to clip the images using set viewport so it stays within the mirror. its a lot more work though, writing code to do it for every enemy and the main character and also the background. . i wish there was a fast grabimage command. think it would be very useful! <br><br></td></tr></table><br>
<a name="1083850"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> The reason it's slow is because it's getting data from the video card and video cards are optimized for SENDING data to them obviously, not the other way round.  Back in BlitzPlus days a whole screen grab image could take 300ms or more. <br><br></td></tr></table><br>
<a name="1083991"></a>

<a name="1083992"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rico</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> ah ok thanks Grey Alien, i think i just worked out that there are 16.6 millisconds in one frame (my game runs at 60 fps). so you can see why grabimage is far from usable, i was only grabbing a 72 by 143 pixels rectangle as well . it seems far too slow still even taking into account what you said. (considering the power of modern day PCs)<br><br>i used to have an Amiga (a very slow computer compared to a modern PC) and you could use the blitter to moves sections of the screen about for scrolling etc. im sure most PC graphics cards have blitters in them. can i use the blitter in my gfx card somehow (via Blitz)?<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1083996"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> i realise now though that i have to flip any of the graphics drawn by the mirror and draw and confine them to the mirror rectangle <br></div><br><br>What about the SetViewPort command?<br><br>If that doesnt help my GLmax2d module has fast grab image<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=2612" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=2612</a> <br><br></td></tr></table><br>
<a name="1084023"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Actually moderns graphics systems don't use a blitter as such. The whole concept of what is displayed is actually wildly different than back in the day. Blitz does a wonderful job of disguising it all so you can think about things in the "classic" way, but hardware acceleration is where it all happens and you just can't apply that tech to a straight blitter... It used be back in the day there was memory, and the display buffer, and the back buffer. you got to play with all of them. Now there's memory and a troll under a bridge known as a GPU... you feed it things it likes and close your eyes :0)<br><br>With the power of modern systems, combined with their very refined data paths (basically OUT and that's it for graphics it's usually much faster to repeat yourself a lot (draw things a large number of times) rather than try to change the flow (get anything back from the graphics system). <br><br></td></tr></table><br>
<a name="1084041"></a>

<a name="1084043"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rico</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks slenkar yes i decided to use set viewport. i got my mirror working fine, though i havent done it for all the bad guys yet, just the main characater and the background so far. i like the sound of your faster grabimage, what do i have to do to get it running in my game? do i just have to copy your function code into it?<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1084042"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rico</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks for the info ima747. i just remember in the old blitz you used to be able to find out if the blitter was available in some of the graphics modes, so i assumed it was still active. but yes brute force output will have to be the order of the day :) <br><br></td></tr></table><br>
<a name="1084073"></a>

<a name="1084074"></a>

<a name="1084075"></a>

<a name="1084076"></a>

<a name="1084077"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> yw<br><br>EDIT- you could try just copying the function over :)<br>Function GrabImage:TImage(x,y,width,height)<br>	Local i:TImage=CreateImage(width,height)<br>	glBindTexture GL_TEXTURE_2D,i.name<br>	glCopyTexSubImage2D GL_TEXTURE_2D,0,0,0,x,GraphicsHeight()-i.height-y,width,height<br>	Return i<br>End Function<br><br><br>or if that doesnt work:<br><br>to use the module I made just copy the source code to <br>mods/keef/gldraw/gldraw.bmx<br><br>theres collision and bitmap font code in the same code archive too<br><br>the commands are the same as the normal drawing commands<br>its a total replacement for the graphics driver so you dont have to use<br>SetGraphicsDriver<br><br>you will have to use the FrameWork command so my functions dont clash with the official glmax2d<br><br><font class="tiny">Last edited 2011</font><br><br><font class="tiny">Last edited 2011</font><br><br><font class="tiny">Last edited 2011</font><br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1084343"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rico</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Slenkar, i will give it a go. im not very good with that framework stuff haha so i hope it works.  but i have doen it before with Box2D. thanks for the help! :D <br><br></td></tr></table><br>
<a name="1084349"></a>

<a name="1084350"></a>

<a name="1084351"></a>

<a name="1084352"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here, just rustled this up as a possible approach for you to consider:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">SuperStrict

AppTitle$ = "Mirrorz"
Graphics 800,600,0

Local myMirror:TMirror = CreateMirror(250,200)
myMirror.Position(0,300)

TBubble.Init(60)

SetBlend ALPHABLEND

While Not ( KeyHit(KEY_ESCAPE) Or AppTerminate() )
	
	TBubble.UpdateAll()
	TBubble.DrawAll()
	
	myMirror.Position( MouseX(),MouseY() )
	myMirror.Update()
	myMirror.Draw()

	Flip -1
	Cls
Wend

Type TBubble
	Global list:TList = CreateList()
	
	Field x:Float
	Field y:Float
	Field xVel:Float
	Field yVel:Float
	Field r:Int
	Field g:Int
	Field b:Int
	Field size:Int 
	
	Function Init(count_arg:Int)
		For Local count:Int = 1 To count_arg
			Local newBubble:TBubble = New TBubble
			newBubble.x = Rnd(0,GraphicsWidth()-1)
			newBubble.y = Rnd(0,GraphicsHeight()-1)
			newBubble.xVel = Rnd(-2,2)
			newBubble.yVel = Rnd(-2,2)
			newBubble.r = Rand(100,250)
			newBubble.g = Rand(100,250)
			newBubble.b = Rand(100,250)
			newBubble.size = Rand(25,100)
			
			list.Addlast(newBubble)
		Next
	End Function
	
	Function UpdateAll()
		For Local currentBubble:TBubble = EachIn list
			currentBubble.Update()
		Next		
	End Function
	
	Method Update()
		x = x+xVel
		y = y+yVel
		If x&lt;(-size) x=x+GraphicsWidth()+size
		If x&gt;GraphicsWidth()-1 x=x-GraphicsWidth()-size
		If y&lt;(-size) y=y+GraphicsHeight()+size
		If y&gt;GraphicsHeight()-1 y=y-GraphicsHeight()-size		
	End Method
	
	Function DrawAll()
		For Local currentBubble:TBubble = EachIn list
			SetAlpha 1.0
			SetColor currentBubble.r,currentBubble.g,currentBubble.b
			DrawOval currentBubble.x,currentBubble.y,currentBubble.size,currentBubble.size
			
			SetAlpha 0.25
			SetColor 255,255,255
			DrawOval currentBubble.x+(currentBubble.size/5),currentBubble.y+(currentBubble.size/5),currentBubble.size/8,currentBubble.size/8			
		Next
	End Function
End Type

Type TMirror
	Field rows:TPixmap[]
	Field x:Int
	Field y:Int
	Field width:Int
	Field height:Int
	
	Function Make:TMirror(width_arg:Int, height_arg:Int)
		Local newMirror:TMirror = New TMirror
		newMirror.height = height_arg
		newMirror.width = width_arg
		newMirror.rows = New TPixmap[newMirror.height]
		
		Return newMirror
	End Function
	
	Method Position(x_arg:Int, y_arg:Int)
		x=x_arg
		y=y_arg
		
		If x&lt;0 x=0
		If x&gt;GraphicsWidth()-width x=GraphicsWidth()-width
		If y&lt;height y=height
		If y&gt;GraphicsHeight()-height y=GraphicsHeight()-height		
	End Method
	
	Method Update()
		For Local currentRow:Int = 0 To height-1
			rows[currentRow]= GrabPixmap(x,y-currentRow,width,1)	
		Next
	End Method
	
	Method Draw()
		SetColor 255,255,255
		SetAlpha 1.0
		DrawRect x-1,y-1,width+2,height+2
		For Local currentRow:Int = 0 To height-1
			DrawPixmap(rows[currentRow],x,y+currentRow)	
		Next
		SetAlpha 0.25
		SetColor 0,0,255
		DrawRect x,y,width,height
		SetAlpha 1.0		
	End Method
End Type

Function CreateMirror:TMirror(width_arg:Int, height_arg:Int)
	Return TMirror.Make(width_arg, height_arg)
End Function</textarea><br><br>I don't know why you're grabbing images instead of pixmaps. :D<br><br>EDIT: Added highlights and tint. Why not!<br><br>EDIT 2: Oh, pretty sure that the last time I did something like this I grabbed one big pixmap and rendered it in rows using DrawSubImageRect(), which *should* be faster than grabbing individual rows. But there you go, I was supposed to get my head down half an hour ago :D<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1086077"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rico</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks very much for that Sledge *thumbs up*, sorrry i thought the thread was finished so i didnt check back until now<br><br>i did try using Grab Pixmap but it was exatcly the same speed as GrabImage as far as i remmeber so i gave up. i didnt go any further looking into that.<br><br>thats a very nice program but it does run quite slowly on my computer. so i dont think i could use that approach in my game. does it run fast on yours? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
