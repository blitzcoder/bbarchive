<!DOCTYPE html><html lang="en" ><head ><title >Problem with powers</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Problem with powers</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Problem with powers</a><br><br>
<a name="698058"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ChristianK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have a little problem with powers.<br><br>x = 4<br>Print x^2<br><br>gives me a 15.999999999999998.<br>Have i done something wrong? <br><br></td></tr></table><br>
<a name="698062"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's quite odd!  Same result even if you declare X as an integer.<br><br>Print 4^2 gives the right result.  I appreciate this is a fairly useless reply.<br><br>[edit]<br><pre class=code>x:int = 4
y:int = x^2
print y</pre><br>15!  Heh! <br><br></td></tr></table><br>
<a name="698072"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd assume that ^ is a floating point operator, and automatically casts to float when you use it. This is probably why it's slow and people recommend avoiding it. <br><br></td></tr></table><br>
<a name="698092"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> ^ has 2 implementations, float and double.<br>If you don't declare the variables correctly and explicitely, it will most likely end with float (which is faster than double) which gives incorrect result.<br><br>Using x^2:double should give the correct result. <br><br></td></tr></table><br>
<a name="698104"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I only see one implementation of ^ and it is:<br><b>double bbFloatPow( double x,double y )</b><br>Which is in Blitz_cclib.c<br>You can prove it by putting:<br><b>printf("I am in bbFloatPow now!\n");<br>fflush(stdout);</b><br>into the function and recompiling.  You will see that no matter how it is cast, the one version is always called. <br><br></td></tr></table><br>
<a name="698124"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> It doesnt matter if dream is right about float and double, any whole number ^ 2 should give the right value<br><pre class=code>x:Float = 4.0 ^ 2.0
Print x</pre>Prints 16<pre class=code>x:Float = 4.0
Y:Float = x^2.0
Print y</pre>Prints 16<pre class=code>x:Float = 4.0
Print x^2.0</pre>Prints 15.999999999998<br>This is a bug with Print <br><br></td></tr></table><br>
<a name="698200"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, it's not a bug with print.  4.0^2.0 returns a double.  By doing x:float = 4.0 ^ 2.0, you are casting the double to a lower precision float, which happens to truncate the inacurate bits.  When you Print x^2.0, it is printing the entire Double result.  Try casting the result to float like this<br><pre class=code>x:Float = 4.0
Print Float(x^2.0)</pre><br>It now prints 16.<br><br>The problem is with the ^ opperator itself.  It doesn't distinguish the different types of variables passed to it, treating them all like doubles.  Then after some checks for range and negatives, it passes the parameters into the Log() and Exp() functions which take Doubles as parameters.  This will always create precision problems like with any floating point numbers. <br><br></td></tr></table><br>
<a name="698248"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Edited<br><br>Yep, your right. Thats bloody stupid. <br><br>I do not believe that pow 2 should ever be wrong on a power of 2<br><div class="quote"> which happens to truncate the inacurate bits <br></div><br>Im not saying you are wrong, but that is stupid. There shouldnt be inacurate bits if all the numbers are whole numbers within 2^16 of each other<br><br>Well there is no question of not using RoR for int  now is there <br><br></td></tr></table><br>
<a name="698343"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could change the brl.mod/blitz.mod/blitz_cclib.c to edit <b>bbFloatPow()</b> like this:<br><pre class=code>
double bbFloatPow( double x,double y ){
	return pow(x,y);
}</pre>Then rebuild.  It'll be a tad slower, but it will be more accurate. <br><br></td></tr></table><br>
<a name="698353"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I *HATE* floats...<br><pre class=code>
x:Float = 1.0
For loopy:Float = 0.0 To 1.1 Step 0.1
	y:Float = x - loopy
	Print y
Next
</pre><br>Don't care about floating point precision,  1.0 - 0.1 = 0.9<br>and that's final. <br><br></td></tr></table><br>
<a name="698354"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> @tonyg,<br><br>Thats a pain, but as I would expect that sort of behavior it wouldnt catch me out. This 4^2 tho is just stupid. <br><br></td></tr></table><br>
<a name="698414"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> It was mentioned <a href="/posts.php?topic=61954#693003" target="_blank"> here </a>.<br>I just hate floats. It seems to give an excuse to return the wrong result. <br><br></td></tr></table><br>
<a name="698429"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Uuuh yeah sure, its an excuse that 0.1 can't be represented precise enough with large scale values if float is used ...<br><br>Why don't you just use int if you are unabled to program calculation stable stuff with float? (you know, there is a whole 4 year study including Master just to learn how to do this and similar stuff avoiding floating point precision problems or even double precision problems) <br><br></td></tr></table><br>
<a name="698459"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Tonyg,<br><br>Tony that was my thread. (I did miss that ^2 didnt work right, other than when I would have expected it to not work right)<br><br>@Dream, yes, this time its a rubbish excuse. Surly you can see that in whole numbers, saying <i>Sorry float cannot represent powers of 2</i> is a very bad excuse <br><br></td></tr></table><br>
<a name="698467"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Uuuh yeah sure, its an excuse that 0.1 can't be represented precise enough with large scale values if float is used ...<br> <br></div><br>It's just 'wrong'. Calculators can do it, B3D can do it.<br>I don't give a stuff about any technical explanation. <br>A simple sum should return the right answer.<br><br><div class="quote"> <br>Why don't you just use int if you are unabled to program calculation stable stuff with float? <br> <br></div><br>Working around something is fine. Having to like it is a different matter.<br><div class="quote"> <br>(you know, there is a whole 4 year study including Master just to learn how to do this and similar stuff avoiding floating point precision problems or even double precision problems) <br> <br></div><br>That's handy. Whoever coded B3D seemed to have done the course. Maybe they should give the Bmax developer a few pointers... errr... hold on!<br>Anyway, I'm just using the opportunity to slag off the implementation again. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
