<!DOCTYPE html><html lang="en" ><head ><title >Caching graphics to avoid drawing delay?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Caching graphics to avoid drawing delay?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Caching graphics to avoid drawing delay?</a><br><br>
<a name="737352"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, I'm gonna ramble a bit here but perhaps some of you knowledgeable people can help me ... :-) please<br><br>On my zooming in map screen, I noticed that when it first appears and begins to zoom there is a jerk during the zoom in anim.  This is caused because the first frame takes longer to draw than the rest and the delta time code "catches" up and jumps ahead a bit when drawing the second frame.  Then all other frames are fine.<br><br>So why is there a delay drawing the first frame?<br><br>I found a similar thing in BlitzPlus and it's because the image is held in RAM and the first time it's drawn it get's "uploaded" to the video card VRAM before it's drawn. Then each subsequent time, providing that the image hasn't been edited, it just draws straight from VRAM (no upload required) so it's faster.<br><br>My understanding of BMax was that it didn't need to do this (unless you are using pixmaps) because all the images are in VRAM anyway.<br><br>However, I made a change to my code where I draw the first frame but don't call flip (so it can't be seen) and then I do it properly with flip and this seemed to resolve the jerk problem.  This infers that there is some kind of caching/optimisation going on when the images are first drawn.  Is that the video card or BMax?  Or am I deluding myself and I'm seeing the jerk (and disappearace of it after a dummy frame is drawn) due to some other issue with my code.<br><br>Anyone know anything about this and the possible reasons why it may occur?  I'd really like to have some standard code in place that optimises the graphics for each screen, or a game level, so that's it's all ready to draw at top speed the first time it's used without any delay, that would be cool.<br><br>Thanks in advance for any advice, knowledge, speculation etc ;-) <br><br></td></tr></table><br>
<a name="737409"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlackSp1der</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>I found a similar thing in BlitzPlus and it's because the image is held in RAM and the first time it's drawn it get's "uploaded" to the video card VRAM before it's drawn. Then each subsequent time, providing that the image hasn't been edited, it just draws straight from VRAM (no upload required) so it's faster.<br><br>My understanding of BMax was that it didn't need to do this (unless you are using pixmaps) because all the images are in VRAM anyway.<br> <br></div><br>Images in Blitzmax are pixmaps too, internaly. the first time it's drawn an imageframe is created from the pixmap.<br>I use a function to build the imageframe after load the image.<br><pre class=code>
Function ActiveImage(image:TImage)
	For Local _frame:Int=0 Until image.Frames.Length
		image.Seqs[_frame]=GraphicsSeq
		image.Frames[_frame]=_Max2DDriver.CreateFrameFromPixmap(image.Pixmaps[_frame],image.Flags)
	Next
EndFunction
</pre> <br><br></td></tr></table><br>
<a name="737416"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> BlackSp1der: Aha, cool so you've verified my theory.  thanks for the code snippet.  So that effectively caches them on all the video card, cool. <br><br></td></tr></table><br>
<a name="737490"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert Cummings</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just do a warm up cycle, most commercial games do. <br><br></td></tr></table><br>
<a name="737512"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Just do a warm up cycle <br></div>You mean draw everything without call flip or do as BlackSp1der suggests?  Actually I was wondering if you don't call Flip if BMax/DirectX/GFX card actually bothers to transfer the image to VRAM in such a case or if it is "optimised/intelligent" and only does the transfer when Flip is called? <br><br></td></tr></table><br>
<a name="737522"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlackSp1der</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> drawing without flip or calling the function have the same effect. The imageframe is builded (uploaded to VRAM) <br><br></td></tr></table><br>
<a name="737534"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, thanks that's worth knowing.  So I could call this at the start of the game when everything is loaded.  But what about this:<br><br>- I load in some graphics for the first time on level 1<br>- I call the imageframe code.<br>- At the end of the level I set the images to null for Garbage Collection (does this clear them out of VRAM too? probably not...)<br>- For level two I load in some of the same graphics (not all the same).<br>- I call the imageframe code again.<br>- What happens to the old image which was the same, does it remain in VRAM cluttering/taking up space, or will it get shuffled/celared out by the gfx card eventually?<br>- Also what if I don't free up the image and I just call the code to build the image frame twice, will that cause a problem, or two of the images in VRAM, or is it intelligent and only has one copy?  Any ideas?<br><br>Thanks. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
