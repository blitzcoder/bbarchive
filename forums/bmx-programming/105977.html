<!DOCTYPE html><html lang="en" ><head ><title >Invoke argument count limit?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Invoke argument count limit?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Invoke argument count limit?</a><br><br>
<a name="1299581"></a>

<a name="1299584"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've ran into a strange issue with Invoke and I'm just wondering if anyone has encountered the same thing..?  Two TMethods, calling Invoke() and passing arrays of Int (as String) for arguments like so...<br><br>[ "0", "0", "-1", "0", "0", "-1" ]<br><br>[ "1", "1", "0", "0", "0", "0", "0", "0", "-1", "-1", "-1", "0", "0", "0", "0" ]<br><br>First one works; second one throws an error in the <b>_Call function in reflection.bmx</b>.<br><br>For Local i=0 Until args.length<br> If Int Ptr(sp)&gt;=Int Ptr(q)+8 Throw "ERROR"  &lt;&lt;&lt;&lt;&lt; This line...<br> sp=_Push( sp,argTypes[i],args[i] )<br>Next<br><br>The only obvious difference is that one has more arguments, which leads me to believe there's an argument count limitation somewhere.  Otherwise, I have no clue.<br><br>Anyone know what is happening here? <br><br></td></tr></table><br>
<a name="1299583"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> There's a maximum limit of 8 arguments.<br><br>You can see it in the large case statements in _call() in reflection.bmx :-)<br><br>I suppose Mark thought it was a reasonable limit.<br><br>Another option might be to pass a Type with fields representing all your arguments. <br><br></td></tr></table><br>
<a name="1299586"></a>

<a name="1299588"></a>

<a name="1299591"></a>

<a name="1299592"></a>

<a name="1299593"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, but there are no large case statements in the reflection.bmx file I'm using.  Not one...<br><br>Thanks for your response, but I'm very surprised that would be considered a reasonable limit.<br><br>EDIT: Increasing the limit wasn't too hard, but now my reflection.bmx is out of synch.  :/ <br><br></td></tr></table><br>
<a name="1299594"></a>

<a name="1299595"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Look at how the method is actually called. It's through a BlitzMax function pointer declared as `f` and cast from raw pointer type. The number and type of arguments is part of the type signature of the variable in BlitzMax, making it fixed at compile-time. The only way to implement this without <i>some</i> arg count limit would be to write _Call in assembly, rather than BlitzMax or C. (Arguably a better way to do things since the existing implementation makes assumptions about the behaviour of the underlying assembly anyway.)<br><br>More arguments will imply some performance hit, although my guess is that  upping the count to 16 or even 128 would probably be lost in the noise compared to all the other stuff Invoke does.<br><br>Maybe Mark held to the idea that functions having that many arguments indicates bad design... maybe consider a <a href="https://en.wikipedia.org/wiki/Fluent_interface" target="_blank">fluent interface</a> instead? <br><br></td></tr></table><br>
<a name="1299603"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> IMO, making assumptions about how things are used and imposing hard limits IS generally bad design, but I don't fault Mark too much in this case.  Obviously, this implementation required a limit for the reasons you stated (I changed mine to 16). There are no comments in the version of reflection.bmx that I'm using that indicate the hard limit.<br><br>I wouldn't use reflection at all if performance was a concern.  My engine offers functions for constructing objects from Lua and setting a hard limit on argument count seems like a bad idea.  That's not a problem on the Lua side, but <b><i>I wanted something on the Blitz side to test the procedures</i></b>.  It has to be able to look up a method based on name (which is already slow) and then call it with however many arguments the user wants.  It's not up to me to decide that for them. <br><br></td></tr></table><br>
<a name="1299606"></a>

<a name="1299607"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Best to do that is to wrap your arguments in a custom type (like suggested by Brucey already):<br><br>TLuaArguments<br>TLuaResult<br>...<br><br>Each of them could then contain lists, maps, fields ...<br><br><br>In Lua you could create a TLuaArguments-instance and then via helper methods you expose adding arguments<br><br>bla = CreateLuaArgument()<br>bla.AddNumber(1, 123)<br>bla.AddString(2, "test")<br>bla.AddObject(3, anotherobject)<br>CallBlitzMaxFuncXY(bla)<br><br>first number in the brackets = argument index<br><br>This of course can get simulated from Blitz too.<br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1299619"></a>

<a name="1299677"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ive wanted to do this for a long time, and after reading this i finally caved in :p<br><br>Check out <a href="/posts.php?topic=84918" target="_blank">BRL.Reflection: Pointer Support</a>.<br>Specifically <b>callmethod.s</b> in the top post, and how to use it in <b>_Call</b>.<br><br>There are some changes to <b>_Call</b> though, so need to remove the If clause with <b>PointerTypeId</b> and <b>FunctionTypeId</b> if using it with vanilla reflection. <br><br></td></tr></table><br>
<a name="1299667"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> after reading this I finally caved in <br></div>Hey thanks, grable!  Just tried it and it worked without a hitch.  :)<br><br>I'm not quite understanding your last comment about PointerTypeId.  I'm using vanilla and it worked without changing anything.<br><br>Since this change is x86-only, what would happen if someone tried the test on a different OS?<br><br><div class="quote"> wrap your arguments in a custom type <br></div>Seems like extra work on the Lua side.  Right now most of my Lua exposed functions are wrappers for FFI calls.  It was my understanding that this is the fastest method and that was validated in my tests.<br><br>On the Blitz side, I don't know how I could call methods from types defined in outside modules without using Invoke. <br><br></td></tr></table><br>
<a name="1299678"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I'm not quite understanding your last comment about PointerTypeId. I'm using vanilla and it worked without changing anything. <br></div>My modified reflection supports pointers and function types and other stuff, so copying the _Call function without removing those would not work.<br>Hence my comment. But i suspect you just replaced the entire mod, in which case you can ignore it ;) <br><br></td></tr></table><br>
<a name="1299683"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah, okay.  That makes sense. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
