<!DOCTYPE html><html lang="en" ><head ><title >[MacOS] Window doesn't get focus</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >[MacOS] Window doesn't get focus</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >[MacOS] Window doesn't get focus</a><br><br>
<a name="1162830"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I initially posted this as a bug report, but I'm not really sure it is as some googling suggests that Apple think a window forcing focus to itself is a very very bad thing (even if the full-screen game already had focus anyway?!).  But I digress...<br><br>Consider this code:<br><pre class=code>Strict

Graphics 1024,768,32

Local isWindowed:Byte = False

While Not KeyDown(key_Escape)
	PollEvent()
	Cls
	If KeyHit(key_space) And (Not isWindowed)
		Graphics 1024,768,0
		isWindowed = True	
	EndIf
	DrawText "PRESS SPACE FOR WINDOWED MODE",50,10
	If CurrentEvent.id = EVENT_MOUSEMOVE
		DrawText "MOUSEMOVE",50,50
	EndIf	
	Flip
Wend

End</pre><br><br>It starts in fullscreen.  Move the mouse around and you'll see it's catching events nicely as it displays "MOUSEMOVE" when you move the mouse.  Now hit SPACE, and do the same.  The window is at the front, but does not have focus and is not capturing events.<br><br>Clicking in the window also does not give it focus.  The only way I have found around this, is to manually click outside of the window, THEN click in it.  I have no knowledge at all of Objective C and have no idea how to fix this, or if it can be fixed.<br><br>There is actually another way around the problem, as I've noticed that if the game starts in windowed mode, then goes fullscreen, and finally back to windowed, the problem doesn't happen.  This looks very ugly though at game startup, and all of this leads me to believe that a solution is possible.<br><br>My game is meant to be going on sale in a couple of weeks so I'm in desperate need of a solution here. <br><br></td></tr></table><br>
<a name="1162832"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Dave, have a look at Jakes thread here:http://www.blitzmax.com/Community/posts.php?topic=94364<br><br>It might help ya. <br><br></td></tr></table><br>
<a name="1162838"></a>

<a name="1162839"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks -already saw that and it doesn't really help.<br><br>I guess what I'm really looking for here is a modification to glgraphics.macos.m which corrects the initial behaviour when switching from fullscreen to windowed and ensures that the window has focus.  I'm pretty sure it'll fail on functionality QA if I submit it like this.<br><br>[edit]...and looking at the sales numbers for Mac compared to PC, I'm pretty sure I'm not going to bother supporting Mac any more after this.  Too much effort for too little reward.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1162840"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Corum</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm glad to notify that here, under Snow Leopard 10.6.8, the app doesn't lost its focus.<br>Tested your snippet both in debug and release mode, with Max 1.48 and XCode 4.2<br>Once again I'm sad to remind that 10.6.8 was the latest real OS from Apple.<br>What SO version are you running? <br><br></td></tr></table><br>
<a name="1162842"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's 10.8, which I *have* to support. <br><br></td></tr></table><br>
<a name="1162873"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Raz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> There is actually another way around the problem, as I've noticed that if the game starts in windowed mode, then goes fullscreen, and finally back to windowed, the problem doesn't happen. This looks very ugly though at game startup, and all of this leads me to believe that a solution is possible. <br></div> Not really fixing things, but can you have a titlebar-less splash screen to start?<br><br>I don't know too much about OSX, but is there any indication as to what might be the focussed app (even though it seems either Blitz or OSX already things the blitz window is focussed)? <br><br></td></tr></table><br>
<a name="1162880"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've solved it thus.<br><br>Just create a 2x2 window at startup, but only if the game prefs file says it's going to launch in fullscreen mode.  I don't need to do any of this if the game is starting in windowed mode (which it may do if that's what the user sets it to).  It's not an elegant solution, but it works, and you don't even notice the tiny window appearing for a split second - certainly not as much as the mouse pointer not being there, anyway.<br><br>I'm sure there's a better way than this and I don't know if it'll get through QA, but for now, with time ebbing away, it'll have to do.  Delivery of the first release candidate for both PC and Mac is due, like, now!<br><br>In the meantime if anybody knows of an Objective C-based solution to fix up glgraphics.macos.m's window creation code, then I'm all ears. <br><br></td></tr></table><br>
<a name="1163069"></a>

<a name="1163071"></a>

<a name="1163072"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Like you, I make and destroy a small window at start up (for Full Screen mode) so that stuff works properly.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1163075"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good to know, thanks. <br><br></td></tr></table><br>
<a name="1163094"></a>

<a name="1163095"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Like you, I make and destroy a small window at start up (for Full Screen mode) so that stuff works properly. <br></div><br><br>LOL! I've just spotted that code in commontypes.bmx.<br><br>[bbcode]			?MacOS<br>			'Due to a problem with ccGetActiveWindowOSX() where if you start the game in full-screen mode<br>			'it is never able to get a proper handle for windowed mode after you toggle to windowed mode,<br>			'we need to ALWAYS start in windowed mode.<br>			'So if the game is about to start in Full-screen mode, we need to quickly make and destroy a<br>			'small window first like this.<br>			If FullScreen Then<br>				Graphics 10,10,0<br>				EndGraphics()<br>			EndIf <br>			?[/bbcode]<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1163148"></a>

<a name="1163149"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yup that's it. This is why my framework is cool, because I've figured out all this crazy shit and solved it. /end blow own trumpet mode<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1163226"></a>

<a name="1163227"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I totally agree! You did heaps of groud of work, so glad a grabbed my copy :)<br><br>@Dave, I'm suprised that you havent you into this issue before - maybe you have and fixed it before?<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1163255"></a>

<a name="1163256"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SLotman</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> This only happens in the latest MacOS? <br><br>Edit: Just tested on Lion, the example app does the same thing - the strange thing is... none of my games has that problem.<br><br>So I tested it further and guess what?  <b>There is no bug in the compiled app</b>!<br><br>It's something to do with Blitzmax IDE. Just run the compiled .app and see for yourself - your app won't loose focus when switching from fullscreen to windowed mode - so you won't need the "small window" after all :)<br><br>A 'quick fix' for this when you're testing your game - just click on the window bar (on top of the screen - the 'main' bar for every window on MacOS) and not on the window itself, and you regain your focus.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1163258"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> How strange!<br><br>Well I'm needing to do that funny fix so I can get a window handle later to deal with mouse positioning related to the window coordinates. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
