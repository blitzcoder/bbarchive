<!DOCTYPE html><html lang="en" ><head ><title >1d access to a 2d type array</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >1d access to a 2d type array</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >1d access to a 2d type array</a><br><br>
<a name="833589"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CS_TBL</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, here's the idea: I have a type representing a pixel, e.g.<br><pre class=code>
type pixel
  field r:float
  field g:float
  field b:float
  field i1:int
  field i2:int
end type
</pre><br><br>Then I'll create my 'image':<br><pre class=code>
local myimage:pixel=new pixel[16,16]
</pre><br><br>(or something, maybe some more initializing, anyway, that's not the point here :P)<br><br>Anyway, I can access the pixel fields in a nested y,x FOR loop of course. But next to doing this I also want 1-dimensional access for both reading and writing. E.g. if I know the width and height (16 and 16) then I want to be able to run through the whole shebang in a for 256 loop. Oh.. and superstrict..!<br><br>How? :P I didn't find PTRs to be very cooperative, and going out of bounds (e.g. mypixel[255,0]) also wasn't much appreciated. <br><br></td></tr></table><br>
<a name="833590"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Haven't tested but shouldn't it be something like this?<br><pre class=code>
Function GetLinear:pixel(Value:int)
    return MyImage[value/16,Value mod 16]
End Function
</pre> <br><br></td></tr></table><br>
<a name="833600"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CS_TBL</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's not the solution I meant.. of course I can calculate everything myself: 1d access in a 2d arrary, '2d' access in a 1d array. It's this calculation I want to get rid of (in per-pixel calculations), and thus I want something low-level.<br><br>One can step through, say, ints in a 2d int array using a pointer. That's 1d access of a 2d array. But alas, couldn't make a pointer of my pixel object. And I'm not sure whether a pointer is such a nice solution here anyway. <br><br></td></tr></table><br>
<a name="833603"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't think BlitzMax array of type instances are stored in a uniform block or memory. So I don't think accesing to the data directly is possible. Also, pointer for class instances are not valid in BlitzMax, so making something like:<pre class=code>Local X:Pixel Ptr</pre>won't compile. Local X:pixel is a pointer itself... Maybe someone with more experience on arrays on BlitzMax can lend a hand...<br>Obviously creating a one dimensional array of pointers to the 2 dimensional array items would do the job, but it would be slow on creation time and not consitent on data storage. instance changes on the 2 dimensional array would not be reflected on the other one, and vice-versa. <br><br></td></tr></table><br>
<a name="833619"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you have a two dimensional array, each element in the first dimension potentially has its own memory space to store all items within it. So if you define your array as [x,y], and if let's say both x and y are 16, then for every x position in the array there is a separate block of memory with 16 y's in it. When you add a dimension to an array it stops being a contiguous block of memory. You could step through each of the elements in the first dimension and read the entire contents of that element's second dimension in sequence, but like at the end of a row you have to jump to a new memory location.<br><br>If you want a contiguous memory block I recommend using a bank instead of an array, or just allocate some memory yourself, and then use pointer access, because every time right now that you're doing array[x,y] blitzmax is behind the scenes going array+rowbasepointer+x to find the address. At least then you are in control of when you use it as rows and when you use it as a solid block of pixels. Also pointers to memory may be faster than arrays. <br><br></td></tr></table><br>
<a name="833681"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CS_TBL</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> A bank has its advantages yes.. for instance, you can poke either a float or an int at a specific spot, meaning you actually have choice during the process. The low-level poking is a bit less nice tho, tho one can use CONSTs for offsets like 'r', 'g', 'b', etc.<br><br>But uhm, before I make worries about something irrelevant, is a x+width*y for each array entry in a 1-dimensional array slowing down? Or does BMax's 2d array addressing works exactly the same? <br><br></td></tr></table><br>
<a name="833684"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thats how it most likely works, yes.<br>anything else makes no real sense especially as BMs performance is en par with C# and higher. <br><br></td></tr></table><br>
<a name="833825"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CS_TBL</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok, I've chosen wisely: TBank, and 2 arrays which contain bank offsets. One array is a 1d array, the other is 2d. Both contain the same numbers, but I can thus choose my preferred access method. Storing those offsets in those arrays saves quite a few multipliers for each pixel..<br><br>Still I wonder whether I'm just making too crappy stuff here or whether BMax seriously lacks some functionality here ... aaaaaaaanyway ... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
