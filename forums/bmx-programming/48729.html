<!DOCTYPE html><html lang="en" ><head ><title >opensource screensaver code</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >opensource screensaver code</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >opensource screensaver code</a><br><br>
<a name="542024"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >netmaestro</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> The code in this program will serve as boilerplate to create a fully functional screen saver. It will run in the preview window, full screen or config. All you have to do is put your own presentation in the main loop. I deliberately kept the presentation part of the code to a bare minimum to keep focus on the boilerplate, which is written entirely in Bmax with no reliance on C++ or dlls. I present this sourcecode as a gift to the folks on the forum, and I point out that it is the evolution of a work started by eikon. It was intended at its inception to be open source, and that's what it is.<br><br>You can pull this code into your ide, make sure your "create GUI App" is CHECKED, compile it, rename the .exe to .scr and put it in your windows\system32 folder to demo.<br><br><br><br>'******************** Open Source Screensaver Program ************************<br>'<br>' Version 1.0 	July 2, 2005<br>'<br>' Known issues: None at this time<br>'<br>' Contributors: netmaestro, eikon, chris c<br>'<br>'<br>' Use: 	Compile with "GUI App" CHECKED<br>'		Rename .exe to .scr<br>'		move .scr to c:\windows\system32 (or...)<br>'<br>'*****************************************************************************<br><br>Framework 	BRL.GLMax2D <br>Import 		BRL.Basic<br>Import 		BRL.System<br>Import 		BRL.Retro<br>Import		"-lshell32"<br>Import 		"-luser32"<br>Import 		"-lkernel32"<br><br>Extern "win32"<br>                Function FindWindow			(x:Byte Ptr, y:Byte Ptr)			 = "FindWindowA@8"<br>	Function MoveWindow			(hWnd,x,y,w,h,d)					 = "MoveWindow@24"<br>	Function ShowWindow			(hWnd,style)						 = "ShowWindow@8" <br>	Function GetWindowLong		(hwnd, nIndex) 						 = "GetWindowLongA@8"<br>	Function SetWindowLong		(hWnd,x,y)							 = "SetWindowLongW@12"<br>	Function SetParent			(hWnd1,hWnd2)						 = "SetParent@8"<br>	Function IsWindowVisible	(hWnd)						 		 = "IsWindowVisible@4"<br>	Function GetDesktopWindow	()									 = "GetDesktopWindow@0"<br>	Function GetWindowRect		(hWnd:Int,r:Byte Ptr)				 = "GetWindowRect@8"<br>	Function CreateSemaphore	(a:Byte Ptr, b:Int, c:Int, d:String) = "CreateSemaphoreW@16"<br>	Function GetLastError		()									 = "GetLastError@0"<br>EndExtern<br><br>Global r:Int[4]					'**************** Get Current Desktop Resolution *******************<br>Global p:Byte Ptr=Varptr(r[0])	'<br>								'	This is advisable because it is best not to switch screen <br>deskWnd=GetDesktopWindow()		'	settings when the screen saver starts.<br>GetWindowRect(deskWnd,p)		'<br>								'<br>Global DeskWidth :Float =r[2]	'<br>Global DeskHeight:Float =r[3]	'**************** End Get Current Desktop Resolution ***************<br><br>Global width: Float 	= 0<br>Global height:Float 	= 0<br>Global startmousex:Int 	= 0<br>Global startmousey:Int	= 0<br><br>Const ERROR_ALREADY_EXISTS:Int 	= 183<br>Const PREVIEW_ACTIVE			= 0<br>Const CONFIG_ACTIVE				= 1<br>Const SAVER_ACTIVE				= 2<br><br>Global PrevWnd		= Int(AppArgs[2])	'Handle of the preview window<br>Global pscale:Float = 1					'scale value to apply depending on screen size<br>Global bmw:Int		= 0					'Handle of the BMax window<br>Global Status:Int   = 0					'Program status, identifies preview, regular, or config modes<br>Global timemark:Int = 0					'Time marker to use for a makeshift timer <br><br>SetGraphicsDriver GLMax2DDriver()<br><br>Select AppArgs[1] <br>	Case "/p"<br>		InitPreviewMode()<br>	Case "/s"<br>		InitSaverMode()<br>	Case "/c"<br>		InitConfigMode()<br>	Default<br>		InitConfigMode()<br>EndSelect<br><br>While Not KeyHit(KEY_ESCAPE) <br>	<br>	'**************** TODO: Write your own presentation code ***************<br>	'<br>	'  Multiply any scaling by pscale (=1 in Saver mode, .15-.25 in Preview)<br>	'  You will scale your speeds too (nothing moving in this one)<br>	'	<br>	'***********************************************************************<br>	Cls<br>	SetColor 255,255,255	<br>	DrawOval 0,0,200,200<br>	SetColor 255,0,0<br>	DrawOval width-(200*pscale),0,200,200<br>	SetColor 0,255,0<br>	DrawOval 0,height-(200*pscale),200,200<br>	SetColor 0,0,255<br>	DrawOval width-(200*pscale),height-(200*pscale),200,200<br>	Flip<br>	FlushMem<br>	<br>	Select Status 				'******* This block is boilerplate ********<br>		Case PREVIEW_ACTIVE		'<br>			CheckVisible()		'<br>		Case SAVER_ACTIVE		'<br>			CheckMovement()		'<br>	EndSelect					'************* Do Not Remove **************<br>	<br>Wend<br>	<br>End<br><br>Function InitSaverMode()<br>	If SetProcessLock("SaverModeLock") &lt;&gt; 0 Then End<br>	Status = SAVER_ACTIVE<br>	width = DeskWidth<br>	height = DeskHeight<br>	Graphics width,height,-1,-1<br>	pscale = 1<br>	startmousex = MouseX()<br>	startmousey = MouseY()<br>	Return<br>EndFunction<br><br>Function InitPreviewMode()<br>	If SetProcessLock("PreviewModeLock") &lt;&gt; 0 Then End<br>	Status = PREVIEW_ACTIVE<br>	width  = 152; height = 112<br>	Graphics width,height,0, -1<br>    bmw = FindWindow(Null,"BlitzMax Application")<br>	Local bmx_Style = GetWindowLong(bmw, -16)<br>	bmx_Style = bmx_Style And $40000000 Or $800000 And $10000000<br>	SetWindowLong bmw, -16, bmx_Style;<br>    SetParent(bmw,PrevWnd)<br>	MoveWindow (bmw,0,0,152,112,True)<br>	pscale = 152/DeskWidth<br>	SetScale pscale,pscale<br>	timemark = MilliSecs()<br>    Return<br>EndFunction<br><br>Function InitConfigMode()<br>	Status = CONFIG_ACTIVE<br>	width = 320<br>	height = 200<br>	AppTitle = "Configuration Screen"<br>	Graphics width,height, 0<br>    bmw = FindWindow(Null,"Configuration Screen")<br>	MoveWindow (bmw,(DeskWidth/2-width/2),(DeskHeight/2-height/2),320,200,True)<br>	SetClsColor 192,192,192<br>	SetColor 0,0,0<br>	Cls<br>	DrawText "TODO: Write config code",50,80<br>	DrawText "Press &lt;ANY KEY&gt; to exit",55,130<br>	Flip<br>	WaitKey<br>	End<br>EndFunction<br><br>Function SetProcessLock:Int(LockStr:String)<br>	Global MySem = CreateSemaphore(Null,0,1,LockStr)<br>	If MySem&lt;&gt;0 And GetLastError() = ERROR_ALREADY_EXISTS<br>	  Return 1<br>	Else<br>	  Return 0<br>	EndIf<br>EndFunction<br><br>Function CheckVisible()<br>	If MilliSecs()-timemark &gt; 2000 'Delay visibility check til window is drawn<br>		If Not IsWindowVisible(PrevWnd)<br>			End<br>		EndIf<br>	EndIf<br>EndFunction<br><br>Function CheckMovement()<br>	If MouseX()&lt;&gt;startmousex Or MouseY()&lt;&gt;startmousey Then End<br>	If GetChar()&lt;&gt;0 Then End<br>	'Probably want to put some more keyhits in here; I'm too lazy<br>EndFunction <br><br></td></tr></table><br>
<a name="542124"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >netmaestro</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I made a simple implementation of this code by adding some movement to the main loop. Download the example at <br><a href="http://www.networkmaestro.com/simplesaver.scr" target="_blank">http://www.networkmaestro.com/simplesaver.scr</a> <br>and see it in action. Starting with the boilerplate already made, creating this took about fifteen minutes! <br><br></td></tr></table><br>
<a name="864902"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >INVENT</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> any chance you could email that to me.....link is dead...if you still have it..or if anyone has it... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
