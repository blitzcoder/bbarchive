<!DOCTYPE html><html lang="en" ><head ><title >Vectors vs Arrays</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Vectors vs Arrays</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Vectors vs Arrays</a><br><br>
<a name="985673"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >spacerat</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm creating some geometry types so that I have standardised objects for everything which needs shapes in my game, such as lighting, collisions and possibly physics. However before I continue I'd like to know your opinion on weather you think it's a good idea to use vector objects everywhere, or to stick to arrays,  multidimensional arrays, or even arrays of arrays, for functions which will see a lot of use. For example...<br><br><pre class=code>
''''Vector
Method GetPoints:TVec2[] ()
'Return NEW vectors for each point
End Method
'''Array
Method GetPoints:Float[]()
'e.g. Return [x,y,x+w,y+h]
EndMethod
'''Array of arrays
Method GetPoints:Float[][]()
'e.g. Return[[x,y],[x+w,y+h]]
EndMethod
'''Multidimensional
'can't be bothered to write it but you get the picture
</pre><br><br>Which method offers the best usability/speed in your opinion? My thought is that, if using vectors here for every point turns out to be too slow, I'd probably go with arrays of arrays, so that you can, for example, get Point[1][0] <br><br></td></tr></table><br>
<a name="986082"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Arowx</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would say that you would be better of with objects!<br><br>But there are already a few vector/math libraries in the code archives and the community framework why not use one of those as your base? <br><br></td></tr></table><br>
<a name="986095"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mahan</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> As reference iirc MiniB3D uses objects for vectors. It even uses objects as result-types when making many vector calculations. I think that was this that stopped me from playing with MiniB3D with BMX-threading back in the day because the garbage collector (at least back then) was much to slow to cope with the massive about of objects this produced.<br><br>MiniB3D worked quite ok in single threaded more though. <br><br></td></tr></table><br>
<a name="986103"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >spacerat</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Since creating the topic I've actually benchmarked the different choices. The speeds were a ratio of (array:array-of-array:objects) = (2:7:8), making objects significantly slower than an array, but not much slower than an array of arrays. However the difference only becomes noticeable at hundreds of thousands of calculations per second, which I won't even get close to doing, so I've gone with vector objects for usability.<br><br>However, Mahan, you make a good point about threaded mode, which I've yet to test. I'm sure vectors will be slower still, but I've already started sticking them in all over the place now, and even with the threaded GC I don't think I'm doing enough calculations for it to matter. <br><br></td></tr></table><br>
<a name="986120"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mahan</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>[...]benchmarked the different choices[...] and even with the threaded GC I don't think I'm doing enough calculations for it to matter. <br> <br></div><br><br>Proof-of-concepts or benchmarks are my preferred method of testing computer "doubts"  (in lack of a better word) too.<br><br>The second quote also has a lot of merit. Before building in optimization (which often complicates the code structure) be certain that the optimization is needed. A well written and clear piece of code is commonly easy to optimize. It's often much harder to optimize a complex code (due to previous. possibly unnecessary optimizations). KISS principle at it's best (Keep it simple, stupid!) :-) <br><br></td></tr></table><br>
<a name="986127"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Both Arrays and Objects are heap allocated and subject to garbage collection though.<br>The reason Objects seem slower, is probably because they carry around their own VMT (using more memory).<br><br>Where you can expect speed improvements is in 1D arrays of multiple "vectors" (ie vecs:Float[3*count]) and filling pre-allocated space instead of allocating new space on each math operation. <br><br></td></tr></table><br>
<a name="986129"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AlexO</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> IMO, a distinct vector class has better usability/readability. And since Arrays are objects, you're speed "hit" isn't going to come from accessing the fields (x,y, etc), but from creating those objects (either TVec or Array). <br><br>When I wrote the initial port to Farseer Physics I knew there'd be a performance bottleneck with allocating vectors and such but didn't do it until it BECAME a problem. Only then did I start using inlining, caching, and pooling techniques to mitigate the allocation of objects inside the main loop. <br><br></td></tr></table><br>
<a name="986143"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> The best way with automated garbage collectors is to recycle objects. With out recycling and randomly removing objects, The memory gets trashed just like Harddrives when they get fragmented. after a while of adding and removing objects the memory allocation  starts to slow down the program. the best way is to create objects and when they are done being used, store them for future use. It can be done in arrays but work best with Link Lists sense you can expand and shrink them as needed. a good example is demonstrated here by DStastny:<br><a href="http://www.blitzmax.com/Community/posts.php?topic=62215" target="_blank">http://www.blitzmax.com/Community/posts.php?topic=62215</a><br><br>There are other similar ways but this one illustrate the principle really clear. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
