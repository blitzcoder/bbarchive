<!DOCTYPE html><html lang="en" ><head ><title >Unhandled Exception:Unicode character out of UCS-2</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Unhandled Exception:Unicode character out of UCS-2</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Unhandled Exception:Unicode character out of UCS-2</a><br><br>
<a name="1009715"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Murilo</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm writing an app that permits the dragging and dropping of files/folder. Everything appeared to be working nicely, when I decided to drag the "developer" folder on to my app (to test recursion in large folders). It resulted in the following error:<br><br>Unhandled Exception:Unicode character out of UCS-2 range<br><br>Surely BlitzMax should be able to handle all OS X filenames? Am I missing something?<br><br>Thanks <br><br></td></tr></table><br>
<a name="1009719"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Unhandled Exception:Unicode character out of UCS-2 range <br></div><br>Oooh.. I wondered who'd be the first to see that :-p<br><br>But I'm surprised there are unicode chars above 65k... <br><br></td></tr></table><br>
<a name="1009722"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Murilo</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> It looks like it's an issue with a Japanese character:<br><br>"H.264<b>&amp;#65288;</b>Blu-ray &amp;#29992;<b>&amp;#65289;</b>.setting"<br><br>Is there nothing I can do? <br><br></td></tr></table><br>
<a name="1009724"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Speak to Mark really nicely, perhaps? :-/<br><br>The problem lies with BlitzMax's newer string handling code which better supports UTF8.<br>Specifically, Mark added a cutoff so that each real "character" would be able to fit only into a single BlitzMax character. A BlitzMax character is UTF16 or UCS-2, depending how you look at it.<br>True UTF16 would allow for multiple UTF16 entries to represent a single real character.<br>That means, that a character with a code like 65289 should in reality be stored in TWO BlitzMax UTF16 characters.<br>As you might imagine, that kind of throws things like LENGTH checks up in the air, because you'd need some UTF16 savvy code to understand that 5 characters might actually be only 4 real characters.<br><br>BlitzMax uses UTF16/UCS-2 because Windows does by default.<br><br>Ideally, one might prefer UTF32. That would certainly avoid this particular issue.<br><br>As for a "workaround"... the code you'd be interested in, is bbStringFromUTF8String() within blitz_string.c / brl.blitz. <br><br></td></tr></table><br>
<a name="1009792"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm...<br><br>But 65289 *should* fit into 16 bits.<br><br>&gt; "H.264&amp;#65288;Blu-ray &amp;#29992;&amp;#65289;.setting"<br><br>Is that HTML encoding? <br><br>Does the &amp;#29992;&amp;#65289; bit 'mean' a single character or something? From here, it looks like 2 characters that should fit OK into 16 bit UCS-2.<br><br>Could be a bug in StringFromUTF8 I guess - wouldn't be the first! <br><br></td></tr></table><br>
<a name="1009816"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh... apologies...  This is related to <b><a href="/posts.php?topic=88063" target="_blank">this bug</a></b> for 1.37 :<br><br>Using the patch, this works :<br><pre class=code>
SuperStrict

Local s:String = Chr(65289)

Print Asc(s)

Local s2:String = String.FromCString(s.ToUTF8String())

Print s2.length

Local s3:String = String.FromUTF8String(s2)

Print Asc(s3)
</pre> <br><br></td></tr></table><br>
<a name="1009827"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Murilo</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks guys.<br><br>@Mark: Yeah - That's HTML encoding. When I pasted the filename into the text area, I could see the Japanese character.<br><br>I'm using 1.37 - I'll give the patch a whirl now... <br><br></td></tr></table><br>
<a name="1009846"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Murilo</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> That patch worked perfectly! Cheers <br><br></td></tr></table><br>
<a name="1015261"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Imphenzia</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Since upgrading to 1.38 (from 1.36) my Raknet implementation also crashes out with the "Unhandled Exception:Unicode character out of UCS-2" being thrown, presumably in my line:<br><br>Local value:String = String.FromUTF8String(Self.rPacket.GetData())<br><br>I'll haven't found the issue yet but I'll keep troubleshooting it.<br><br>Update: Found it - I padded my string with CHR(255) which was not appreciated :) Now I just have to figure out why the first Raknet ID byte is messing up my string, I assume it's dropping out of alignment somehow... <br><br></td></tr></table><br>
<a name="1059779"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >degac</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, I've found a new problem now!<br>And this time is for MaxIDE itself! It doesn't start anymore!<br><br>This morning I was testing some basic code (no string-UFT related) and MaxIDE works fine.<br>Now a double click on the icon is useless: I opened a terminal and I get the following error...<br><pre class=code>
degac@degac-VirtualBox:~/Scrivania/BlitzMax$ ./MaxIDE
Unicode character out of UCS-2 range
</pre><br><br>Any hints?<br>I'm using Ubuntu 10.10 on a VirtualBox and I dont' know really what happened!<br>Some 'silent' upgrading in Ubuntu? <br><br></td></tr></table><br>
<a name="1059780"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >degac</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just re-downloaded BlitzMax 1.41 from the site, extracted in another folder, copied the MOD folder and now it works...<br>Linux mistery... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
