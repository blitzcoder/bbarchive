<!DOCTYPE html><html lang="en" ><head ><title >List.AddLast() and List.AddFirst() Different?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >List.AddLast() and List.AddFirst() Different?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >List.AddLast() and List.AddFirst() Different?</a><br><br>
<a name="923368"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm possibly just having a brainfart here, but I'm getting some downright bizarre behaviour with TLists. Namely items being added to lists going walkabouts for no apparent reason. Almost as though TLinks are being reissued, and Removing those TLinks is causing different objects to be removed.<br><br>Anyway, I've managed to pinpoint one very clear difference, and that makes no sense either. Specifically, if I add my objects to the list with AddFirst() one particular object remains in that list. If I add all objects to the list with AddLast() that exact same object is not in the list any more. That is the only line of code that changes.<br><br>Given that no other code is changing, is there any logical reason why AddLast() and AddFirst() would cause a variance in which objects are and are not on the list?<br><br>I'm not using a Compare() method for any of the objects, derived objects or parent objects. I've come across a couple of very obscure bugs when using the Compare method before, but that's not it here. <br><br></td></tr></table><br>
<a name="923373"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> When you remove/replace a link are you patching the links on both sides of the original to the new link? <br><br></td></tr></table><br>
<a name="923375"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm not sure what you mean by "both sides of the original".<br><br>Essentially I just have a function which is called at various times. It removes the object from the list it's in, and then evaluates a few conditions, before placing it in a new list and storing the link within the object. The conditions should never fail, so it should never fail to be in at least one list, and I have it set to throw a runtime error if this should ever happen, just to be sure that it doesn't.<br><br>EDIT: I use the same Link field to store the TLink, regardless of which TList the object is placed in. That shouldn't be a problem, should it? The TLink knows what TList it relates to. I specifically chose TLists over TMaps because I wanted the ability to remove an object from a container without necessarily knowing which container it's in. <br><br></td></tr></table><br>
<a name="923379"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Always use AddFirst().  Never use AddLast().  AddLast iterates through the entire list and will cause significant slowdown. <br><br></td></tr></table><br>
<a name="923386"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Leadwerks: That makes no sense, Max lists are looped (don't know the technical term), meaning the head link of the list has the last link as its 'predecessor', so it should just insert the new object between head and head._pred.<br><br><div class="quote"> I'm not sure what you mean by "both sides of the original". <br></div>Read up on linked lists, or just take a long look at the linked list source.<br>Each link has a field for the predecessor (previous) and the successor (next) links in the list, a linked list has a link called the head, which has the first link as its successor and the last link as its predecessor (the head is the link of the chain which separates the actual object links).<br><br>So to insert a link in another link you have to patch both sides of the link to the two surrounding the insert position (addfirst would be head-&gt;newlink-&gt;currentfirst-&gt;..; AddLast would be currentlast-&gt;newlink-&gt;head-&gt;..)<br><br><a href="/codearcs.php?code=2351" target="_blank">This</a> may help.<br><br>EDIT: Leadwerks, list.AddLast() does not iterate the entire list. It calls InsertBeforeLink() which just patches between the currentlast and the head of the list, go ahead, look at the source yourself. <br><br></td></tr></table><br>
<a name="923389"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> AddLast iterates through the entire list and will cause significant slowdown.  <br></div><br>Well that's total nonsense. AddLast takes as much (or as little, if you wish) time as AddFirst.<br><br>It does as Plash says it should, and simply inserts before head - which it already has a reference for. <br><br></td></tr></table><br>
<a name="923390"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Edited at the same time you posted, Brucey :P <br><br></td></tr></table><br>
<a name="923404"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> How long has it been like that? <br><br></td></tr></table><br>
<a name="923411"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Gab, not sure what you mean. Have you got some runnable example code?<br>&lt;edit&gt; Isn't the TLINK destroyed when you remove from one list and a new one created when adding to another? I thought that was a reason why GC was called so often if this was happening a lot (e.g. in particle systems which had a 'free' and 'in-use' list.) <br><br></td></tr></table><br>
<a name="923462"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> So to insert a link in another link you have to patch both sides of the link to the two surrounding the insert position <br></div><br>Oh. No, I'm not inserting a link into another link. I just remove one link and then generate another by adding it into a new list. I always know the new list it's going into. I just don't want to know which one it's already in, for speed reasons.<br><br><div class="quote"> Gab, not sure what you mean. Have you got some runnable example code? <br></div><br>Not yet, that's why I'm posting, because I don't know what code is affecting it. It's an apparently simple problem, but would have been spotted a long time ago if it really was as simple as it appears. Somehow the TLinks are getting corrupted or being reused, or something.<br><br><div class="quote"> Isn't the TLINK destroyed when you remove from one list and a new one created when adding to another? <br></div><br>Yep, I don't keep any other references to the link, so they should all be collected the next time the GC goes into action. Although I don't force the GC to collect immediately. <br><br></td></tr></table><br>
<a name="923482"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> No, I'm not inserting a link into another link. <br></div>Whoops.. That was a typo, should've been 'to insert a link into a list (between two other links) ...'<br><br><div class="quote"> I just remove one link and then generate another by adding it into a new list. I always know the new list it's going into. I just don't want to know which one it's already in, for speed reasons <br></div>So your just moving an object from one list to another? <br><br></td></tr></table><br>
<a name="923490"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> You are not saving a TLINK somewhere and using it later are you?  I think if you add to or remove from a TLIST, all TLINKS become invalid. <br><br></td></tr></table><br>
<a name="923494"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> You are not saving a TLINK somewhere and using it later are you? I think if you add to or remove from a TLIST, all TLINKS become invalid. <br></div>Correct. If you snatch a link out of a list you have to make it 'not exist' anymore, so if I were to take link2 out of link1-&gt;link2-&gt;link3 I would have to do link1._succ = link3 and link3._pred = link1; then further taking the predecessor and successor of link2 and pointing them to the surrounding links of the new position in a list (which then you would have to do so for the surrounding to the new aswell).. <br><br></td></tr></table><br>
<a name="923512"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> In c++, when you add objects last to a list, it's the slowest way. According to my books. :) <br><br></td></tr></table><br>
<a name="923540"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> So your just moving an object from one list to another?  <br></div><br>Yep, pretty much.<br><br><div class="quote"> You are not saving a TLINK somewhere and using it later are you? <br></div><br>Well I'm keeping the TLink that is return'ed when the object is added to the list. There's no other way to remove it.<br><br><div class="quote"> I think if you add to or remove from a TLIST, all TLINKS become invalid. <br></div><br>That surely can't be. I've been using TLists for years, and I've never found that to be true. Are you saying that If I do this :<br><br><pre class=code>
Global List:TList=New TList
Type Thingy
   Field Link:TLink
End Type
Local A:Thingy=New Thingy
A.Link=List.AddLast(A)
Local B:Thingy=New Thingy
B.Link=List.AddLast(B)
</pre><br><br>Then A.Link is already invalid because I added B later? If that was the case, there would be no point in AddLast and AddFirst even returning a TLink. <br><br></td></tr></table><br>
<a name="923544"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> In c++, when you add objects last to a list, it's the slowest way. According to my books. :)  <br></div><br>Obviously, it depends on the structure of your list.<br><br>TList is a double-linked list, or whatever the proper term is. That means, you can navigate it in either direction. Therefore, when at the head (or first item), you also have access to the tail (or last item).<br><br>So, to add AddLast, you get the head, and insert a new link between it and the previously last item.<br><br>Since the source is available, it's quite easy to see for yourself how it works :-) <br><br></td></tr></table><br>
<a name="923545"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Then A.Link is already invalid because I added B later? If that was the case, there would be no point in AddLast and AddFirst even returning a TLink. <br></div>No, the links are both valid. I must have been thinking of something else when I wrote my last post. <br><br></td></tr></table><br>
<a name="923556"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> No, the links are both valid. I must have been thinking of something else when I wrote my last post.  <br></div><br><br>I also think I was thinking of something else.  I have been doing a lot of php recently and I think I ran into something that had an issue like that and confused the two.<br><br>Sorry, don't mean to add to the confusion.  :) <br><br></td></tr></table><br>
<a name="923561"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you remove an object from lista the associated tlink is no longer valid and a new one created if the object is added to another list.<textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Local teststring:String="one"
Local list1:TList=CreateList()
Local list2:TList=CreateList()
Local mylink1:TLink=list1.addlast(teststring)
Print mylink1.tostring()
list1.remove(teststring)
Local mylink2:TLink=list2.addlast(teststring)
Print mylink2.tostring()
</textarea><br>By keeping a variable pointer to the old tlink you keep it alive but, I believe, it doesn't point to anything (other than a memory block). <br><br></td></tr></table><br>
<a name="923563"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am pretty sure it didn't used to be this way:<br><a href="http://blitzmax.com/Community/posts.php?topic=59747#666475" target="_blank">http://blitzmax.com/Community/posts.php?topic=59747#666475</a> <br><br></td></tr></table><br>
<a name="923583"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> That "advice" was never correct to begin with ;)<br>TList has allways been doubly-linked. <br><br></td></tr></table><br>
<a name="923815"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dmaz</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> grable is right leadwerks... it's always been a double linked list.  you are confusing AddLast with Remove.   you never use Remove or ListRemove for performance.  use RemoveLink as suggested in the link you posted.<br><br><div class="quote"> <br>TList is a double-linked list, or whatever the proper term is. That means, you can navigate it in either direction. Therefore, when at the head (or first item), you also have access to the tail (or last item). <br></div><br><br>actually the "double-linked" part just means it points to a previous and next item while the ends are null.  taking that and having the ends point to the other ends instead of null make it cyclic.  so TList is a double linked cyclic list. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
