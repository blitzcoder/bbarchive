<!DOCTYPE html><html lang="en" ><head ><title >Streams, Universal Binary and Headaches!</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Streams, Universal Binary and Headaches!</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Streams, Universal Binary and Headaches!</a><br><br>
<a name="1051625"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, here I was building a Universal Binary for the Mac, all tested fine on the Intel but it would instantly quit on the PPC...<br><br>Hmmmm, so I install BlitzMax on the the old PPC and compile my game... error - oooookay, now we are getting somewhere....<br><br>The ReadInt of the Stream was causing the issue... removed the stream and its all good... but thats not good for the game...<br><br>Finally found it!!! Can anyone guess what the problem was? (Apart from my lack of knowledge on the subject of Streams....) <br><br></td></tr></table><br>
<a name="1051627"></a>

<a name="1051628"></a>

<a name="1051629"></a>

<a name="1051630"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's almost certainly due to <a href="http://en.wikipedia.org/wiki/Endianness" target="_blank">endian-ness</a>. You would probably fix it by changing any ReadFile calls to something like this:<br><br><pre class=code>
Local stream:TStream = LittleEndianStream (ReadFile (f$))
</pre><br><br>... or this:<br><br><pre class=code>
Local stream:TStream = BigEndianStream (ReadFile (f$))
</pre><br><br>I can never remember which is which, but see which one works on your existing Intel version, and it should then "just work" on your PPC version too.<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1051636"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks James I forgot about that 'little quagmire' :)<br><br><div class="quote"> <br>Death to the Pixies!<br> <br></div><br>IIRC you have had that 'sig' every since Blitz PC began :) <br><br></td></tr></table><br>
<a name="1051658"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> x86 (intel) are little endian<br>PPC is big endian<br><br>If there's a chance your app might be run on 2 different platforms it's a good idea to convert all your streams to the same endianness just to make sure it doesn't come back and get you later (as you've found :0). If you never have to share files between the platforms then the endianness doesn't really matter, but you just never know and it's 1 line of code... I must say I'm not great about enforcing this myself but it is worth it.<br><br>Another nice thing to look into would be catching exceptions so if your streams blow up in your face (corrupted files, god knows what someone else's hardware is going to do... or if the file gets mangled flowing through email etc.) the app doesn't follow. <br><br></td></tr></table><br>
<a name="1051680"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Thanks James I forgot about that 'little quagmire' :)<br> <br></div><br><br>It's really easy to deal with, though -- just pick an endian-ness and do something like the above.<br><br><div class="quote"> <br>... sig...<br> <br></div><br><br>I kind of forget it's there -- I have sigs turned off! <br><br></td></tr></table><br>
<a name="1051682"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Also, what ima747 said. There's an example <a href="/codearcs.php?code=2477" target="_blank">here</a> -- just look at the first function, GetBMPInfo (), for an example of handling streams, taking endian-ness into account and catching exceptions.<br><br>Also, this only applies to reading/writing files "manually" -- you don't have to worry about the built-in LoadImage, etc, functions. <br><br></td></tr></table><br>
<a name="1051729"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep... it was the bloody endians!!! LOL!<br><br>Least the fix was nice and quick:<br><br><b>Original Code:</b><br><pre class=code>
Local stream:TStream = ReadStream(file)
</pre><br><br><b>Fixed Code:</b><br><pre class=code>
Local stream:TStream = ReadStream("littleendian::" + file)
</pre> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
