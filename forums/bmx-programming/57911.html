<!DOCTYPE html><html lang="en" ><head ><title >strange(?) issue pertaining to memory usage</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >strange(?) issue pertaining to memory usage</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >strange(?) issue pertaining to memory usage</a><br><br>
<a name="644044"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bukky</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello again,<br><br>Sorry about all of these threads, but its crunch time over here and we're trying to get a lot done all at once. <br><br>ANYHOW....<br><br>I've been working on optimizing my code in oder to reduce memory usage (changed whatever images I could to power of two, dynamically loading music as needed), but my game still takes up massive amounts of memory. <br><br>I've been monitoring memory usage via Windows Task Manager in Windows XP, and this is what happens when  I run my game:<br><br><pre class=code>
Game loaded up, user is at menu screen (modest amount of RAM)

User goes to first stage (RAM shoots up as expected)

User returns to menu screen (RAM shoots up AGAIN(wth??))

User goes to level two (RAM shoots up)

User goes to level three (RAM shoots up)

User loses and goes back to menu (RAM stays constant)

User goes back to level one (RAM stays constant)
</pre><br><br>By the time all is said and done, Windows Task Manager is registering well over 200mb of RAM for my process. What in the world is going on here? All of my images are loaded at runtime, and it seems that the memory goes up substantially when those images are in use. Now, why doesnt it go back down when those particular images are not being drawn? It seems that there is a compounding of memory somewhere. <br><br>Is there something obvious I'm not doing? Anyone have suggestion? <br><br></td></tr></table><br>
<a name="644070"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chris C</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> the garbage collector uses a pool of memory because allocating memory via the OS is expensive in terms of time.<br><br>you need to set all the resources (and *ALL* ) references to level two and three to null before the GC will release them<br><br>freed memory is kept in the memory pool, but if unused is usually released after a while<br><br>You'll have to check carefully you haven't got some reference to somthing refering to an object in level 2 &amp; 3 <br><br></td></tr></table><br>
<a name="644074"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bukky</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey Chris,<br><br>Thanks for the reply. <br><br>So you think creating a function which unloads all of my variables between loading stages to null will solve at least some of my RAM woes? <br><br></td></tr></table><br>
<a name="644114"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe. It depends on your data structure. In an ideal world, emptying your collections should clear any references you have. If oit doesn't, see if you managed to make an cyclic data structures that are being orphaned. <br><br></td></tr></table><br>
<a name="644186"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chris C</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> as flameduck says it depends on your data structure, chasing down a cyclic data structure problem could be a nightmare<br><br>but in theory nulling all the stuff thats used should work<br><br>another idea to consider is have a function to "play" your level that uses only local vars, when the function returns from playing the level they will all go out of scope and be released<br><br>you could make it generic playlevel(l) and load in whatever data you need for level l, you could even get flash and use a function pointer for special code pertaining to specific levels...<br><br>the key is to use local vars in a function wherever possible <br><br></td></tr></table><br>
<a name="644376"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bukky</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey guys,<br><br>I just ended up making some routines which dynamically load and unload images as needed. This, combined with changing my images to power of 2 has reduced my RAM consumption by half!<br><br>Are there any build options that would help me further reduce it though? Anything else that might be obvious to Blitz veterans but overlooked by Blitz newcomers such as myself? <br><br></td></tr></table><br>
<a name="644395"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> No there aren't any settings that reduce the RAM usage.<br>The GC is already quite optimized in low ram usage<br>(.NET GC for example would not free anything automatically as long as there is more ram to allocate as it takes time. This shows that it theoretically is not needed to free unless there is a shortage in memory) <br><br></td></tr></table><br>
<a name="644410"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chris C</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd have a look at framework assistant, that may well bring down the size of the exe and under some circumstances the mem usage too (if you're very lucky!) <br><br></td></tr></table><br>
<a name="644419"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bukky</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
