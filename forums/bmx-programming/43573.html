<!DOCTYPE html><html lang="en" ><head ><title >Arrays in User-Types</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Arrays in User-Types</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Arrays in User-Types</a><br><br>
<a name="486481"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grover</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Im a little puzzled by the use of arrays within usertypes. Heres the code:<br><br>Type Vec<br>	Field x:Float<br>	Field y:Float<br>	Field z:Float<br>	Field w:Float<br>End Type<br><br>Type DispPos<br>	Field d:Vec[255]<br>End Type<br><br>Type Spline<br>	Field dispmap:DispPos[255]<br>	Field knot:Vec[255]<br>End Type<br><br>Global sp:Spline = New Spline<br><br>My problem comes when trying to access the fields within the arrays - I always get an error informing me the Field or Method is null. <br><br>this breaks: <br>sp.knot[0].x = 10    <br>sp.dispmap[0].d[0].x = 10 <br><br>Do the arrays of usertypes need to be 'newed' also? I have tried such an implementation and still couldnt access the fields. <br><br>Any assistance would be greatly appreciated. <br><br></td></tr></table><br>
<a name="486483"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fredborg</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> The type elements of the array aren't automatically instanced when you create it.<br><br>You need to add:<br>sp.knot[0] = New Vec<br>Before trying to access the knot vector. <br><br></td></tr></table><br>
<a name="486539"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grover</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> So the array that is created, is only an array of references? And each reference has no allocated instance? If it were a builtin type instead what would happen? ie, replace Vec with int. (I just tried that, and builtin types work fine). <br><br>Is there a way to make a default constructor for this? It seems a little wierd for me to have to new each and every Vec in the array? Certainly a little counter to the way a Type is supposed to be similar to a class. Ie in c++ <br>class Vec {<br>public:<br>  float x,y,z;<br>};<br><br>class DisPos {<br>   Vec d[255];  &lt;-- no allocations needed when DisPos created<br>};<br><br>This must also mean things like copying user types is a manual process of implementing a copy routine (ala Blitz3d). I had hoped this would have changed. Adds a large amount of extra code, when basic is all about high level code reduction. <br><br></td></tr></table><br>
<a name="486540"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >fredborg</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Method New() is automatically called when you create a type instance, so you could go:<br>Type DispPos<br>  Field d:Vec[255]<br>  Method New()<br>    For Local:i = 0 until d.length<br>      d[i] = New Vec<br>    Next<br>  EndMethod<br>End Type <br><br></td></tr></table><br>
<a name="486546"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grover</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, I have done that. Its just that the array declaration isnt consistant across all types, so like I said, its very counter intuitive. Especially when Types are being called Class like. Not a good way to descibe them at all.<br>Also, I cant manage to get this to work at all<br>sp.dispmap[0].d[0].x = 10 <br><br>I have tried all sorts of different ways to tackle it - newing both the DispPos and Vec types, to no avail. The new method doesnt work either. I must be missing something?<br><br>Does BlitzMax support multi-level usertypes? <br><br></td></tr></table><br>
<a name="486547"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grover</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> finally managed a solution.. this is plain messy and has put me off Blitz again.<br><br>Type Vec<br>	Field x:Float<br>	Field y:Float<br>	Field z:Float<br>	Field w:Float<br>End Type<br><br>Type DispPos<br>	Field d:Vec[255]<br>	Method New()<br>		For Local i:Int = 0 Until d.length<br>			d[i] = New Vec<br>		Next<br>	EndMethod <br>End Type<br><br>Type Spline<br>	Field dispmap:DispPos[]<br>	Field knot:Vec[]<br>	Method New()<br>		dispmap = New DispPos[255]<br>		For Local i:Int = 0 Until dispmap.length<br>			dispmap[i] = New DispPos<br>		Next<br>		knot = New Vec[255]<br>		For Local j:Int = 0 Until knot.length<br>			knot[j] = New Vec<br>		Next<br>	EndMethod	<br>End Type<br><br>Global sp:Spline = New Spline<br><br>This is a very poor way to handle user typed arrays. <br><br></td></tr></table><br>
<a name="486549"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grover</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Additionally, each type will need a respective delete method.    Oh well.. ce la vie.. <br><br></td></tr></table><br>
<a name="486597"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >teamonkey</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Additionally, each type will need a respective delete method. Oh well.. ce la vie..  <br></div><br>No it won't. <br><br></td></tr></table><br>
<a name="486873"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tiggertooth</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Seems like BlitzMax works just like C++ in terms of constructing these arrays (assuming your arrays were arrays of pointers).  I think this is a reasonable approach for BlitzMax.<br><br>In general, allocating the memory for you could be bad because the User Type might require construction arguments, or the size of the array might need to be dynamic, or you might want to carefully control when this memory is actually allocated.<br><br>I can understand wanting to have automatic allocation, but given that User Types are stored by pointer not by value, I think BlitzMax is doing the best it can.  That may not change your opinion of it though :-)<br><br>Ken <br><br></td></tr></table><br>
<a name="488252"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grover</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Id disagree that BlitzMax works like C++, its quite a bit different. Allocating even a struct in C is totally different to a Type in BlitzMax. BlitzMax, as you pointed out, only allocates pointers on the heap, its is expected that the user must provide all allocations - but this is counter intuitive, because BlitzMax uses a smart pointer and garbage collection system, yet it requires the user to alloc? <br><br>A simple example of why BlitzMax isnt even close to C.<br><br>struct Point2D { int x, y; }<br>struct Box2D { Point2D tl, br; }<br><br>In C if I declare an instance of Box2D, the members and the parent is created in its entirity. like so:<br><br>Box2D  abox;   <br><br>In Blitz:<br>Type Point2D<br>    Field x:Int<br>    Field y:Int<br>End Type<br>Type Box2D<br>    Field tl:Point2D<br>    Field br:Point2D<br>End Type<br><br>Now an instance of Box2D:<br><br>Global abox:Box2D<br><br>That only creates a pointer to abox, its not even an object, so lets build an object<br><br>abox = New Box2D<br><br>Now, all that has been created is an object with two pointers in it. We still need to allocate them.<br><br>abox.tl = New Point2D<br>abox.br = New Point2D<br><br>Now Im pretty sure you can see why it is nothing like C++ or even C for that matter. All the inheretence, polymorphism and overriding in the world cant help there. So, the best solution is to implement a New method in every user-defined type. Even in a small project (game) this increases the amount of extra code to write, and certainly I think has also lead to alot of users not being able to follow why they are getting 'null field' errors. <br><br>It actually irks me a little that people keep calling Type's class like, when quite obviously they are nothing of the sort. And also, the term references for objects, when clearly they are not references (since a reference is an address of an already allocated object) but pointers? <br><br>I have managed to get what I wanted working in BlitzMax, but I am left wondering why a Basic has so much extra workload especially when they have a memory managed system running? <br><br></td></tr></table><br>
<a name="488636"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >teamonkey</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you mean that Max can't create objects on the stack, then no it can't. Nor can Java. In fact, Max's object model is very similar to Java's (although with the advantage that you can tell when the garbage collector is going to operate).<br><br>Also, your C++ example isn't memory managed. Even smart pointers in C++ (std::auto_ptr, boost::shared_ptr etc.) can't be used with objects created on the stack. To use memory management you have to create memory on the heap, just like Max, using New (or malloc or whatever).<br><br>People refer to Types as "classes" because Type definitions work just like C++/Java class definitions and hold all the properties that you'd normally associate with a "class". Likewise, people call Max's references "references" because they are references, not pointers. Pointers in Max are different beasties. An unititialised reference is still a valid reference, it's just a reference to Null. <br><br></td></tr></table><br>
<a name="488661"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tiggertooth</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> To Grover:<br><br>BlitzMax types are like C++ classes if (as I mentioned in my post) you contain by pointers rather than by value.  To show your example:<br><br>In C++:<br>struct Point2 { int x,y; };<br>struct Box2D { Point2 *tl, *br;};<br><br>Now it works like BlitzMax (you have to new tl and br).  That was the point I was trying to make.  I think there are great reasons to build systems like this.  It might have been nice if BlitzMax supported containment by value, but it still is powerful, works much like other OO languages, and gives you precise control.<br><br>Ken <br><br></td></tr></table><br>
<a name="488692"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grover</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> teamonkey - yes point taken, Blitz is alot more like Java, hence then OOP in likeness. Technically the example isnt memory managed, however the stack will clean itself up :-)  <br><br>Okay with the pointer/reference thing, I am getting a little confused obviously by what is implemented. When an object is created is it assigned a hash key or some such, which then is used as a lookup to the memory it uses?  Hence the need to New all user defined types? And builtin types are assigned directly to an object? The idea that an object and reference are the same thing holds true?<br><br>I guess my confusion has mainly come from thinking it as a C++ styled implementation - thinking Java has actually made alot more sense. <br><br>Thanks for the feedback Tigger and teamonkey, my head is actually alot clearer now :-) I apologise for my misunderstanding.. got it quite wrong.. &lt;damn idiot I am&gt;. I have been immersed in Symbian for the last 4 weeks, and I think I was starting to see everything in C++... :-) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
