<!DOCTYPE html><html lang="en" ><head ><title >bits, bytes and bitshifts</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >bits, bytes and bitshifts</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >bits, bytes and bitshifts</a><br><br>
<a name="614760"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >deps</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>Wanted to try and write some code that could deal with Flac files. (http://flac.sourceforge.net/)<br><br>The problem I have now is when I load the Metadata blocks.<br>Inside the blockheader is 24 bits that shows how long the block is. If I'm not mistaken, 24 bits is equal to 3 bytes. So I need to load these three bytes to get the length. If I use ReadInt( filestream ) it will read four bytes, so I guess I must use ReadByte() and do some bitshifts to get the correct length of the block.<br>This is what I have at the moment and it's not working at all since it gives me some strange sizes:<br><br><pre class=code>
	' Length of this block
	Local b1:Byte = ReadByte(fs)
	Local b2:Byte = ReadByte(fs)
	Local b3:Byte = ReadByte(fs)
	
	Local blen:Int = (b3 Shr 0) | (b2 Shr 8) | (b1 Shr 16)
	
	Print "  Block length in bytes: "+blen
</pre><br><br>The first block (StreamInfo) is reported to be 18 bytes. I guess that could be right since a block can be from 16 to 65535 bytes long.<br>The next block is reported to be 14483481 bytes long. That doesn't seems right to me, and then the app freezes while trying to jump to the next block after that. <br><br>So... What did I do wrong? I have tried to rearrange the b1,b2,b3 vars and then 0,8,16 values but can't get anything that works right. changing Shr to Shl doesn't help either.<br>The Flac files is written in BigEndian format. (edit: and i load the file using bigendian:: in front of the filename)<br><br>Or am I overcomplicating things here? <br><br></td></tr></table><br>
<a name="614762"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >deps</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Think I solved it. :P<br><pre class=code>
Local blen:Int = (b3 Shl 0) | (b2 Shl 8) | (b1 Shl 16)
</pre><br>is the right one to use, at least on a Mac, and the real problem was some lines above, where I read a byte when I should have read a bit. <br><br></td></tr></table><br>
<a name="614769"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Haramanai</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> There is an example that uses this technic to write a pixel in a pixmap in the BlitzWiki : <a href="http://www.blitzwiki.org/index.php/WritePixel" target="_blank">http://www.blitzwiki.org/index.php/WritePixel</a><br>Have a look at it, it may help you. <br><br></td></tr></table><br>
<a name="614772"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Deps, I think you're right. The first byte you have read has been shr 16 by reading it as a single byte so you need to SHL. <br><br></td></tr></table><br>
<a name="614828"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can get rid of the (b3 Shl 0) and just replace it with b3<br><br>ie<br><br>Local blen:Int=b3 | (b2 shl 8) | (b1 shl 16) <br><br></td></tr></table><br>
<a name="615010"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Alternatively you can read an Int, shift it once to mask off the unwanted byte (or `and` it with a mask), then set the file position back one byte. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
