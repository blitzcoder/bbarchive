<!DOCTYPE html><html lang="en" ><head ><title >FOR bug</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >FOR bug</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >FOR bug</a><br><br>
<a name="773268"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MrCredo</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>
j=20
For i=1 To j
	Print "max:"+j+" current:"+i
	j=j-1
Next
</pre><br><br>run this code<br><br>"j" in for is not updated - i don't know why, but it should<br><br>test above code in blitzplus - last output should be "max:11 ..."<br><br><br><pre class=code>
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int main()
{
    int i;
    int j=20;

    for (i=0; i&lt;j; i++)
    {
        printf("max:%i%s%i\n",j," current:",i);
        j--;
    }
}
</pre><br><br>test this c code - last output should be "max:11 ..."<br><br><br>XPsp2 <br><br></td></tr></table><br>
<a name="773276"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yan</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is by design, 'j' is only evaluated at the start of the loop (unlike previous incarnations of blitz). <br><br>Use While/Wend or Repeat/Until for this kinda thang.<br><br><br>Isn't this in the docs?<br><br>[edit]<br>Yes it is, got to 'Language&gt;Program Flow' and in the 'For/To/Next Loops' section, ye shalt find...<div class="quote"> The exit value is only evaluated once at the start of the loop. This means it is safe to use complex or 'slow' code as an exit value. <br></div>[/edit] <br><br></td></tr></table><br>
<a name="773294"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MrCredo</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> hm i don't like this "design" - this is non-standard <br><br></td></tr></table><br>
<a name="773297"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> It makes perfect sense.  The "to" part must be a constant.<br><br>If you aren't happy with that, then as Yan said, use While/Wend, or Repeat/Until, depending on whether you want the expression evaluated at the start or end of the loop. <br><br></td></tr></table><br>
<a name="773309"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Works for me too :-) <br><br></td></tr></table><br>
<a name="773326"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> The for in C isnt really the same as a for in Basic.<br><br>HOWEVER, I agree with you, the Bmax result is... Unexpected if you have been using something else latly.<br><br>I mean B3D would give 11 as the max....<br><br>I think<br>1) It was a bug, which was co-opted as a feture<br>2) It needs serious defence, on speed grounds<br>3) I Prefer it. <br><br>@GFK and Yan.<br>I agree with both of you, but when all said and done it is a deviation from the BASIC standard that BRL have used, and some reason for the change would be good.<br><br>@MrCreda.<br>Ive never trusted these "POP/Exit the loop" variable changes, and before I used it in any code, I would generaly test it to see what the Language did. I use BMax to exclution now, and its handleing seems natural, but I can see that it isnt  obviously so. <br><br></td></tr></table><br>
<a name="773334"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MrCredo</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> the problem is that FOR works with "constants" but j is not a constant (you understand?) - and you can't trust the result - this makes for-loop not usable.<br><br><pre class=code>
for i=0 to array.length-1
  print array[i]
  array=array[..array.length-2]
next
</pre><br><br>codes like this are buggy in blitzmax - and this should signal that here is something wrong with for. yes i can use other loops, but i call this workaround.<br><br>=EDIT=<br><br>BlitzMax should detect automaticaly "constant" or "variable" as select optimized routines... <br><br></td></tr></table><br>
<a name="773352"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Who was John Galt?</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I guess it's a matter of preference, but I like Max loops just the way they are. Modifying for loop variables in the loop makes for hard to read code. <br><br></td></tr></table><br>
<a name="773366"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yan</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Whether it's 'standard' or not, this is the way BMax works.<br><br>It's the way it's always worked.<br><br>It's documented.<br><br>It's not gonna change.<br><br>There are viable alternatives for what you're trying to do, even if you see them as 'workarounds'.<br><br>Stop worrying about it, have a nice cup of tea and get on with your coding. :o) <br><br></td></tr></table><br>
<a name="773382"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is by design. <br><br>It means you can have quite complex/slow expressions as the 'To' value and not have to worry about them being re-evaluated every loop, eg:<br><br>For Local x=0 Until ReallySlowFunction() <br><br></td></tr></table><br>
<a name="773386"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is cool, so you can do this:<br><br>For v=0 to CountVertices()-1<br><br>Instead of:<br><br>verts=CountVertices()<br>for v=0 to verts<br><br><br>You can even do this:<br><br>For n#=5 To 0 Step -0.5<br>	Notify n<br>Next <br><br></td></tr></table><br>
<a name="774008"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah I like it this way.  I'd use a While Went or Repeat Until if I say had a list and was removing items until it was empty. <br><br></td></tr></table><br>
<a name="774047"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I personaly prefer it this way as well, and as Ive said I never assume anything about what happens in any lang when you mess with the Index or the condition <br><br></td></tr></table><br>
<a name="774113"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Andrew Rollings</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I dunno... It's very counter-intuitive. I would call that a bug... In every other language I can think of, if you don't want to re-evaluate every loop, you store it in a variable outside the loop...<br><br>It seems a big sacrifice to make for a small convenience.<br><br>Andrew <br><br></td></tr></table><br>
<a name="774135"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> It seems a big sacrifice to make for a small convenience. <br></div>I disagree. Which sacrifice? How often do you modify the ending index of a for loop? If the answer is "very often" then I'll bet you do that to prematuraly exit the lopp. And frankly that's not a very good idea IMHO.<br>On the other hand, not having to worry about declaring and initialize a variable before the loop - for the sake of avoiding duplicate unneeded evaluations - is certainly a nice little plus on the code clarity side. <br><br></td></tr></table><br>
<a name="778021"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> In addition to the exposed beneffits, I supose that evaluating the expression "to" once, can let the compiler store the result (if it is an integer) in a processor register, wich is faster than accessing a regular variable. <br><br></td></tr></table><br>
<a name="778468"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_33</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> The only problem I find with the For statement which irritates me if that someitmes I would like to have a Step a, where a would either be -1 or +1, but that doesn't work. <br><br></td></tr></table><br>
<a name="778479"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can use Step, I do it all the time...<br><br>Edit: Oh wait, you mean you actually want to use a variable in the Step command?  Strange, I can't see a need for that, but I guess anything is possible... <br><br></td></tr></table><br>
<a name="778545"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> I can see a need for a variable step size.  One example is drawing a grid<br><pre class=code>For Local X:Int = 0 to 800 Step Size
    DrawLine X,0,X,600
Next
For Local Y:Int = 0 to 600 Step Size
    DrawLine 0,Y,800,Y
Next
</pre><br><b>Size</b> would be the size of your grid.  Except this code will not work since the step portion must be a constant.  So instead, I have to do something like this.<br><pre class=code>Local X:Int = 0
While X &lt; 800
    DrawLine X,0,X,600
    X :+ Size
Wend

Local Y:Int = 0
While Y &lt; 600
    DrawLine 0,Y,800,Y
    Y :+ Size
Wend</pre> <br><br></td></tr></table><br>
<a name="778547"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>For Local X:Int = 0 to 800/Size
    DrawLine X*size,0,X*size,600
Next
For Local Y:Int = 0 to 600/Size
    DrawLine 0,Y*size,800,Y*size
Next</pre><br>However I agree that I dont like step needing to be a const. I dont maind it being evaluated once, but why can I not have a variable <br><br></td></tr></table><br>
<a name="778567"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blueapples</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> This behavior is standard BASIC behavior and has been for 40 years. BRL aren't going to change it. <br><br></td></tr></table><br>
<a name="778656"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> This behavior is standard BASIC behavior and has been for 40 years. BRL aren't going to change it <br></div>Which?<br>Because "to" is different between B3D and BMax. So it was changed at some point. <br><br></td></tr></table><br>
<a name="778660"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blueapples</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry, I mean the single evaluation of the limit expression. The properties of TO are often unique to different dialects, though personally I prefer QuickBasic style. A variable step seems very un-BASIC, why not just use While? I'd be for it if the step value was evaluated *once*, just like the limit value.<br><br>Things like this scare me though, if the Step value was evaluated on every loop:<br><br><pre class=code>
For Local X:Int = 0 to 800 Step Size
    DrawLine X,0,X,600
    Step :+ 1
Next
</pre><br><br>This is far too subtle. Much better to be more obvious and use While or some other loop. <br><br></td></tr></table><br>
<a name="778665"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>Direction = 1 or -1
For x = StartPoint to StartPoint+Direction*Length step direction
    Plot or do STuff
Next</pre>JetPac laser (for example)<br>I have no problem with the expression being evailuated once, but I do think that I should be able to change the step before this evailuation.<br>I used to be able to do it on the spectrum, and whilst I accept that I can/should use some of these newer loops, I have often instintivly used a for to step. <br><br></td></tr></table><br>
<a name="778996"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Object-orientated is very un-BASIC but it's in BlitzMax. I don't see what's so evil about a variable step. I've needed it once, and had to make messy while loops instead. If you don't want to use it, then don't. The compiler can easily detect whether the step is constant or not and change the code accordingly. <br><br></td></tr></table><br>
<a name="779071"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blueapples</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> Object-orientation is a straw man argument: that feature is an addition, not a modification. Changing expectations (beyond adding new features) is a bad idea. It isn't BASIC if the core stuff doesn't behave as expected. <br><br></td></tr></table><br>
<a name="779072"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Re STep<br>Mr Blueapples you seem to be under the impressiom that this is a change that isnt already in some other Basics. It is in some other Basics. Its not changing expectations, because, as I said in this thread <div class="quote"> I would generaly test it to see what the Language did <br></div><br>Its also a change that woulnt effect anything already written. <br><br></td></tr></table><br>
<a name="779135"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's adding functionality that wouldn't affect anybody who didn't know about it. It's kind of hard to accidently modify a variable expecting it to be a constant, unless you didn't know what you were doing. <br><br></td></tr></table><br>
<a name="779146"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Every BASIC I've used allows a variable for a step size.  I also checked with Visual Basic and, sure enough, even that allows a variable step size.  BlitzMAX is the first BASIC variant I've used that only accepts a constant for a step size.<br>Here is the original manual for the first BASIC.  <a href="http://www.bitsavers.org/pdf/dartmouth/BASIC_Oct64.pdf" target="_blank">http://www.bitsavers.org/pdf/dartmouth/BASIC_Oct64.pdf</a><br>Notice the example on page 22.  Definately using a variable for the step size.<br><br>There are several advantages to a variable step size.  One is speed.  The step has to be evaluated only once.  If you must use a While..Wend construct, then the step must be evaluated every time through the loop.<br>Second, it just looks and reads better.  Look at my two examples above.  It is much easier to understand what is going on in the For..Next..Step loop rather than the While..Wend loop.  It gets even worse when the loops get more complex.<br>I see no advantages to restricting the step size to a constant. <br><br></td></tr></table><br>
<a name="779158"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> Actually I would have thought a constant step size would have been faster, as accessing a constant is quicker than getting a variable from memory. But I don't see how it would be difficult for the compiler to detect whether it is a constant or variable and change the code accordingly, no differently to detecting a = b + 1 from a = b + c. <br><br></td></tr></table><br>
<a name="779161"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> One is speed....<br><br>Actually I would have thought a constant step size would have been faster <br></div>What I belive Tom was refering to was not the comparison between a variable step(evaluated once), and a constant step, but rather that a for loop with a variable step would be quicker than the alternative method needed to achieve this, specified by Tom (for example) as a While..Wend loop <br><br></td></tr></table><br>
<a name="779164"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was basically stating that a variable in a For..Next..Step loop would be faster than using a variable in a While..Wend loop, because since the parameters are only evaluated on entering the loop, you only need to grab the value from memory once.  From there, it can be grabbed from the stack or a register.  But since the values in a While..Wend loop are evaluated each loop, and since the values can change, then they must be grabbed from memory every loop.<br>Actually, the only slowdown with a variable instead of a constant in a For..Next..Step loop would be on entering the loop.  After that, there shouldn't be no difference in the speed of a constant and a variable, since the variable would've been reduced to a constant after evaluation. <br><br></td></tr></table><br>
<a name="779172"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SculptureOfSoul</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> This reminds me why I love Lisp so much. Extending the language to include a customized for loop as in the suggestions above would take you all of 5 minutes with a macro. <br><br></td></tr></table><br>
<a name="779188"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skn3</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> I like it the way blitzmax does it!<br><br>It was something that wasn't clear as to which way (never done any tests).<br><br>Would be good if this could be a strict / non strict implementation though! Best of both worlds. <br><br></td></tr></table><br>
<a name="779212"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> Alright, we know this isn't a bug, the mechanics shouldn't be changed because this is how Blitz has always worked, and you should definitely use a While loop if you want to modify variables the loop depends upon so that you know what's happening.  Why hasn't this thread died, then? <br><br></td></tr></table><br>
<a name="779241"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SoggyP</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello.<br><br>Just to add to the mix, I thought While/Wend was faster than For/Next?  I can't confirm that being in work and I may have been drunk/dreaming/deceased at the time but I'm sure While is faster.<br><br>Goodbye. <br><br></td></tr></table><br>
<a name="779243"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Just to add to the mix, I thought While/Wend was faster than For/Next? I can't confirm that being in work and I may have been drunk/dreaming/deceased at the time but I'm sure While is faster. <br></div><br>Actually, they compile down to the exact same assembler output ;) <br><br></td></tr></table><br>
<a name="779276"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blueapples</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Actually, they compile down to the exact same assembler output ;) <br> <br></div><br><br>I'm quite sure that they do not. That's the point of a large portion of this conversation; While evaluates it's condition on <b>every</b> iteration, but For's upper limit is <b>evaluated once</b> and then that unchanging result is compared to the For variable on each iteration.<br><br>Those two things cannot possibly result in the same ASM. <br><br></td></tr></table><br>
<a name="779279"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blueapples</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>I see no advantages to restricting the step size to a constant. <br> <br></div><br><br>I totally agree. I think I missed a post or two, what I understand the term "variable" to mean is usually that the value <b>varies</b>, meaning, I was reading various arguments as suggesting that the step value could <b>change</b> during the loop. I hope that's obviously a bad idea.<br><br>So I agree, but actually I think the step value should be an expression, not a constant or variable, or any other specific item, just <b>any</b> kind of expression. Provided that that expression is, like the limit, evaluated once when the loop is entered. <br><br></td></tr></table><br>
<a name="779281"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I'm quite sure that they do not. <br></div><br>Asside from the constant eval for <b>for</b> loops, they do.<br>But dont take my word for it, check it out for yourself. <br><br></td></tr></table><br>
<a name="779292"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blueapples</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Asside from the constant eval for for loops, they do.<br>But dont take my word for it, check it out for yourself.<br> <br></div><br><br>Hmmm. You're right. That's just... wrong, but I guess it makes sense in a way. Given this, I would be afraid how they might end up implementing support for expressions/variables as step arguments in for. That would probably lead to exactly what I think is a terrible and bug causing behavior: allowing the step value to change during a loop.<br><br><br>Both types of loops look like this (with a "I :+ 1" inside the While loop):<br><br><pre class=code>
	mov	eax,10

_6:
	add	edx,1
_4:
	cmp	edx,eax
	jle	_6
</pre><br><br>So, it would seem that For actually does <b>not</b> use a constant eval, since it is just taking the value from eax without any kind of checking. I added "I :- 1" to the loop, and it just modifies eax merrily without caring that it's in a For loop.<br><br>The While however does prefix the loop with this:<br><br><pre class=code>
_2:
	mov	edx,1
	jmp	_4
</pre><br><br>So, technically, it does do three more instructions (jmp, cmp, jle) than the equivalent For loop. But if anyone is worried about three CPU instructions, they shouldn't be writing their code in BMax in the first place.<br><br>BMax code used to get this ASM:<br><pre class=code>
Framework BRL.Blitz
Local I:Int
Local Limit:Int = 10

For i = 1 To Limit
i :- 1
Next

i = 1
While i &lt;= Limit
	i :+ 1
Wend
</pre> <br><br></td></tr></table><br>
<a name="779293"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> ... at least nothing that'll make a speed difference even over 100000s of loops. <br><br></td></tr></table><br>
<a name="779296"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blueapples</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> Even better, they really are exactly the same. I hadn't noticed a couple instructions, the for loop does the same jump and initial check. So... no difference. Nuts, I guess I really should look into things before just blinding making claims like that.<br><br>To be fair, this isn't the behavior I'm used to. <br><br></td></tr></table><br>
<a name="779297"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> Fifty Percent More, maybe this thread hasn't died because whether you can see it or not, people want that extra percent more ironically. A good programming language doesn't deny you flexability for arbitary reasons, and some examples of its usage have been given.<br><br><div class="quote"> mechanics shouldn't be changed because this is how Blitz has always worked <br></div><br><br>Then go back to Blitz Basic 1, whatever that was.....<br><br>A step which can be anything but isn't changed during the loop is what I have needed before, but had to use clumsy while loops (nested too) to achieve the effect.<br><br>If people want to use a varying step inside the loop I don't see why not. What do you mean by bugs? Such a simple thing wouldn't cause any random Blitz Basic bugs.<br><br>If you're referring to bugs the programmer makes, then if they really wanted to they could do the same with equivilent while loops if they really wanted to (which would probably cause more bugs due to less readability) so you're not protecting anybody by disallowing it.<br><br>If you don't want to use varying steps, that is fine. But what's so great about this addition is that all previous code would work the exact same way. If steps that could vary were secretly added, you would never know (unless you tried it). So it's not like we are purposing a radical change that would mess up people's code.<br><br>So in summary, if the task can already be accomplished, but using a less tidy method, and a tidy method is disallowed for just an arbitary reason, then why not allow it? Why so much resistance? Want Blitz to work as it aways has? Then just don't use it :) <br><br></td></tr></table><br>
<a name="779466"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Fifty Percent More, maybe this thread hasn't died because whether you can see it or not, people want that extra percent more ironically. <br></div>Good for you, I'm sure you understand every aspect of this.<br><div class="quote"> A step which can be anything but isn't changed during the loop is what I have needed before, but had to use clumsy while loops (nested too) to achieve the effect. <br></div>So you're saying that because you know exactly where something is happening, it's clumsy?<br><div class="quote"> If people want to use a varying step inside the loop I don't see why not. What do you mean by bugs? Such a simple thing wouldn't cause any random Blitz Basic bugs. <br></div>If you're talking to me, I said no such thing about it causing random bugs.  I'm simply talking about mechanics that, if changed, would result in slower loops (something you don't seem to understand). <br><br></td></tr></table><br>
<a name="779480"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I said no such thing about it causing random bugs. I'm simply talking about mechanics that, if changed, would result in slower loops (something you don't seem to understand). <br></div>I dont think that step being a Variable/expression which is analysed once would make it a slower loop. It would (probably) make the setup of the loop take one maybe two cpu cycles slower, but once in the loop, the loop would take the same amount of time.<br><br>If the expresion was to be analyised each loop then yes ok slower each loop, but int the way I would like it, the Step once computed will be available at just the same speed.<br><br><div class="quote"> the mechanics shouldn't be changed because this is how Blitz has always worked <br></div>As had been pointed out before and after your post, For next step <b>has not</b> been consitant across the blitz range<br><br><div class="quote"> So you're saying that because you know exactly where something is happening, it's clumsy? <br></div>That makes no sence? What was being said was that as many of us used to do it like that in prvious Basics, we tend, without analysing it, to do it that way again<br>, yet it no longer works<br><br>I say this in all seriousness, but you can probaly see a better way to do things with the more modern commands that have always existed for you. However in the Basic that I, (and probaly others) learnt "for to step" was practicly the only loop we had, (excluding goto/gosub). And I nearly always approach a index loop problem by trying a for first.<br>This doesnt mean thta you are not correct, amd that the for loop should be streamlined to be the fastest, but it deosnt surly preclude the possibility that a more general for loop structure might be of more productive use <br><br></td></tr></table><br>
<a name="779609"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> @BlueApples:  Your simple example does not properly illustrate where While..Wend will slow down the execution of loops over For..Next.<br>Using this code:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Local Lowvalue:Int
Local HighValue:Int
Local Multiplier:Int

For Local I:Int = 0 To (GetLowValue() + GetHighValue()) * GetMultiplier()
	Print I
Next
Rem
Local I:int = 0
While I &lt;= (GetLowValue() + GetHighValue()) * GetMultiplier()
	Print I
        I :+ 1
Wend
End Rem

Function GetLowValue()
	Return 10
End Function

Function GetHighValue()
	Return 1000
End Function

Function GetMultiplier()
	Return 5
End Function
</textarea><br>Produces this for the For..Next loop<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">	call	_bb_GetLowValue
	mov	ebx,eax
	call	_bb_GetHighValue
	add	ebx,eax
	call	_bb_GetMultiplier
	imul	ebx,eax
	jmp	_34
_21:
	push	esi
	call	_bbStringFromInt
	add	esp,4
	push	eax
	call	_brl_standardio_Print
	add	esp,4
_19:
	add	esi,1
_34:
	cmp	esi,ebx
	jle	_21
_20:
	mov	eax,0
_22:
	pop	esi
	pop	ebx
	mov	esp,ebp
	pop	ebp
	ret</textarea><br>And this for the While..Wend loop<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">	mov	esi,0
	jmp	_19
_21:
	push	esi
	call	_bbStringFromInt
	add	esp,4
	push	eax
	call	_brl_standardio_Print
	add	esp,4
	add	esi,1
_19:
	call	_bb_GetLowValue
	mov	ebx,eax
	call	_bb_GetHighValue
	add	ebx,eax
	call	_bb_GetMultiplier
	imul	ebx,eax
	cmp	esi,ebx
	jle	_21
_20:
	mov	eax,0
_22:
	pop	esi
	pop	ebx
	mov	esp,ebp
	pop	ebp
	ret</textarea><br>It is conceivable that the return values of function calls would be used as part of the exit test, and that could result in a considerable amount of time difference with the WHile..Wend loop over the For..Next loop.<br>Now if the Functions are to be only evaluated once, such as it is in the For..Next loop, you could use this:<br><pre class=code>Local I:Int = 0
Local Temp:Int = (GetLowValue() + GetHighValue()) * GetMultiplier()
While I &lt;= Temp
	Print I
	I :+ 1
Wend</pre><br>Which produces this:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">	mov	esi,0
	call	_bb_GetLowValue
	mov	ebx,eax
	call	_bb_GetHighValue
	add	ebx,eax
	call	_bb_GetMultiplier
	imul	ebx,eax
	jmp	_19
_21:
	push	esi
	call	_bbStringFromInt
	add	esp,4
	push	eax
	call	_brl_standardio_Print
	add	esp,4
	add	esi,1
_19:
	cmp	esi,ebx
	jle	_21
_20:
	mov	eax,0
_22:
	pop	esi
	pop	ebx
	mov	esp,ebp
	pop	ebp
	ret</textarea><br>Nearly identical to the For..Next loop, but the loop just gets uglier and uglier.  Also the more you must implement yourself, the more likely that bugs will creep in.  When I first compiled the two examples above, I forgot to include the <b>I :+ 1</b> in the While..Wend loop,  a problem that would not occur in the For..Next loop.<br><br>ETA:  The above is compounded when adding the Step value to the equation, which is where I have problems with the implementation of For..Next. <br><br></td></tr></table><br>
<a name="779958"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> So you're saying that because you know exactly where something is happening, it's clumsy? <br></div><br><br>So why write a program using functions when you can use goto and gosubs? After all, if you know exactly what's happening, it's not clumsy is it.<br><br><div class="quote"> If you're talking to me, I said no such thing about it causing random bugs. <br></div><br><br>I was refering to Blueapples.<br><br><div class="quote"> if changed, would result in slower loops (something you don't seem to understand).  <br></div><br><br>Like I said, <br><div class="quote"> The compiler can easily detect whether the step is constant or not and change the code accordingly.  <br></div> And this is proved by the fact the compiler complains if you use a non-constant. And what I meant was the compiler can be changed/modified to do that, rather than it can do so already, in case you misunderstand me.<br><br>So if the step value is constant, like it is now, then it treats it as the for loop is now. However if the step is a variable, it creates it as a new, though slower, kind of loop. But using the for loop in the "standard" way will still not cause any slowdown.<br><br>What exactly have I misunderstood? Please enlighten me. <br><br></td></tr></table><br>
<a name="780149"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Otus</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#49">[#49]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I dont think that step being a Variable/expression which is analysed once would make it a slower loop. It would (probably) make the setup of the loop take one maybe two cpu cycles slower, but once in the loop, the loop would take the same amount of time. <br></div>I think it would. A variable/expression would have to be evaluated at run time, so the compiler could not optimize the loop as efficiently.(See <a href="http://en.wikipedia.org/wiki/Loop_unrolling" target="_blank">http://en.wikipedia.org/wiki/Loop_unrolling</a> ) <br><br></td></tr></table><br>
<a name="780188"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#50">[#50]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well as Czar Flavius said, it's easy for the compiler to handle both cases differently: the case where the expression is constant, and the case wher it's not. So it's not like it's not doable. The question is, is it really an improvement to have a construct called "for" that is actually a disguised general loop? Any loop that has a variable step has little to do with my idea of a "for" loop, and the principle of least astonishment should apply here: if it doesn't feel like a for loop, then maybe it shouldn't look like it. It will cerainly be easier to read and maintain for me.<br>That's naturally totally personal, but I think it applies to most people, wether they realize it or not. <br><br></td></tr></table><br>
<a name="780225"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#51">[#51]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> A variable/expression would have to be evaluated at run time <br></div>Once at the commensment of the loop, after which it would be effectivly a const. So no I disagree that the loop itself would now not be as efficient. <br><br></td></tr></table><br>
<a name="780301"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#52">[#52]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>The 'const step size' issue was discussed back in the B3D days, but I'll explain why it's the way it is again.<br><br>The problem is that the sign of the step size affects the comparison code needed to 'terminate' the loop - ie: greater-than if step is &gt;0, less-than if it's &lt;0.<br><br>To do this 'on the fly' is pretty ugly - it'd look something like this (emulating for/next with repeat):<br><pre class=code>
Local _from=1
Local _to=10
Local _step=GetVariableStep()
Local _index=_from
Repeat
  '
  ' yuck...
  If _step&gt;0
    If _index&gt;_to Exit
  Else
    If _index&lt;_to Exit
  EndIf
  '
  'your code here...
  '
  _index:+_step
Forever
</pre><br><br>But you generally know when writing the code whether the comparison should be &gt; or &lt;, so the code is less efficient than writing your own 'while' or whatever - and I don't particularly like the compiler generating less efficient code for the sake of convenience.<br><br>The problem is really to do with the lack of enough information in BASIC's for/next construct. For example, C makes you explicitly provide the terminating condition:<br><br>//will not work well if step is &lt;0!<br>for( _index=1;_index&lt;=10;_index+=step ){...}<br><br>However, I agree that it's inconvenient, and perhaps I should relax things a bit here? The slow/wonky comparison would only need to be generated for non-const steps anyway.<br><br>Another option would be to generate 2 'versions' of the entire loop, and select which one to use at loop entry. This would be efficient, although a little nasty for me to mung into the compiler! <br><br></td></tr></table><br>
<a name="780321"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#53">[#53]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>Local _from=1
Local _step=GetVariableStep()
Local _index=_from
Local _to=10* Sgn _step
Repeat
  '
    If _index* Sgn _step&gt;_to Exit

  '
  'your code here...
  '
  _index:+_step
Forever</pre>But I admit that would slow the loop more than I had been claiming <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
