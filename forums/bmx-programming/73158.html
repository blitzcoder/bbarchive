<!DOCTYPE html><html lang="en" ><head ><title >BlitzMaxier 2D?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >BlitzMaxier 2D?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >BlitzMaxier 2D?</a><br><br>
<a name="817756"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Would anybody be interested in creating a 'package' for BlitzMax which extends the existing 2D command set and collects useful modules and code archives.<br>(a bit like the B2D Extended DLL did).<br>Maybe have a thread where people can request features which are found if existing or written if possible?<br>I am not talking so much about new engines and wrappers but more new functions : blend modes, multitexturing, drawimagerect etc <br>Might even go as far as Particle and Sprite systems and, perhaps, TileMap editors.<br>Anyway, what do people think?<br><br>&lt;edit&gt; From the requests :<br><a href="/posts.php?topic=73174" target="_blank"> Line Antialias </a><br><a href="/posts.php?topic=73193" target="_blank"> Unfilled/filled shapes </a><br><a href="/posts.php?topic=73195" target="_blank"> BBstyle DrawImageRect </a><br><a href="/posts.php?topic=73197" target="_blank"> Scaled pixmaps </a><br><br>Once these threads have had enough (?) input I'll add comments and tidy the variable names.<br>Maybe edit them into a module here? <br><br></td></tr></table><br>
<a name="817761"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CS_TBL</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> how about these:<br>- anti-aliased line and open oval<br>- open rect (yeah, simple, to do, but nice to have natively)<br>- resurrection of ye olde DrawImageRect, but then one that doesn't bug on various videocards -including my Geforce4MX-.<br><br>I'm not sure about particle, sprite and tilemap stuff, this is all so terribly custom to one's needs that it's nearly impossible to make a one-stop solution. I'd focus on the smallest elements only. Take particles.. drawing something is not really a biggie, the biggest part of such a particle system would be the math and the programmability of that math. Technically speaking such a particle system can serve anything, gfx just being one of many examples.<br>Sprites idem.. there's quite some overlap with particles I think, in any case it's perhaps a bit too high-end if you ask me.<br>Tilemaps, same again.. there're so many things one might want to have in a maptile class. Rather than having to investigate how a lib works, I rather make my own tile class in 5 minutes.. :P<br><br>So, all nice, but I'd focus on low-level/basic functionality. That said, don't let me stop you if you want to do particles/sprites/tiles anyway. :P <br><br></td></tr></table><br>
<a name="817764"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >pls</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Take a look at the grey alien framework... <br><br> PLS <br><br></td></tr></table><br>
<a name="817768"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> It would be nice too, if one could control when glstart/end are used... Surely it can't be very efficient to call them *every* time you draw a line ?<br><br>The programmer should be big enough to know when to end it himself..<br><br>Unless it doesn't matter that they are called all the time, of course?<br><br><br>I had to write my own set of "open" drawing functions for the graphviz module - rectangle, ellipse, etc. Bit of a pain, as it is something you would have expected to be available in the package already... <br><br></td></tr></table><br>
<a name="817769"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> For every line, no. But whenever you switch texture you must have it within a begin end ... so the "regular BM" programmer wouldn't be capable of doing it correctly.<br><br>Although I like this idea ... a BeginDraw(textureHandle) ..... EndDraw() would surely be something usefull :) <br><br></td></tr></table><br>
<a name="817770"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Take a look at the grey alien framework... <br> <br></div><br>I have GA's framework which does have some extended functions but I am thinking more community driven requests rather than a framework. In fact GAs framework includes some of the functions from the Code Archives and/or supplied in posts so could also benefit.<br><br>@CS_TBL, yep I agree with the Particle, Sprite and Map Editor remarks. However, if somebody was to say "You can package my Particle System" and it's a good one then it won't hurt to add it.<br>Your requests are very much the sort of thing I envisaged. The extra benefit is having a few more people available to stress test any solutions.<br><br>@Brucey, The glstart/glend query is another good one. <br>Does it matter? I don't know but maybe others *do* know and/or are willing to test it. <br><br>Finally, there are open drawing functions in the Code Archives. I haven't used (they might even be yours Brucey) but, if somebody has a problem with them, it could be looked at further.<br><br>Anyway, thanks for the interest.<br>As always I guess it's who is willing to help and how it can be controlled. Many times I see the comment :<br><div class="quote">  Can this be added to the official modules?  <br></div> which gets no response. I would prefer an official update but, maybe, the next best is <br><div class="quote">  Can this be added to the unofficial modules?  <br></div><br><br>&lt;EDIT&gt; From DX point of view 'SetFillStyle' should allow filled/non-filled rects, circles, elipses etc. I'll have a look.<br>I can see how to anti-alias a line in DX but OGL seems OK. I also think some graphics cards don't allow anti-alias which was the problem with B3D. <a href="/codearcs.php?code=1683" target="_blank"> GetCaps </a> shows the cards DX capabilities with this<br><pre class=code>
If mycaps.dwRasterCaps_LINE &amp; D3DPRASTERCAPS_ANTIALIASEDGES 
   Print "The device can antialias lines forming the convex outline of objects."
Else
   Print "The device can NOT antialias lines forming the convex outline of objects."
EndIf
</pre><br>showing if it can do it or not (I think : It was a long time ago I wrote GetCaps and didn't really know what I was doing : still don't). <br><br></td></tr></table><br>
<a name="817776"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sounds like a good idea (except for future framework sales ;-) but I don't mind).  I was thinking about this just yesterday.  Basically the code archives are all spread out and have lots of less useful stuff, and many other cool bits of code are in general posts, not the archives.  So to collate it all (perhaps standardising some names) and make it into a single downloadable file (or several files based on category) would be pretty cool.  Who's gonna do it though? <br><br></td></tr></table><br>
<a name="817777"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CS_TBL</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> You know what I'd like? I dunno whether it's possible.., to draw a TPixmap... scaled, with SetScale! <br><br></td></tr></table><br>
<a name="817780"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> @GA, Yep I agree about collating the useful code. Not that they're not all useful in some way just some are more niche than others.<br>As for who is going to do it : Not my strong point although I would be willing to help to some degree. <br>Maybe somebody who has a syncmods server. If we have guidelines for the code it could be as easy as a cut/paste into a module.<br>@CS_TBL, might be worth adding it as a normal post then, if/when it is answered, it can be stuck in Code Archives and then be a candidate. <br><br></td></tr></table><br>
<a name="817784"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> How about something like GoogleCode ?<br><br>I'm using it for wxMax, and it's very good, and has a simple interface.<br>Give a few chosen developers write access to the repository, who can apply fixes, add new functionality.<br><br>Work out a release strategy, which doesn't have to be very involved, and is simply a case of upload a new release into the downloads area.<br><br>You might have a source-only build, and maybe one pre-built for each platform.<br>And of course, there's direct subversion access for those that want the latest and greatest...<br><br>(I find googlecode easier to navigate than the sourceforge monster, but they all do the same thing at the end of the day). <br><br></td></tr></table><br>
<a name="817788"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Never worked with GoogleCode, nor with SourceForge ...<br>Use Origo and our university SVN service normally :) <br><br></td></tr></table><br>
<a name="817801"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jake L.</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not easy to find (english) words for what I want to say, but I'll try:<br><br>Before contributing any clever stuff (particles, effects etc..) we need a basic but solid framework to handle the lowlevel stuff. E.g. a particle engine that calls glBegin..glEnd for each particle is a bad idea, so it wouldn't be good to rely on default Max2D commands for contributed functions. Ok, no problem, let's use vertexbuffers, there are plenty examples in the code archives. With using vertexbuffers the next problem comes up: texture management. Everything inside a VB must use the same texture, so the way to code with VB's is total different than with Max2D commands....if we solve all problems that come along with VBs (and other enhanced topics like shaders, additional backbuffers) we end up creating an engine.<br><br>Don't get me wrong, to have a enhanced graphics engine that's based on BlitzMax and works together with Max2D is a very good thing! I would love to contribute all my engine's code to build a community engine, but if we really want to do that we need a clear and clever plan how we do it!<br>How to handle extensions (VB,Shaders) ? How to do texture management? How to do fallback/error handling for the whole stuff etc...<br><br>Without an modular and flexible engine that drives everything most contributed functions will be isolated solutions that hack Max2D to achieve a single effect. Then there's nothing more to do as the code archives are still up and running.<br><br>Jake <br><br></td></tr></table><br>
<a name="817802"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> For what you need, you can use miniB3D or miniB3D extended from klepto which does that and a few other things.<br><br>From what I get, this is meant as a similar thing as Blitz3D extended. This means extend Max2D, not replace max 2D.<br>Although the beginDraw endDraw part might actually be something that BRL even could consider to integrate into BM if it was developped carefully. <br><br></td></tr></table><br>
<a name="817803"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Jake L, I think what you're talking about is slightly beyond the scope I had in mind. <br>I was looking for more of a 'best of the forums' module which collates good basic function code on-top of Max2D. <br><br></td></tr></table><br>
<a name="817877"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> This sounds like a good project in general. I think Max2D definitely would benefit from being extended in a number of ways. It seems Mark was working on Max3D which I always presumed would let you do most of the things that we wanted Max2D to do but in an integrated way, but now that's turned into a whole new higher-level editor-driven system so now Max2D is still left with its diapers on.<br><br>I think Max2D needs to at the very least have a comprehensive set of drawing functions. I don't know why there weren't hollow rectangles and ovals right from the start, this was a major oversight. DrawPixmap unfortunately uses glDrawPixels which in Max2D code does not set the scale factor. It is actually possible to define a scaling operation which occurs during the drawing, if you write it on your own OpenGL code. I think we also need to see splines and we also need access to the points along the spline to use them not just as drawing primitives but as paths for animation etc. As far as new draw modes go, there aren't a whole lot of blend modes that are supported in the base level OpenGL. We already do Add and Multiply. It's possible to do Inverse and it's possible to copy the alpha value into the RGB components during rendering, but that's about it. More blend modes were added in newer versions of GL. Maybe it would be helpful though to do composite things like drawing shadows beneath sprites. It's hard to do a subtract mode, though. We should also have use of the stencil buffer - BlitzBasic on the Amiga had stencils!<br><br>I also agree about the glBegin glEnd - I implemented this into some drawing functions that I made for myself and called them MultiBegin and MultiEnd. I as the programmer then calls MultiBegin when I'm starting to draw primitives of the same kind e.g quads, and then so long as I know when I'm done I can do MultiEnd, rather than having new begins and ends around every quad drawn. It does help with the speed and removes a lot of overhead, but then this would only apply to OpenGL and you'd have to write all your own GL drawing operations to replace the standard Max2D stuff otherwise normal Max2D calls would interrupt it. <br><br></td></tr></table><br>
<a name="817946"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I implemented my BeginDraw EndDraw today ...<br>Easy on GL, but hard to do in DX as someone tried to make those two as incosinstent against each other as possible *grml*<br><br> Anyway: The speed difference can be forgotten ...<br>Used hitoros breakout to test it with batching all the bricks ...<br><br>No difference on my 8800GTS and 3 frames more (on 150) on my P-M tablet with Intel GMA900 onboard ...<br><br>So the point is really not there.<br><br>Seems like the current driver do quite some of this stuff internally. <br><br></td></tr></table><br>
<a name="817952"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've taken parts in something like this in the past, it starts out nice and ends up a mess of spaghetti, especially if the main players get bored and move on or jump ship to another platform.<br><br>I personally think a much better community project would be coding a stable DX8 or DX9 enhanced Max2D module. Using the D3DXSPrite Object for all 2D rendering would provide a good speed increase and give you the Start and End batching improvements similar to the OGL equivilent. (Especially with the DX9 version.)<br><br>Coding a community engine would take forever, too many ideas, you wouldn't make everyone happy, etc.<br><br>Coding a community collection of self contained routines that perform a certain task would be ideal. :) <br><br></td></tr></table><br>
<a name="817957"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hehe it isn't like the Blitz community wouldn't have any experience with Community projects ... Even thinking of the most current one, the online multi user world editor, shows that :)<br><br>As this one here seems to be more of a collection of functionality (and someone who has to standardize them to get them together) I think it is much more doable than CPs :) <br><br></td></tr></table><br>
<a name="818239"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> @CS_TBL, Can you check if the links to code I have added in the initial post are OK with you? <br><br></td></tr></table><br>
<a name="818280"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why link or post in other threads? Have all the goodies in this thread. ;) <br><br></td></tr></table><br>
<a name="818281"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Then the thread will get huge with any discussion on particular bits of code getting mixed up with others. <br><br></td></tr></table><br>
<a name="818420"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Curtastic</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Heres the functions I use. I think this functionality should be built in but I'm biased because I use these.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

Function RectsOverlap:Int(aX:Float, aY:Float, aSizeX:Float, aSizeY:Float, bX:Float, bY:Float, bSizeX:Float, bSizeY:Float)
	If bX &lt; aX Then
		If bX + bSizeX &lt; aX Then
			Return 0
		EndIf
	Else
		If bX &gt; aX + aSizeX Then
			Return 0
		EndIf
	EndIf
	If bY &lt; aY Then
		If bY + bSizeY &lt; aY Then
			Return 0
		EndIf
	Else
		If bY &gt; aY + aSizeY Then
			Return 0
		EndIf
	EndIf
	Return 1
EndFunction




Function DrawRectOutline(X:Float, Y:Float, SizeX:Float, SizeY:Float)
	DrawRect X        , Y        , SizeX, 1       'top
	DrawRect X        , Y + SizeY, SizeX, 1       'bottom
	DrawRect X        , Y        , 1      , SizeY 'left
	DrawRect X + SizeX, Y        , 1      , SizeY 'right
EndFunction




Function LoadImageSafe:timage(name:String, flags:Int = - 1)
	Local image:timage
	
	image = LoadImage(name + ".bmp", flags)
	
	If image = Null Then
		If FileType(name + ".bmp") = 0 Then
			RuntimeError "Image does not exist: " + name
		Else
			RuntimeError "Image cannot be loaded: " + name
		EndIf
	EndIf
	
	Return image
EndFunction




Function DrawImagePart(Image:TImage, DrawX:Float, DrawY:Float, PartX:Float, PartY:Float, PartWidth:Float, PartHeight:Float, Frame:Float = 0)
	Local OldX:Int
	Local OldY:Int
	Local OldWidth:Int
	Local OldHeight:Int
	
	Local ViewportX:Int = DrawX
	Local ViewportY:Int = DrawY
	
	Local ScaleX:Float, ScaleY:Float
	GetScale(ScaleX, ScaleY)
	
	'Save current viewport settings
	GetViewport(OldX, OldY, OldWidth, OldHeight)
	
	'Calculate viewport coordinates based on image's handle
	If Image.Handle_X Then
		ViewportX :- Image.handle_x * scalex
	EndIf
	If Image.Handle_Y Then
		ViewportY :- Image.handle_y * scaley
	EndIf
	
	SetViewport(ViewportX, ViewportY, PartWidth, PartHeight)
	DrawImage(Image, DrawX - PartX, DrawY - PartY, Frame)
	
	'Restore old viewport settings
	SetViewport(OldX, OldY, OldWidth, OldHeight)
EndFunction



'Goes through each pixel in a circle, so you can access them.
Function CirclePixels(x:Int, y:Int, r:Int)
	Local rx:Float
	Local dotx:Int, doty:Int
	Local rr:Int
	
	rr = r * r
	
	For doty = y - r To y + r
		rx = Sqr(rr - (doty - y) * (doty - y))
		For dotx = x - rx To x + rx
			DrawRect dotx, doty, 1, 1
		Next
	Next
EndFunction



'Goes through each pixel in an ellipse, so you can access them.
Function EllipsePixels(x:Int, y:Int, r:Int, fat:Float)
	Local rx:Float
	Local dotx:Int, doty:Int
	Local rr:Int
	
	rr = r * r
	
	For doty = y - r To y + r
		rx = Sqr(rr - (doty - y) * (doty - y)) * fat
		For dotx = x - rx To x + rx
			DrawRect dotx, doty, 1, 1
		Next
	Next
EndFunction



Function AlphaOn(a:Float)
	SetBlend alphablend
	SetAlpha a
EndFunction

Function AlphaOff()
	SetAlpha 1
	SetBlend maskblend
EndFunction



Function SetColor255(R:Int,G:Int,B:Int)
	If r&gt;255 Then r=255 ElseIf r&lt;0 Then r=0
	If g&gt;255 Then g=255 ElseIf g&lt;0 Then g=0
	If b&gt;255 Then b=255 ElseIf b&lt;0 Then b=0
	SetColor r,g,b
EndFunction


Function MouseOnRect:Int(X:Int,Y:Int,SizeX:Int,SizeY:Int)
	Return MouseX()&gt;=x And MouseY()&gt;=y And MouseX()&lt;x+sizex And MouseY()&lt;y+sizey
EndFunction


Function ChangeDirSafe:Int(Name:String)
	If ChangeDir(Name) = 0 Then RuntimeError "no directory at " + Name
EndFunction



Function Round:Float(Num:Float, Precision:Float)
	Return Int(Num / Precision + .5 * Sgn(Num)) * Precision
EndFunction


Function AngleDifference:Float(angle1:Float, angle2:Float, anglemax:Int = 360)
	Local temp:Float
	
	temp = angle2 - angle1
	If temp &gt; + anglemax / 2 Then Return temp - anglemax
	If temp &lt; - anglemax / 2 Then Return temp + anglemax
	Return temp
EndFunction


'The angle from x1,y1 pointing to x2,y2
'Returns 0-359
Function AngleTo:Int(x1:Float, y1:Float, x2:Float, y2:Float)
	Local angle:Int
	
	angle = ATan2(y2 - y1, x2 - x1)
	If angle &lt; 0 Then
		Return angle + 360
	Else
		Return angle
	EndIf
EndFunction


Function KeepInInt:Int(num:Int, low:Int, high:Int)
	If num &lt; low Then
		Return low
	ElseIf num &gt; high
		Return high
	EndIf
	Return num
EndFunction

Function KeepInFloat:Float(num:Float, low:Float, high:Float)
	If num &lt; low Then
		Return low
	ElseIf num &gt; high
		Return high
	EndIf
	Return num
EndFunction







'Returns 0 if the variable did not change. (It was already in bounds)
'Returns 1 if the var was below minimum
'Returns 2 if the var was above maximum
Function KeepInVarFloat:Int(num:Float Var, low:Float, high:Float)
	If num &lt; low Then
		num = low
		Return 1
	ElseIf num &gt; high
		num = high
		Return 2
	EndIf
	Return 0
EndFunction

Function KeepInVarInt:Int(num:Int Var, low:Int, high:Int)
	If num &lt; low Then
		num = low
		Return 1
	ElseIf num &gt; high
		num = high
		Return 2
	EndIf
	Return 0
EndFunction



Function MoveToVarFloat(Number:Float, Target:Float, Speed:Float)
	If Abs(Number - Target) &lt;= Speed Then
		Number = Target
		Return
	EndIf
	If Number &lt; Target Then
		Number:+ Speed
	Else
		Number:- Speed
	EndIf
EndFunction


Function MoveToVarInt:Int(Number:Int Var, Target:Int, Speed:Int)
	If Abs(Number - Target) &lt;= Speed Then
		Number = Target
		Return
	EndIf
	If Number &lt; Target Then
		Number:+ Speed
	Else
		Number:- Speed
	EndIf
EndFunction


Function CurveTo:Float(num:Float, dest:Float, speed:Float)
	If num &lt; dest Then
		Return num + Abs(dest - num) / speed
	ElseIf num &gt; dest Then
		Return num - Abs(dest - num) / speed
	EndIf
EndFunction




Function WrapGet:Float(num:Float, low:Float, high:Float)
	While num &lt; low
		num = num + (high - low + 1)
	Wend
	While num &gt; high
		num = num - (high - low + 1)
	Wend
	Return num
EndFunction



Function Distance2D:Float(x1:Float, y1:Float, x2:Float, y2:Float)
	Return Sqr((x2 - x1)^2 + (y2 - y1)^2)
EndFunction





Function ListAfter:Object(List:TList, Element:Object, Cycle:Int = False)
	Local link:TLink
	
	If List = Null Then RuntimeError "ListAfter: list=null"
	If Element = Null Then RuntimeError "ListAfter: element=null"
	
	link = List.findlink(Element)
	If link = Null Then RuntimeError "ListAfter: the element is not in the list"
	link = link.nextlink()
	
	If link = Null Then
		If Cycle Then
			Return List.firstlink().value()
		Else
			Return Null
		EndIf
	Else
		Return link.value()
	EndIf
	
EndFunction

Function ListBefore:Object(List:TList, Element:Object, Cycle:Int = False)
	Local link:TLink
	
	If List = Null Then RuntimeError "ListBefore: list=null"
	If Element = Null Then RuntimeError "ListBefore: element=null"
	
	link = List.findlink(Element)
	If link = Null Then RuntimeError "ListBefore: the element is not in the list"
	link = link.prevlink()
	
	If link = Null Then
		If Cycle Then
			Return List.lastlink().value()
		Else
			Return Null
		EndIf
	Else
		Return link.value()
	EndIf
	
EndFunction



Function StringInsert:String(s:String, chars:String, index:Int)
	If index &lt; 0 Then Return s
	Return Left(s, index) + chars + Mid(s, index + 1)
EndFunction




Function LoseChars:String(s:String, index:Int, amount:Int)
	If index &lt;= 0 Or amount &lt;= 0 Then Return s
	Return Left(s, index - 1) + Mid(s, index + amount)
EndFunction 



Function IsNumber:Int(txt:String)
	Return (txt = "0") Or (Int(txt) &gt; 0)
EndFunction 

Function IsLetter:Int(c:String)
	Return (c &gt;= "a" And c &lt;= "z") Or (c &gt;= "A" And c &lt;= "Z")
EndFunction

</textarea> <br><br></td></tr></table><br>
<a name="818460"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sonic</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would really like to see a way of storing textures with a custom format - for example 10 bit where you have say 5 bits using a lookup table for colour and 5 bits for an alpha channel (the use of this for me is shifting around lots of smooth, large, cell-shaded sprites.)<br><br>Don't know if it's possible, but I believe it must be! <br><br></td></tr></table><br>
<a name="818465"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> @sonic, I am sure it is possible but is too niche for this suggested project. Create a new post with all the details and requirements as I am sure somebody can help. <br><br></td></tr></table><br>
<a name="818467"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Curtastic: Thanks!<br><br>I posted some of my drawing ones here: <a href="http://www.blitzbasic.com/Community/posts.php?topic=73196" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=73196</a> <br><br></td></tr></table><br>
<a name="818784"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mr. Write Errors Man</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> A couple of suggestions:<br><br>- textured polygon<br><br>- texture splatting<br><br>-AF <br><br></td></tr></table><br>
<a name="818947"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Texture splatting?<br>You mean multi texturing? <br><br></td></tr></table><br>
<a name="819020"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mr. Write Errors Man</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, multi texturing so that you can use alpha from a separate texture (or certain channel of a separate texture).<br><br>Like this:<br><br><a href="http://img223.imageshack.us/my.php?image=splatel1.jpg" target="_blank"><img src="http://img223.imageshack.us/img223/6623/splatel1.th.jpg"></a><br><br><pre class=code>
Strict
SetGraphicsDriver D3D7Max2DDriver()
Graphics 800,600
Global gDriver:TD3D7Max2DDriver = TD3D7Max2DDriver(_max2dDriver)

Local imgGrass:TImage = LoadImage("grass.png")
Local imgDirt:TImage = LoadImage("dirt.jpg")
Local imgMask:TImage = LoadImage("blend.png")

SetBlend ALPHABLEND
SetClsColor 200,200,200

While Not KeyHit(KEY_ESCAPE)
	
	Cls
	
	DrawImage imgGrass,0,0
	DrawText "imgGrass",0,0
	
	DrawImage imgDirt,256,0
	DrawText "imgDirt",256,0
	
	DrawImage imgMask,512,0
	DrawText "imgMask",512,0
				
	DrawImage imgGrass,0,256	
	DrawImage imgDirt,256,256

	
	If MouseDown(1) Then
		Splat(imgDirt, imgMask)
		DrawImage imgDirt, 0 ,256
		gDriver.device.SetTexture 1 , Null
		DrawText "imgDirt splat",0,256
	
		Splat(imgGrass, imgMask)
		DrawImage imgGrass, 256 ,256
		gDriver.device.SetTexture 1 , Null
		DrawText "imgGrass splat",256,256
	Else
	
	EndIf
	
	Flip
	
Wend
End

Function Splat(r_image1:TImage , r_image2:TImage)
        Local frame1:TD3D7ImageFrame=TD3D7ImageFrame(r_image1.frame(0))
        Local frame2:TD3D7ImageFrame=TD3D7ImageFrame(r_image2.frame(0))
 		gDriver.device.SetTexture 0,frame1.surface
   		gDriver.device.SetTextureStageState( 0, D3DTSS_COLORARG1, D3DTA_TEXTURE );
   		gDriver.device.SetTextureStageState( 0, D3DTSS_COLOROP,   D3DTOP_SELECTARG1);
   		gDriver.device.SetTextureStageState( 0, D3DTSS_ALPHAARG1, D3DTA_TEXTURE);
  		gDriver.device.SetTextureStageState( 0, D3DTSS_ALPHAOP,   D3DTOP_SELECTARG1 );
 		gDriver.device.SetTexture 1 , frame2.surface
   		gDriver.device.SetTextureStageState( 1, D3DTSS_COLORARG1, D3DTA_TEXTURE);
   		gDriver.device.SetTextureStageState( 1, D3DTSS_COLOROP,   D3DTOP_SELECTARG2);
   		gDriver.device.SetTextureStageState( 1, D3DTSS_COLORARG2, D3DTA_CURRENT);
  		gDriver.device.SetTextureStageState( 1, D3DTSS_ALPHAOP,   D3DTOP_SELECTARG1 );
 		gDriver.device.SetTextureStageState( 1 , D3DTSS_ALPHAARG1 , D3DTA_TEXTURE ) ; 
End Function
</pre><br><br>-AF <br><br></td></tr></table><br>
<a name="819196"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> @arctic-fox, is that definately the code you got those results with?<br>I have been looking at multitexturing for a little while and have managed to 'merge' the blend and texture1. This gives me results as per your code (but *not* in the image) where there is no gradual move from one texture to the other.<br>When I try to alpha the images together it blends nicely<br>but darkens the picture. <br>Here is the code which shows the problem I have :<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Strict
SetGraphicsDriver D3D7Max2DDriver()
Graphics 800,600
Global gDriver:TD3D7Max2DDriver = TD3D7Max2DDriver(_max2dDriver)

Local imgGrass:TImage = LoadImage("grass.png")
Local imgDirt:TImage = LoadImage("floor.png")
Local imgMask:TImage = LoadImage("blending.png")

While Not KeyHit(KEY_ESCAPE)
	
	Cls
	SetBlend alphaBLEND
	SetAlpha 1.0
	DrawImage imgGrass,0,0
	DrawText "imgGrass",0,0
	
	DrawImage imgDirt,256,0
	DrawText "imgDirt",256,0
	
	DrawImage imgMask,512,0
	DrawText "imgMask",512,0
				
	DrawImage imgGrass,0,256	
	DrawImage imgDirt,256,256

	
	If MouseDown(1) Then
	SetAlpha 0.6
'	SetBlend alphablend

		Splat1(imgDirt, imgMask)
		DrawImage imgDirt, 0 ,256
		gDriver.device.SetTexture 1 , Null
		DrawText "imgDirt splat1",0,256
	
		Splat1(imgGrass, imgMask)
		DrawImage imgGrass, 256 ,256
		gDriver.device.SetTexture 1 , Null
		DrawText "imgGrass splat1",256,256
'	Else
	EndIf
	If MouseDown(2) Then
'		SetAlpha 0.6
		Splat2(imgDirt, imgMask)
		DrawImage imgDirt, 0 ,256
		gDriver.device.SetTexture 1 , Null
		DrawText "imgDirt splat2",0,256
	
		Splat2(imgGrass, imgMask)
		DrawImage imgGrass, 256 ,256
		gDriver.device.SetTexture 1 , Null
		DrawText "imgGrass splat2",256,256
	EndIf	
	
	Flip
	
Wend
End
Function Splat1(r_image1:TImage , r_image2:TImage)
        Local frame1:TD3D7ImageFrame=TD3D7ImageFrame(r_image1.frame(0))
        Local frame2:TD3D7ImageFrame=TD3D7ImageFrame(r_image2.frame(0))
		D3D7GraphicsDriver().Direct3DDevice7().SetTexture 0,frame1.surface
		gDriver.device.SetTextureStageState( 0, D3DTSS_COLORARG1, D3DTA_TEXTURE );
		gDriver.device.SetTextureStageState( 0, D3DTSS_COLOROP,   D3DTOP_SELECTARG1 );
		gDriver.device.SetTextureStageState( 0, D3DTSS_ALPHAOP,   D3DTOP_DISABLE );
	
		D3D7GraphicsDriver().Direct3DDevice7().SetTexture 1,frame2.surface
		gDriver.device.SetTextureStageState( 1, D3DTSS_COLORARG1, D3DTA_TEXTURE );
		gDriver.device.SetTextureStageState( 1, D3DTSS_COLOROP,   D3DTOP_MODULATE );
		gDriver.device.SetTextureStageState( 1, D3DTSS_COLORARG2, D3DTA_CURRENT );
		gDriver.device.SetTextureStageState( 1, D3DTSS_ALPHAOP,   D3DTOP_DISABLE );

End Function
Function Splat2(r_image1:TImage , r_image2:TImage)
        Local frame1:TD3D7ImageFrame=TD3D7ImageFrame(r_image1.frame(0))
        Local frame2:TD3D7ImageFrame=TD3D7ImageFrame(r_image2.frame(0))


 		gDriver.device.SetTexture 0,frame1.surface
   		gDriver.device.SetTextureStageState( 0, D3DTSS_COLORARG1, D3DTA_TEXTURE );
   		gDriver.device.SetTextureStageState( 0, D3DTSS_COLOROP,   D3DTOP_SELECTARG1);
   		gDriver.device.SetTextureStageState( 0, D3DTSS_ALPHAARG1, D3DTA_TEXTURE);
  		gDriver.device.SetTextureStageState( 0, D3DTSS_ALPHAOP,   D3DTOP_SELECTARG1 );
 		gDriver.device.SetTexture 1 , frame2.surface
   		gDriver.device.SetTextureStageState( 1, D3DTSS_COLORARG1, D3DTA_TEXTURE);
   		gDriver.device.SetTextureStageState( 1, D3DTSS_COLOROP,   D3DTOP_SELECTARG2);
   		gDriver.device.SetTextureStageState( 1, D3DTSS_COLORARG2, D3DTA_CURRENT);
  		gDriver.device.SetTextureStageState( 1, D3DTSS_ALPHAOP,   D3DTOP_SELECTARG1 );
 		gDriver.device.SetTextureStageState( 1 , D3DTSS_ALPHAARG1 , D3DTA_TEXTURE ) ; 
End Function


</textarea><br>I keep coming back to multitexturing and, some day, was hoping for a DX/OGL module where an array of images and texturestates was passed to the function and the results returned. <br><br></td></tr></table><br>
<a name="820099"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mr. Write Errors Man</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, the image is produced with the code I posted. And yes, the code does not work fully. Scaling brakes it just like alpha. I just posted it as an example of what I meant with texture splatting.<br><br>-AF <br><br></td></tr></table><br>
<a name="820124"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, I seem to get different results with your code and the images than you have posted. In my case the textures simply switch places. <br>What do you mean by scaling breaking it? I understand it being an example but, from the images posted, it seems to work for you and not for me. <br><br></td></tr></table><br>
<a name="820738"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mr. Write Errors Man</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can't take blend.png from that screenshot, because it doesn't include alpha channel. I uploaded the original blend.png here: <img src="http://img527.imageshack.us/my.php?image=blendmf8.png"><br><br>-AF <br><br></td></tr></table><br>
<a name="820743"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks, I get it now. <br><br></td></tr></table><br>
<a name="1106482"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Canali</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> Anyone knows how to port this code to OpenGL and/or DX9??? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
