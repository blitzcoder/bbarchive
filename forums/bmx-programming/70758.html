<!DOCTYPE html><html lang="en" ><head ><title >Faster Floats</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Faster Floats</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Faster Floats</a><br><br>
<a name="790952"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was doing some speed tests to see how fast my computer (Intel iMac Core2 Duo 2GHz) is at reading and writing different types of data (bytes, shorts, ints, floats etc), based on number of instructions or based on amount of memory read. Looks like if you store a Float as an integer and read it from an Integer it is faster than reading it from a float:<br><br><pre class=code>
Local MyFloat:Float
IntPtr(VarPtr(MyFloat))[0]=IntegerMemoryPtr[offset]
</pre><br>is faster than<br><pre class=code>
Local MyFloat:Float=FloatMemoryPtr[offset]
</pre><br>Reading the float from binary data stored in an int with an Int Ptr took about 200 millisecs, versus 300 for reading from a Float pointer.<br><br>Also<br><pre class=code>
IntegerMemoryPtr[offset]=IntPtr(VarPtr(MyFloat))
</pre><br>is faster than<br><pre class=code>
FloatMemoryPtr[offset]=MyFloat
</pre><br>Writing the float to memory as an integer of binary data took 167 millisecs, versus 173 millisecs to write a Float to a Float pointer.<br><br>Okay so the write isn't that much faster, but the read is significantly faster. Also seems in general that dealing with floats and doubles and longs is substantially slower than dealing with Int's, more than just the extra bytes of memory access.<br><br>Maybe reading a floating point number (Float/Double) in from memory entails reading the memory, writing it back out as a float, then reading it into a float variable? I know the PPC processor used to have the issue that a float had to be written to memory before it could be read as an integer, and vice versa. <br><br></td></tr></table><br>
<a name="790958"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Bad idea.<br><br>The first one is faster because it's doing an integer move.<br><br>However, if you ever actually want to *use* the float (god forbid), a float move will eventually be required!<br><br>In addition, the first one will cause the float to be spilled, since you are taking the address of a local variable (which always causes a local to spill). <br><br></td></tr></table><br>
<a name="790963"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting. I understand what you're saying except for spilling. What is that? Do you mean that getting the address of a local requires pushing it into memory and is then accessed as an integer from memory?<br><br>I do disagree though about needing to do a float move. If you create the float as a real Float variable, and write its bytes using varptr to a 4-byte space in memory, then to re-use it you just create a blank Float variable and read the bytes into its memory space. Why wouldnt you be able to just use the Float once you've read the bytes into its memory? <br><br></td></tr></table><br>
<a name="791035"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> All floating point operations take place in special 80-bit registers. Since this is the only way such numbers can be used it seems reasonable for BlitzMax to load the number into a register as it moves the value in memory.<br><br>If you had an application which needed to move large amounts of floating point numbers, without doing any operations on them, then it would make sense to do the kind of floatless read/write that you suggested. There aren't many such applications. Notice that sorting is not one them as the numbers must be loaded into registers in order to compare them. <br><br></td></tr></table><br>
<a name="791069"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok. So at some point there has to be a transfer to the Float register in order to use the values, so the speedup wouldn't apply.<br><br>I found also that Reading/Writing memory using Doubles is faster than using Int's or Long's, if you need to just move memory around. Doubles took 40 millisecs while Int's took about 60, even though in general Int's are much faster than everything else for math and stuff. Longs in general seem kind of slow - I thought perhaps a Long would be a nice fast 64-bit move but alas not.<br><br>Int's are way faster than using Shorts and Bytes that it almost seems pointless to use Shorts and Bytes unless you want to save memory space - even if you store byte values in Int's and read four times as much memory it's faster than reading individual bytes. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
