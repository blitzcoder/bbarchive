<!DOCTYPE html><html lang="en" ><head ><title >Confusion with Byte Pointers and Function Pointers</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Confusion with Byte Pointers and Function Pointers</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Confusion with Byte Pointers and Function Pointers</a><br><br>
<a name="789269"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> In the below program, a function is defined and its function pointer is then stored in a byte pointer. Then two separate function pointers become equated with the byte pointer and are then called. Each of the function pointers is defined with a different number of parameters. One of them does not the match the number of parameters in the mapped function. The program compiles and runs.<br><br>It prints "hi 5" twice. When func2() is called, does the value 5 get passed into the function and printed? How is BlitzMax remembering it? Is this remembering deliberate (and reliable) or just some `left over` data? Also, when activating the line Hi(10), the value 10 then carries over to the func2() call. Why?<br><br>Since the function pointer is converted into a byte pointer, and the byte pointer has no definition of how many parameters should go with it, and is then blindly converted back to a function, how is the function pointer then working correctly if it is passing the value that the previous call passed? Does the byte pointer somehow store information about the function? Is BlitzMax keeping the local register data that was filled in when the first function passed a 5 and is now referring back to it - and it just happens that it still contains the 5 and hasn't been trashed?<br><br>If you set the parameter of the original Hi() function to Hi(a:Int=15), whereby it should fill in a 15 if no value is passed, the call to Func2() does NOT print "hi 15", it still prints whatever was the previously passed value.<br><br>What's going on here? When the function is converted from a byte pointer, does it lose track of how many parameters it has and thus is unable to activate the default =15 feature?<br><br>I'm confused.<br><pre class=code>
Local myfunc(param1:Int)
Local myfunc2()
Local mybytepointer:Byte Ptr

Function hi(a:Int)
	Print "hi "+a
End Function

myfunc=hi
mybytepointer=myfunc
myfunc=mybytepointer
myfunc2=mybytepointer

myfunc(5)
'hi(10)
myfunc2()
</pre><br>What I'd like to be able to do is have a number of functions with different numbers of parameters and different data types for each parameter, and then store all of these functions in byte pointers. Then later I want to be able to convert the byte pointers back to functions and call the functions and pass to them the appropriate amounts of data in the appropriate type. If converting from a byte pointer to a function pointer means that it does not keep track of how many parameters are asked for or of what type, this would actually be beneficial to me since I could then just pass a bunch of Int's as parameters, even if the function is asking for things like byte pointers, pointers to custom types, etc (I would be using HandleToObject and HandleFromObject etc to convert for storage). Would this work? I'm guessing not.<br><br>This is aside from the above described behavior which doesn't entirely affect what I'm trying to do but it is a curiosity nonetheless. <br><br></td></tr></table><br>
<a name="789298"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think it works as follows. BlitzMax knows how parameters should be passed based on the declaration of the function pointer.<br><br>myfunc has one integer parameter. So a call to myfunc(5) pushes a 5 onto the stack and then jumps to the address in myfunc.<br>myfunc2 has no parameters so it simply jumps to the specified address.<br><br>Both fuction calls jump to address in hi. This retrieves one value from the stack and prints it. If myfunc2() prints a 5 then that just means that nothing disturbed the stack since the call to myfunc(5). <br><br></td></tr></table><br>
<a name="789374"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm ok I guess that makes sense. But I guess you can't really rely on the stack not being disturbed, there could be all sorts of other things that disturb it. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
