<!DOCTYPE html><html lang="en" ><head ><title >Inaccurate floating/double numbers</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Inaccurate floating/double numbers</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Inaccurate floating/double numbers</a><br><br>
<a name="941300"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Johnsprogram</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> It has been bothering me for a while.<br>When I use the data types float or double to a variable and assign a number 0.02 and later retrieve it, it'll show up as something like 0.01932932 or so.<br>Is there a reason for that? <br><br></td></tr></table><br>
<a name="941307"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Its been mentioned about 14 million times before.  Floating point innacuracy - nothing you can do about it (other than store the value as a string). <br><br></td></tr></table><br>
<a name="941318"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's some more information as per the <a href="http://en.wikipedia.org/wiki/Floating_point" target="_blank">Wikipedia article</a> on Floating point<br><div class="quote"> <br>By their nature, all numbers expressed in floating-point format are rational numbers with a terminating expansion in the relevant base (for example, a terminating decimal expansion in base-10, or a terminating binary expansion in base-2). Irrational numbers, such as &amp;#960; or &amp;#8730;2, or non-terminating rational numbers, must be approximated. The number of digits (or bits) of precision also limits the set of rational numbers that can be represented exactly. For example, the number 123456789 clearly cannot be exactly represented if only eight decimal digits of precision are available.<br>When a number is represented in some format (such as a character string) which is not a native floating-point representation supported in a computer implementation, then it will require a conversion before it can be used in that implementation. If the number can be represented exactly in the floating-point format then the conversion is exact. If there is not an exact representation then the conversion requires a choice of which floating-point number to use to represent the original value. The representation chosen will have a different value to the original, and the value thus adjusted is called the rounded value.<br>Whether or not a rational number has a terminating expansion depends on the base. For example, in base-10 the number 1/2 has a terminating expansion (0.5) while the number 1/3 does not (0.333...). In base-2 only rationals with denominators that are powers of 2 (such as 1/2 or 3/16) are terminating. Any rational with a denominator that has a prime factor other than 2 will have an infinite binary expansion. This means that numbers which appear to be short and exact when written in decimal format may need to be approximated when converted to binary floating-point.<br> <br></div><br><br>Of course, you can also store your values as rational numbers (fractions), and work your arithmetic on those... but if you need at some point, to show it on screen with a decimal place, you'll probably have to round it. <br><br></td></tr></table><br>
<a name="941327"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warpy</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> And using rationals is a massive faff, so not worth bothering with unless you're doing Science! <br><br></td></tr></table><br>
<a name="941328"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nothing wrong with science! :-p <br><br></td></tr></table><br>
<a name="941380"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> You might also try using fixed point, which is particularly nice if your numbers are not going to get too large. If you are within the range 0..65535, then you can just use `Shl 16` and `Shr 16` to convert between fixed point and integer. You will get better accuracy, in a way, than floating point, because you always get the same number of decimal places no matter where the number is in the range - whereas with floating point, smaller numbers get more decimal points than larger ones.<br><br>With that in mind, what if you store a float as 0.00002, does it come back correctly? <br><br></td></tr></table><br>
<a name="968159"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shortwind</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> In some quick tests, it seems to me that the internal floats are working as needed, it seems on quick inspection that the print function is borked...<br><br>Can any blitzmax dev or other expert confirm this brief analyst? <br><br></td></tr></table><br>
<a name="968160"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> It would help if you show how you tested it <br><br></td></tr></table><br>
<a name="968163"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> It would help if you show how you tested it  <br></div>Doesn't really matter how he tested it, because its wrong.  Floats by nature are not accurate.  Nothing to do with Blitz, or print functions.  You would have the same issues using floats in any other language. <br><br></td></tr></table><br>
<a name="968169"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shortwind</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I recant my previous post... Doing more investigation, will return my findings shortly... <br><br></td></tr></table><br>
<a name="968190"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shortwind</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Still investigating, but have a question.  How does anyone do simple currency calculations using floats?  From what I can see you can't, easily, and that is scratching the surface.  What is the internal conversion of the compiler when getting literal float values?  I mean, my old C64 was more accurate then this. LOL<br><br>Local i:Float = 2.01<br>Local k:Float = 0<br>Local x:Int<br>Local a:Long<br><br>k=i<br>a=201<br>For x=1 To 10<br>	k=k+1.02<br>	a=a+102<br>	Print k<br>	Print a<br>	Print<br>Next<br><br>The only way (for currency anyway) to get some accuracy is to do the following:<br><br>local i:Float = 2.01001<br><br>But even that will turn up errors eventually. <br><br></td></tr></table><br>
<a name="968196"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> For currency, do all of your math in Integers, then place the decimal point yourself when printing numbers. <br><br></td></tr></table><br>
<a name="968198"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nate the Great</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> are you planning on starting a bank with the money management programmed in blitz max?<br><br>but floating point innacuracy is not avoidable as far as I know... unless you make your own math system to use strings as numbers. <br><br></td></tr></table><br>
<a name="968200"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shortwind</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> @GfK:<br><br>First: I beg to differ on your comment that you'd have the same problems in any language.  I'm not disputing the problems with floats, I'm just saying somewhere in the implementation of them in BlitzMax there is an error.  They are seriously too inaccurate.<br><br>Standard C<br>#include &lt;stdio.h&gt;<br><br>int main()<br>{<br>  float i=2.01;<br>  float k=0.00;<br>  int x;<br><br>  k=i;<br><br>  for(x=1;x&lt;10;x++)<br>  {<br>    k=k+1.01;<br>    printf("%f\n",k);<br>  }<br><br>}<br><br>As you can see, if you compile and run this code, the standard C float, for literals conversion is more than sufficiently accurate.  Somewhere in the BlitzMax code it gets it seriously wrong.  Example:<br><br>Local j:float = 0.22<br>print j<br><br>AND<br><br>#include &lt;stdio.h&gt;<br><br>int main()<br>{<br>  float j=0.22;<br>  printf("%f\n\n",j);<br><br>}<br><br>I'd really like to here from a developer on this issue.  It's not like this is a free program, so I feel I have the right as a owner of the software to ask questions in this regard. <br><br></td></tr></table><br>
<a name="968204"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> What's your definition of "seriously wrong"? When I run your code, it's no more than 0.000000001 away from what it should be. That seems pretty accurate for single precision floats to me.<br><br>EDIT: I'm not using the latest version of BlitzMax so if you're getting vastly different results, perhaps it's a newly introduced bug. <br><br></td></tr></table><br>
<a name="968207"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> It's not like this is a free program, so I feel I have the right as a owner of the software to ask questions in this regard. <br></div>An official response is a rare sight :( <br><br></td></tr></table><br>
<a name="968208"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shortwind</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Currency was just an example.  In the scope of games, maybe it is a moot point, but it is still valid.  Search the forums and see how many functions and routines require floats and doubles?  There are tons.  I'm sure we could list 100 things that these inaccuracies will effect in many types of programming.  There are more than just game programmers out there using this language, so the argument is not moot.<br><br>For someone that has been programming since 1982, of course you come to realize that floating point calculations can go wack.  But, you learn the scope of the accuracy (to how many decimal places) you can expect your code to work, most of the time.  But to have your floating point values screwed before you even attempt any calculations on them is not just inconvienent, it's unforgivable.<br><br>When you put in a literal such as 0.22, the very least the compiler should do is encode that as 0.22000000000 or how ever many places the float or double requires.  If the blitzmax compiler is encoding this value as 0.219999999 this is just wrong. <br><br></td></tr></table><br>
<a name="968210"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> If making currency, you should use string based calculations as PL/1 does. I remember there was a module written by Brucey to do so.<br>for small currency calculations, you can use good old error rounding techniques:<br><pre class=code>Local i:Float = 2.01
Local k:Float = 0
Local x:Int
Local a:Long

k = i
a = 201
For x = 1 To 10
	k = k + 1.02
	a = a + 102
	Print k
	Print a
	Print ccRound(a, 2)
	Print
Next

Function ccRound:Double(number:Double, decimals:Int)
	Local t:Int = 10^decimals
	Local result:Double = Int(number * t + 0.5:Double * Sgn(number))
	Return result / t
End Function</pre> <br><br></td></tr></table><br>
<a name="968211"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shortwind</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Gabriel<br><br>With only 2 decimal places when you enter 0.22 it should print 0.22, not 0.219999999....... <br><br></td></tr></table><br>
<a name="968212"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shortwind</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ziggy<br><br>True, true. Of course there are work arounds, but in every other language I've ever programmed in I didn't have to worry to much about accuracy in the first and second decimal place..... :( <br><br></td></tr></table><br>
<a name="968213"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Shortwind:Well, you were complaining on how it is printed, so that is the solution. If you complain about the precision of a float, then there's nothing to do!<br>It may help (not tested) if you specify double precision on variables AND constats<br><pre class=code>k = k + 1.02:Double</pre> <br><br></td></tr></table><br>
<a name="968215"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> It's not like this is a free program, so I feel I have the right as a owner of the software to ask questions in this regard. <br></div>Of course, but having the right to ask questions doesn't magically make you right, and everybody else wrong. <br><br></td></tr></table><br>
<a name="968216"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shortwind</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> @GfK<br><br>LOL. Of course.  Not trying to start a fight, just trying to figure out how they screwed up something so seemingly simple.<br><br>How do I represent 0.22 in floats without convoluted routines and integers and such?  Do tell. LOL <br><br></td></tr></table><br>
<a name="968218"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Doesn't really matter how he tested it, because its wrong. Floats by nature are not accurate. Nothing to do with Blitz, or print functions. You would have the same issues using floats in any other language. <br> <br></div><br>Every program under the sun has this problem, all languages do. The only programs that dont seem to is accounting packages. <br><br></td></tr></table><br>
<a name="968223"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >matibee</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's a simple test, and I found BMax is outputting floats to 8 decimal places which is why you see the error;  printf works better in your example when defaulting to 6 decimal places.<br><br><pre class=code>
//====  floattostring.h
#include &lt;stdio.h&gt;

extern "C" {

	void floattostring( char * pDest, float f );
	
}

//==== floattostring.cpp
#include "floattostring.h"

void floattostring( char * pDest, float f )
{
	sprintf( pDest, "%f\n", f ); // defaults to 6 decimal places
	//sprintf( pDest, "%5.8f\n", f ); // gives same result as bmax

}

//==== test.bmx
Import "floattostring.cpp"

Extern "C"
	Function floattostring( a:Byte Ptr , f:Float )
End extern


Local f1:Float = Float 2.01
Local f2:Float = Float 1.02

For Local t:int = 1 To 10

	Local b:Byte[200]
	Local bp:Byte Ptr = b
	Local s:String

	floattostring( bp , f1 )
	
	Local i:Int = 0
	While b[i]
		s = s + Chr$( b[i] )
		i :+ 1
	End while

	Print "float : " + f1
	Print "string: " + s
	
	f1 :+ f2
next
</pre><br><br>I couldn't find a better way of passing a string buffer, or converting one to a string :) <br><br></td></tr></table><br>
<a name="968225"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  How does anyone do simple currency calculations using floats <br></div><br>You don't. In any language. They aren't accurate enough. (of course that doesn't stop companies using 32-bit floats to do currency calculations... perhaps they didn't know any better, but it's a bit embarrassing admitting to working for one...)<br><br>Using Integers is one way. Using String/character representation is another.<br><br>For example, <a href="http://code.google.com/p/maxmods/wiki/MapmModule" target="_blank">MAPM</a> can handle up to  an accuracy of 2 billion digits, if you have enough memory to store it. Internally it uses some kind of digit representation. <br><br></td></tr></table><br>
<a name="968243"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> The accuracy of floats and doubles is whatever the hardware supports. The odd looking display comes from the fact that there is no control over formatting.<br><br>For single precision BlitzMax uses nine digits when converting a float to a string, which is then used for Print. The reason it uses nine digits is that this is the smallest number which guarantees converting float to string and then back to float recreates the original float. Thus you can save a text file, or XML or whatever, read it back and get the original number. Doubles do the same thing, but with seventeen digits.<br><br>The result is an unsightly display, which is as accurate as it can be.<br><br>Note that Blitz3D rounds the display to six digits. The result often looks better, and more accurate, even though the underlying numbers are the same. <br><br></td></tr></table><br>
<a name="968244"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  I couldn't find a better way of passing a string buffer, or converting one to a string <br></div><br>There may even be a module to do it already... <br><br></td></tr></table><br>
<a name="968248"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can find the default number-to-string conversion in \mod\brl.mod\blitz.mod\blitz_string.c<br><br>The code for float and double is <br><pre class=code>
	sprintf( buf,"%#.9g",n );
	sprintf( buf,"%#.17lg",n );
</pre>It would be nice to have a little more control for display purposes. But this is the way it is done for automatic conversion between numeric and string values. <br><br></td></tr></table><br>
<a name="968260"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >matibee</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> There may even be a module to do it already... <br> <br></div><br><br>lol brucey, I'm sure there is.  I expected to be able to pass a ToCString(), but meh.  Quick newbie test n all that.<br><br>Anyway, none of this solves the op's problem, it's merely highlighting using floats for currency is a bad idea.<br><br>Integer math would readily give you +/-$21,474,836.48.  That'd do for balancing my books..  just about :) <br><br></td></tr></table><br>
<a name="968281"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> lol brucey, I'm sure there is. <br></div><br><br>Yup: Brucey made one himself some time back. It's on his download page. <br><br></td></tr></table><br>
<a name="968345"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Shortwind</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well that was a lively discussion.  Thanks to all that responded.<br><br>I suppose I'll have to work on modifiying the blitzmax source code to support BCD. :) <br><br></td></tr></table><br>
<a name="968755"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dynaman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; Every program under the sun has this problem, all languages do. The only programs that dont seem to is accounting packages.<br><br>Used to do some bank work, they have special packages that do the calculations and never use floating point variables (well, at least the ones I worked on).  The package code was much slower then floating point, but much more accurate - and accuracy was the primary requirement. <br><br></td></tr></table><br>
<a name="968805"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> I did wrote this some time ago. It is a function to show floats with precission lose correction when converted to strings. It works very well and outputs the same as b3d and other languages.<br><pre class=code>Local V1:Float
V1 = -1.112
Print V1
Print FloatToString(V1)

V1 = 1324323.54323
Print V1
Print FloatToString(V1)

V1 = 1000000000
Print V1
Print FloatToString(V1)

V1 = 0.0001
Print V1
Print FloatToString(V1)


Function FloatToString:String(FVale:Float)
	Local S:String = ccRound(Fvale, 6)
	If s.EndsWith("1") Then s = Left(s, Len(s) - 1)	'Last char double-precission rounding error.
	While Right(s, 1) = "0"	'Remove unneeded 0 at the end of te decimal part
		s = Left(s, Len(s) - 1)
	Wend
	If s.EndsWith(".") Then s = Left(s, Len(s) - 1)
	Return S
	Function ccRound:Double(number:Double, decimals:Byte)	'Weigted non-trucate rounding.
		Local t:Long = 10 ^ decimals
		Local result:Double = Long(number * t + 0.5:Double * Sgn(number))
		Return result / Double(t)
	End Function
End Function
</pre> <br><br></td></tr></table><br>
<a name="969928"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Blueapples</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> How does anyone do simple currency calculations using floats <br><br>You don't. In any language. They aren't accurate enough. <br></div><br><br>Trust me, Brucey hit the nail on the head with this. Spent about 10 hours forcing floats to work correctly for a Quickbooks import. We finally got it to work but you have to do a lot of really retarded round(x, 2) and 2 decimal string formatting. Too bad it's too late at this point to change our DB structure to use a fixed decimal string value, it would have saved us a lot of time.<br><br>Oh and this is Python code. If Python doesn't "get it right", no one has much chance. Use a currency library. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
