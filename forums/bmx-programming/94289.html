<!DOCTYPE html><html lang="en" ><head ><title >Passing a byte ptr to C++?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Passing a byte ptr to C++?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Passing a byte ptr to C++?</a><br><br>
<a name="1081111"></a>

<a name="1081112"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> How do I pass a byte ptr to a C++ library?<br><br>This is the C++ command declaration:<br><pre class=code>void SetTexturePixels(le3::Texture* texture, char* buf, int miplevel, int framenumber, int cubeface);</pre><br>And here it is declared in BlitzMax:<br><pre class=code>Function leSetTexturePixels(texture:LETexture,buf:Byte Ptr,miplevel:Int,framenumber:Int,face:Int)="SetTexturePixels"</pre><br>It doesn't appear to be working.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1081185"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SebHoll</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is your C++ Declaration wrapped inside an <b>extern "C"</b> block to force standard C calling convention? <br><br></td></tr></table><br>
<a name="1081195"></a>

<a name="1081196"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes.<br><br>The function gets called, but the data contained in the byte ptr is not being read.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1081434"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> In the C++ function you called it "cubeface" but in the BMax function you call it "face".  Does that matter? <br><br></td></tr></table><br>
<a name="1081466"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Does that matter?  <br></div><br>No. <br><br></td></tr></table><br>
<a name="1081496"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >beanage</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe an issue with Strict&lt;&gt;SuperStrict, void declaration, and the bmx function trying to return an int or something along those lines? Have you looked into what kind of data arrives in SetTexturePixels? <br><br></td></tr></table><br>
<a name="1081707"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is the way I have this declared supposed to work, or has no one ever even tried doing this? <br><br></td></tr></table><br>
<a name="1081722"></a>

<a name="1081723"></a>

<a name="1081726"></a>

<a name="1081727"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, I'm currently doing similar things ( mixing c++ and BMax ) and I'll explain what I've found on my travels, hopefully it may help you to trace what may be going on there......<br><br>I was getting mixed up what was being returned by the c++... was it a pointer to data or a pointer to a pointer to the data. It took me a while and still trips me up now.<br><br>Ive also noticed that within BMax say you have a Type with 3 Fields. If you use a Byte Ptr to the type the pointer points to the first Field, not the address of the Type itself. Say you have a new Type at address $00403020 then use a Byte Ptr to it, the Byte Ptr will be $00403028, something to consider when passing into c++ using Byte Ptr or Var.<br><br>I'm messing with the D3DX and associated libraries with getting the D3DX skinned meshes, shaders, animation controllers etc working from within BMax, and its going really well already, boned skinned meshes and static meshes in text or binary are all loading and displaying perfectly after a tiny hackup thats easy to correct later so others can use it.<br><br>Anyway....For the most part I had confusion with what I should really be sending and receiving to/from the c++ code, maybe this is my bad c++ skills, but we've all got to learn somewhere.<br><br>Consider this....... where you have 'buf:byte ptr' this will point to the first piece of data in your buffer, your c++ code will probably want an address ( char* ), which is one reason it may not be working, the c++ will try to use the first 8 bytes of buffer data as an address and read from there.<br><br>Hope this helps in at least trying different things in getting it to work.<br><br>All the best<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1081730"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I printed out the point values.  They look correct:<br><br>BMX:<br>Print(Int(buf))<br>result: 37979488<br><br>C++:<br>Print(le3::String(int(buf)));<br>result: 3.79795e+007 <br><br></td></tr></table><br>
<a name="1081738"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> so what is not happening ? i assume you are passing in a buffer of data and you want it assigned to the texture? in which case i assume thats happening ? but the texture in BMax isnt updating ? <br><br></td></tr></table><br>
<a name="1081739"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> When I call SetTexturePixels() the texture is filled with what looks like random memory.  When I call GetTexturePixels() the pixmap is unaffected, presumably because the memory is being copied to somewhere else. <br><br></td></tr></table><br>
<a name="1081750"></a>

<a name="1081752"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Zeke</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>Function leSetTexturePixels(texture:byte ptr,buf:Byte Ptr,miplevel:Int,framenumber:Int,face:Int)="SetTexturePixels"</pre><br><br>this is interesting:<br><pre class=code>
SuperStrict

Import "test type.cpp"

Extern "C"
	Function dump_type(t:mytype) 'wrong values (correct values if using padding)
	'Function dump_type(t:Byte Ptr) 'correct values if no padding
End Extern

Type mytype
	Field a:Int=4
	Field b:Int = 7
	Field c:Int = 8
End Type

Local a:mytype = New mytype

dump_type(a)
bmx_dump(a)


Function bmx_dump(m:mytype)
	Print "bmx_dump"
	Local point:Byte Ptr=Int Ptr(Int Ptr((Varptr m))[0]) 
	
	point = point + 8 'skip 8 padding bytes
	
	For Local i:Int = 0 Until SizeOf(m)
		Print Hex(point[i])
	Next
End function</pre><br><br>test type.cpp:<br><pre class=code>
#include &lt;stdio.h&gt;

extern "C" 
{
struct mytype {
	int padding1; //comment if using byte ptr
	int padding2; //uncomment if using blitzmax type
	int a;
	int b;
	int c;
};

void dump_type(mytype* type) {
	printf("c++ dump\n");		
	printf("mytype.a=%i\n",type-&gt;a);
	printf("mytype.b=%i\n",type-&gt;b);
	printf("mytype.c=%i\n\n",type-&gt;c);
	
}
}</pre><br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1081751"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> The texture object isn't a problem.  It's an Externed C Type, and all the other texture commands work fine.<br><br>You are right that for BlitzMax types, you do have to pass them to C++ as a Byte Ptr, and BlitzMax Null for Types is not the same as C Null for Types. <br><br></td></tr></table><br>
<a name="1081755"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> When I call SetTexturePixels() the texture is filled with what looks like random memory. <br></div><br>Where is the data you're "sending" coming from? A pixmap? What format of pixmap? Is this SetTexturePixels command one of your own or a particular API or library? What format is the created texture in? Is the texture you're trying to use compressed or uncompressed? <br><br></td></tr></table><br>
<a name="1081760"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's an RGBA8888 pixmap<br><br>I am using it like this:<br>SetTexturePixels(pixmap.pixels,0,0,0)<br><br>The pixmap is an RGBA8888 pixmap.<br><br>Using this command in C++ to load textures works fine. <br><br></td></tr></table><br>
<a name="1081762"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> The error had to do with how I was creating those textures.<br><br>The proper way to pass a Byte Ptr to a C++ lib is to use char* in the C++ parameter.<br><br>Confirmed, once and for all. <br><br></td></tr></table><br>
<a name="1081794"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Excellent, I'm glad you got it fixed. <br><br></td></tr></table><br>
<a name="1081853"></a>

<a name="1081854"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> What is the padding used for in Blitz types? Virtual table and type id? Ref count?<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1081890"></a>

<a name="1081891"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> c++ class constructor and deconstructor<br><br>edit: oops, I see the padding is in the c++ code, I've only seen and used it in the BMax code....hmmm.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1081893"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> The ref count is/was definitely in there, because there's the old typeinstance[0] hack to retrieve it. That's from before the new GC though, so whether it does the same with both the old and the new GC, I don't know. <br><br></td></tr></table><br>
<a name="1082178"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting. How does run-time type information work? This is more of a general question. When I cast a type to an extended type, how does it figure out whether it's an extended type or not? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
