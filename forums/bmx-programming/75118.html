<!DOCTYPE html><html lang="en" ><head ><title >XP Pro Users - Please help with shared data test</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >XP Pro Users - Please help with shared data test</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >XP Pro Users - Please help with shared data test</a><br><br>
<a name="839473"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, I'm trying to work out if XP Home (which I have) is different from XP Pro with regards to folders created in: C:\Documents and Settings\All Users\Application Data<br><br>If you have XP Pro, I wondered if you can run some tests for me, thanks!<br><br>TEST1:<br><br>1) download this: <a href="http://www.greyaliengames.com/aotmg/aotmg106.zip" target="_blank">http://www.greyaliengames.com/aotmg/aotmg106.zip</a><br><br>2) Make sure you are logged on as administrator<br><br>3) In case you've run AOTMG before, first go to C:\Documents and Settings\All Users\Application Data\Grey Alien Games\AOTMG and delete the folder. (Note that Application Data is a hidden folder, so you may need to click Tools/Folder Options/View/Show Hidden Files and Folders.<br><br>4) Unzip AOTMG106 to the C Drive somewhere suitable (not on your Desktop).<br><br>5) Run AOTMG.exe.  It should work fine. If you check, you'll see that's it's made a folder called C:\Documents and Settings\All Users\Application Data\Grey Alien Games\AOTMG with some dynamic data in it.<br><br>6) Change to a non-admin user.<br><br>7) Run the game again.  It should work fine as the data is shared for all users with some special code.  This is NOT working on one user's PC from Portugal and I can't figure out why!  It works fine on mine and lots of other PCs.<br><br>TEST 2:<br><br>1) download this: <a href="http://www.greyaliengames.com/aotmg/aotmgtest.zip" target="_blank">http://www.greyaliengames.com/aotmg/aotmgtest.zip</a><br><br>2) Make sure you are logged on as administrator<br><br>3) This time you MUST delete C:\Documents and Settings\All Users\Application Data\Grey Alien Games\AOTMG and all the contents. (Note that Application Data is a hidden folder, so you may need to click Tools/Folder Options/View/Show Hidden Files and Folders.<br><br>4) Go to your previous installation of AOTMG and copy in the exe from the aotmgtest.zip file overwriting the old exe.<br><br>5) Run the exe.  It should work.<br><br>6) Change to a non-admin user.<br><br>7) Run the game again.  It should NOT work.  You should get an error about an ini file not being able to write.  That's what I get on mine anyway.<br><br>Please report back your results.  I really appreciate your help with this, thanks! <br><br></td></tr></table><br>
<a name="839487"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EOF</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I get the exact results as described above<br>That is,<br><br><br>TEST 1<br>Admin -&gt; Works<br>Guest -&gt; Works<br><br>TEST 2<br>Admin -&gt; Works<br>Guest -&gt; Fails (Cannot write to blahblah file) <br><br></td></tr></table><br>
<a name="839503"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Big&amp;</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Same as Jim <br><br></td></tr></table><br>
<a name="839504"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK thanks, really appreciate your help.  Your results were what I expected.  Now to figure out why this person's PC is different.<br><br>Hey if anyone else has XP Pro on a non English-language setup, it would be really great if you could run this test for me, thanks! <br><br></td></tr></table><br>
<a name="839541"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >degac</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> TEST 1<br>Admin -&gt; Works<br>Guest -&gt; Works<br><br>TEST 2<br>Admin -&gt; Works<br>Guest -&gt; Error: Failed to write to 'C:\Documents and Settings\All Users\Dati applicazioni\Grey Alien Games... '<br><br>XP Pro 2002 SP 2 <br><br></td></tr></table><br>
<a name="839591"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK thanks!  So that's the Italian version of Windows tested :-) <br><br></td></tr></table><br>
<a name="839605"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> XP Pro in that manner should work quite similar to how Vista works when it comes to right management and writing to the application data folder.<br><br>And on the not working: Ask the user from portugal if the paths for application data has some special char in and I thought the BM core does only support US AScii (0-127 instead of 0-255 which is ASCII) <br><br></td></tr></table><br>
<a name="839607"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> The BM core stores strings in unicode format, and leaves the unicode format in every print or console operation (even when the console doesn't support unicode character set), but files and folders names are internally managed as ANSI in some windows distros. Depending on the country and the windows build. I'm not sure if this will be the problem. <br><br></td></tr></table><br>
<a name="839610"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thats exactly the problem.<br>BM Strings are unicode<br>But not the stuff that the internal core uses which is not String based. This was officially confirmed by BRL.<br>The internal core is not unicode compatible -&gt; BM will not work with foldernames that are non-ANSI even thought its nowhere mentioned that BM is english only (because it is not even ascii compliant which is a joke in 2008 where the OS are unicode compliant) <br><br></td></tr></table><br>
<a name="839727"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well on the user's PC who is experiencing problems, it works on the admin account but not on the guest account (so this infers that the paths are fine and don't contain illegal chars).  It's as if the special code to share the folder is failing on his PC despite working on all others.<br><br>Interesting about the ANSI chars users in the core.  I was thinking that perhaps if the path had non-ANSI chars it might get garbled when passed into the Windows function which shares the path, but it seems to be standard ANSI chars. Here's the path on his PC:<br><br>C:\Documents and Settings\All users\Dados de aplicativos\Grey Alien Games/<br><br>As you can see there are no funny characters used there unless he missed them out when typing the name?  Anyone know portugese? <br><br></td></tr></table><br>
<a name="839734"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could ask him if he reduced the rights of his user account. XP Pro offers you far more indepth setting possibilities.<br>As well it could be that he has some kind of security application that interfers or "catches" the call you do through appi.<br><br>I would assume thats more something towards the first one, that Windows just does not give it the right to do it when you use your WinAPI calls.<br><br>Good thing is that the solution most likely will work in the higher Vista Editions as well on user accounts with reduced rights. <br><br></td></tr></table><br>
<a name="839744"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I asked him that and he says he didn't alter anything.  I also wondered if it was a security program somehow blocking stuff.  It's weird.  I may have to give in - gasp!<br><br>The code seems to work on Vista, no one has reported any issues yet, but it probably hasn't been used on as many vista PCs. <br><br></td></tr></table><br>
<a name="839816"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >degac</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't know it this could be useful, but I made this little program to test on my computer<br><pre class=code>
Framework BRL.BASIC
Import BRL.Retro

Print "USER PROFILE: "+getenv_("USERPROFILE")
Print "USER NAME   : "+getenv_("USERNAME")
Print 
Print "USER OS     : "+getenv_("OS")
Print "USER TEMP   : "+getenv_("TEMP")
Print "USER TMP    : "+getenv_("TMP")
Print
Print "ALL USER    : "+GETENV_("ALLUSERPROFILES")
Print "App data    : "+getenv_("APPDATA")
Print
Print "Processor arch: "+getenv_("PROCESSOR_ARCHITECTURE")
Print "Computer name : "+getenv_("COMPUTERNAME")
Print "Home drive    : "+getenv_("HOMEDRIVE")
Print "Home path     : "+getenv_("HOMEPATH")
Print "Program files : "+getenv_("PROGRAMFILES")
Local username$=getenv_("USERNAME")
Local MYDATA$=getenv_("APPDATA")+"\MyFolder"
Local r:Int=CreateDir(mydata)
If r
	Print "Folder: "+mydata
	rr=CreateFile(mydata+"\test_file_"+username+".txt")
	If rr Print "file created..."
End If

'App data    : C:\Documents and Settings\degac\Dati applicazioni
'try to write here: C:\Documents and Settings\All users\Dati applicazioni

Local newpath$=Replace(mydata,username,"All Users")
Print "New path: "+newpath

Local r2:Int=CreateDir(newpath)
If r2
	Print "Folder: "+newpath
	rr2=CreateFile(newpath+"\test_file_newpath_"+username+".txt")
	If rr2 Print "file created..."
End If
</pre><br>Basically it creates a folder 'myfolder'  under (user_name)<br><div class="quote"> <br>C:\Documents and Settings\degac\Dati applicazioni\MyFolder<br> <br></div><br>and in this folder it creates a file test_file.txt.<br>Then it creates a new folder in 'all users' and a new file test_file_newpath.txt in<br><div class="quote"> <br>C:\Documents and Settings\All Users\Dati applicazioni\MyFolder<br> <br></div><br><br>I have tested with 2 users: degac (administrator) and test (normal user without admin privileges) under XP Pro<br>For every users I disconnected and logged in with the other one.<br>It works. I can create both the files under user_name\Dati applicazioni\MyFolder without errors.<br><br><div class="quote"> <br>Building _OS_INFO<br>Executing:_OS_INFO.exe<br>USER PROFILE: C:\Documents and Settings\degac<br>USER NAME   : degac<br><br>USER OS     : Windows_NT<br>USER TEMP   : C:\DOCUME~1\degac\IMPOST~1\Temp<br>USER TMP    : C:\DOCUME~1\degac\IMPOST~1\Temp<br><br>ALL USER    : <br>App data    : C:\Documents and Settings\degac\Dati applicazioni<br><br>Processor arch: x86<br>Computer name : AMIGA<br>Home drive    : C:<br>Home path     : \Documents and Settings\degac<br>Program files : C:\Programmi<br>Folder: C:\Documents and Settings\degac\Dati applicazioni\MyFolder<br>file created...<br>New path: C:\Documents and Settings\All Users\Dati applicazioni\MyFolder<br>Folder: C:\Documents and Settings\All Users\Dati applicazioni\MyFolder<br>file created...<br><br>Process complete<br> <br></div> <br><br></td></tr></table><br>
<a name="839817"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's strange as if a file already exists in the folder having been created by the admin user it should be read only when you logon as the other user and then the createfile command will fail because it's not allowed to overwrite it. <br><br></td></tr></table><br>
<a name="839826"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >degac</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, I can access the 'All users' folder as Test user, open the file, write on it, save it.<br>I cant' access to DEGAC (admin user) folder - I get an error. <br><br></td></tr></table><br>
<a name="839827"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm this is curious because on my PC (and the ones who ran the test, which includes yourself), the test user cannot overwrite the ini file because it's "read only" when it's created by the first admin user.  I don't understand what your code above is doing different (haven't tested it yet mind you). <br><br></td></tr></table><br>
<a name="839829"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >degac</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> I changed a little the program<br><pre class=code>
Framework BRL.BASIC
Import BRL.Retro
Import BRL.PolledInput


Local username$=getenv_("USERNAME")
Local MYDATA$=getenv_("APPDATA")+"\MyFolder"
Local r:Int=CreateDir(mydata)
If r
	Print "Folder: "+mydata
	rr=CreateFile(mydata+"\test_file_"+username+".txt")
	If rr Print "file created...test_file_"+username+".txt"
	
	rr0=CreateFile(mydata+"\test_file.txt")
	If rr0 Print "file created...test_file.txt in "+mydata
End If

'App data    : C:\Documents and Settings\degac\Dati applicazioni
'try to write here: C:\Documents and Settings\All users\Dati applicazioni

Local newpath$=Replace(mydata,username,"All Users")
Print "New path: "+newpath

Local r2:Int=CreateDir(newpath)
If r2
	Print "Folder: "+newpath
	rr2=CreateFile(newpath+"\test_file_ALLUSER.txt")
	If rr2 Print "file created...test_file_ALLUSER.txt"
	
End If

WaitKey
</pre><br>Compile it with 'Build GUI App' not selected (to view the output window).<br>The program writes (as admin or as simple user) a file in<br><div class="quote"> <br>C:\Documents and Settings\All users\Dati applicazioni\MyFolder\test_file_ALLUSER.txt<br> <br></div><br>I stared as TEST user, the program creates the files. I opened the file in All Users...and I wrote in it 'from test user'.<br>Switched to ADMIN user, I can read the modified file.<br>Run the program.<br>Now the file 'Test_file_ALLUSER.txt' is blank. I wrote in it 'From ADMIN',<br>switched again to TEST user, run the program, Test_file_ALLUSER.txt - rewritten &amp; blank.<br><br>I dont' know it this is normal or not - but I can access the ALL USER folder and write to the file, BUT I can't copy a .exe file from D: to C:\ as TEST user. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
