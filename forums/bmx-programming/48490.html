<!DOCTYPE html><html lang="en" ><head ><title >Sound Latency</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Sound Latency</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Sound Latency</a><br><br>
<a name="539113"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Has or is anyone else experiencing issues with latency when using the PlaySound Command? Is this a known issue with the homegrown sound library? <br><br></td></tr></table><br>
<a name="539139"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have experienced this occassionally as well.  It seems to be a slightly worse problem on my Linux PC. <br><br></td></tr></table><br>
<a name="539296"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mark Tiffany</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I rooted around in the code a while back, and I decided that the problem boils down to the sound buffer.  In order to prevent choppy sounds, a number of bytes are loaded each Flip.  The problem is that the sound buffer needs to be quite big to prevent it from coming out all stuttered, but as it gets bigger, it can introduce some latency.<br><br>Two things: <br>1) it would be nice if we could define that buffer (8K at the moment I think), possibly even on a per sound basis, such that short, time critical sounds get a short buffer and longer, less critical sounds get a long buffer (maybe that could even be auto-selected by bmax?)<br>2) it should be possible to have cuesound do exactly what it says on the tin, such that PlaySound really does start playing immediately. <br><br></td></tr></table><br>
<a name="539319"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmn perhaps I shall try cuesound instead (but tomorrow). <br><br></td></tr></table><br>
<a name="539405"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> In order to prevent choppy sounds, a number of bytes are loaded each Flip <br></div><br><br>Where is the sound buffer? How do I get bytes from the buffer? How do I play them manually? <br><br></td></tr></table><br>
<a name="539411"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> The latency was introduced to provide compatability with extremely poor multimedia drivers that ship with some soundblaster cards. A DirectSound driver is planned for FreeAudio that will feature much more responsive performance on Windows machines. <br><br>There are also audio stream hooks coming that will allow you to capture and feed the mixer with your own raw audio data. <br><br></td></tr></table><br>
<a name="539524"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Skidracer,<br><br>How soon is this coming? I've a commercial release to make and this is a big issue for me. <br><br></td></tr></table><br>
<a name="540457"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mark Tiffany</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Where is the sound buffer? How do I get bytes from the buffer? How do I play them manually? <br></div><br>"Hidden" in the module source, which for the actual grunt-work is C code.  While I understand enough C to work out that there is a buffer, and to hack a bit of code, I don't understand enough of how audio stuff 'works' - especially when I hit the scary looking mixing code!  I did manage to write a RestartSound function, which reset a non-looping sound such that you can play it again <i>without</i> loading or cueing it, i.e. aiming to avoid any potential setup delay.  But I quickly realised that wasn't the true source of the latency problem (it's the fact it all happens in one thread, and has to buffer the sound). <br><br></td></tr></table><br>
<a name="540516"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Audio streams that you can feed data to sounds really cool!!! <br><br></td></tr></table><br>
<a name="540685"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hotcakes</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Those audiohooks sound mighty nice, skiddy...<br><br><div class="quote"> How soon is this coming? I've a commercial release to make and this is a big issue for me. <br></div><br>Chances are your customers won't notice it as much as you.  It may not even be a problem at all for many of them. <br><br></td></tr></table><br>
<a name="540693"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TartanTangerine (was Indiepath)</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have a professional soundcard so I doubt that is the issue.<br><br>I've played with the C code and found that a buffer size of 4096 is just right.<br><pre class=code>
struct winmmdevice:audiodevice
{
	HWAVEOUT	device; 
	int 		buffersize;
	abuffer 	buffer[2];
	int 		bnum;
	int 		mode;			//0=8bit 1=16bit
	int 		playing;

	int reset()
	{
		int sz=4096;
		mix=new mixer(sz);
		device=0;
		buffersize=0;
		bnum=0;
		mode=0;
		playing=0;
		return init(44100,2,16,sz);
	}
</pre><br><br><div class="quote"> Chances are your customers won't notice it as much as you. It may not even be a problem at all for many of them.  <br></div><br><br>It was the testers who noticed it first. <br><br></td></tr></table><br>
<a name="540960"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mark Tiffany</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I believe 4096 is what it was originally set to, but got bumped to allow for some (presumably slower) machines.  As I've said before, the neatest solution would be to be able to set the buffer size from BMax code.  Which probably wouldn't be too hard to hack into the C code... <br><br></td></tr></table><br>
<a name="834304"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jp22</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm new to blitzmax, so hopefully someone can help me<br><br>I've downloaded gthe demo of BlitzMax, having previously used BlitzPlus<br><br>I found that the latency for BlitzPlus was too large (trying to do things like wavetable lookups at 60fps just didn't swap between samples quickly enough..Think C64 Drum sounds here..)<br><br>I found this thread, so *think* that BlitzMax should allow me to change the latency to get around this problem, but would like to know how to go about changing the audio output buffer size, as described above.<br><br>From the files i've got from downloading the demo, I can't see anywhere in the module side of things which seems to initially set this up or anywhere which has the code as shown above..<br><br>Thanks in advance<br><br>JP <br><br></td></tr></table><br>
<a name="834313"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Have you tried using OpenAL or DirectSound instead of FreeAudio as that was the driver with the latency issues.   Look up EnableOpenALAudio and SetAudioDriver. <br><br></td></tr></table><br>
<a name="834319"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jp22</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for this. I'll take a look at SetAudioDriver<br><br>Thing is, even though I can do a google search and find info on SetAudioDriver, I can't see this function mentioned at all in BlitzMax.. Again, making me wonder if the demo version is the same as the full price version?<br><br>Another thing,  I've seen threads where people have said about compiling BlitzMax and getting problems when it gets to the freeAudio.cpp file..<br><br>With the demo version of BlitzMax that i've downloaded, there's no .cpp files at all. Can somebody tell me if I will get *full* source to this kind of thing if I buy the full BlitzMax version?<br><br>Thanks again<br>JP <br><br></td></tr></table><br>
<a name="834321"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jp22</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmmm the demos v 1.12, which i'm guessing isn't the latest version?<br><br>doesn't seem to recognise SetAudioDriver either...tsk tsk... <br><br></td></tr></table><br>
<a name="834365"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yan</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> As you've realised, the demo version of BMax is pretty old. The current release version stands at v1.28 and does indeed include the source to all modules. <br><br></td></tr></table><br>
<a name="834381"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jp22</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the clarification, Ian<br><br>Much appreciated <br><br></td></tr></table><br>
<a name="834393"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry didn't know you had the demo.  Think that stuff was added midway through V1.24, so it's in V1.26 upwards. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
