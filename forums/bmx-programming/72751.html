<!DOCTYPE html><html lang="en" ><head ><title >How to create and link MSVC .lib files into blitzm</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >How to create and link MSVC .lib files into blitzm</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >How to create and link MSVC .lib files into blitzm</a><br><br>
<a name="813130"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gameshastra</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> What is the procedure to create and link a library from MSVC into blitzmax, <br>1)should we create a .lib file , a .dll file or both?<br>2) how to convert the .lib to a .a and where should the .a file be placed<br>3)ALso what are options to select in MSVC to create the .lib file. <br>Should the file containing the c++ code necessarily have _declspec(__dllexport) .... entries <br><br>I would be happy to get full details, as I have not found this anywhere else in the forums <br><br></td></tr></table><br>
<a name="813131"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gameshastra</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Further on my question posted above. I wonder if the object(.o) file of the c++ code compiled by MSVC file cannot be directly provided to the compiler to link? <br><br></td></tr></table><br>
<a name="813135"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> If the API is exposed as C++ (rather than C), you may have problems with MSVC's C++ name-mangling, which I believe is different from GCC's.<br>ie. a function in the DLL might have a different mangled name to the one expected by GCC (which BlitzMax uses).<br><br>If the API is exposed as C, this should not be a problem. <br><br></td></tr></table><br>
<a name="813140"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gameshastra</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is it possible to get the mangled name using dumpbin and change the name in the .def file. What would the procedure be in this case<br>If the API is exposed as C, what are the other steps to follow? <br><br></td></tr></table><br>
<a name="813141"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is what I used for my BaH.DBMySQL module :<br><br>[code]<br>reimp -d libmysql.lib<br>dlltool -k -d libmysql.def -l libmysql.a<br>[/quote]<br>reimp creates the .def file. dlltool uses the .def to create the .a that is linked in to the app. <br><br></td></tr></table><br>
<a name="813144"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gameshastra</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have used reimp -d on my library file  and it doesn't produce any output<br><br>My code has __declspec(dllexport) entries and I have compiled the same in MSVC as a static library. I am not sure this is the right procedure. <br><br></td></tr></table><br>
<a name="813150"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Did you enclose it in extern "C" { .. }?<br><br>and on your original question: at best you create a .a file and a dll <br><br></td></tr></table><br>
<a name="813154"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gameshastra</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Isn't the extern "Win32" declaration to be placed in the blitzmax file? what is the need for an extern "C" in the c++ file. <br><br>How can I compile both as lib and dll <br>One requires __declspec(dllexport) and other doesn't <br><br></td></tr></table><br>
<a name="813155"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> what is the need for an extern "C" in the c++ file <br></div><br>As far as I know (and I'm certainly no expert!), exported C++ functions have their names mangled, exported C functions don't. Different C++ compilers mangle their names in different (incompatible) ways.<br><br>Can't answer any of your other questions, as I don't know much about Win32. Sorry. <br><br></td></tr></table><br>
<a name="813158"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gameshastra</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any help on the win32 side would be appreciated <br><br></td></tr></table><br>
<a name="813374"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gameshastra</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Assuming I have the .a file where do I place it and how does the linker know that this file is to be linked. <br><br></td></tr></table><br>
<a name="813452"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you are using standard BlitzMax, you should put the .a into, BlitzMax/lib<br><br>You link against using a line like :<br><br>Import "-lstuff"<br><br>Where the .a file is named "libstuff.a" <br><br></td></tr></table><br>
<a name="813621"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gameshastra</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any help on the win32 side?<br>Is the ffmpeg module going to come soon? <br><br></td></tr></table><br>
<a name="814024"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gameshastra</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I managed to link to the Dll using LoadLibraryA<br>I get the mangled function names using the pexports utility <br>pexports dllname <br><br></td></tr></table><br>
<a name="814026"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gameshastra</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Linking to the .a files still fails. Though I have solved my problem through dll use as in previous post. <br><br></td></tr></table><br>
<a name="814027"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> If linking with the .a fails you either didn't use it like Brucey sad or you are compiling it somehow strange with GCC <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
