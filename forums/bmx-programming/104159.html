<!DOCTYPE html><html lang="en" ><head ><title >OpenAL Running out of channels?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >OpenAL Running out of channels?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >OpenAL Running out of channels?</a><br><br>
<a name="1259939"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Arska</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok more topics. (i have lot of problems :D) Just tested my project and i noticed that if there is many sounds going on. My friend reported this:<br><pre class=code>
Projectile flying sound doesn't work, and disables other sounds over time when multiple shots are fired? Too many overlapping sounds? Still, rocket works fine.
</pre><br><br>I got same results, but not as often as my friend. I found this topic , but in topic there is 'crash'.<br><a href="http://www.blitzbasic.com/Community/posts.php?topic=87867" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=87867</a><br><br>I am not having any crashes, but sounds got muted over time. So this is channel problem? I have lot's of channels in my project, because i need calculate sound volume from distance and etc..<br><br>Here is some code:<br><pre class=code>
Shot.sound = LoadSound(Shot.soundPath)
Shot.soundVol = 1 - Distance#( myplayerX, myplayerY, X, Y ) / soundDivision
Shot.soundChannel = CueSound(Shot.sound)
SetChannelVolume( Shot.soundChannel , Shot.soundVol )
ResumeChannel Shot.soundChannel
</pre><br><br>So any other way around? <br><br></td></tr></table><br>
<a name="1259941"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Limit the number of sounds you're playing.  Keep an array of TChannels and cycle through the array when playing sounds.  When you get to the end, go back to the start.<br><br>This way, you'll never have more sounds playing than the number you specify, and old sounds get killed (if needed) to make way for new ones.<br><br>Oh - one more thing.  I've had situations where CueSound as you're using it, will fail sometimes.  The way I found around it was thus:<br><br><pre class=code>Shot.soundChannel = AllocChannel()
CueSound(Shot.sound, Shot.SoundChannel)
Shot.SoundChannel.Resume()</pre><br><br>Well, you get the idea.  Haven't used Blitzmax in a while so you might have to iron out the creases. <br><br></td></tr></table><br>
<a name="1259943"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> In another thread I created this code:<br><a href="https://github.com/GWRon/Dig/blob/master/base.sfx.channelpool.bmx" target="_blank">https://github.com/GWRon/Dig/blob/master/base.sfx.channelpool.bmx</a><br>Simple sample:<br><a href="https://github.com/GWRon/Dig/blob/master/samples/channelpool/channelpool.bmx" target="_blank">https://github.com/GWRon/Dig/blob/master/samples/channelpool/channelpool.bmx</a><br><br><br>Another user was using it (and had problems which were mostly based on the approach he took on "sound channels"):<br><a href="/posts.php?topic=104066" target="_blank">Community/posts.php?topic=104066</a><br><br><br>Basically it is something like what GfK suggested. You might limit the channels, and when requesting a specific channel it will return an already existing one instead.<br><br>How to use such a thing?<br>- have some protected channels for "unstoppable" things like background music, voice overs, main character sound effects, ...<br><br>all other things (random sfx for accelerating vehicles etc) could get played on a limited amount of channels.<br><br><br><br>If you need more channels than available, you might end up with some kind of software mixer (you directly write your sounds to the audio buffer and this resulting audio is played on a channel).<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1259972"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Arska</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> So i basicly have just few sound channels and use existing one to play.. let's say: all explosions. But is it possible to set channel volume for every sound, without interrupting other sounds playing in channel? <br><br></td></tr></table><br>
<a name="1259976"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> The volume is done on a per-channel-basis.<br><br>The only solution to overcome this limit it a software mixer. Check the mod-sources, somewhere was some kind of software mixer, just do not remember where.<br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1262600"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Arska</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Still not solved. I have still no idea how i can overcome this limit, i have lot's of sounds and all must play no matter what. Someone want to explain 'software mixer' in game development and give me example? <br><br></td></tr></table><br>
<a name="1262602"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Arska</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried Derrons 'base.sfx.channelpool', but example gives Unhandled Exception:Attempt to access field or method of Null object. Debugger points this line:<br><pre class=code>if GetPooledChannel("soundchannel1").Playing() then channel1 = "USED"</pre><br><br>Also when i delete those lines i can test it, but when i first press key '1' to play sound 1 on channel 1, it starts playing it, but when i press 'Q' to stop that sound in channel 1 it is not stopping. It only happens in channel which i play first. Any ideas? <br><br></td></tr></table><br>
<a name="1262603"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Could you try to lower the channel amount?<br><br>in the sample code you find this lines:<br><pre class=code>
Repeat
	'enable this to see how only one channel is used
	'TChannelPool.channelLimit = 1
</pre><br><br>check what happens if you re-enable that line.<br><br><br><pre class=code>
if GetPooledChannel("soundchannel1").Playing() then channel1 = "USED"[
</pre><br>This means it was not even able to AllocChannel() the first channel...<br><br>Does debugger mean the returned channel object is null ?<br><br>As you said you commented the line out ... and it played a song, I am left puzzled.<br><br>Is there someone out having the same trouble with that sample?<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1262604"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Arska</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> By enabling <pre class=code>TChannelPool.channelLimit = 1</pre> It still gives me 'Unhandled Exception:Attempt to access field or method of Null object' At the same line. <br><br></td></tr></table><br>
<a name="1262605"></a>

<a name="1262606"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Arska</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looks like it works this way:<br><pre class=code>If GetPooledChannel("soundchannel1") And GetPooledChannel("soundchannel1").Playing() Then channel1 = "USED"</pre><br><br>But still. Why can't i pause first sound. When first sound is played i can stop any channel.<br><br>Edit: Nevermind now it works with code above. <br><br></td></tr></table><br>
<a name="1262608"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> The problem with your code is:<br><br>It only checks the first condition - and as this fails, it already skips the rest.<br><br>Please try something like:<br><br><pre class=code>
If GetPooledChannel("soundchannel1") 
  print "found valid channel"
Else
  print "no valid channel found"
EndIf 
</pre><br><br>If that already "fails", then The "GetPooledChannel("soundchannel1").Playing()" portion is never executed.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1262609"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Arska</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is that problem, because it works. In my opinion it's better to avoid channel playing check if channel is Null. <br><br></td></tr></table><br>
<a name="1262618"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Did you do what I asked you for?<br><br>No?<br><br>In that case you would have seen that there is nothing returned in your case ;D - and you would have helped me to locate a bug.<br><br><br>The problematic line is this:<br><pre class=code>
AddChannel(key, AllocChannel())
</pre><br><br>I planned to use it "chainable" (returning the added channel so you could AddChannel(bla).Play()) but I missed to return the channel within that method.<br><br>So I replaced that with returning a boolean and changed the line of code in GetChannel().<br><br>Please download the new version at:<br><a href="https://github.com/GWRon/Dig/blob/master/base.sfx.channelpool.bmx" target="_blank">https://github.com/GWRon/Dig/blob/master/base.sfx.channelpool.bmx</a><br><br>and give it a whirl, hopefully it resolves the issue.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1262627"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Arska</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks it solved it! Now i'll try implement this to my project and at least try to get all sounds work good. Sounds good already. Thanks again. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
