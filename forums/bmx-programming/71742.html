<!DOCTYPE html><html lang="en" ><head ><title >Multithreading and Working around the GC</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Multithreading and Working around the GC</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Multithreading and Working around the GC</a><br><br>
<a name="801681"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >UByte</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have read that the BlitMax GC is not threadsafe and attempts to do multithreading in BlitzMax unreliable, resulting in crashes.<br><br>What actually causes these crashes though? Is it just a case of reference counting going awry due do non-syncronisation. Aside from accesing an object which has been destroyed prematurely (which I'm guessing is happening) what else might cause crashes?<br><br>As the threading I whish to do will only occur for finite time and periodically and there would be no significant memory allocation during this time. Could I simply just disable automatic garbage collection in this period to get round any issues?<br><br>Are there any other workarounds/ carefull programming tips which would allow me to access blitz objects from multiple threads with garbage collection enabled? <br><br></td></tr></table><br>
<a name="801683"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> As the threading I whish to do will only occur for finite time and periodically  <br></div><br>(Ok when you say Finite I assume you mean small as apposed to not InFinite)<br><br>If so just use a timer Hook, as long as you have a pollEvent in your message/Main loop, and the other task wasnt long, then it would look like multithreading<br><a href="http://www.blitzmax.com/codearcs/codearcs.php?code=1721" target="_blank">http://www.blitzmax.com/codearcs/codearcs.php?code=1721</a> or<br><a href="http://www.blitzmax.com/Community/posts.php?topic=69149#773096" target="_blank">http://www.blitzmax.com/Community/posts.php?topic=69149#773096</a> <br><br></td></tr></table><br>
<a name="801688"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >UByte</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, bad choice of terminoligy. Tasks will typically take up to a minute (perhaps longer). By finite I meant; not a looped task that lasts the duration of the program's lifecycle, but a series of one-off tasks.<br><br>What I'm trying to do is achievable without threads but at the cost of performance, file IO for example. <br><br></td></tr></table><br>
<a name="801689"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Winni</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can also spawn another process to do these things and communicate with it through sockets, for example. That's not as sexy as using multithreading, but it won't have to worry about the garbage collector issues. <br><br></td></tr></table><br>
<a name="801696"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> What actually causes these crashes though? <br></div>Concurrent actions. What happens is that the so-called "critical section" of an object/algorithm is accessed by more than one thread which - in the best case scenario - results in an undefined result, often leading to random and arbitrary crashes. <br><br></td></tr></table><br>
<a name="801711"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> So that's where you need to make some kind of lock thing, right, so that the code has to finish the critical part before another thread can? <br><br></td></tr></table><br>
<a name="801759"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> right, and thats the point that you would need to add to the GC to prevent it from accessing objects you are working on. <br><br></td></tr></table><br>
<a name="801772"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >UByte</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Doesn't the GC only access private fields though? So it wouldn't be a case of the GC mangling objects you are working on as that memory space isn't going to get touched.<br><br>Rather, is it GCCollect running concurrently in multiple threads that causes crashes or screwing up an objects reference count, perhaps deallocating them prematurely?<br><br>In any case I should be fine disabling automatic Garbage Collection while a thread is running, yes? <br><br></td></tr></table><br>
<a name="801773"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >UByte</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Winni<br>Communicating through blocking Streams would probably have more of a performance hit than trying to do manual time-slicing. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
