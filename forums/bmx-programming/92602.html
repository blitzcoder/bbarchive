<!DOCTYPE html><html lang="en" ><head ><title >Image fonts are distorted?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Image fonts are distorted?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Image fonts are distorted?</a><br><br>
<a name="1055899"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I thought it would be easy to match the text Windows uses for its GUI, but it's turning out to be very hard.  I have smoothing and blending enabled, and that is working.  However, the image fonts do not resemble their "real" counterparts.  I am trying to load segoeui, and the font is displayed wide and short, compared to what it is supposed to look like.  Any tips on this?  Why is this happening? <br><br></td></tr></table><br>
<a name="1055942"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Becouse BlitzMax does not use ClearType technology to draw fonts on the graphical contexts. I'm afraid there's not much you can do... <br><br></td></tr></table><br>
<a name="1055948"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm talking about the dimensions of the text.  The Blitz version is wide and short.  It's obviously distorted. <br><br></td></tr></table><br>
<a name="1055950"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> It is also the same. Blitzmax string rendering is not using a grid fit for text and this changes proportions. You can pre-render system fonts using the fontmachine editor if you are in a hurry. It supports cleartype and antialias properly. <br><br></td></tr></table><br>
<a name="1056003"></a>

<a name="1056005"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, that sounds like just what I need.<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1056014"></a>

<a name="1056015"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why does SegoeUI 12 pt with cleartype look like this?:<br><br><img src="http://www.leadwerks.com/post/fontmachine.jpg"><br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1056016"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Enable alpha blending and export it over white background. Clear type is calculated also using the background color where it is rendered (not transparent). <br><br></td></tr></table><br>
<a name="1056017"></a>

<a name="1056018"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Also disable border and shadow in the renderer<br><br>EDIT: FontMachine clear type renderer is assuming a black background for internal interpoloation. I'm changing this right now, give me 5 minutes and I'll send you a fixed version (Please, send me an email so I can send you a fixed version)<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1056022"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> It will take a bit more than I first tought, as it is not possible to render alphablended characters with ClearType. Nothing that can really be done here... I'm sorry. <br><br></td></tr></table><br>
<a name="1056023"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why would you use a black background for clear type rendering? <br><br></td></tr></table><br>
<a name="1056024"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> The think is that I'm using a transparent background and the Windows API treats transparent pixels as black pixels. That's the problem. The only way to solve it is by providing a solid background BUT then ther's the problem with characters overlapping their backgrounds, wich looks nasty too. I can send you a Segoe font renderer with white background and if you modify the fontmachine module to add a maskcolor of 255,255,255 it'll look properly. That's the only solution I can think of now... <br><br></td></tr></table><br>
<a name="1056223"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I need to get this done, so I would definitely appreciate that. <br><br></td></tr></table><br>
<a name="1056230"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Send me an email and I'll reply with the font buit on white background <br><br></td></tr></table><br>
<a name="1056231"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can update your fontmachine module with the latest one (I've just uploaded it). The new version allow to set a maskcolor before loading a font.<br>before loading the font set:<br><pre class=code>font.MaskColorRed = 255
font.MaskColorGreen = 255
font.MaskColorBlue = 255
Font.UseMask = True</pre><br>Whenever I get an email from you, I'll send you the font. I've tested it and it works. <br><br></td></tr></table><br>
<a name="1058848"></a>

<a name="1058849"></a>

<a name="1058850"></a>

<a name="1058851"></a>

<a name="1058853"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Regarding the original issue of fonts being distorted:<br><br>I spent a few days implementing FreeType 2, the same library BlitzMax uses.  Here are my results, compared to Paint Shop Pro text, which was added to the image, and BlitzMax.  Leadwerks and Paint Shop Pro match perfectly, and BlitzMax text is very clearly different:<br><img src="http://www.leadwerks.com/post/freetype.png"><br><br>All of these use Tahoma, size 11.<br><br>Take a look at this tutorial:<br><a href="http://www.freetype.org/freetype2/docs/tutorial/step2.html" target="_blank">http://www.freetype.org/freetype2/docs/tutorial/step2.html</a><br><br><img src="http://www.freetype.org/freetype2/docs/tutorial/metrics.png"><br><br>I used 96 for the DPI settings and that seemed to produce correct results.  Clear Type is also apparently supported by FreeType, but I have not got it working yet.<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1058859"></a>

<a name="1058860"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> It probably has to do with the way BlitzMax handles graphics internally.  If an image is not a power of 2, BlitzMax converts it to one, but then draws the image too small.  I don't know the specifics of the problem, as I have never researched it enough to figure out exactly what the problem is.  But, i always use images with a power of 2 size with BlitzMax to avoid the problem or draw them the correct size myself using DrawSubImageRect.  I had my own version of DrawSubImageRect before it was added a few versions ago.<br><br>When the font is broke down into its parts, BlitzMax is probably creating a bunch of TImages for the font (one for each letter/number), and it is resizing them all to a power of 2 size.<br><br>I had a couple of threads here about it a long time ago.  One when I discovered it, and another when I asked Mark why it worked that way.  He had and explanation, having something to do with how it solved some complicated issues.<br><br>If you force the library to use power of 2 sizes instead of letting BlitzMax scale them, it will probably solve the problem.<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1058966"></a>

<a name="1058967"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >beanage</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Josh - could you please publish your Freetype code?<br><br>[edit:]Oh well, its cpp right?<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1058974"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is the important part, that tells you the x and y offset to draw the letters at:<br>charpos[c].x = face-&gt;glyph-&gt;metrics.horiBearingX/64;<br>charpos[c].y = face-&gt;glyph-&gt;metrics.horiBearingY/64;<br>charsize[c].x = face-&gt;glyph-&gt;bitmap.width;<br>charsize[c].y = face-&gt;glyph-&gt;bitmap.rows;<br>charspacing[c] = face-&gt;glyph-&gt;metrics.horiAdvance/64.0; <br><br></td></tr></table><br>
<a name="1059262"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> The BLide font machine module is very good, and will do what you need without any hassle.  Internally, it works the same as the BMX font commands. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
