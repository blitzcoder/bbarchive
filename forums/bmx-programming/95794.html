<!DOCTYPE html><html lang="en" ><head ><title >Finding a Memory Leakage</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Finding a Memory Leakage</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Finding a Memory Leakage</a><br><br>
<a name="1105498"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AvestheFox</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> The longer I play my game the slower it seems to get. (Or it may be the size of the current map and how I'm using certain objects.)<br><br>All I know is that I have a memory leak somewhere.<br><br>My question here is... what are some of the best methods for finding the potential leakage point?<br><br>I'm sure there are some practical methods out there other than sending the entire code to a stranger. :P <br><br></td></tr></table><br>
<a name="1105499"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Do you use banks?<br>Do you stick things on lists,and then forget about them? <br><br></td></tr></table><br>
<a name="1105503"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AvestheFox</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> @H&amp;K<br><br>I've used banks only once and that's to read tile obstacle types from a file and apply them to the tiles upon map setup. Should I probably use banks for other purposes?<br><br>As for forgetting things on lists. Could you be a bit more specific? I'm not sure if I'm being a bit w reckless with my list or not. every tile (foreground and background layers), and entity are stored in a list developed specifically for their own Type and that's the only thing I've ever used list for. <br><br></td></tr></table><br>
<a name="1105504"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Don't know if this still applies but you used to be able to use an Int for an image handle (rather than a TImage), but garbage collection never cleaned up in those cases.  Don't know if Blitzmax still allows it but that has/did have potential to cause a huge leak.<br><br>Also keep an eye on your list counts. <br><br></td></tr></table><br>
<a name="1105510"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  you used to be able to use an Int for an image handle <br></div><br>Not if you use Strict or SuperStrict, which I expect AvestheFox does, since he's a good BlitzMax citizen :-) <br><br></td></tr></table><br>
<a name="1105511"></a>

<a name="1105512"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> a game getting slower doesn't necessarily means a memory leak.  It can also mean an excessive use of the garbage collector; A sign of poor object/memory management.<br><br>what kind of game is it?<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1105514"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AvestheFox</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Jesse<br><br>Its a platform Metroidvania style game. erm.. the early workings of one anyway...<br><br>I'll admit, even after a decade of using Blitz related software, I'm still a complete noob when it comes to coding.<br><br>My global variables list is quiet massive if that says anything... :P <br><br></td></tr></table><br>
<a name="1105517"></a>

<a name="1105526"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> ....a game getting slower doesn't usually mean a memory leak, it means the game is doing more (which admittedly may be caused by a memory leak).<br><br>The game steadily eating more memory means a memory leak. Have you checked to see how much is actually being used?<br><br><div class="quote"> Should I probably use banks for other purposes? <br></div><br><br>...not to avoid memory leaks, no. (They're a relic of old-style Blitz programming; they don't offer anything you can't do otherwise, except for untyped and unsafe data storage, yay!)<br><br>Anyway, are you familiar with the circular reference problem? If not, that's one place to start looking.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1105527"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AvestheFox</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> circular reference problem? cant say I am.<br><br>please fill me in :P <br><br></td></tr></table><br>
<a name="1105529"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AvestheFox</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Anyway, I've narrowed the slowdown problem down to a single map in my game. I'm wondering if it has something to do with the size of the map.<br><br>the bigger the map the more tiles that are being drawn and on three layers to top it off...<br><br>I've already programmed the game to eliminate empty tiles so I'm not sure if its that or not. :P <br><br></td></tr></table><br>
<a name="1105531"></a>

<a name="1105532"></a>

<a name="1105533"></a>

<a name="1105537"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> do a millisecs check to see how long it takes to draw the map.<br><br>are you drawing tiles off screen also?<br><br><div class="quote"> <br>My global variables list is quiet massive if that says anything... :P <br> <br></div><br>ouch! management of global variables is really awful. Thats why I love OOP  makes management of variables a lot, a lot, a lot... easier.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1105535"></a>

<a name="1105536"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was having memory leaks in my program due to circular references. I don't know if it's the same problem here or not, but I tested it as follows. Have a global variable set to 0, in the new method increase this by 1 and in the delete method decrease this by 1. Then output the number and see if it stays sensible. Quit the level (but not game) entirely and then reload, to see if the numbers have reset.<br><br>Make the boundries for clipping tiles smaller than your screen size, to double check it is clipping tiles correctly.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1105538"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Trust your instincts... a couple things specifically to consider.<br>How many tiles are you drawing (multiply by layers as needed etc.)<br>How long are you loops? If you're storing tiles in a tlist, and the map is big, looping through that whole list could take a long time...<br>Are you doing things you don't need to be (like drawing things that aren't even partially on screen...)<br>How big/how many images are you using? Are you updating any images regularly? It's quite possible to exceed the vram capacity which means every time you try to draw something that's not loaded on the graphics card it has to first make room on the card by dropping something, then upload the picture you want from RAM, repeat when you want to draw the thing it dropped, etc... every time you edit the pixmap for an image it also (automatically) re-uploads it to the graphics card on it's next draw call... you may not be using a lot of RAM, but you might be thrashing the hell out of the pipe between RAM and VRAM, this causes some CRAZY slowdown, and gets worse with every step over that line you take... and if this is the case, before you have to ask, no, there is no reliable way to get the VRAM limit, it's been a thorn in my side for years now... <br><br></td></tr></table><br>
<a name="1105540"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AvestheFox</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> well hey. now there's something... o.o<br><br>I thought I had my clipping code in place but apparently I didnt<br><br>applying it now to see if it makes a difference! <br><br></td></tr></table><br>
<a name="1105541"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AvestheFox</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> HUUUUGE DIFFERENCE!!!<br><br>yay. :3<br><br>Thanks guys! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
