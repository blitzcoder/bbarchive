<!DOCTYPE html><html lang="en" ><head ><title >Don't call an important func as part of an OR test</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Don't call an important func as part of an OR test</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Don't call an important func as part of an OR test</a><br><br>
<a name="765687"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Gah, I just got stuck on a bug for about an hour.  Looked everywhere until by fluke I found out what I'd done and then it was obvious how I'd cocked up.<br><br>Consider this:<br><br><pre class=code>
Local Anim=AnimFunction1()
Anim = Anim or AnimFunction2()
</pre><br>So basically I want anim to be set if either anim function returns true because and animation is occuring.<br><br>Here's the dumbass problem: due to incomplete boolean evaluation (meaning as soon as the test is satisfied, the rest of the clauses are ignore) if AnimFunction1 returns true, anim=1 and therefore the second line goes "OK anim=1 so I don't even need to look at the part after the OR" and so AnimFunction2 never gets called!  This is no good if both functions are supposed to run EVERY frame.<br><br>Anyway fixed it with:<br><br><pre class=code>
Anim = AnimFunction2() or Anim
</pre><br><br>Simple, unless later on Mark decides to optimise Blitz by saying, hmm the second part of the OR is only a variable test, thus is quicker to check than the function so I'll do that first.  That would break my code and lots of others I expect...so it's very unlikely :-) phew.<br><br>Doh! <br><br></td></tr></table><br>
<a name="765690"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CS_TBL</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ooh that looks like a valid stinker.. :P Yet it's a proper example of the fact that users can come up with more bugs than BRL can anticipate on from scratch. :P <br><br></td></tr></table><br>
<a name="765691"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> That would break my code and lots of others I expect...so it's very unlikely :-) phew. <br></div>ACtually that's pretty likely. In fact I believe to some extent it already does this (ie. evaluates the expression it thinks is faster, rather than left to right).<br><br>I'm more surprised the syntax is actually legal (and failing that, does what you expect). <br><br></td></tr></table><br>
<a name="765711"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nelvin</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is how all programming languages I know work and it's called shortcut evaluation so it's how it really should (and does) work. <br><br></td></tr></table><br>
<a name="765712"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> In Delphi that Syntax is totally legal and it does left to right evaluation. It seems to be the same in BMax BUT maybe we need some official confirmation?  Oh and I used that style for my last 2 games BMax games and they worked fine.<br> <br>Nelvin: Which way is called shortcut evaluation? Left to right or actually checking all the conditions to see which can be tested fastest? <br><br></td></tr></table><br>
<a name="765713"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why not use byte operators for this kind of calculations. I mean the | operator.<br><br><pre class=code>SuperStrict
If True | Test() Then
	Print "Hello"
End If

If True or Test() Then
	Print "Hello"
End If

Function Test:Int()
	Print "Called!"
	Return True
End Function</pre><br>This is the output I get:<br><pre class=code>Called!

Hello

Hello</pre><br><br>I thing this is one of the strong points of BlitzMax. you can use logical operations in a optimized way, or arithmetic boolean operations. <br><br></td></tr></table><br>
<a name="765714"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I dunno?  (OK Ziggy, just seen your test example, nice tip thanks)<br><br>here's another related thread:<br><br><a href="http://blitzbasic.co.nz/Community/posts.php?topic=58687" target="_blank">http://blitzbasic.co.nz/Community/posts.php?topic=58687</a><br><br>Oh and here's the Delphi proof:<br><br>http://www.delphibasics.co.uk/RTL.asp?Name=$B <br><br></td></tr></table><br>
<a name="765720"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Its called "short circuit" and as said before is pretty normal.<br>And really the preferred way too, why waste unnecessary cycles when the test has already been satisfied? <br><br></td></tr></table><br>
<a name="765721"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah I've just been researching it some more, I realise it's normal as I've been using it for years.  Flameduck threw doubt on if it was left to right but it really does seem that it's that way. So all is safe ... for now ... <br><br></td></tr></table><br>
<a name="765722"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> It makes sense that if the first part of the statement is true, there's absolutely no point going any further.<br><br>Does the second part of the Or make it *even truer* if the first part is true?<br><br>:-p <br><br></td></tr></table><br>
<a name="765724"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> The point is using logical operators for arithmetic operations. that's the problem. (see example above). If you want to be sure every part of the expression is fully evaluated, use the arithmetic boolean operations ( | for Or, &amp; for And, and ~ for Xor) <br><br></td></tr></table><br>
<a name="765728"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Your code is pretty wacky.<br><br>Why not this?:<br><br>if ( AnimFunction1()+AnimFunction2() ) then... <br><br></td></tr></table><br>
<a name="765747"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Your code is pretty wacky. <br></div>yeah it jsut eneded up that way. I'll just do Anim = AnimFunction1()+AnimFunction2() <br><br></td></tr></table><br>
<a name="765803"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SculptureOfSoul</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, short circuiting is an intentional design to save unnecessary evalutation. AND works that way too, though in reverse of course (first return of false kills evaluation).<br><br><div class="quote"> Simple, unless later on Mark decides to optimise Blitz by saying, hmm the second part of the OR is only a variable test, thus is quicker to check than the function so I'll do that first. That would break my code and lots of others I expect...so it's very unlikely :-) phew.<br> <br></div><br><br>Man, that's one thing that is so great about Lisp. You could, if you were looking for ultimate efficiency, easily write your own macro to see what kind of arguments you are dealing with and then generate the appropriate code - look up variables before function calls. It'd all be handled at compile time based on the arguments you are calling it with, so you'd suffer no runtime performance. <br><br>Anyways, your code will work as is but wouldn't it be possible for the animation function itself to increment an animation counter when the animation starts and then decrement it when the animation stops? This way you wouldn't have to call look-up functions to see if an animation is running - you'd just check the "AnimInProgress" variable. <br><br>Too bad inlining isn't an option or I'd say just inline your lookup calls and you'd have the best of both worlds - good efficiency and code clarity. <br><br></td></tr></table><br>
<a name="765812"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> you'd just check the "AnimInProgress" variable. <br></div>All the anims have different counters and so I use an anim var to track the output of all certain anim functions to decide if I should be block player input or not. <br><br></td></tr></table><br>
<a name="765940"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WendellM</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> if AnimFunction1 returns true, anim=1 and therefore the second line goes "OK anim=1 so I don't even need to look at the part after the OR" and so AnimFunction2 never gets called! <br></div><br>Yes.  If I were writing a program like that, my instinct would be to:<br><br><pre class=code>
Local Anim1 = AnimFunction1()
Local Anim2 = AnimFunction2()
If Anim1 Or Anim2 Then
</pre><br>But then I'm old-fashioned...  My primate brain never tries for excessive cleverosity with my dull, excessively easy-to-understand code (hey, it learned programming in the early 80s and never much grew out of that). &lt;g&gt; <br><br></td></tr></table><br>
<a name="765972"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah I just spent a couple hours hunting down a bug that was caused by calling MidHandleImage on an image that was odd numbered in height.  It was trying to draw it at 2 places and was blurred.<br><br>GA, meant to ask you about the mouse lag thing.  I put in a Delay 1 right before Flip 0 and my mouse lag is non-existant.  Works well with delta time that I use.  Did you end up having to fiddle with the module source?<br><br><pre class=code>
If Mode = 0 Then Delay 1     'Only delay 1 for windowed mode
Flip 0
</pre> <br><br></td></tr></table><br>
<a name="766000"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> WendellM: Yeah that's what I changed the code to when testing and realised my mistake<br><br>Chroma: tip.  Make sure ALL images are even sized AND have a one pixel empty border arounf them.<br><br>As for mouse lag, originally I had to fiddle with the module source but not with a Delay, with a DX call.  The mouse lag is in DX only right?  Anyway in the end BRL incorporated the fix into their module so you shouldn't be getting a lag if you are up to date now.  Well maybe a one frame lag but not a major one like before. <br><br></td></tr></table><br>
<a name="766010"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SculptureOfSoul</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> All the anims have different counters and so I use an anim var to track the output of all certain anim functions to decide if I should be block player input or not. <br></div><br><br>Well, I'm not sure how your code works as I'm not fully understanding in your original example why both Anim1() and Anim2() need to be called if either returns true. If either returns true, you know you can block the input right? So why does the second function need to be called anyways?<br><br>It seems like you're making a single function handle two tasks - keeping track of the state of the animation and perhaps advancing it forward, as well as reporting the state of that animation. Wouldn't it be better to separate those two tasks...so you'd have something like <br><br>UpdateAnimations() <br><br>that gets called every frame regardless, and then<br><br>IfAnimationsRunning() <br><br>which checks the status of the animations? <br><br></td></tr></table><br>
<a name="766019"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> possibly.  It's no big deal though.  Those Anim functions actually have different names in my code and handle different animation aspects of the game.  I could wrap them in another function which returns the status of if an anim is occuring but there is no need in my case.  There are some other functions also that I call and the end result is that if any of the functions return 1, then I need to block user input.  It works well and is understandable.  Thanks for the advice. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
