<!DOCTYPE html><html lang="en" ><head ><title >problem with type usage</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >problem with type usage</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >problem with type usage</a><br><br>
<a name="851635"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >z80jim</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm trying to get back into using types, what's wrong with the following?<br><br>Graphics 640,480<br><br>Type Tsprite<br>	Field sprite:timage=LoadImage("sprite.jpg",1)<br>	Field x:Int<br>	Field y:Int<br>End Type<br><br>Global player:Tsprite=New Tsprite<br><br>player.x=50<br>player.y=50<br>DrawImage player.sprite:timage,player.x,player.y<br>Flip<br>While Not KeyHit(key_q)<br><br>Wend <br><br></td></tr></table><br>
<a name="851641"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> there is nothing wrong with that. assuming your sprite.jpg exists in the same folder as the sources, it should work. <br><br></td></tr></table><br>
<a name="851645"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >z80jim</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> it exists, I know the image is good :( have you tried running it to see the error it gives? It gives it at the drawimage line. <br><br></td></tr></table><br>
<a name="851649"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bremer</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Your code does not throw any errors when I run it. <br><br></td></tr></table><br>
<a name="851651"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> it works fine for me, what error does it give you?<br><br>(Is the image in the same directory as your source?) <br><br></td></tr></table><br>
<a name="851654"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >z80jim</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> "unhandled exception: attempt to access field or method of null object"<br>then it highlights the drawimage line. I did a drawrect line as follows,<br>drawrect player.x,player.y,50,50<br>and it works fine. <br><br></td></tr></table><br>
<a name="851661"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I assume you own BlitzMax right?<br>The demo is worthless (totally outdated and incompatible) and does NOT support the = within types at all. <br><br></td></tr></table><br>
<a name="851667"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >z80jim</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> yes I know it is I have owned bmx for years, and it is up to date. <br><br></td></tr></table><br>
<a name="851679"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Works here. <br>Might be worth double-checking the version of Bmax and posting the 'Help About' output.<br>If the code works for other people then it might be the image file so you might want to post a link to it. <br>Also try setting the sprite field within a Create() function rather than automatically. If that doesn't work then add a <br><pre class=code> 
if not sprite notify "Image file not loaded" 
</pre><br>and see what comes out. <br>Finally, what OS are you using? <br><br></td></tr></table><br>
<a name="851680"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >z80jim</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm using leopard, I used a catch to see if it actually was loading the image, and I found that according to my program the image doesn't exist. The name is exact, and the image is in the same folder... <br><br></td></tr></table><br>
<a name="851683"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> try making sprite a global instead, <br><br></td></tr></table><br>
<a name="851685"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> How do you know the program thinks it doesn't exist rather than has a problem loading it?<br>Have you tried another jpg and another image file (png, bmp)?<br>If it is a particular image file then post it here for somebody else to try.<br>Possibly the OS if everybody else here has tried on Win.<br>What level of Bmax are you using? <br><br></td></tr></table><br>
<a name="851687"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >z80jim</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried doing this outside of a type the why I normally would, and it still wouldn't work. I checked with other lines of loading code that I've written that work, and they're identical except for the name. I tried loading another image, again in the same directory and it still didn't work. Here's my latest code, slightly changed but still not running.<br><br>Graphics 640,480<br>Type Tsprite<br>	Field sprite:timage=LoadImage("sprite.jpg",0)<br>	Field x:Int<br>	Field y:Int<br>End Type<br><br>Global player:Tsprite=New Tsprite<br><br>player.x=50<br>player.y=50<br>If sprite:timage=Null<br>Print "null image"<br>End<br>EndIf<br>While Not KeyHit(key_q)<br>	DrawImage player.sprite:timage,player.x,player.y<br>	Flip<br>Wend<br><br>excuse the not indenting but this is just testing I'll clean it up as soon as it works lol. <br><br></td></tr></table><br>
<a name="851691"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> How about point the loadimage to a file in another directory where you can get a program to load an image?<br>What version of Bmax are you using?<br><div class="quote"> <br> I checked with other lines of loading code that I've written that work, and they're identical except for the name. <br> <br></div><br>I guess these programs still run OK? If so, what is different about them (e.g. different location etc). If they're in another location then use them but point the loadimage to the failing file in the other location. <br><br></td></tr></table><br>
<a name="851695"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> The trouble with that code is that the Global initialization of player could be executing before the call to Graphics and BlitzMax is unfortunately unable to loadimages when not in a graphics mode. <br><br>Try the following maybe to avoid a call to new TSprite before your program is actually running:<br><br><pre class=code>
Global player:Tsprite

player=New Tsprite
</pre> <br><br></td></tr></table><br>
<a name="851702"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Really? So there needs to be some delay between creating graphics and loading images? <br><br></td></tr></table><br>
<a name="851704"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >z80jim</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> problem solved. <br><br></td></tr></table><br>
<a name="851707"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> z80jim, can you say how? If it was Skids answer then why did your other programs not have the same problem if they're identical?<br>Skid, can you explain what the problem is? I understand what you're saying the cause is but not sure how the loadimage can fail as long as it is after the graphics command. <br><br></td></tr></table><br>
<a name="851720"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >z80jim</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm sorry I never even saw his post lol sorry skid!<br>I asked my dad to take a look, and he fixed it. Here is the updated code, with the fix noted.<br><br>Graphics 640,480<br>Type Tsprite<br>	Field sprite : TImage'I was loading the image here... you can't do that because when the program comes to this line	 it should be a "general" line of code.<br>	Field y:Int<br>End Type<br><br>Global player:Tsprite=New Tsprite<br><br>player.x=50<br>player.y=50<br>player.sprite =LoadImage("sprite.png")'after creating the tsprite "player", you are free to load the Timage with an image.<br><br>If player.sprite=Null<br>	Print "null image"<br>EndIf<br><br>While Not KeyHit(key_q)<br>	DrawImage player.sprite,player.x,player.y<br>	Flip<br>Wend <br><br></td></tr></table><br>
<a name="851728"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> TonyG: I think what Skidracer is saying is that initializers are evaluated once, as constants, when the type is initialized, and then that value is tucked away somewhere. I think he's saying that the initializer is not called on every new instance. <br><br>Which, if true, seems like a bug to me. <br><br></td></tr></table><br>
<a name="851751"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> z80jim, there was nothing wrong with your code, apart from the bit that ski pointed out.<br><br><div class="quote"> you can't do that because when the program comes to this line it should be a "general" line of code. <br></div><br>Doing this:<br><pre class=code>
Field sprite:timage=LoadImage("sprite.jpg",0)</pre><br>is perfectly valid... as long as Graphics mode has started by the time LoadImage is called.<br><br>What version of BlitzMax are you using?<br>It's interesting that other people had this working, when you didn't. <br><br></td></tr></table><br>
<a name="851755"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >z80jim</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't know the exact number, but it IS up to date. I can't claim to be an expert, I didn't understand what ski said, and I was repeating what my dad said. Since a type isn't referring to a specific "object" you can't load the image there, rather have to do it later. <br><br></td></tr></table><br>
<a name="851759"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try taking your original example, and change the word "Global" to "Local" and it should work as you had originally expected :-)<br><br>Globals appear to be initialized "out of order", which is news to most people... me included. <br><br></td></tr></table><br>
<a name="851804"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> globals initialization always worked different.<br>Within a function / method they behave even worse. If you have global someglob:ttype = new ttype this is a const initialize. it won't create a second instance. if you want a second one you must put the definition and instance creation on different lines.<br><br>Thats hard to catch and very totally not documented. Most learned it the "head against the bricks" way me including a long time ago ... <br><br></td></tr></table><br>
<a name="851813"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> If you have global someglob:ttype = new ttype this is a const initialize. it won't create a second instance. <br></div><br>I find this useful in Functions :-)<br><br>But I didn't realise it would initialise the variable before normal code got to run. I suppose because I've never had code in my functions in front of a Global variable...<br><br>Fun fun :o) <br><br></td></tr></table><br>
<a name="851815"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> It is actually usefull as it allows you to do a "first run" init without the annoying if checks so you safe performance.<br>But it is a thing you will definitely fail to grasp on the first time. <br><br></td></tr></table><br>
<a name="851862"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >z80jim</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok thanks for the replies :) it was really helpful! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
