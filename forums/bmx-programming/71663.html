<!DOCTYPE html><html lang="en" ><head ><title >Quaternions</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Quaternions</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Quaternions</a><br><br>
<a name="800873"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm a fan of quaternions, actually I'm addicted to them.  I understand fundamentally how they work.  I've ported a lot of quaternion code and libs for my own use.  What I'd like to do here is get opinions and knowledge from some of you who have better insight about them than I do.  Here's what I know about them:<br><br>1. Made up of w,x,y,z<br>2. they are unitless<br>3. 1,0,0,0 is called an identity<br>4. they avoid gimbal lock<br><br>There's also something called angle-axis that I've recently come across.  It looks like angle-axis is a GL thing that's used to access a quaternion and rotate the model in GL.<br><br>Through my personal experience I know that when you're using quats you are dealing with VERY small numbers.  Stuff like 0.0001 gives you a decent turn speed.  Putting 0.1 into a quat makes is spin like it's possessed.<br><br>Please post what you know about them and also your experiences with quaternions, good or bad.  Maybe we can all learn from each other. <br><br></td></tr></table><br>
<a name="800914"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Quaternions are non-commutative (which means that factorial order is important) complex numbers with one real component (w) and 3 imaginary parts, useful in spatial dynamics and physics for calculating orientation.<br><br>Angle-axis, on the other hand is a one-dimensional rotation around an arbitrary three dimensional axis.<br><br>While the number of components needed to represent an orientation are the same in both cases, they are not immediately interchangeable. <br><br></td></tr></table><br>
<a name="801483"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> FD, all rotations are a one-dimensional rotation around an arbitrary three dimensional axis.  The axis direction is defined by the x,y,z component which actually is just a direction vector showing where the axis is pointed.  The angle is the rotation speed in radians.  That's why quaternions are so useful for rotations, because they are set up just like that.<br><br>q = rotation speed in radians<br>x = direction vector component x (normalized)<br>y = direction vector component y (normalized)<br>z = direction vector component z (normalized)<br><br>Once you get your head around the fact that an object can only spin on one axis and that the axis is a direction vector, it all falls into place nicely.<br><br>Here's linear movement (simplified):<br>force = 0<br>acceleration = force / mass<br>velocity :+ acceleration * dt<br>position :+ velocity * dt<br><br>Rotation has equivalent components:<br>torque = 0<br>angularAcceleration = torque / inverseMass<br>angularVelocity :+ angularAcceleration * dt<br>orientation = 0.5 * Quaternion(0, angularVelocity.x, angularVelocity.y, angularVelocity.z) * orientation <br><br>I may be slightly off on the rotation and I'm still identifying the correction sequence and terminology. <br><br></td></tr></table><br>
<a name="801617"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >big10p</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've looked into learning about quaternions, but every site I've visited quickly descends into math moonspeak.<br><br>I figure life is too short to bother. <br><br></td></tr></table><br>
<a name="801629"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know what you mean big10p.  I understand them basically now.  And if you put it in simple terms it's not too bad.<br><br>Pseudo-code:<br><pre class=code>
torque.zero()
torque.x = 1.0
angularMomentum :+ torque * dt
angularVelocity = angularMomentum * inverseInertiaTensor
orientation.normalize()
spin = 0.5 * Quat(0, angularVelocity.x, angularVelocity.y, angularVelocity.z) * orientation
orientation :+ spin * dt
euler = EulerFromQuat( orientation )
RotateEntity blah, euler.x, euler.y, euler.z
</pre><br>This works really well.  But there are some things I've noticed.  The z axis is always a local rotation while the x and y axis rotate globally.  I'm not sure if this is normal.  Does anyone else know? <br><br></td></tr></table><br>
<a name="801631"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why are you converting from Quat to Euler? That's only going to get you into trouble, as there are an infinite number of euler angle combinations for any given Quaternion orientation. If, for example, you add render tweening into the mix, kaboom! <br><br></td></tr></table><br>
<a name="801633"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Then would you suggest converting Quat to Angle-Axis?  Either way you have to get it down to the euler angles so you can use RotateEntity.  What am I missing? <br><br></td></tr></table><br>
<a name="801635"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well this is in the BlitzMax forum, so I didn't necessarily assume that you were using Blitz3D or even MiniB3D. I mean you're right that if all you've got is TurnEntity, you've got to come back to Euler Angles, and I don't think it will matter how you get there. I don't know, but I don't think Axis Angles will help you, there are still an infinite number of Euler represenations.<br><br>If you're using B3DSDK, why are you using quaternions at all? If you're using MiniB3D, doesn't it have any matrix or quaternion commands? If not, could you not add some? You seem to be proficient with Quaternions, so I would have thought a GetQuaternion() and SetQuaternion() function pair would have been ok. <br><br></td></tr></table><br>
<a name="801690"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Well this is in the BlitzMax forum, so I didn't necessarily assume that you were using Blitz3D or even MiniB3D. <br></div>I'm using BlitzMax.  Hence that's why it's in the BlitzMax forum.<br><br><div class="quote"> I mean you're right that if all you've got is TurnEntity, <br></div>TurnEntity? There's RotatEntity too.<br><br><div class="quote"> you've got to come back to Euler Angles, and I don't think it will matter how you get there. <br></div>It does matter.  It also matters in what order you do the rotations.<br><br><div class="quote">  I don't know, but I don't think Axis Angles will help you, there are still an infinite number of Euler represenations. <br></div>Angle-Axis is actually pretty handy to use in OpenGL.  No idea what you mean by the inifinite number of Euler representations, but I'm looking for 6DOF (no gimbal lock).  And to expand on that a bit, I'm looking to get this working right so I can add torques at certain locations (aileron etc).<br><br><div class="quote"> If you're using B3DSDK, why are you using quaternions at all? <br></div>I never stated I was using B3DSDK.  I'm using quaternions to avoid gimbal lock...<br><br><div class="quote"> If you're using MiniB3D, doesn't it have any matrix or quaternion commands? <br></div>I'm sure you're quite aware that MiniB3D has matrix and quats in it.<br><br><div class="quote"> If not, could you not add some? <br></div>It already has some...<br><br><div class="quote"> You seem to be proficient with Quaternions, <br></div>Not really but I'm getting there.  Thanks for the compliment.<br><br><div class="quote"> so I would have thought a GetQuaternion() and SetQuaternion() function pair would have been ok. <br></div>Sure that sounds ok to me.  That why I put those commands in my own quat lib about 3 years ago...<br><br>Please, if you actually would like to help that'd be great man.  I'm just stuck on trying to do local rotations.  As in taking the current orientation and adding the new rotation to it.  Which I thought I was doing but it's not working quite right. <br><br></td></tr></table><br>
<a name="801923"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't know what all the hints and comments about what I'm supposed to know and not know are all about. I don't know if you think I have the solution and I'm just being difficult or something, but my crystal ball is in for repairs so I don't know half of what you appear to think I do or think I should know.<br><br>Anyway, in short, I don't know why you think that axis angle rotations will be any different to quaternions, because they're practically the exact same thing, as you yourself stated when you replied to FlameDuck. If you're convinced they are, go ahead and prove me wrong.<br><br>You get an infinite number of Euler representations because 360,720,0,-360,1080,-720,-1080, ad infinitum are all the same angle. Getting back -180 when you expected 180 is why things like tweening and interpolation will make things explode.<br><br>You don't need quaternions to avoid gimbal lock. It's just one ( possibly over complicated ) way of avoding gimbal lock. There's a good article on Nehe about the mythical necessity of quaternions for flight sims. I have nothing against them, I use them, but I use them because I need them, and I think they're too fussy to bother with unless you *really* need them.<br><br>As I said, I have no idea why you think I know so much about MiniB3D and I'm just holding back from helping you, but I know absolutely nothing about it apart from that it uses OpenGL. If it already has quaternions as you say ( and apparently you're sure I know ) then just use them instead of TurnEntity and RotateEntity. Then all your tweening and interpolating problems, not to mention the imprecise nature of Quat&gt;Euler conversions will be gone.<br><br>I think that answers everything I can answer. There isn't any more. I'm not holding back or being difficult, I'm just trying to help despite not being a MiniB3D user, an OpenGL coder or a flight-sim programmer. <br><br></td></tr></table><br>
<a name="801935"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nah I don't think any of that.  I'm just looking for people to post what they know about quaternions.  Ok cool I'll check out NeHe and see what I can find out.<br><br>Also I think quats make applying torque to rotations really easy.  I'm just missing something somewhere in my code.  Hopefully I'll figure it out soon.  Worst case scenario is that everything is working fine and I'm apply torque in the wrong manner...  I may be applying torque in a global manner instead of applying torque to the rotated orientation and then computing it.<br><br>I think you're assuming I'm using turnentity and rotatentity in the rotation code itself.  I'm use using RotateEntity to do the final visual rotation of the 3d model, that's all.<br><br>Thanks for the tips. <br><br></td></tr></table><br>
<a name="802251"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think what my big problem is, is trying to duplicate the TForm commands from B3D.  As in you have an aileron positioned in local space.  The aircraft rotates and the aileron changes places in global space.  I need to know how to rotate a point locally using a quaternion.  Gah... <br><br></td></tr></table><br>
<a name="802307"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ehhh. sounds like you need to look up Matrix stuff... :)<br><br>Multiply the global matrix by the local matrix and you get a matrix containing that global point as if it was in "local space" to its parent.<br><br>I recently got my head around this myself. it's not as scary as it sounds! <br><br></td></tr></table><br>
<a name="802360"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I could have sworn you could rotate points with quaternions and avoid matrices altogether.  I must be doing something wrong.  If I figure it out I'll post it Cyg. <br><br></td></tr></table><br>
<a name="802362"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have this.  I don't really remember what I wrote it for:<br><br>Function RotatePointAroundVector(x#,y#,z#,u#,v#,w#,a#)<br>	ux#=u*x<br>	uy#=u*y<br>	uz#=u*z<br>	vx#=v*x<br>	vy#=v*y<br>	vz#=v*z<br>	wx#=w*x<br>	wy#=w*y<br>	wz#=w*z<br>	sa#=Sin(a)<br>	ca#=Cos(a)<br>	VECTOR_x#=u*(ux+vy+wz)+(x*(v*v+w*w)-u*(vy+wz))*ca+(-wy+vz)*sa<br>	VECTOR_y#=v*(ux+vy+wz)+(y*(u*u+w*w)-v*(ux+wz))*ca+(wx-uz)*sa<br>	VECTOR_z#=w*(ux+vy+wz)+(z*(u*u+v*v)-w*(ux+vy))*ca+(-vx+uy)*sa<br>End Function <br><br></td></tr></table><br>
<a name="802369"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Halo's code looks good at a glance but if you need any more help, I have a TFormPoint in my engine which works entirely with Vectors and Quaternions, no matrices. It will only look like pseudo code without all my maths classes ( which are messy and besides you have your own and Halo posted his recently ) but they will give you the method you need to do it. <br><br></td></tr></table><br>
<a name="802417"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sure that would be awesome Gab. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
