<!DOCTYPE html><html lang="en" ><head ><title >TStreamReadException?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >TStreamReadException?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >TStreamReadException?</a><br><br>
<a name="868685"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is there any way to see how and where this is thrown im trying to look at it and the docs are about as helpful as a chocolate teapot.<br><br>Basically I get a null error from a stream when reading, I know full well this stream was created at creation time (I have one function to create it and another to destroy it). I have gone entirely through the code (all 10000~ lines) and there are no other closestream or closesocket references. I just want to add a check to make sure the stream exists.<br><br>Anyone have any ideas on finding out if a stream exists or not? <br><br></td></tr></table><br>
<a name="868695"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> stream.Eof()? <br><br></td></tr></table><br>
<a name="868707"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> basically im reading from a Tsocketstream and the code line that throws the error is:<br><pre class=code>
PacketData = PacketData + ReadBytes( ClientData.Stream, AvailableBytes-1 )
</pre><br><br>Now the socket exists because thats checked first, and when the stream is closed the socket is closed at the same time and they are set to null for checking. The problem is it still throws the error. Its as if the stream vanishes. <br><br></td></tr></table><br>
<a name="868708"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> is AvailableBytes updated right in front of it as well? <br><br></td></tr></table><br>
<a name="868709"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> yup, heres the small code segment<br><br><pre class=code>
						'see if there is any data in the socket
						AvailableBytes = SocketReadAvail( ClientData.Socket )
						If AvailableBytes&gt;19				'19 is the size of an empty packet
							PacketData = ""
							ExtractedPacket = ""
							Important = "F"
							PacketClass = 0
							NewPacket = ""
							PacketData = PacketData + ReadString( ClientData.Stream, AvailableBytes-1 )'Chr$( ReadByte( ClientData.Stream ) )
</pre> <br><br></td></tr></table><br>
<a name="868712"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> What happens when you print the string read from clientdata.stream?<br>Did this code ever work and, if so, what has changed? <br>You mention there are 10000 lines so I am guessing you've compiled and run it a few times so what did you add since it worked?<br>How many packets are read before the error? Maybe keep some count of how many times it gets updated and a type to save each packet content which you output as trace data? <br><br></td></tr></table><br>
<a name="868714"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> it throws an error at the PacketData = PacketData + ReadString... bit so I cannot print it out. It says its a null error but there is only one closestream command in the entire file and one closesocket command that is in the removeclient function and after that they are set to null before the entry is removed from the list.<br><br>I just wanted a way to find out if a stream is valid and if it exists. <br><br></td></tr></table><br>
<a name="868718"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh OK. Good luck<br>&lt;Edit&gt; Socketconnected()? <br><br></td></tr></table><br>
<a name="868719"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> SocketConnected is to test sockets, unfortunately it doesnt work on streams. Would love a streamconnected function tho :) <br><br></td></tr></table><br>
<a name="868720"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Don't you need a socket to create a socketstream? Doesn't the socket get autoclosed when the stream closes is autoclose=true is set?<br>&lt;edit&gt; It's possible that the socketa nd/or socketstream have closed somehow but it might be best to test in case something else is happening. <br><br></td></tr></table><br>
<a name="868721"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> yup that is correct, this is how I know the stream should have been closed I have a RemoveClient function that closes all streams and sockets for me, its the only function in the entire code file that does it (basically it makes it easier to keep track if I just call RemoveClient instead of closing sockets here there and everywhere). <br><br></td></tr></table><br>
<a name="868723"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> So you have good reasons to think the socketstream is still open except it is returning null.<br>So...<br>Did this code ever work and, if so, what has changed?<br>How many packets are received successfully?<br>If packets are received print/save them and check them against the input to the stream. <br><br></td></tr></table><br>
<a name="868724"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> The socket is there as I call if SocketConnected( ClientData.Socket ) before going into checking the stream. The only time the stream is destroyed is if the socket is destroyed with it via RemoveClient. There is no other closestream/closesocket calls in the entire program. <br><br></td></tr></table><br>
<a name="868725"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I understand that. <br>That means either <br>a) Something else has happened to the socket/stream to close it<br>or<br>b) The socket/stream is still open and something else is the problem. <br><br></td></tr></table><br>
<a name="868727"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> this is why I wondered if there was a way of checking is a stream exists, and if so how? <br><br></td></tr></table><br>
<a name="868728"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> stream.eof()<br>From the source :<br><div class="quote"> 	For communication type streams such as socket streams, Eof returns True if the stream<br>	has been shut down for some reason - either locally or by the remote host. In this case,<br>	no more bytes can be read from or written to the stream.<br> <br></div><br>but this was mentioned earlier. <br><br></td></tr></table><br>
<a name="868729"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> strangely enough it returns false here :s<br><br>Will look into it more tomorrow :s <br><br></td></tr></table><br>
<a name="868732"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Which means it is likely to be still open. <br>Really, answer the following as it might help :<br>Did this code ever work and, if so, what has changed?<br>How many packets are received successfully?<br>If packets are received print/save them and check them against the input to the stream. <br><br></td></tr></table><br>
<a name="868733"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> the code worked fine, somewhere along the line it has stopped working and for the life of me I havent a clue why as I havent adjusted anything relating to streams or sockets. Basically ive been working on position packets. <br><br></td></tr></table><br>
<a name="868735"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> So how many packets are received before the error?<br>If it always fails at a certain packet what *would* it have been? <br><br></td></tr></table><br>
<a name="868737"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Its random thats what makes it harder to find <br><br></td></tr></table><br>
<a name="868738"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> The TStreamReadException is thrown when the number of bytes to be read are not available normally due to the end of file.<br>Can you catch the exception and then do a readbyte loop until the error occurs again? If you check the bytes read and packets received it might give some idea where the problem is occurring. <br><br></td></tr></table><br>
<a name="868771"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> funny, the code above uses readstring not readbytes. thought that normally should not make a difference it makes a massive difference if you send chr(0) or wrote a string into the packet on the other end. <br><br></td></tr></table><br>
<a name="868815"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> tonyg how do you catch the exception ive tried to use the try ...catch...endtry but catch required a type and the docs dont explain it enough from that it looks like a exit command that was in blitz3d.<br><br>it did use readbyte but that threw an error and I was trying to see if anything was faster <br><br></td></tr></table><br>
<a name="868836"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try throws as string which catch takes as argument.<br>If the issue is seen with readbytes then what is the previous byte value?<br>I really would consider creating a trace_string type and using it to find what is successfully received and what causes the error.<br>Even if it is random there might be some pattern to the problem. <br><br></td></tr></table><br>
<a name="868857"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Try throws as string which catch takes as argument. <br></div><br>A thrown exception can be any object, not just strings.<br>And you can mix and match types to trap the exception you want.<br><pre class=code>
Type TTest
	Method ToString:String()
		Return "TTest"
	EndMethod
EndType

Try
	Throw "String"
	'Throw TRuntimeException.Create("exception")
	'Throw New TTest
Catch e:String
	Print e
Catch e:TRuntimeException
	Print e.ToString()
Catch e:Object
	Print e.ToString()
EndTry</pre><br>Note the order of the catch statements, since a TBlitzException is also an Object it must come first. <br><br></td></tr></table><br>
<a name="868889"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks guys will have a look <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
