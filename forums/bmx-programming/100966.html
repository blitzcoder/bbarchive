<!DOCTYPE html><html lang="en" ><head ><title >Load a rectangular section of an image</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Load a rectangular section of an image</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Load a rectangular section of an image</a><br><br>
<a name="1196297"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just wondering - if I have a massive image of arbitrary size (say, 3000x3000), is it possible to load, for example, a 512x512 portion from anywhere within that image (without loading the entire 3000x3000 image as a pixmap first)?<br><br>I'm thinking not, but figured I'd ask. <br><br></td></tr></table><br>
<a name="1196298"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could probably do it with an uncompressed bmp, knowing its dimensions and whatnot. <br><br></td></tr></table><br>
<a name="1196299"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >computercoder</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't think that is possible - at least not feasible due to the idea that you need to know specific bounds of the image itself and the rectangle you are needing to grab. <br><br>My only thought is to evaluate the image as its loading and possibly keep track of the content as it loads? In the end, I believe you'd be better off just loading the image into a pixmap, ripping out what you need into a new pixmap (or set of pixmaps) and then release it after you are done with that (assuming you are looking to save resources). <br><br></td></tr></table><br>
<a name="1196301"></a>

<a name="1196302"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can likely find out the dimensions of the image from the file data. You will need to parse through the file format structure yourself. But extracting a portion depends on the format. Most formats are based on rows, and some have compression algorithms. JPEG is based on blocks and I think I've seen it possible to extract individual blocks, which allows things like rotation without quality loss. If its a PNG you have to decompress the whole row to get the original data. Like Brucey said BMP is uncompressed so would let you more easily lookup only the stuff you want. GIF similarly would require whole rows, or worse.<br><br>Within the code that actually loads an image, usually like for PNG it'll read a row into a buffer and then decode it and then output it to the pixmap... you could discard part of the buffer and end up with just the pixmap you want but it still has to read the entire file. <br><br></td></tr></table><br>
<a name="1196309"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I already kind of discounted the uncompressed bitmap idea.  I was going to store the image data in a proprietary format, 3000x3000 pixels, 4 bytes per pixel comes to over 36MB.<br><br>I'll have to think of something else.  Thanks all! <br><br></td></tr></table><br>
<a name="1196320"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you are making a proprietary format, you might be able to come up with an efficient compression scheme that will also allow you to grab random parts of the image.  For example, you could compress by row and have a pointer at the start of each row pointing to the next.  So, for example, you could have 00 0A 15 13 D3 4F AA 12 3E 44 92 01 00 09...  The first 2 bytes is the compressed byte count of the row followed by the compressed bytes.  00 0A means the row is compressed in 10 bytes.  the next 10 bytes are the pixel data compressed, then an 00 09 showing the next 9 bytes make up the next row, and so on.  So, to load only part of the image, you could do something like this<br><pre class=code>
//pseudocode

Top = 10
Left = 15
Right = 115
Bottom = 210

ImageStream = ReadImageFile()
for i = 1 to Top
    Skip = ReadInt(ImageStream)
   SeekStream(StreamPos()+Skip)
next

For i = Top to Bottom
    CompressedBytes = ReadInt(ImageStream)
    RowOfPixels = Uncompress(CompressedBytes)
    CopyPixels(RowOfPixels,Left,Right,NewImage)
Next
Close ImageStream
</pre> <br><br></td></tr></table><br>
<a name="1196343"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jsp</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> When reading this I remembered an code archive entry from BlitzSupport, to get the picture size without loading the image:<br><a href="http://www.blitzmax.com/codearcs/codearcs.php?code=2477" target="_blank">http://www.blitzmax.com/codearcs/codearcs.php?code=2477</a> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
