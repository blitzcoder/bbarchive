<!DOCTYPE html><html lang="en" ><head ><title >Ogg memory leak not shown in Bmax...</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Ogg memory leak not shown in Bmax...</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Ogg memory leak not shown in Bmax...</a><br><br>
<a name="712774"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> A framework customer has just told me about a memory leak when playing oggs in my framework. Or at least it looks like a leak in Task Manager but NOT in BMax, it's weird.  Read on...<br><br><br>If you run the AOTMG demo:<br><br><a href="http://www.greyaliengames.com/aotmg/aotmg041.zip" target="_blank">http://www.greyaliengames.com/aotmg/aotmg041.zip</a> (5.74Mb)<br><br>and press D for debug, you'll see some stats inc. memory.  Also press Ctrl+Alt+Del del and look at the memory in task manager.  Then basically click play, press enter to choose a level, and then press escape to quit to the menu.  Keep repeating this and the memory in task manager will go up and up, yet the Bmax memory figure GCMemAlloced will stay constant.  Why is this?  Anyone know.  Thanks very much. <br><br></td></tr></table><br>
<a name="712784"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> What does your code do?<br>Or asked in a different way: is StopChannel called on the running channel before leaving to menu? (or setpaused on leave and reenter)<br><br>I'm mainly asking that in case it does just call TSound.Play() over and over without actually stopping running channel and without specifying the previously allocated channel as alloced_channel to the play method. <br><br></td></tr></table><br>
<a name="712795"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> yet the Bmax memory figure GCMemAlloced will stay constant. Why is this? Anyone know. <br></div><br>Probably because the GC amount is only based on max-managed memory, and not external C-allocated memory (which I imagine is where memory is allocated by the ogg loader. <br><br></td></tr></table><br>
<a name="712857"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> The same channel is reused so it shouldn't be that. hmm maybe I should make a test app. <br><br></td></tr></table><br>
<a name="713025"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK the problem WAS the fact that I was reusing the channel, by Pausing it (because StopChannel frees the channel) and then loading some new music and playing it on the same channel.  For some reason that doesn't free up the ogg properly!  So now, I'm using StopChannel, then reallocating a NEW music channel and the loading in the new music.<br><br>Is this behaviour a Bmax bug?  It sure feels like it. <br><br></td></tr></table><br>
<a name="713031"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I thought reusing channel is meant for playing the same track again ...<br><br>But the not freeing is definitely a memory leak, no mather if using a different sounds channel is correct usage or not. <br><br></td></tr></table><br>
<a name="713060"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> yeah I was reusing the channel to play different tracks, and reusing the same MusicSample variable so basically there shouldn't be a memory leak but there is...<br><br>Thing is, this memory leak is a HUGE one compared to most minor memory leaks as oggs when uncompressed are MBs big! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
