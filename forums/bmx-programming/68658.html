<!DOCTYPE html><html lang="en" ><head ><title >Large Amount of Memory Used Drawing Photos</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Large Amount of Memory Used Drawing Photos</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Large Amount of Memory Used Drawing Photos</a><br><br>
<a name="767231"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SebHoll</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>I'm making an app at the moment that includes a basic slideshow feature that loads up JPEGs from a specified directory and plays them at a configurable interval with a basic fade effect in between. The JPEGs are obviously scaled to fit onto the window, and are being drawn onto a MaxGUI canvas.<br><br>The problem I'm having is that when I load the images (there's about 8 150KB JPEGs with resolution of about 1024x768), it seems to consume a lot of memory in Task Manager (about 40MB is added) and then, as the images are drawn one after the other, memory increases further by about 8MB each time until all the pictures have been shown once and are looping through again, at which points it remains constant (at about 100MB!). <br><br>Surely this isn't normal, I'm not doing any fancy affects - it is literally drawing and scaling the image to the screen and I can't expect customers to be using almost 100MB of memory just for a small app.<br><br>In addition, I've tried loading BMPs, PNGs and every single other format I could think of and it makes no difference. Finally, I also tried using the Image Loader sample app that comes with BlitzMax, and loading the same images and it still eats loads of memory!<br><br>What can I do to make the memory usage reasonable? Has anyone else experienced this? Is BlitzMax just not designed to handle large images (instead of miniature game figures)? <br><br>Many thanks<br><br><br>Seb<br><br>P.S. I'm on Windows Vista but I've tried the same program on Windows XP and it doesn't seem to make a difference. <br><br></td></tr></table><br>
<a name="767235"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> A 1024x768 image will take up roughly 4mb.  So if you have 'about 8' of them, that's 'about' 32MB.<br><br>GCMemAlloced() doesn't show resources used by those images until they've been drawn for the first time, hence the gradual increase.<br><br>How can you make the memory usage more reasonable?  Don't load eight massive images at once. <br><br></td></tr></table><br>
<a name="767245"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JazzieB</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> It doesn't matter what file format the images are, as they will all get uncompressed when loaded into memory, which is why your 150KB file turns into about 4MB, as Gfk has pointed out.<br><br>If you want to limit the amount of memory that is being used, then you will need to load them off disk when needed and then purged from memory when no longer needed.  Basically, only keep 2 images in memory at once - the current one (for display and use within your fade), and the next one.  Once the next one is fully visible, null the last one (so it's freed from memory), and load the next one in ready for the transition.  I would also use a GCCollect() call after freeing up the first picture to free the memory straight away. <br><br></td></tr></table><br>
<a name="767578"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Basically, only keep 2 images in memory at once - the current one (for display and use within your fade), and the next one. Once the next one is fully visible, null the last one (so it's freed from memory), and load the next one in ready for the transition. <br></div>I did this in my current game using a tList.<br><br>If I want to fade to a new image, I load a new one and add it with 'tList.AddLast object'.  An object would just contain a tImage field, and an alpha float.<br><br>I know that if there are two items in the list, then I'm supposed to be fading the last one in (newest), and the first one out (oldest).<br><br>When the alpha of the first one reaches 0, I remove it from the list.  When the object and therefore the tImage go out of scope, GC cleans it up.<br><br>Rinse, repeat. <br><br></td></tr></table><br>
<a name="767914"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SebHoll</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Did as suggested and the HDD lag isn't really that noticable - I'd have thought all the images into memory would be necessary for acceptable results but it loads really quickly and is tonnes better memory wise.<br><br>Thanks for the tips everyone! <br><br></td></tr></table><br>
<a name="767926"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> &lt;useless fact&gt;<br>Platypus loaded its graphics "on the fly".<br>&lt;/useless fact&gt; <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
