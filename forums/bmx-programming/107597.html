<!DOCTYPE html><html lang="en" ><head ><title >Persistent Backbuffer?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Persistent Backbuffer?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Persistent Backbuffer?</a><br><br>
<a name="1333144"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi.  I need either one of two things:<br><br>* a Back buffer that remains intact after the Flip() call and doesn't flicker<br>* a way to draw on to the frontbuffer and not bother with Flip()<br><br>The problem is that I have a large grid of small tiles and even if there has been no change or very little change in the grid, the whole thing has to be redrawn every cycle and it kills speed.  Like textmode which used to be super fast, emulating it with having to redraw the grid every frame means that, arguably, old computers can do it faster.<br><br>I suppose the best method would be the first, where Flip() doesn't clear the backbuffer and it's still there to modify.<br><br>Can one of these be done?  Thanks.  :D <br><br></td></tr></table><br>
<a name="1333148"></a>

<a name="1333149"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bobysait</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Flip does not clear anything, it only swap front and back buffers.<br>What clear the buffer is the Cls function.<br>Don't use Cls() and your buffer will be kept intact after the flip.<br><br>(?) Just remember this : anytime you call SetGraphics with a different source, it internally calls Cls/Flip 2 times, so if you use a gui application with multiples canvas for example, anytime you switch the graphics destination for an other canvas, the new canvas will be cleared.<br>If you just do some Graphics stuff without GUI, then this is not relevant. <br><br></td></tr></table><br>
<a name="1333159"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> You have no guarantee that the backbuffer contains what was rendered. So it might contain garbage.<br><br>You might consider using the render2texture code which was recently posted in the programming section (and on git). So you set a texture as current target...and then draw your tiles on it if something changed. Then set target to screen again...and render that texture.<br><br>Bye <br>Ron <br><br></td></tr></table><br>
<a name="1333256"></a>

<a name="1333257"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Bobysait: I know it swaps the buffers instead of copying it over which would take longer.  Doesn't really help me.  Without CLS every second frame contains the drawn stuff so it flashes rapidly.  I have epilepsy so that's not good, and it doesn't exactly solve the problem.<br><br>Derron: That sounds good but won't using a drawn texture for the screen-space not kill the pixel-perfection?  I'm pretty sure even if the texture is the perfect size and you plot it to the screen perfectly it'll still have hardware filtering going on.. <br><br></td></tr></table><br>
<a name="1333260"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> How many tiles are you drawing per frame?<br><br>DrawImage is not the most efficient... drawing from an "atlas" would be much faster. <br><br></td></tr></table><br>
<a name="1333264"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Both OpenGL and DirectX have an inconsistent backbuffer after a flip -- depending on the videocard and the drivers, you can end up with either:<br><br>1) The previous frame<br>2) the frame from two flips ago<br>3) the frame from three flips ago<br>4) the frame from four flips ago<br>5) a blank screen<br>6) random memory garbage<br><br>(Some cards/drivers use multiple frame to cycle through, if you happen to have one of those then you'll end up with a lot of flickering and 'rewinds' in the background if you depend on the content remaining). <br><br>The ONLY way to guarantee what's on the screen, is to redraw it each frame. (Either sprite-by-sprite, or doing a full screengrab/redraw) <br><br></td></tr></table><br>
<a name="1333268"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> An "atlas", Brucey?  What is that?  I Googled it but apparently a trillion companies have names like "atlas programming".<br><br>xlsior:  So there can't even be library tweaks or gl/dx code to achieve it? <br><br></td></tr></table><br>
<a name="1333284"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> In the background the tiles you draw are already using textures.. so you just modify the content of a new texture when using the render2texture code.<br><br>An atlas is a big image containing multiple sprites and the coordinates/dimensions of each. You then tell to only draw a portion of the big image...with x,y,w,h defined in the atlas.<br><br>For each drawn image texture blitzmay' max2d needs to activate the texture...a "texture swap" which is a bit expensive. Drawing from an atlas reduces the amount of texture switches (eg drawing all tiles each after another from a tile spritesheet).<br><br>An animated spritesheet is already some kind of atlas... with fixed dimensions.<br><br><br>Bye<br>Ron <br><br></td></tr></table><br>
<a name="1333286"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> xlsior: So there can't even be library tweaks or gl/dx code to achieve it?  <br></div><br><br>Not without redrawing it for you -- pretty sure that both then OpenGL and the DX specifications declare that the backbuffer state is undetermined after a flip. <br><br></td></tr></table><br>
<a name="1333321"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Streaksy</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> xlsior: and you absolutely can't draw to the front buffer directly?<br><br>Derron: That atlas thing being fast because it doesn't need "texture swaps" is good to know.  But whenever I've done something like that the edges blur over to the adjacent sprite.  I can't just turn filtering off because it'll look horrible on anything but a native resolution.  :/  I suppose I can build a new compound image where the contained sprites' edges are surrounded with the appropriate pixels, if that makes sense...  A bit tricky.. <br><br></td></tr></table><br>
<a name="1333325"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> this is not that hard to do - and many "sprite packers" already have this functionality to avoid bleeding.<br><br><br>I never had issues with it (am not scaling the sprites) nor did I get complaints of the players of my game (&gt;1.500 of each main release).<br>Of course this does not mean that it does not happen at all - maybe it is a matter of scaling and GPU.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
