<!DOCTYPE html><html lang="en" ><head ><title >Bank and array speed test</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Bank and array speed test</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Bank and array speed test</a><br><br>
<a name="977219"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> <textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SuperStrict

Local Bank:TBank = CreateBank(40000*4) 'Must be divisible by 16 for unrolled loop
Local Pixels:Byte[40000*4]	'Must be divisible by 16 for unrolled loop
Local P:Byte Ptr, EP:Byte Ptr
Local P2:Int Ptr, EP2:Int Ptr
Local Index%
Local R%, G%, B%, RGB%, RGB2%
Local T0%, T1%, T2%, T3%, T4%, T5%, T6%
Local Loop%, Loops% = 10000

T0 = MilliSecs()

	' Array Byte Ptr
	
	For Loop = 1 To Loops
	
		P = Pixels
		EP = P + 40000*4
	
		Repeat
		
			R = P[0]	
			P = P + 1
			B = P[0] 
			P = P + 1
			G = P[0]
			P = P + 2
	
		Until P = EP
	
	Next

T1 = MilliSecs()
	
	' Array Byte Ptr (different index method)
	
	For Loop = 1 To Loops
	
		P = Pixels
		EP = P + 40000*4
	
		Repeat
		
			R = P[0]	
			B = P[1] 
			G = P[2]
			P = P + 4
	
		Until P = EP
	
	Next

T2 = MilliSecs()

	' Array Int Ptr

	For Loop = 1 To Loops
	
		P2 = Int Ptr(Byte Ptr(Pixels))
		EP2 = P2 + 40000
	
		Repeat
		
			RGB = P2[0]
	
			R = (RGB Shr 16) &amp; 255 
			G = (RGB Shr 8 ) &amp; 255
			B = (RGB       ) &amp; 255
	
			P2 = P2 + 1		
		
		Until P2 = EP2
	
	Next

T3 = MilliSecs()

	' Bank Int Ptr

	For Loop = 1 To Loops
	
		P2  = Int Ptr(Bank.Buf())
		EP2 = P2 + 40000
	
		Repeat
		
			RGB = P2[0]
	
			R = (RGB Shr 16) &amp; 255 
			G = (RGB Shr 8 ) &amp; 255
			B = (RGB       ) &amp; 255
	
			P2 = P2 + 1		
		
		Until P2 = EP2
	
	Next

T4 = MilliSecs()

	' Bank Int Ptr Peek
	
	For Loop = 1 To Loops
		
		Index = 0
			
		Repeat
		
			RGB = PeekInt(Bank, Index)
	
			R = (RGB Shr 16) &amp; 255 
			G = (RGB Shr 8 ) &amp; 255
			B = (RGB       ) &amp; 255
	
			Index = Index + 1		
		
		Until Index = 40000
	
	Next


T5 = MilliSecs()

	For Loop = 1 To Loops
				
		P2  = Int Ptr(Bank.Buf())
		Index = 0
			
		Repeat
		
			RGB = P2[Index]
	
			R = (RGB Shr 16) &amp; 255 
			G = (RGB Shr 8 ) &amp; 255
			B = (RGB       ) &amp; 255
	
			Index = Index + 1		
		
		Until Index = 40000
	
	Next


T6 = MilliSecs()

Print "Array Byte Ptr = " + (T1-T0)
Print "Array Byte Ptr (inc pointer once) = " + (T2-T1)
Print "Array Int Ptr = " + (T3-T2)
Print "Bank Int Ptr = " + (T4-T3) 
Print "Bank PeekInt = " + (T5-T4) 
Print "Bank Indexed = " + (T6-T5)
</textarea><br><br>Just a speed test I did to see what would be the best way to modify a lot of image data in my texture generator.<br><br>The short of it is:<br><br>Arrays and banks are the same speed.<br><br>It is no better to pull ints from an bank than bytes, provided you don't need to increment the pointer after each byte, and instead can just use a different index as in my second example.<br><br>Peek is ten times slower than using array style indexing to access the data.  I'm not sure why it doesn't simply get optimized out.<br><br>Using pointers to index the data should be faster but it seems the index is added when derefencing even if it is zero.  At least, my understanding from coding in assembly years ago is that Buffer[10] should not be as fast as using Buffer[0] all the time, because Buffer[10] would add 10 to the Buffer pointer, whereas Buffer[0] should need to add nothing.<br><br>But perhaps this is simply a case where the index is stored in a register and on modern PC's adding a register to a pointer in another register is so fast as to be instant.  Maybe it's a ulti core thing.  I dunno.  <br><br>All I know is there's no speed difference, and you could just as eaily use a while loop with a pointer or a for loop with an index to access the data in a buffer and they both would be equally fast. <br><br></td></tr></table><br>
<a name="977236"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Peek is ten times slower than using array style indexing to access the data. I'm not sure why it doesn't simply get optimized out. <br></div>Because by using PeekInt, you're making a function call and a method call to do the same thing as buf[Index].  However, it doesn't help that you're using PeekInt incorrectly. <br><br></td></tr></table><br>
<a name="977253"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Because by using PeekInt, you're making a function call and a method call to do the same thing as buf[Index]. <br></div><br><br>I am well aware that PeekInt is a function call.<br><br>Allow me to rephrase the question:<br><br>Why isn't the compiler replacing the function call with the faster method of accessing the memory?<br><br><br><div class="quote"> However, it doesn't help that you're using PeekInt incorrectly.  <br></div><br><br>If you're going to tell me I'm doing something incorrectly, at least have the courtesy to explain what exactly it is that you think I'm doing wrong. <br><br></td></tr></table><br>
<a name="977255"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >joncom2000</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I dont know if it would make much difference in the grand scheme of things but I notice that you use the bank.buf() method to get a pointer to it, yet   you use the wrapper function peekint(bank,offset) when you could use bank.peekint(offset) thus reducing a call to a function.<br><br>Also on your array creation, why create a byte array to store int's then have to int ptr the byte ptr, why not just make an array of int's in the 1st place ? I know your 1st array test access'd by byte but you didnt do a peekbyte test on the bank?<br><br>Actually you could skip the whole bank test and just memalloc and use a pointer and offset to it to save on the whole bank type and method overhead if speed is really an issue since its just a nice wrapper around that anyway. <br><br></td></tr></table><br>
<a name="977317"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> In general, reading integers from memory is faster than reading any other type of data including the same number of bytes. But if that means you have overhead of having to extract bytes from the integer, that will probably eat up the benefits.<br><br>Also I have found that allocating some memory and then using pointers can be a little bit faster than using arrays or banks. I didn't get a major increase, though, only a few percent difference. The thing is that when you access an element from an array, it has to go to the array *object*, find the base address of the array *memory*, and then index it, whereas with plain memory you already are keeping the base address in a register and then just have to index it. But still, most of the bottleneck is in the memory transfer rate/bus/cache speed etc.<br><br>I know what you mean about indirect addressing in assembler optimizing to use a faster addressing mode - maybe the blitz/gc compiler just doesn't do that optimization for some reason.<br><br>btw reading/writing doubles can be faster than integers, but then you'd have to use like varptr to get the base of the double data and then read off the bytes.<br><br>You might find that you get more optimizations elsewhere in your algorithm because if you're doing image manipulations I presume there are hefty chunks of code that could be made faster. <br><br></td></tr></table><br>
<a name="977371"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> If you're going to tell me I'm doing something incorrectly, at least have the courtesy to explain what exactly it is that you think I'm doing wrong. <br></div>Ordinarily I would, but you're different.  You don't really seem to make any attempt to learn something on your own, which is eery in its own right considering you've somehow managed to ship an application, several modules, and a bad game.<br><br>That being said, you're not using the PeekInt method, you're using the procedural wrapper of the method.  Additionally, if you want proper access to a bank that isn't going to break, you're also going to have to lock the bank before getting the buffer (you're not doing that either).  In short, you're just using the method incorrectly, and you're using the bank incorrectly.<br><br><div class="quote"> Why isn't the compiler replacing the function call with the faster method of accessing the memory? <br></div>Why do you think it would? <br><br></td></tr></table><br>
<a name="977407"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Why do you think it would?  <br></div>Also.. how in all bliss would it know? <br><br></td></tr></table><br>
<a name="977554"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I dont know if it would make much difference in the grand scheme of things but I notice that you use the bank.buf() method to get a pointer to it, yet you use the wrapper function peekint(bank,offset) when you could use bank.peekint(offset) thus reducing a call to a function. <br></div><br><br>I didn't notice banks had a peekint method.  It's worth a try I suppose.  <br><br><div class="quote"> Also on your array creation, why create a byte array to store int's then have to int ptr the byte ptr, why not just make an array of int's in the 1st place ? I know your 1st array test access'd by byte but you didnt do a peekbyte test on the bank? <br></div><br><br>It shouldn't make a difference.  An array is a block of memory.  Declaring it as an int array or a byte array will only affect how you index it and how much memory it takes up.  Converting the byte pointer to the byte array to an int pointer to the byte array, is just a way of telling the compiler to access the data as if it were ints.  <br><br>And I just did it that way in my code because I was too lazy to declare another array. :-)<br><br><br><div class="quote"> <br>You might find that you get more optimizations elsewhere in your algorithm because if you're doing image manipulations I presume there are hefty chunks of code that could be made faster.<br> <br></div><br><br>Well with the indexing method of accessing the banks alone, Seamless Texture Generator written in BlitzMax is gonna be 10x faster than it was in BlitzPlus.  And if I decide to unroll any loops we could be talking 100x faster based on earlier tests.  Fast enough, perhaps, for realtime previews.<br><br>As for optimizing the algorithms, those are already very optimized.  I have one of the fastest median algorithms in there, and a very fast box/gaussian blur.<br><br><div class="quote"> ctually you could skip the whole bank test and just memalloc and use a pointer and offset to it to save on the whole bank type and method overhead if speed is really an issue since its just a nice wrapper around that anyway. <br></div><br><br>I didn't even notice BlitzMax had Memalloc.  But looking at the source to TBank, it doesn't look like there'd be any overhead associated with writing via pointer dereferencing so there's not really a point in switching over to that.  Other than maybe making things clearer should I ever choose to port to C. :-)<br><br><br><div class="quote"> You don't really seem to make any attempt to learn something on your own, which is eery in its own right considering you've somehow managed to ship an application, several modules, and a bad game. <br></div><br><br>And you don't really seem to make any attempt at being polite.<br><br>Noel, don't presume that you know anything about me.  Because I assure you, you know NOTHING about me.  <br><br>Allow me to educate you with a bit of the light reading I've been doing over the last two weeks while researching the algorithms I'll need for my new texture generator:<br><br><a href="http://en.wikipedia.org/wiki/Color_models" target="_blank">http://en.wikipedia.org/wiki/Color_models</a><br><a href="http://en.wikipedia.org/wiki/YCbCr" target="_blank">http://en.wikipedia.org/wiki/YCbCr</a><br><a href="http://en.wikipedia.org/wiki/RG_Chromaticity" target="_blank">http://en.wikipedia.org/wiki/RG_Chromaticity</a><br><a href="http://en.wikipedia.org/wiki/HSL_color_space" target="_blank">http://en.wikipedia.org/wiki/HSL_color_space</a><br><a href="http://en.wikipedia.org/wiki/Opponent_process" target="_blank">http://en.wikipedia.org/wiki/Opponent_process</a><br><a href="http://en.wikipedia.org/wiki/Lab_color_space" target="_blank">http://en.wikipedia.org/wiki/Lab_color_space</a><br><a href="http://en.wikipedia.org/wiki/Seam_carving" target="_blank">http://en.wikipedia.org/wiki/Seam_carving</a><br><a href="http://www.seamcarving.com/arik/imret.pdf" target="_blank">http://www.seamcarving.com/arik/imret.pdf</a><br><a href="http://www.shellandslate.com/download/fastmedian_5506.pdf" target="_blank">http://www.shellandslate.com/download/fastmedian_5506.pdf</a><br><a href="http://www.cs.princeton.edu/gfx/pubs/Barnes_2009_PAR/patchmatch.pdf" target="_blank">http://www.cs.princeton.edu/gfx/pubs/Barnes_2009_PAR/patchmatch.pdf</a><br><a href="http://en.wikipedia.org/wiki/Bilateral_filter" target="_blank">http://en.wikipedia.org/wiki/Bilateral_filter</a><br><a href="http://people.csail.mit.edu/sparis/publi/2006/tr" target="_blank">http://people.csail.mit.edu/sparis/publi/2006/tr</a><br><a href="http://people.csail.mit.edu/fredo/PUBLI/Siggraph2002/DurandBilateral.pdf/Paris_06_Fast_Bilateral_Filter_MIT_TR.pdf" target="_blank">http://people.csail.mit.edu/fredo/PUBLI/Siggraph2002/DurandBilateral.pdf/Paris_06_Fast_Bilateral_Filter_MIT_TR.pdf</a><br><a href="http://groups.csail.mit.edu/graphics/ibedit/ibedit_s2001_cameraReady.pdf" target="_blank">http://groups.csail.mit.edu/graphics/ibedit/ibedit_s2001_cameraReady.pdf</a><br><a href="http://artis.imag.fr/Publications/2004/ED04/flash.pdf" target="_blank">http://artis.imag.fr/Publications/2004/ED04/flash.pdf</a><br><a href="http://people.csail.mit.edu/sparis/bf_course/slides/07_variants.pdf" target="_blank">http://people.csail.mit.edu/sparis/bf_course/slides/07_variants.pdf</a><br><a href="http://www.gamedev.net/reference/programming/features/edf/page2.asp" target="_blank">http://www.gamedev.net/reference/programming/features/edf/page2.asp</a><br><a href="http://en.wikipedia.org/wiki/Sobel_operator" target="_blank">http://en.wikipedia.org/wiki/Sobel_operator</a><br><a href="http://en.wikipedia.org/wiki/Band-pass_filter" target="_blank">http://en.wikipedia.org/wiki/Band-pass_filter</a><br><a href="http://en.wikipedia.org/wiki/Albedo" target="_blank">http://en.wikipedia.org/wiki/Albedo</a><br><a href="http://research.microsoft.com/en-us/um/people/zhang/papers/iccv01-reflectance.pdf" target="_blank">http://research.microsoft.com/en-us/um/people/zhang/papers/iccv01-reflectance.pdf</a><br><a href="http://www.cs.adelaide.edu.au/users/mjb/Papers/Light_source_direction_from_a_single_image.pdf" target="_blank">http://www.cs.adelaide.edu.au/users/mjb/Papers/Light_source_direction_from_a_single_image.pdf</a><br><a href="http://perception.inrialpes.fr/people/Prados/demos/SFS/demo_real_images/demo_real_images.html" target="_blank">http://perception.inrialpes.fr/people/Prados/demos/SFS/demo_real_images/demo_real_images.html</a><br><a href="http://dspace.mit.edu/bitstream/handle/1721.1/7420/CS010.pdf?sequence=1" target="_blank">http://dspace.mit.edu/bitstream/handle/1721.1/7420/CS010.pdf?sequence=1</a><br><a href="http://www.vision.cs.ucla.edu/papers/pradosJS09.pdf" target="_blank">http://www.vision.cs.ucla.edu/papers/pradosJS09.pdf</a><br><a href="http://srv-43-200.bv.tu-berlin.de/~vr/papers/acrobat/CAIP93.pdf" target="_blank">http://srv-43-200.bv.tu-berlin.de/~vr/papers/acrobat/CAIP93.pdf</a><br><a href="http://sibgrapi.sid.inpe.br/col/sid.inpe.br/banon/2002/11.04.11.11/doc/7-14.pdf" target="_blank">http://sibgrapi.sid.inpe.br/col/sid.inpe.br/banon/2002/11.04.11.11/doc/7-14.pdf</a><br><a href="http://gandalf.psych.umn.edu/users/schrater/schrater_lab/courses/CompVis09/Papers/Lec05Shading.pdf" target="_blank">http://gandalf.psych.umn.edu/users/schrater/schrater_lab/courses/CompVis09/Papers/Lec05Shading.pdf</a><br><a href="http://www.loria.fr/~kerautre/publications/Kerautret05b.pdf" target="_blank">http://www.loria.fr/~kerautre/publications/Kerautret05b.pdf</a><br><a href="http://www.if.pwr.wroc.pl/~optappl/pdf/2008/no2/optappl_3802p387.pdf" target="_blank">http://www.if.pwr.wroc.pl/~optappl/pdf/2008/no2/optappl_3802p387.pdf</a><br><a href="http://research.microsoft.com/en-us/people/yasumat/isfs_cvpr05.pdf" target="_blank">http://research.microsoft.com/en-us/people/yasumat/isfs_cvpr05.pdf</a><br><a href="http://pc2.iam.fmph.uniba.sk/amuc/_contributed/algo2009/breuss.pdf" target="_blank">http://pc2.iam.fmph.uniba.sk/amuc/_contributed/algo2009/breuss.pdf</a><br><a href="http://www.comp.leeds.ac.uk/bmvc2008/proceedings/1993/bmvc-93-015.pdf" target="_blank">http://www.comp.leeds.ac.uk/bmvc2008/proceedings/1993/bmvc-93-015.pdf</a><br><a href="http://web.mit.edu/bcs/sinha/papers/sinha_adelson_ICCV93.pdf" target="_blank">http://web.mit.edu/bcs/sinha/papers/sinha_adelson_ICCV93.pdf</a><br><a href="http://www.cs.huji.ac.il/~peleg/papers/pami90-Peleg-Rom.pdf" target="_blank">http://www.cs.huji.ac.il/~peleg/papers/pami90-Peleg-Rom.pdf</a><br><br>I don't know how you got the silly notion in your head that I don't have a desire to learn.  I'll have you know that when it comes to computer programming I'm completely self-taught.  And I don't even post questions here that often.  I suspect that you've mistaken having priorities with an aversion to learning.<br><br><br><div class="quote"> That being said, you're not using the PeekInt method, you're using the procedural wrapper of the method. <br></div><br><br>You are correct, I am using the function isntead of the method.  <br><br>Now kindly explain to me how that translates to "You're using the peekint function wrong."<br><br>Perhaps you meant to say "You are using the peekint function instead of the peekint method."<br><br><br><div class="quote"> Why do you think it would? <br></div><br><br>Because compilers are supposed to optimize things.  Have you ever even used a compiler besides Blitz, Noel?  Have you ever looked at the aseembly code they output?  Real compilers do optimizations like unrolling loops for you and stuff.<br><br><a href="http://en.wikipedia.org/wiki/Compiler_optimization" target="_blank">http://en.wikipedia.org/wiki/Compiler_optimization</a><br><br><br><div class="quote"> Also.. how in all bliss would it know? <br></div><br><br>Oh come on.  Are you guys being intentionally obtuse?<br><br>Replacing A = PeekInt(B, C) with A = B[C] is not a complicated procedure. <br><br></td></tr></table><br>
<a name="977556"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Arrays and banks are the same speed. <br></div><br>No surprise there then.<br><br>If they were a different speed I'd be a bit concerned... <br><br></td></tr></table><br>
<a name="977562"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Brucey:<br>The way multi-dimensional arrays in BlitzMax are treated as arrays of arrays concerned me about hidden overhead with how they're dealt with internally.  That's why I performed that test. <br><br></td></tr></table><br>
<a name="977563"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> The way multi-dimensional arrays in BlitzMax are treated as arrays of arrays concerned me about hidden overhead with how they're dealt with internally. That's why I performed that test. <br></div>Multidim arrays are not arrays of arrays, they're a solid block of memory (with the usual array header).  An array of arrays is an array of arrays. <br><br></td></tr></table><br>
<a name="977565"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Oh come on. Are you guys being intentionally obtuse?<br>Replacing A = PeekInt(B, C) with A = B[C] is not a complicated procedure. <br></div>Not all procedural wrapper functions are exact calls of &lt;obj&gt;.&lt;method&gt;.<br><br>It would be ludicrous and so very wrong if the compiler even attempted to do what you suggest.<br>Also, procedural wrapper functions can also own or disown parameters that the method being wrapped does not or does have. <br><br></td></tr></table><br>
<a name="977578"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Not all procedural wrapper functions are exact calls of &lt;obj&gt;.&lt;method&gt;. <br></div><br><br>I'm not sure how "&lt;obj&gt;.&lt;method&gt;" has anything to do with what I wrote.<br><br><br><div class="quote"> It would be ludicrous and so very wrong if the compiler even attempted to do what you suggest. <br></div><br><br>I think that's going a bit far.<br><br>Sure, if you want to be picky, the code which is actually executed when you call PeekInt is:<br><br><pre class=code>
Method PeekInt( offset )
		Assert offset&gt;=0 And offset&lt;_size-3 Else "Illegal bank offset"
		Return (Int Ptr(_buf+offset))[0]
	End Method
</pre><br><br>And if you were to simply replace that with my code you'd lose the protection provided by Assert.  <br><br>But one could put up a pretty good argument for there not being a condtional jump in a function which is going to be used in situations where speed is of the essence.  That Assert call should have a conditional compiler directive so it is included when running in debug mode only.<br><br>And if you remove that, then the function call simply boils down to:<br>Return (Int Ptr(_buf+offset))[0]<br><br>Which is the same as the code I suggested.  With the odd exception of the offset being added to the pointer rather than being used as the index for dereferencing.  What the heck is up with that?<br><br><br><div class="quote"> Also, procedural wrapper functions can also own or disown parameters that the method being wrapped does not or does have. <br></div><br><br>You are speaking in hypotheticals.  We are talking about the peek functions here, not every wrapper function in Blitzmax. <br><br></td></tr></table><br>
<a name="977580"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> how they're dealt with internally <br></div><br>Since all the source code is provided with/for BlitzMax, you could always examine that and see for yourself how arrays are handled :-) <br><br></td></tr></table><br>
<a name="977583"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> What the heck is up with that? <br></div><br>Because this<br><pre class=code>Int Ptr(buffer)[offset]</pre><br>is not the same as this<br><pre class=code>Int Ptr(buffer+offset)[0]</pre> <br><br></td></tr></table><br>
<a name="977585"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Multidim arrays are not arrays of arrays, they're a solid block of memory (with the usual array header). An array of arrays is an array of arrays. <br></div><br><br>My bad. <br><br></td></tr></table><br>
<a name="977587"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Because this<br><br>Int Ptr(buffer)[offset]<br><br>is not the same as this<br><br>Int Ptr(buffer+offset)[0]<br> <br></div><br><br>You got me again.  You're two for two. <br><br></td></tr></table><br>
<a name="977589"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Since all the source code is provided with/for BlitzMax, you could always examine that and see for yourself how arrays are handled :-) <br></div><br><br>What do you mean?  I see source to the mods and things, but I don't see any source for the internals of the BlitzMax compiler?<br><br>*searching for .c files*<br><br>Oh, I see some in brl.mod.  But there's not many.  Hm.  There's an array source file.  Can't make heads or tails of it.  Looks like code for a compiler...  No wait, those are case statements for each data type. <br><br>Hm.  Well I'll have to look at this more to really figure it out, but if all the source code's here, where's the source file that has the END function?  I'd like to take a look at what that does so I can see what might have been causing the long delay when you quit playing Space Beetles.<br><br>[edit]<br><br>Hm, I think I found it, but all it does is call Exit(0)?  I can't find the exit function though.  It may be a C command.  If so then now I'm confused how my app could have been locking up on end.<br><br>Anyway this is getting way off topic. <br><br></td></tr></table><br>
<a name="977594"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I can't find the exit function though. It may be a C command. If so then now I'm confused how my app could have been locking up on end. <br></div><br>Off topic, but this is the man page (Mac OS, anyway, doubt it differs much between platforms):<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">EXIT(3) 		 BSD Library Functions Manual		       EXIT(3)

NAME
     exit, _Exit -- perform normal program termination

LIBRARY
     Standard C Library (libc, -lc)

SYNOPSIS
     #include &lt;stdlib.h&gt;

     void
     exit(int status);

     void
     _Exit(int status);

DESCRIPTION
     The exit() and _Exit() functions terminate a process.

     Before termination, exit() performs the following functions in the order
     listed:

	   1.	Call the functions registered with the atexit(3) function, in
		the reverse order of their registration.

	   2.	Flush all open output streams.

	   3.	Close all open streams.

	   4.	Unlink all files created with the tmpfile(3) function.

     The _Exit() function terminates without calling the functions registered
     with the atexit(3) function, and may or may not perform the other actions
     listed.  Both functions make the low-order eight bits of the status argu-
     ment available to a parent process which has called a wait(2)-family
     function.

     The C Standard (ISO/IEC 9899:1999 (``ISO C99'')) defines the values 0,
     EXIT_SUCCESS, and EXIT_FAILURE as possible values of status.  Cooperating
     processes may use other values; in a program which might be called by a
     mail transfer agent, the values described in sysexits(3) may be used to
     provide more information to the parent process.

     Note that exit() does nothing to prevent bottomless recursion should a
     function registered using atexit(3) itself call exit().  Such functions
     must call _Exit() instead (although this has other effects as well which
     may not be desired).

RETURN VALUES
     The exit() and _Exit() functions never return.

SEE ALSO
     _exit(2), wait(2), atexit(3), intro(3), sysexits(3), tmpfile(3)

STANDARDS
     The exit() and _Exit() functions conform to ISO/IEC 9899:1999
     (``ISO C99'').

BSD			       September 9, 2002			   BSD
</textarea> <br><br></td></tr></table><br>
<a name="977600"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mahan</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> A comment regarding compiler optimizations (inline):<br><br>Some compiled languages (like C++) provide the option to mark functions as "inline" to instruct the compiler to instead of making a call, actually include the body of the function everywhere it is used (thus removing the time to shuffle around the stack and make the call of course).<br><br>This has some similarity with preprocessor macros in pure C but inlining is much more potent and advanced and part of the actual compilers work.<br><br>Now the C++ language has a special keyword (inline) so that the developer can control this behavior manually, as the compiler (at compile time) usually does not have enough information about the bottlenecks in an application to know what functions should be inlined. Obviously not everything can be inlined (think about recursive functions, as an extreme example.)<br><br>Afaik, BlitzMax does not have inline functionality at all.<br><br>On a sidenote: In the Java Virtual Machine (JVM) there is JIT (Just In Time compiling) that does runtime compilation. The JVM has the ability to monitor and locate bottlenecks in runtime and to use JIT for inlining code and even bypass OOP call-chains (as used when overriding functions in inheritance) based on knowledge that the JVM gathers while the program is running, that simply isn't available before the program is executed. Modern Java sometimes outperforms C++ in server-code (long running, heavy processes) today because of this.<br><br>edit: some grammar <br><br></td></tr></table><br>
<a name="977659"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt;Multidim arrays are not arrays of arrays, they're a solid block of memory (with the usual array header). An array of arrays is an array of arrays. <br><br>&gt;My bad. <br><br>Actually when I looked at the code for arrays I was under the impression that for a multidimensional array there is a separate block of memory for each `row` of the array in a given dimension. So for a 2D array [10,20] you'd have 10 blocks of memory 20 bytes long, or whatever. So it IS kind of like an array of arrays, just that the length of each array is the same. <br><br></td></tr></table><br>
<a name="977666"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_Skully</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mahan,<br><br>So basically inline just means copy the raw code here... providing a means to centrally manage the code (instead of finding all occurances) but removing the need for the function call itself.<br><br>Hmmmm... sounds like good optimization stuff... <br><br></td></tr></table><br>
<a name="977675"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nilium (Noel) is an odd character.  He's been on this site desperately seeking recognition and respect for as long as I can remember but he don't get it.  It's actually quite comical. <br><br></td></tr></table><br>
<a name="977683"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Chroma (Noel) is an odd character. He's been on this site desperately trying to make a flight sim for as long as I can remember but he doesn't get it. It<i>'s</i> actually quite comical. <br><br></td></tr></table><br>
<a name="977686"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> C'mon Noel you have been rude to SSwift. Apologize to him now lad, or no dinner for you. <br><br></td></tr></table><br>
<a name="977704"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're right, that was excessively rude on my part.  Apologies, sswift - I'll try to be less caustic and not accuse you of something I can't prove next time. <br><br></td></tr></table><br>
<a name="977798"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nilium, Noel, or whatever your nick is this week.  I've been on these forums a long time and I know for a fact that sswift is a ten times better programmer than you are.  You remind me of a 2d Lt that goes around saying "hey, I'm an officer!"...and then everyone laughs at him and treats him like crap.  Bottom line is, you have to give respect to get respect.  You were disrespectful to sswift for absolutely no reason except to try and look like some coding guru with all the answers.  In actually you came out of it looking like an idiot.  Sswift has released a game.  He completed something.  It's for sale on a website.  What have you done?<br><br>Go write vein 3 and then post the bloated non-working code in the archives.  Then when someone replies that it doesn't work you can say "Sorry I can't be bothered to fix it".  It seems to be your forte.  Or better yet...just start posting all your poison on BlitzMonkeys.com!! <br><br></td></tr></table><br>
<a name="977805"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Nilium, Noel, or whatever your nick is this week. I've been on these forums a long time and I know for a fact that sswift is a ten times better programmer than you are. You remind me of a 2d Lt that goes around saying "hey, I'm an officer!"...and then everyone laughs at him and treats him like crap. Bottom line is, you have to give respect to get respect. You were disrespectful to sswift for absolutely no reason except to try and look like some coding guru with all the answers. In actually you came out of it looking like an idiot. Sswift has released a game. He completed something. It's for sale on a website. What have you done?<br><br>Go write vein 3 and then post the bloated non-working code in the archives. Then when someone replies that it doesn't work you can say "Sorry I can't be bothered to fix it". It seems to be your forte. Or better yet...just start posting all your poison on BlitzMonkeys.com!! <br></div>Let me address this point by point:<br><br>1) My name really doesn't change that often.<br><br>2) I don't know about sswift's skills, and it was wrong of me to judge him as harshly, rudely, and stupidly as I did.  Unfortunately, I shot first and asked questions later, and that hardly ever works out in one's favor.  I unfortunately have a somewhat bad history of doing this, but I try to refrain from doing it as often as I once did.<br><br>3) Wouldn't know, I've not been in the military.  Doesn't really work as an analogy here, since I don't get it.<br><br>4) In regards to respect, not necessarily.  I respect people who have given me none in return, and vice versa.  It sounds like a nice ideal to give respect and get respect in return, but that's not how reality works.<br><br>5) No, I was disrespectful to sswift because after numerous posts of his, most of them displaying what I perceived as him showing very little effort on his part to understand a topic, I felt like he was just being annoying.<br><br>6) Yes, I did come out of it looking like an idiot.  As I said, I was excessively rude.  There was really no genuinely good reason for this, just me being annoyed.<br><br>7) He released a bad game.  I don't take that back, it really just isn't fun.  Kudos to putting something out, but I don't see much point in respecting someone for putting out something that isn't fun and failed to sell.<br><br>8) I've completed a few different things and been paid for them (and am being paid now for some work to do with BMax).  I don't sell what I make because I would rather share those things with people than charge them for it.  The way I see it is that if even one person finds something I made useful, even if it's just one line of code that explained something, then that's good enough.  At any rate, I won't discuss exactly what I'm doing now for contractual reasons (in other words, I'd rather sit on the safe side of the confidentiality clause).<br><br>8) Vein 3 was mostly functional, and what pieces of it I released (e.g., the GUI) worked.  Not sure what you're on about there.  There's plenty of other code in the code archives for Blitz3D, but I really can't be bothered to fix it because I no longer have Blitz3D.  Some other pieces of code are dated and I don't use them anymore, so I'm not going to fix those either.  If you really want up to date stuff, you get it off my github repo.<br><br>9) What does BlitzMonkeys have to do with this? O_o<br><br>Now, if you want to come out looking like the white knight in this, there you go, you can have the title.  I don't care, but really, holding grudges as you seem to be doing isn't going to do you or me any good. <br><br></td></tr></table><br>
<a name="977842"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mahan</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> @_Skully<br><br><div class="quote"> <br>So basically inline just means copy the raw code here... providing a means to centrally manage the code (instead of finding all occurances) but removing the need for the function call itself.<br> <br></div><br><br>Yes, you could say that, but in the C++ implementation you actually define the function as inlined and that means that every time you "call" this function, in reality a copy of the function code is inserted. (instead of specifying inline when you make the call)<br><br>Still you get to keep lots of benefits of a normal function as the inline function can have local variables, params and return value just as any other function.<br><br>Why i wrote this about the inline stuff is because sswift wrote this:<br><div class="quote"> <br>Why isn't the compiler replacing the function call with the faster method of accessing the memory?<br> <br></div><br><br>The answer is that I don't think BlitzMax has the concept of inlining as an optimization.<br><br>Besides without an inlining directive (or clearly specified levels of optimization) the compiler would imho do wrong by optimizing away pure function calls by itself.<br><br>I don't know of a single C/C++ compiler that implements advanced optimizations like inlining or loop-unrolling etc, that does not provide optimization-levels where these advanced optimization techniques are possible to disable. (example: gcc compiler -o[x] directive where x is the level of optimizations used) <br><br></td></tr></table><br>
<a name="977885"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> well noel apologized so let bygones be bygones <br><br></td></tr></table><br>
<a name="977894"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Arowx</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> So when should I be using banks and when should I use arrays? <br><br></td></tr></table><br>
<a name="977948"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> always use arrays?<br><br>I cant think of any advantages of banks <br><br></td></tr></table><br>
<a name="978009"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> Merx:<br>It depends on the situation.  <br><br>Banks are probably good if you intend to store a lot of data you need to save or transmit.<br><br>Arrays are generally fine if you need a fixed size block of memory and you're not doing anything particularly intensive with it.  And if you want to access 2D data at random an array makes that simpler and using a bank wouldn't really be any faster.<br><br>But I'm leaning strongly towards using memalloc instead of banks in situations that call for storing, copying, and modifying very large chunks of memory such as when processing images.  I don't need the extra features of banks, and getting access to the bank pointers is just another level of abstraction.  Why store a pointer to a bank when every time I need to access it I'm gonna have to dereference that to a float pointer? <br><br></td></tr></table><br>
<a name="978012"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I'm learning strongly towards using memalloc instead of banks in situations that call for storing, copying, and modifying very large chunks of memory such as when processing images. <br></div>I would recommend this route, especially if you're frequently allocating and deallocating buffers. Using arrays in this situation can put a fair amount of strain on the GC (I tried this while writing my JSON parser, and using arrays as buffers slowed parsing to a crawl due to the number of arrays that had to be created and resized - using MemAlloc and such just worked better). <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
