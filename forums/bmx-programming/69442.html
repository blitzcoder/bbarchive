<!DOCTYPE html><html lang="en" ><head ><title >Drawing on a pixmap</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Drawing on a pixmap</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Drawing on a pixmap</a><br><br>
<a name="776926"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tylerbot</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I want to draw small sprites directly onto a background image/pixmap.<br><br>Right now, the only way I can see to do that is to do the following at each rendering step:<br><br>1. draw the background image to the buffer<br>2. if it is necessary to draw such a sprite to the background:<br> 2a. draw the sprite to the buffer<br> 2b. grab a new pixmap and set the return value to the background image (so that next time I draw the background image, the sprite is automatically incorporated)<br>3. draw the rest of the scene<br><br>I have considered the possibility of blitting the pixels from the sprite directly onto the pixels of the background image, but that seems to be really inefficient and I'd have to write my own transforms.<br><br>What should I be doing instead? <br><br></td></tr></table><br>
<a name="776951"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you don't need alpha then use pixmap.paste method..<br>I wrote <a href="/codearcs.php?code=1692" target="_blank"> this </a> which still might work to memcopy non-maskcolour pixels only but really for small sprites.<br>Writepixel is quick so might be an option as is drawimage/grabimage. Finally, Indiepath wrote a Render-To-Texture module to do just this which I can't get to work since Mark changed the DX7 Driver.<br>If you ask nicely maybe Tim will rewrite it. <br><br></td></tr></table><br>
<a name="777111"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Punksmurf</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I have considered the possibility of blitting the pixels from the sprite directly onto the pixels of the background image, but that seems to be really inefficient and I'd have to write my own transforms. <br></div><br>What makes you think that is inefficient? It's not like Blitz interally does something else (at least, I cannot not imagine what, not where alpha is involved anyway).<br><br>Besides that, grabimage is amazingly slow (I don't remember why, but there's an answer out there). Anyway, what you're doing now is drawing your background picture (big) to the background, then drawing a small image onto the background, and then grabbing it (thus, effectively drawing it again). Just blitting the small image over the background image would thus be way faster. <br><br></td></tr></table><br>
<a name="777139"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >peltazoid</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Alternatively,  hold each sprite as an array and plot each pixel to the pixmap when required.<br><br>For one of my projects, I need 'old school' sprite splitting effects and having the sprite as an array of colour indices to a pallet array then drawing each pixel to the background for the sprite.  Not hard to do and is faster than having to grab an image each time, also it is more flexible. <br><br></td></tr></table><br>
<a name="777292"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tylerbot</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for your prompt replies, but I don't yet see the answer I'm looking for. Let me elaborate a bit.<br><br>tonyg: I do need alpha.<br><br>Punksmurf: The copying of the pixels of each sprite becomes inefficient when there are many, many sprites. I'd like to stop keeping track of a sprite after I draw it (since it's static from then on). Whereas, I figured updating the background texture once every couple of frames would be OK, and it wouldn't care how many sprites are "pasted" onto it. I hadn't counted on grabimage being so ghastly inefficient, though.<br><br>peltazoid: The problem there is, I need to rotate the image and possibly also scale it just before plotting the pixels. I'm not familiar with the smoothing algorithms and I really like the native ones in Blitz. So, I'd like to use the native rotation and scale methods, as well as alpha per-pixel transparency, when I blit the sprite onto the background texture.<br><br>Thanks for your help so far though. I'm still experimenting heavily with this and always open to new techniques. <br><br></td></tr></table><br>
<a name="777487"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> One idea I could think of is to break up the background into smaller sections, then you only need to draw and grab the section that the new sprite will cover (or sections if the sprite overlaps more than one). <br><br></td></tr></table><br>
<a name="777573"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Punksmurf</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah, when you want to draw with those transforms, nothing beats your GPU. Perhaps TomToads idea works, otherwise I wouldn't know. <br><br></td></tr></table><br>
<a name="777659"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >assari</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tylerbot,<br>There is another technique you can use which is using renderlists, see this link <a href="http://www.blitzmax.com/Community/posts.php?topic=56615" target="_blank">http://www.blitzmax.com/Community/posts.php?topic=56615</a> or search forum for renderlists.<br><br>If you need a more basic intro, you can try here<br><a href="http://www.2dgamecreators.com/tutorials/gameprogramming/basics/F4%20-%20Revised%20Framework.html" target="_blank">http://www.2dgamecreators.com/tutorials/gameprogramming/basics/F4%20-%20Revised%20Framework.html</a> <br><br></td></tr></table><br>
<a name="777944"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tylerbot</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> TomToad: Yes your idea might actually be the most efficient, and I might not actually have to break up the background into discrete tiles. I got to thinking about optimization, here's a variation I came up with:<br>1. CLS<br>2. Draw the current background bitmap from memory<br>3. Draw any new, static sprites that are to be "added"<br>4. Using some auxiliary data about the static sprites, grab only those rectangular areas which have been modified, and save that pixel data (pixel by pixel) back into the background texture<br>5. Draw the rest of the scene<br><br>It's kind of like dynamic-sized tiles. What do you think? <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
