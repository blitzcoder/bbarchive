<!DOCTYPE html><html lang="en" ><head ><title >Delete Keyword</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Delete Keyword</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Delete Keyword</a><br><br>
<a name="987752"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >beanage</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey,<br><br>I got a (maybe its actually two) short questions;<br><br>I assume the [Delete()] Method of a type will be called by the GC, when an object is supposed to be deleted, wont it?<br><br>So, what if I do the following:<br><pre class=code>
Type myType
   Global MyGarbageCollection:TList = CreateList()
   Method Delete()
      MyGarbageCollection.AddLast( Self )
   End Method
End Type
</pre>, namely create a new reference when the refcount reaches zero.. I think my intention is self-explanatory, isnt it?<br><br>Thank you, <br><br></td></tr></table><br>
<a name="987753"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >beanage</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> So I just typed my example code into the ide and it all works as i want it to work.. I love BlitzMax. Amen. <br><br></td></tr></table><br>
<a name="987756"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can temporarily suspend the garbage collector, if you need to.<br><br>Is the Delete method safe to use? If it is, I might start using it.. (I'm worried it's not completely safe, because the garbage collector deletes objects when it wants to, not the instant an object loses its references) <br><br></td></tr></table><br>
<a name="987758"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I wonder if this is a safe thing to do. As soon as the GC deletes your object you store it inside a TList. I wonder how long the pointer to it stays valid...<br><br>Also, if it doesn't delete the object it means that you never can delete the object... I don't see why you would want to do that. <br><br></td></tr></table><br>
<a name="987781"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >beanage</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> What is more performant: Holding a new reference to an existing unused object, and reuse that one if a new one is needed, or permanently re-allocating memory for new objects? I dont know, but I'm excited to see the results of this :) <br><br></td></tr></table><br>
<a name="987784"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Scienthsine</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Reusing objects can be good, but I wouldn't advocate doing it this way. In whatever place you remove your object from all of it's references, put it in your deleted list there before it is removed. This would be a much cleaner way of doing it. If you have several places that could reference the object, and aren't sure which one will be the last, then this would make it more difficult... but I would still look for a better way.<br><br>But... aslong as the pointer remains valid (check this... see if the same object gets it's delete called more than once), and you realize that this prevents your objects from getting collected, then you should be gone.<br><br>Do be sure to figure out if the garbage collector counts references made in the delete call, otherwise that memory could get collected in the middle of being used. -And- that the delete call gets called more than once for the same object loosing reference again. (Otherwise you'll get nasty memory leaks.) <br><br></td></tr></table><br>
<a name="987786"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I wonder if this is a safe thing to do. <br></div><br>I can't imagine that it would be... <br><br>Considering that it calls bbGCDeallocObject() after calling Delete(), when using the default GC. <br><br></td></tr></table><br>
<a name="987789"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is there a safe way of having an object deconstructor? <br><br></td></tr></table><br>
<a name="987792"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I use Delete() all the time, but obviously not to "work behind the garbage-collector's back". <br><br></td></tr></table><br>
<a name="987802"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I mean, say I have a missile, and when it hits all references are removed.. can I put the code to cause an explosion in delete? <br><br></td></tr></table><br>
<a name="987805"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, because you won't know when the object itself is going to be GC'd - that's entirely up to the garbage collector. <br><br></td></tr></table><br>
<a name="987812"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Even if I pay taxes the garbage collector won't do as I say?? :P <br><br></td></tr></table><br>
<a name="987814"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Eventually ;-)<br><br>You can manually call the collection, but it might not be very efficient to call this all the time - and it collects everything, which may not be what you want.<br><br>Better to perhaps move your missile from a "live" list to a "dead" list, where it can run its explosion routine, then when finished that, remove from the "dead" list. <br><br></td></tr></table><br>
<a name="987823"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> You really don't want to try to retain an object when it's being finalized.  Lots of things can go wrong there... the object you access might have been freed already and then you're referencing memory that might still be allocated but not associated with what you think it is.  Lots of room for error. <br><br></td></tr></table><br>
<a name="987827"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >beanage</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh, i didnt expect this thread to cause that big waves, its just an experiment. I love experiments :) I *think* if its a good gc, it should recount refs after delete(). Mmmh .. I will need to test it. <br><br></td></tr></table><br>
<a name="987835"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >beanage</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>
Global MyCollection:TList = CreateList()

Type MyType

	Field x
	Method Delete()
		mycollection.addlast(Self)
	End Method
	
End Type

Graphics 800,600

While Not KeyHit( KEY_ESCAPE )
	
	Local o:myType = New MyType
	o.x = mycollection.count()

Wend

For Local a:myTYpe = EachIn MyCollection

	Print a.x

Next
</pre><br><br>Watch those results. I hate pessimism, but I'm afraid those dont allow any optimism anymore, pity. <br><br></td></tr></table><br>
<a name="987836"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I *think* if its a good gc, it should recount refs after delete() <br></div><br>But that doesn't make sense now, does it?<br><br>It's calling Delete() because it has decided there are no refs, and is about to free memory.<br><br>Now you are saying, "well, hold on. I actually want to re-reference this object now, even though collection has begun".<br><br>Not a very good idea.<br><br>It's like that stale sandwich you threw into the trash yesterday. But you've decided to rescue it before the trash-men come to collect the garbage, scrape off the mold, and have it for lunch :-p <br><br></td></tr></table><br>
<a name="987839"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >beanage</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thats one funny picture brucey ;) My intention was catching the sandwich someone else was about to throw :) recycling :D<br><br>Looks like we posted at the same time. I tested it, an it looks like it frees the mem of the object after calling delete, without caring about my refs /: Looks like my first exaple posted was an optimistically short one.<br><br>I tend to do this. sry. <br><br></td></tr></table><br>
<a name="987840"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I tested it, an it looks like it frees the mem of the object after calling delete, without caring about my refs /: <br></div><br><br>Right. Because there needs to be a point in time where it *can* garbage collect the object. And calling Delete() tells YOU, that the object is about to be deleted. No turning back. No passing through Go! :-) <br><br></td></tr></table><br>
<a name="987842"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Scienthsine</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> And I'd like it to stay that way. Trying to keep up with references made during deletes and such would be wasted processor cycles for everyone who uses bmax for a very small benefit .<br><br>Is nice to know how it stands at the moment though, for reference. :) <br><br></td></tr></table><br>
<a name="999762"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >beanage</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I'd like it to stay that way <br></div><br>So maybe you wont like BlitzMax 1.36. <br><br><div class="quote"> Trying to keep up with references made during deletes and such would be wasted processor cycles <br></div><br>The recent BlitzMax Update does. I wonder whether Mark read this Thread. If the update would just have come 2 months earlier, or just someone had told that it was about to be implemented, I would have been spared of writing a 500 lines of workaround. Now that it is supported, this kinda sucks.<br><br>edit: Is there any place where you can read what is to be implemented next? I'm just a little pissed right now :( <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
