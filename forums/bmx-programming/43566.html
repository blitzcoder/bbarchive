<!DOCTYPE html><html lang="en" ><head ><title >C Static library experiment.. so close!</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >C Static library experiment.. so close!</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >C Static library experiment.. so close!</a><br><br>
<a name="486400"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SurreaL</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello! I've tried to play around with compiling a static lib w/ gcc, and using it in blitzmax. It seems I am failing :P Hopefully some kind soul out there in blitzland will be able to help me out :D (Drago..? anyone..? ..bueller?)<br><br>Anyways this is what I've done. I have the following extremely simple source file to work with in c:<br><pre class=code>
//testsource.c
int testfunc(int a,int b)
{
    return a + b;
}
</pre>I pieced together the following steps from several tutorials on compiling/linking static libs.. so bare with me.<br><br>First, I went and compiled the .c file into a .o object file using gcc. Afterwards I used the ar program to throw the object file into a .a file, which is in my understanding an archive of object files. (Or basically a static library)<br><br>Then I went and created the following path in my blitzmax folder.. \mods\surreal.mod\test.mod , and placed the static lib file (statictest.a) within it. Along with this I've gone and created test.bmx, and placed the following code inside:<br><pre class=code>
Strict

Module surreal.test

Import "-lstatictest"

Extern
	Function testfunc:int (a, b)
End Extern
</pre>After saving this module, I've been able to successfully compile it using "bmk makemods -r surreal.test", with no errors. So far so good.. (Or so I'd like to believe)<br><br>Anyways on to test it. I create a new .bmx file which looks like this:<br><pre class=code>
Import surreal.test

Print testfunc (1,2)
</pre>As you can see I'm striving for the simplest code here, just trying to get the pipeline down.. and this is where I run into problems. Upon trying to compile this example, I get the following compile error:<br><br><div class="quote"> <br>Compile Error:Can't find interface for module 'surreal.test'<br> <br></div><br>I've triple checked the path involved (bmaxroot\mod\surreal.mod\test.mod), and it contains the following files:<br>libstatictest.a<br>test.a<br>test.bmx<br>test.i<br><br>and within surreal.mod\test.mod\.bmx:<br>test.bmx.i<br>test.bmx.o<br>test.bmx.s<br><br>I have only tried compiling in release mode, as I realize there is no debug mode version of the lib to compile with. (I've noticed how there are two versions of each module, obviously the '.d.' in the filename denotes debug versions in other mods)<br><br>Other things I've tried, with no effect:<br>-Copying libstatictest.a into .bmx dir. (Didn't think this would work since I've never seen a .a file in a .bmx folder.. but hey)<br>-Using Extern "Win32" instead of just Extern<br>-Renaming everything since originally I named the function, module, and library "test"<br>-Banging my head against the wall.<br><br>Sadly, I'm running out of ideas.. so if anyone could help me out, I'd be very greatful.<br><br>Thanks in advance :) <br><br></td></tr></table><br>
<a name="486403"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SurreaL</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> p.s. Ok turns out the problem was just me being a moron.. I've updated bmax to the 1.03 version today, but I placed it in a new folder, and hadn't told Protean about it. (I updated my paths vars.. oops only half the battle!)<br><br>Anyways. After doing so, I got an error in compilation showing that -lstatictest could not be found. Turns out all I had to do was 'Import "libstatictest.a"', and all was well! So.. everything's working :D <br><br>To re-iterate the method in case anyone else is wondering how this was done..<br><br>Step 1) Take source code, and compile using something along the lines of "gcc -c mysource.c". This results in an object file.<br>Step 2) Pack any object files into an archive of them by calling "ar rc mylib.a mysource.o mysource2.o" etc.. you can add as many objects into the archive as you like.<br>Step 3) Place the resulting .a file into a module directory, and create a module (.bmx file) which Externs the functions from the static library.<br>Step 4) Use the function in any bmax source you write from there :)<br><br>*Remember if you are using the "Framework" command to stop Blitz from loading ALL modules as per default, you will have to explicitly Import your module for it to still work. <br><br></td></tr></table><br>
<a name="486408"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> move strict below the Module declaration and it works. <br><br></td></tr></table><br>
<a name="486637"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Zenith</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Import "-lstatictest"<br>Would work if you had put it in the Blitzmax/lib/ folder. :D<br>And it was named "libstatictest.a" I think. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
