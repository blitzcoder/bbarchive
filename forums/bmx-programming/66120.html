<!DOCTYPE html><html lang="en" ><head ><title >Windowed game losing focus</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Windowed game losing focus</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Windowed game losing focus</a><br><br>
<a name="738872"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello<br><br>Thought it'd be pretty good to have my game pause automatically if its being played in a window and loses focus.<br><br>Is there any way of achieving this?<br><br>PS I do have MaxGUI and I don't know if I can do it with that, but I'd hate to have to include such a large mod for a small task like this. <br><br></td></tr></table><br>
<a name="738876"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >popcade</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Gray Alien's Game Framework has this and working well... <br><br></td></tr></table><br>
<a name="738878"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Don't have that.<br><br>Never mind anyway, done it.<br><br><pre class=code>Extern "win32"
 Function GetActiveWindow%()
End Extern
Graphics 800,600

While Not KeyDown(key_escape)
	Cls
	If getactivewindow()
		DrawText "has focus",20,20
	Else
		DrawText "no focus",20,20
	EndIf
	Flip
Wend</pre> <br><br></td></tr></table><br>
<a name="738881"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Or alternatively you could just use the AppSuspend and AppResume Events. <br><br></td></tr></table><br>
<a name="738887"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks - will that work on MacOS/Linux as well? <br><br></td></tr></table><br>
<a name="738903"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I dunno. I would assume so, but have neither to test it on ATM. <br><br></td></tr></table><br>
<a name="738904"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Me either, but its not really important at this stage.  Was just curious. :) <br><br></td></tr></table><br>
<a name="738906"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> use the events as they are cross platform.  You might alway want to call Delay(1) when the docus is lost to give more CPU power to windows. <br><br></td></tr></table><br>
<a name="738922"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yan</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> . <br><br></td></tr></table><br>
<a name="741897"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was just trying to figure out how to do this myself, but APPSUSPEND and APPRESUME don't seem to work properly in debug mode at least.<br><br>When running in debug mode, if I open an explorer window, and then click that as my game is running, I get an APPSUSPEND event, but then immediately get an APPRESUME event as well.<br><br>I haven't yet tested whether this occurs outside of debug mode. <br><br></td></tr></table><br>
<a name="741908"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just use AppSuspend to pause my game, then let the user un-pause it manually when they want to.<br><br>It seems to be working fine, debug or not. <br><br></td></tr></table><br>
<a name="741914"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just set a flag and then skip the logic but still to the drawing code, works fine. <br><br></td></tr></table><br>
<a name="741917"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I just set a flag and then skip the logic but still to the drawing code, works fine. <br></div>Same.  I also revert to the standard Windows mouse pointer if its running in a window.  A custom mouse pointer looks 'odd' while the game is paused. <br><br></td></tr></table><br>
<a name="741919"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well requiring the user to unpause the game is a clever idea and all, and maybe it's a perfectly fine solution, but I'd still like to know if this is only an issue in debug mode and if not, how you're expected to determine the window doesn't have focus. <br><br></td></tr></table><br>
<a name="741924"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does my code (3rd post) do what you need? <br><br></td></tr></table><br>
<a name="741938"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I assume so, but it is Windows specific, so not suitable for my needs. <br><br></td></tr></table><br>
<a name="742004"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> sswift: just use AppSuspend and AppResume Events like Flameduck says.  My framework does this.  Basically if you are playing in windowed mode and click the desktop or alt tab to another app it pasues and stops music, then a click back in the window unpasues, simple. <br><br></td></tr></table><br>
<a name="742064"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Grey:<br>Yes, but if you read my post, then you'd see that those events don't work right in debug mode.  I haven't tested yet to see if they work the way you say they do normally, but there's still the unexplained debug mode behavior. <br><br></td></tr></table><br>
<a name="742120"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> They work find in debug mode here...<br><br><img src="http://www.greyaliengames.com/misc/paused.jpg"><br><br>However, just noticed I have this code as well:<br><br><pre class=code>
		'Sometimes APPRESUME doesn't work so make a windows call.
		?Win32
		If Suspended = 1 And SuspendedEvent=1 And GetForegroundWindow()=WindowHandle Then SuspendedEvent = 0
		?
</pre><br><br>This is like a manual APP_RESUME event. <br><br></td></tr></table><br>
<a name="742124"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sure you don't have some kind of totally outdated BM version which might have this problem? (or some kind of DLL Module that uses callbacks / threading to catch events?)<br><br>The only other thing I know which can and tends to create problems is crap like WindowBlinds which interfers in many spots. <br><br></td></tr></table><br>
<a name="742361"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have nothing screwy like that installed, and my version of BM is up to date.<br><br>Grey:<br>Have you tried printing the events to the debug window as they occur?  I'd like to see what events you get when you run the game in debug, click another window, then click the game window again.<br><br>It's possible that it is the printing to the debug window which is causing the issue. <br><br></td></tr></table><br>
<a name="742366"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Could this possibly be the cause of my problems?  And if so,  what would be the sugested alternative method?<br><br><br><pre class=code>
	AddHook EmitEventHook, MyHook	
		
	Function MyHook:Object(iId:Int, tData:Object, tContext:Object)
	
 		Local Event:TEvent=TEvent(tData)
		
		If App.Canvas &lt;&gt; Null
			If (Event.Source = App.Canvas) And (Event.ID = EVENT_GADGETPAINT)
				Flip		
				Return Null
			EndIf	
		EndIf

		Return tData
		
	End Function
</pre> <br><br></td></tr></table><br>
<a name="742369"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay I did some testing in non-debug mode, and I get the same results.<br><br>When I run the game, and I click the explorer window, I get:<br>APPSUSPEND<br>APPRESUME<br>WINDOW ACTIVATE<br><br>When I click the game again, the game resumes, but as far as events go, I get nothing, because as far as the window is concenred it is still active apparently.<br><br>I suspect this has something to do with my canvas being redrawn, but I don't know how or why, or what to do to fix it. <br><br></td></tr></table><br>
<a name="742370"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, I removed the hook, but the only difference now in debug mode is that when I click the window after it has gone out of focus I do get a single gadgetpaint event. <br><br></td></tr></table><br>
<a name="742403"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Above shouldn't make a  problem.<br>Are there any other event hooks you have which return NULL instead of tData and thus cause problems? <br><br></td></tr></table><br>
<a name="742407"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> No. <br><br></td></tr></table><br>
<a name="742932"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> I found out what was causing the issue.  It was a line of code I had which would activate my canvas each frame.  <br><br>I did that because I wanted to use polled input while in a window, and if the canvas lost focus because the user activated the window menu or something then they wouldn't be able to control the game anymore.  <br><br>Why use polled input?  Cause it's easier to code.  I'd just have to recode all the polled input functions myself otherwise.  There's no other good way to do it.<br><br>Anyway, I solved the issue by using a function I was going to code myself until I typed in the name and found it already exists.  AppSuspended().  So when AppSuspended() is true, I simply don't activate the canvas.  Or call any of the game update code.  I also pause my music channel.  <br><br>Pausing the channels for all the other sounds that are playing though is gonna be a bit difficult since I don't keep track of every channel currently playing. <br><br></td></tr></table><br>
<a name="743150"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry I was away, doesn't sound like I'd have helped though.<br><br>Make a channel array and pause them. (I know you know this!)<br><br>I don't use polledinput, it's off in my framework, works well. <br><br></td></tr></table><br>
<a name="743196"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you don't use polled input then you have to keep track of all the keys and mouse buttons and whether they're being held down, or were clicked since the last time you checked...  What a pain!<br><br>As for a channel array, don't be silly.  What you need is a channel linked list!  One link for each sound you play.  <br><br>But then you have to keep track of when the sounds end and update the thing so you can free the channel pointers.  That's what's a pain.  Have to write a whole type for that.<br><br>I'm not doing that right now in my code.  I just store a channel pointer for the music.  The other stuff just gets played one shot, and I don't keep the pointer.  If I wanted to support looped sounds though, that I could stop or pause, then I'd definitely need to keep track of those channel pointers. <br><br></td></tr></table><br>
<a name="743218"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> You are aware that this "keep track of" is exactly what BM internally does as well ^^ So you could just copy that if you really need it ;-)<br><br>And I wouldn't use a channel linked list but a TMAP, so you can search for them by key (name, filename, reference - depends on yuor needs) but iterate through them as a list for pause / cleanup. <br><br></td></tr></table><br>
<a name="743247"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> re: keep track of keys, I just overode the BlitzMAx commands for my own input :-) (like Dreamora suggests, I think)<br><br>[quote]As for a channel array, don't be silly. What you need is a channel linked list! One link for each sound you play. <br><br>But then you have to keep track of when the sounds end and update the thing so you can free the channel pointers. That's what's a pain. Have to write a whole type for that.<br>[quote]hehe, sounds like you talked yourself out of using a list.  Channel arrays have some advantages a) you can make a max number of channels thus limit the max noise b) you can assign on channel for a certain sound that you don't want to have multiple occurences of, c) you can have channels that be freely used by any sound d) you don't need to track when they stop playing, you can just iterate throught the channels and test ChannelPlaying e) easy to iterate through and dim the volume on them each frame during fades etc. <br><br></td></tr></table><br>
<a name="743308"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> Grey:<br>Well maybe if it had more than eight channels or something like Blitz3D had, it would be okay.  But that method was really a pain in Blitz3D because you'd have some sounds that trigger continuously and which you want to be overridden if another sound needs to be played, and other sounds which you don't want to ever be overridden if they're playing, and which you don't want to be ignored if all channels are full and playing.  In the Lego Builder bots game I had to have a priority set for every sound and a complicated bit of code to decide what to do when different combinations of looped or unlooped and different priorities were played, just so that the most important sounds wouldn't get cut off.<br><br>I like the linked list thing because it means I don't have to worry about any of that.<br><br>Dreamora says that Blitzmax keeps a list of channels internally so I'll lokk for that I guess. <br><br>As for using a tmap, with the small number of channels you have, you're not gonna get a big speed savings by using a binary tree to store the channels in order of channel name or pointer.  I don't even do that in my sprite system.  It's just not a bottleneck in most realistic scenarios. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
