<!DOCTYPE html><html lang="en" ><head ><title >ICO file format</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >ICO file format</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >ICO file format</a><br><br>
<a name="846772"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm trying to find the ICO file format specification, but all I can find is information on the header and a lot of information of the new PNG-based ico files for vista, wich are not compatible with XP. <br>Does anybody have the Windows XP 32-bits per pixel uncompressed file format specs for an ICO file? I have all the pix.map releated data and I want to output this data in a simple single size ICO file. <br><br></td></tr></table><br>
<a name="846778"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.wotsit.org/list.asp?fc=1" target="_blank">http://www.wotsit.org/list.asp?fc=1</a> <br><br></td></tr></table><br>
<a name="846786"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks brucey, but this only has information for win95-98 ico files (up to 256 colors). I need the XP format that supports 32 bits colors with alpha channel but without compression (I've already have the compressed format, but it is only compatible with Vista). <br><br></td></tr></table><br>
<a name="846806"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kev</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> this any use?<br><br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=1358" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=1358</a><br><br>*EDIT just noticed you want 32 bit, the archives example is still only 4,16,24-bit. <br><br></td></tr></table><br>
<a name="846810"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bremer</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is this useful?<br><br><a href="http://en.wikipedia.org/wiki/ICO_(icon_image_file_format)" target="_blank">http://en.wikipedia.org/wiki/ICO_(icon_image_file_format)</a> <br><br></td></tr></table><br>
<a name="846885"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ked</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I use MSDN for this kind of stuff.<br><br><a href="http://msdn2.microsoft.com/en-us/library/ms997538.aspx" target="_blank">http://msdn2.microsoft.com/en-us/library/ms997538.aspx</a> <br><br></td></tr></table><br>
<a name="846947"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not really an .ICO, but still: Windows also supports BMP bitmap images as icons... Meaning that you can take a bitmap picture, rename it as .ICO, and use it as any other icon.<br><br>Of course that way you won't be able to store multiple dimensions inside a single file, but it can be used as an icon... <br><br></td></tr></table><br>
<a name="846949"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> @zawran: I've already have this information. It talks about the ICO header, the image indexing (that's working well), but when it is time to store the bitmap data, there's no info apart from the new Vista PNG compressed format. In fact, this article was my staring point.<br><br>@Ked: Thanks, but this article only covers 256 colors icons.<br><br>That's the problem I'm having. There's a lot of information about 256 icons, a lot of information about png-based icons, but no real information about 32 bits uncompressed icons with alpha channel for XP. <br><br></td></tr></table><br>
<a name="846958"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Back again...<br><br><a href="http://msdn2.microsoft.com/en-us/library/ms997636.aspx" target="_blank">http://msdn2.microsoft.com/en-us/library/ms997636.aspx</a><br><br>Seems like it's a simple RGB format? <br><br></td></tr></table><br>
<a name="846961"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, thats for 24 bits, but somehow it is creating the alpha channel (on shadows). This is very usefull, thanks Brucey. I'll take a look to see how the alpha channel is included in this 24 bit images, I think it is stored as a separate layer. I think that with all this information, the best I can do is to make a XP icon loader so see exactly how layers are stored there, then I can make the reverse operation. Anyway if any of you have more information on how the 2 layers are stored in a ICO, please let me know it.<br>in the msnd documentation:<div class="quote"> 24-bit color with an 8-bit alpha channel (32-bit total) <br></div><br>that means that I have to store pixels on RGB format, and then a byte bank with all the alpha values? <br><br>thanks <br><br></td></tr></table><br>
<a name="846963"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> The article does talk about 32 bits, where it mentions the 24 + 8 bits alpha to make 32. <br><br></td></tr></table><br>
<a name="846965"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes I see.. great, I supose the alpha layer is stored separately somehow. I'll take a deeper look, but I'm starting to see the light! :D <br><br></td></tr></table><br>
<a name="846969"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I see what you mean... it's a bit vague whether you should use RGBA or RGB+A (separate block of data for alpha).<br><br>Perhaps a look at something like the FreeImage source will give you a better idea? <br><br></td></tr></table><br>
<a name="846975"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> As soon as I get the exact format, I'll post it here :D <br><br></td></tr></table><br>
<a name="846991"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Been doing some little test. The Pixmap data of a 64x64 32 bits ico is 16936 bytes, but 64x64x4 = 16384, so we have 552 bytes of undocumented data. Any idea?<br><br>[EDIT]<br>Just a curious thing: could it be possible to have a DIB header(40 bytes) and a 1 bit per pixel bitmap for masking? That would do:<br><br>40 (DIB header) + (64x64)/8 = 552<br><br>Any ideas? <br><br></td></tr></table><br>
<a name="847027"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting snippet from freeimage :<br><pre class=code>
			if(FreeImage_IsTransparent(dib)) {

				if(bit_count == 32) {
					// create the AND mask from the alpha channel

					int width_and  = WidthBytes(width);
					BYTE *and_bits = and_mask;

					// clear the mask
					memset(and_mask, 0, size_and);

					for(int y = 0; y &lt; height; y++) {
						RGBQUAD *bits = (RGBQUAD*)FreeImage_GetScanLine(dib, y);

						for(int x = 0; x &lt; width; x++) {
							if(bits[x].rgbReserved != 0xFF) {
								// set any transparent color to full transparency
								and_bits[x &gt;&gt; 3] |= (0x80 &gt;&gt; (x &amp; 0x7)); 
							}
						}

						and_bits += width_and;
					}
				} 
</pre><br><br>PluginICO.cpp from FreeImage probably has all you need to understand how all the icon headers work etc. <br><br></td></tr></table><br>
<a name="847068"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, I see it has a 1 bit mask and it is RGB. I'll take a deeper look. thanks! <br><br></td></tr></table><br>
<a name="847245"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Snarkbait</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> does this help at all?<br><br><a href="http://www.codeproject.com/KB/cs/IconLib.aspx" target="_blank">http://www.codeproject.com/KB/cs/IconLib.aspx</a> <br><br></td></tr></table><br>
<a name="847259"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, thanks! <br><br></td></tr></table><br>
<a name="847533"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2008)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is very strange. I've got it working now:<br><br>ICO header:<br>2 	reserved. should always be 0<br>2 	type. 1 for icon (.ICO), 2 for cursor (.CUR) file<br>2 	count; number of images in the file<br><br>'DIRECTORY:<br>1 	width, should be 0 if 256 pixels<br>1 	height, should be 0 if 256 pixels<br>1 	colour count, should be 0 if more than 256 colours<br>1 	reserved, should be 0 <br>2 	colour planes, should be 0 or 1<br>2 	bits per pixel (should be 32)<br>4 	size in bytes of the bitmap data<br>4 	offset, bitmap data address in the file<br><br>'THEN ICO DATA HEADER:<br>4       HEADER SIZE<br>4       PIXMAP WIDTH<br>4       Pixmap Height<br>2       Color planes (must be 1)<br>2 	the number of bits per pixel, which is the color depth of the image. Typical values are 1, 4, 8, 16, 24 and 32.<br>4 	the compression method being used. (0-uncompressed)<br>4 	the image size. This is the size of the raw bitmap data . should not be confused with the file size.<br> 4 	the horizontal resolution of the image. (pixel per meter, signed integer, usually 2835)<br> 4 	the vertical resolution of the image. (pixel per meter, signed integer, usually 2835)<br>4 	the number of colors in the color palette, or 0 to default to 24 or 32 bits.<br>4 	the number of important colors used, or 0 when every color is important; generally ignored.<br><br>RAW DATA:<br>The raw data is a long list of pixles (stored from 0,Height to width,0) in format BGRA<br>After this RAW data, a 1-bit bitmap is also RAW saved. If you save it as a back of bytes with the value 0, it will get the Alpha channel instead.<br><br>Hope it help if anybody else is interested.<br>Thanks to everyone.<br><br>That works! (The mumber before every field is to inform about the bytes of the data, 1=Byte, 2=16bits int, 4=32bits int, etc.) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
