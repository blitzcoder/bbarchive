<!DOCTYPE html><html lang="en" ><head ><title >So many different timing methods; which to use?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >So many different timing methods; which to use?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >So many different timing methods; which to use?</a><br><br>
<a name="1054331"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Amon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> There's so many timing methods which all look different I have no idea which one to use.<br><br>For startes can anybody make a module with the best one that can be used easily? I'm useless at this timing stuff probably because I've never bothered to look in to it and I don't have time to learn about it all.<br><br>So are there any takers on making one a module? <br><br></td></tr></table><br>
<a name="1054340"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >okee</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> i'd like to +1 that <br><br></td></tr></table><br>
<a name="1054346"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> GAs framework has one. Not sure if its part of the shareware bit or the commercial bit tho <br><br></td></tr></table><br>
<a name="1054348"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> TimelineFX is a particle effects module but also comes with a Tweening module that the guy created too. You can download it and just use the Tweening module for your timing - thought you could use both, as the effects are pretty cool tool.<br><br><a href="http://www.rigzsoft.co.uk/index.php?option=com_content&amp;view=article&amp;id=44&amp;Itemid=25" target="_blank">http://www.rigzsoft.co.uk/index.php?option=com_content&amp;view=article&amp;id=44&amp;Itemid=25</a> <br><br></td></tr></table><br>
<a name="1054357"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EOF</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I use this method although I am not sure where I got it from now. It's nothing too fancy making it easy enough to follow. The Update() function contains its own variables which makes dropping it into other projects a doddle<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">

	Function Update(Rate%=12)
		Global timeelapsed:Int
		' simple update limiter
		If MilliSecs()&lt;timeelapsed+Rate Then Return
		timeelapsed=MilliSecs()
		'
		' **** Do all updating here (player/enemy movements)
		'
	End Function


	Function Render()
		Global oldTime%,frameCount%,FPS%
		'
		' **** Do the rendering here
		'
		' FPS monitor
		If MilliSecs()&gt;oldTime
		   oldTime=MilliSecs()+1000
		   FPS=frameCount ; frameCount=0
		Else
		   frameCount:+1
		EndIf
		'
		Flip
	End Function
</textarea> <br><br></td></tr></table><br>
<a name="1054376"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >popcade</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Frame limiting is the easiest method, which should work on most fast-enough PCs.<br><br>However if you have to do network-related programming, it'll cause lots of issues, maybe try delta-timing or others instead. <br><br></td></tr></table><br>
<a name="1054379"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here's another simple method I used for my last 2 minigames:<br><br><pre class=code>
Local gameTimer:TTimer = CreateTimer(60)

While Not (KeyHit(KEY_X) And (KeyDown(KEY_LCONTROL) Or KeyDown(KEY_RCONTROL)))	 
	If game.Logic() Then Finish()
	game.Draw()
	WaitTimer (gameTimer)
	Flip 0
	Delay(1) 'Give system time to catch up on things.
Wend
Finish()

Function Finish()
        'Perform any clean up here.
	End 'Exit the program
End Function
</pre><br><br>This will run a game at 60FPS, one logic per draw (so you can move things by 1 pixel a frame for example).  It doesn't work that well with Flip 1 (vsync) though because there no guarantee the timer will stay in sync with the vsync.  There's no delta timing so if the code got too slow it would just drop frames. <br><br></td></tr></table><br>
<a name="1054380"></a>

<a name="1054381"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Jim Brown: What does the main loop look like that calls your two functions?  Does it just call update then draw?  If so, and Flip 1 (vysnc) was used instead of Flip (default is -1), then the Rate param won't make much difference as the game will be locked to 60FPS.  Same problem exists for mine if I use Flip 1 no matter what rate I set the timer at.  The trick to getting faster or slower Updates than 60FPS with VSync on is to loop the updates until they are all done and then call draw only once - that's the Fixed Rate Logic approach.  Of course Fixed Rate Logic falls down if the code becomes too slow, it can never keep up with what it supposed to be doing, and that's where Delta Time comes into it's own.<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1054383"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >EOF</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Jake,<br><br>The main game loop is a simple:<br><pre class=code>
Repeat
    Update ; Render
Until somestate
</pre><br>Flip is done in the Render() function (using default parameter)<br><br>I am not sure if what I am using is good implementation but I went for the easiest and least complex solution at the time. I can set the 'Rate' in the Update() function which changes how fast the games 'action' takes place <br><br></td></tr></table><br>
<a name="1054397"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I use a slightly modified version of this: <br><a href="/codearcs.php?code=155" target="_blank">Here</a><br>It's always worked well for me.  <br>Remember to always cap the tween value though. <br><br></td></tr></table><br>
<a name="1054422"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm just curious, but what you specifically mean by "timing stuff"? Intended use cases?<br><br>Do you mean stuff like: Stopwatch, CountDown timer, cooldown remaining timer, Date Comparison, FPS counter, Tweening, get timestamps, get timeSince timestamp, Delta time, slowmotion effect, profiling timer or perhaps a windows-based precision-timer in micro/nanosec? <br><br></td></tr></table><br>
<a name="1054423"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I'm just curious, but what you specifically mean by "timing stuff"? <br></div><br>He means making your game run at the same speed on all machines as consistently and nicely as possible, with all the associated factors. <br><br></td></tr></table><br>
<a name="1054426"></a>

<a name="1054427"></a>

<a name="1054428"></a>

<a name="1054429"></a>

<a name="1054430"></a>

<a name="1054431"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why use only one? you have to deal with the fact that some machines will try to run the game faster than it's meant to run, whilst others will run it slower. <br><br>We have frame-limitting for the former case. <br>We have frame-skipping*, tweening or delta-timing for the latter.<br><br>*I'm not absolutely sure about what this is, but I remember some game emulators having this feature. I guess it's a somewhat crude way to make the game run faster, by disregarding some frames (using a Continue to skip to the next logic iteration).<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1054433"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Kryzon: A simple timing system is just to get your game running the same on most computers (an includes frame-limiting), a better one would take into account both the cases you mentioned, although frame-skipping is only really needed for CPU/GPU heavy games - many games simply won't need it unless. <br><br></td></tr></table><br>
<a name="1054439"></a>

<a name="1054440"></a>

<a name="1054441"></a>

<a name="1054442"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dmaz</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> here's mine with example... (I have it as a mod as well) I used this in Rocks, invaders from space and others... <br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">SuperStrict

Framework brl.D3D7Max2D
Import BRL.Random


Graphics 640,480

Local vwait:Int
Local rate:Int = 20
Local stage:TRL = New TRL
stage.SetFrameRate(rate)	' game login updates per second
stage.ResetCounters		' now, choose a frame at the start of your project and keep that one.
				' 30 or 60 are the best.... for a game with a whole lot of ai I'd go 30.
				' my games run at 60 though and do fine even on the slowest of machines.

SetBlend ALPHABLEND
' don't put too much in this main loop, all objects should be updated in the GameUpdate callback.
While Not KeyHit(KEY_ESCAPE) Or AppTerminate()
	If KeyHit(KEY_UP) Then rate :+ 1 ; stage.SetFrameRate(rate)
	If KeyHit(KEY_DOWN) Then rate :- 1 ; stage.SetFrameRate(rate)
	If KeyHit(KEY_V) Then vwait = 1-vwait


	' 2 functions will be called back to, one that capture the old position
	' and one that performs the game update logic.
	Local tween:Double = stage.Update( TObject.CaptureAll, GameUpdate )	
	
	' draw all object with a tween value
	TObject.DrawAll tween
	

	SetAlpha 1
	DrawText "balls: "+TObject.total,10,10
	DrawText "  fps: "+stage.GetFPS(),10,20
	DrawText "  ups: "+stage.GetUPS()+" [up/down]",10,30
	DrawText "vwait: "+vwait+" [v]",10,40
	Flip vwait
	Cls
Wend

' this will be updated at the framerate set by SetFrameRate
' pass it as a callback function pointer to obj:TRL.Update
Function GameUpdate()
	
	If TObject.total &lt; 100 Then New TObject
	TObject.UpdateAll

End Function

' your object(s)
Type TObject
	Const GRAVITY:Float = 0.2
	Const FRICTION:Float = 0.99
	
	Global list:TList = New TList
	Global total:Int
	
	Field link:TLink
	Field x:Float, ox:Float
	Field y:Float, oy:Float
	Field xvel:Float
	Field yvel:Float
	Field alpha:Float = 1		' I could tween things like alpha, size, rotataion and so on if needed.
	
	' this is a callback, make sure you pass it to obj:TRL.Update
	Function CaptureAll()
		For Local o:TObject = EachIn list
			o.Capture
		Next
	End Function
	
	' this of course is called by your GameUpdate function that is passed to obj:TRL.Update
	Function UpdateAll()
		For Local o:TObject = EachIn list
			o.Update
		Next
	End Function
	
	Function DrawAll( tween:Double )
		For Local o:TObject = EachIn list
			o.Draw tween
		Next
	End Function

	' ---------------------------------------------------------------------
	Method New()
		link = list.AddLast(Self)
		x = GraphicsWidth()/2
		y = 20
		xvel = Rnd(-8,8)
		Capture
		total :+ 1
	End Method

	Method remove()
		total :- 1
		link.Remove
	End Method

	' ---------------------------------------------------------------------

	' capture (record current value before update) whatever values you want to
	' tween.  generally x and y but you could do alpha, size, rotation.... and more
	Method Capture()
		ox = x
		oy = y		
	End Method
	
	' this update routine gets called a fixed number per second...  I like this
	' over delta time because you don't have to add weird numbers to all of your
	' values.
	Method Update()
		yvel :+ GRAVITY
		xvel :* FRICTION
		yvel :* FRICTION
		
		x :+ xvel
		y :+ yvel

		If x &lt; 0 Or x &gt; GraphicsWidth() Then xvel = -xvel ; x :+ xvel
		If y &lt; 0 Or y &gt; GraphicsHeight() Then yvel = -yvel ; y :+ yvel
		
		alpha :- .005
		If alpha &lt; 0 Then Remove
	End Method

	' render all tweened values.
	Method Draw( tween:Double )
		SetAlpha alpha
		DrawOval GetTween(ox,x,tween),GetTween(oy,y,tween),10,10
	End Method

	' ---------------------------------------------------------------------
	Method GetTween:Double( oldValue:Double, value:Double, tween:Double )
		Return oldValue + (value-oldValue)*tween 
	End Method

End Type


' end of example program

' I will turn this into a module and post it in the code archives.
Type TRL
	Field gameFPS			:Double	= 60.0:Double
	Field framePeriod		:Double	= 1000.0:Double / gameFPS
	Field frameTime		:Double	= MilliSecs() - framePeriod

	Field gamelogicframes	:Int
	
	Rem
	bbdoc:
	about:
	end rem
	Method Update:Double( captureCallback(), updateCallback() )
		Global frameElapsed:Double
		
		Repeat
			frameElapsed = MilliSecs() - frameTime
		Until frameElapsed
		Local frameTicks:Int = frameElapsed / framePeriod
		Local frameTween:Double = Double(frameElapsed Mod framePeriod) / framePeriod

		' update game and world state
		For Local frameLimit:Int = 1 To frameTicks
			If frameLimit = frameTicks
				captureCallback()
			End If
			frameTime = frameTime + framePeriod
		
			updateCallback()
			gamelogicframes = GetGameLogicFrames()
		Next

		Return frameTween
	End Method


	Rem
	bbdoc:
	end rem
	Method SetFrameRate( gameFPS:Double )
		Self.gameFPS = gameFPS
		framePeriod = 1000.0:Double / Self.gameFPS
	End Method 


	
	Rem
	bbdoc:
	end rem
	Method GetUPS:Int()
		Return gamelogicframes
	End Method


	Rem
	bbdoc:
	end rem
	Method GetFPS:Int()
		Global counter:Int
		Global time:Int
		Global framerate:Int
	
	    counter=counter+1
	    If time=0 Then time=MilliSecs()
	    If time+1001&lt;MilliSecs() Then
	        framerate=counter
	           counter=0
	        time=MilliSecs()
	        EndIf
	       
		Return framerate
	End Method 
	

	Rem
	bbdoc:
	end rem
	Method GetGameLogicFrames:Int()
		Global counter:Int
		Global time:Int
		Global framerate:Int
	
	    counter=counter+1
	    If time=0 Then time=MilliSecs()
	    If time+1001&lt;MilliSecs() Then
	        framerate=counter
	           counter=0
	        time=MilliSecs()
	        EndIf
	       
		Return framerate
	End Method 	


	Rem
	bbdoc:
	end rem
	Method ResetCounters()
		framePeriod	= 1000 / gameFPS
		frameTime	= MilliSecs() - framePeriod
	End Method



End Type

</textarea><br><br><font class="tiny">Last edited 2010</font><br><br><font class="tiny">Last edited 2010</font><br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1054466"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is my tipple...<br><a href="http://blitzbasic.com/codearcs/codearcs.php?code=2039" target="_blank">http://blitzbasic.com/codearcs/codearcs.php?code=2039</a> <br><br></td></tr></table><br>
<a name="1054470"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Amon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> @dmaz<br><br>Is the mod available? If not may I have it, please? <br><br></td></tr></table><br>
<a name="1054524"></a>

<a name="1054543"></a>

<a name="1054545"></a>

<a name="1054546"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dmaz</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> sure, I'll get it up in a couple hours...<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1054547"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dmaz</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> here's the mod, fully documented with an example in help.<br><a href="http://www.ooeyug.com/files/dmaz.mod.zip" target="_blank">http://www.ooeyug.com/files/dmaz.mod.zip</a><br><br>make sure you rebuild documentation. <br><br></td></tr></table><br>
<a name="1054801"></a>

<a name="1054802"></a>

<a name="1054806"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Amon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice one man, thanks! :)<br><br><font class="tiny">Last edited 2010</font><br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1054917"></a>

<a name="1054999"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Amon</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have tried modifying the template TObject but I'm getting problems. First I got a StackOverflow then it complained about the Drawimage command in the Draw Method!<br><br>Can someone help fix this so I can see how all this will fit together nicely?<br><br>Oh I've added comments etc to each in the hope I'd understand it better.<br><br>[EDIT] ISSUE FIXED. I was doing something majorly wrong with TLinks.<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
