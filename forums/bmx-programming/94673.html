<!DOCTYPE html><html lang="en" ><head ><title >Transparent Image drawing masks ????</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Transparent Image drawing masks ????</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Transparent Image drawing masks ????</a><br><br>
<a name="1086912"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul "Taiphoz"</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> this is hard to explain without code .. but I will try.<br><br>I have three images, layers, I then draw a blast hole (black) over the first layer which is the mask colour so layer 2 is then visible through layer 1, I then repeat the above on layer 2 but shrinking the blastimage a little to give a 3D effect.<br><br>Trouble is that when I draw more than one or when I happen to have an image thats colour is the same as the mask it gets all messed up.<br><br>is there a way for me to draw my blast hole image as transparent so that I dont need to worry about maskcolors. ? <br><br></td></tr></table><br>
<a name="1086913"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >kfprimm</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Save your images in a format (such as PNG) that supports an alpha channel so you can have transparency. Then it's just as simple as having your blend mode set to ALPHABLEND, I believe. <br><br></td></tr></table><br>
<a name="1086919"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul "Taiphoz"</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> they are png's <br><br></td></tr></table><br>
<a name="1086920"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul "Taiphoz"</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> is there a faster way to do this ?<br><br><pre class=code>
	DrawImage DesktopImage , 0 , 0
	DrawImage Blast1 , hx , hy , 0
	GrabImage (DesktopImage,0,0)
</pre><br><br>because that's slow as hell and as soon as I call it a few times it's really laggin the code. <br><br></td></tr></table><br>
<a name="1086923"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Unless you use opengl directly I don't think it's possible to do this on the fly. If it is I'd love to know how. <br><br></td></tr></table><br>
<a name="1086929"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul "Taiphoz"</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm doing this once every second , if I up the rate to 2 seconds then I could get away with it as is but I want it faster.<br><br>I find it really odd that blitz3d can do this really fast and max can't there must be some code to do it faster <br><br></td></tr></table><br>
<a name="1086930"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> SetBlend SHADEBLEND<br><br>you will need another layer, a mask layer, which is two colors: black and white. white is the circle (pixels) you want to keep, everythign else is black<br><br>draw from back to front, using the black&amp;white layer inbetween and the final top layer. <br><br></td></tr></table><br>
<a name="1086935"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sounds like a worms game is in the works? <br><br></td></tr></table><br>
<a name="1086937"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is this fast enough to do several dozen times a frame? <br><br></td></tr></table><br>
<a name="1087003"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> It sounds like you want RGBA textures and to then draw the blast circles to the alpha channel of those textures. <br><br></td></tr></table><br>
<a name="1087007"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul "Taiphoz"</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Imaginary yeah that sounds about right got any code for that ?<br><br>I am actually working on a screen saver, the code grabs a screen shot of your current windows desktop, and stores it as an image, I then have two other images, one that looks like a computer circuit board and a third is a hummour picture.<br><br>the bombs fall, land and start to tick, when they blow up , I am drawing a big blast on the desktop image, a smaller blast on the circuit image which over time reveals whats on the funny image.<br><br>it's kinda working at the moment, but as I said in the OP, grabimage is way to slow.<br><br>As for worms, I actually got the idea while looking at my old worms clone game that I wrote in blitz2d so im stunned that blitzmax cant actually do this faster.<br><br>any help code wise would be much appreciated. <br><br></td></tr></table><br>
<a name="1087093"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Harder to change textures, better with pixmaps.<br><br>There's a trick to this, I need to sit and experiment. OpenGL register combiners may work for this.<br><br>There is a simple solution somewhere... <br><br></td></tr></table><br>
<a name="1087218"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> AdamRedwoods, I can't get this to work<br><br><div class="quote"> SetBlend SHADEBLEND<br><br>you will need another layer, a mask layer, which is two colors: black and white. white is the circle (pixels) you want to keep, everythign else is black<br><br>draw from back to front, using the black&amp;white layer inbetween and the final top layer.  <br></div><br><br>The first can't be shadeblend or it's all black. The mask is a white square with a black circle. I can get grass with a black circle but I can't get the sand to fill in the black circle.<br><br><pre class=code>SetBlend ALPHABLEND
DrawImage grass, 0, 0
SetBlend SHADEBLEND
DrawImage mask, 0, 0
SetBlend SHADEBLEND
DrawImage sand, 0, 0</pre> <br><br></td></tr></table><br>
<a name="1087236"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Paul "Taiphoz"</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I might just fake it and just draw hole sprites store them in. A list. But it won't be as good <br><br></td></tr></table><br>
<a name="1087280"></a>

<a name="1087281"></a>

<a name="1087282"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi, I had to sit and think about this one. I'm not sure why this has to be so difficult with OpenGL, but it is.<br><br>Anyways:<br><br><pre class=code>
'' alpha masking example
'' adamredwoods, 2011
''
SetGraphicsDriver (GLMax2DDriver(),GRAPHICS_BACKBUFFER|GRAPHICS_STENCILBUFFER|GRAPHICS_ALPHABUFFER)
Graphics 900,600,0,60


Local imagedesktop:TImage = LoadImage("desktop.jpg")
Local image2:TImage = LoadImage("kitten-1.jpg")

Local maskwidth:Int=90, maskheight:Int=90
SetMaskColor( 0,0,0 )
Local maskimage:TImage = CreateImage(maskwidth,maskheight,1,MASKEDIMAGE)
'Local maskimage:TImage = LoadImage("white_circle_alpha.png")

SetBlend ALPHABLEND
SetClsColor 0,0,0
Cls
SetColor 255,255,255
DrawOval 10,10,80,80
GrabImage maskimage,0,0 ''if you load an image or draw an oval (below), disable this

SetColor 255,255,255 ''reset the color for drawimage


glEnable (GL_STENCIL_TEST)
glDepthMask(GL_FALSE)
glStencilMask($ffffff)
SetBlend solidblend

Local x:Int, y:Int

While Not AppTerminate() And Not KeyDown(KEY_ESCAPE)
	Cls
	glClearStencil(0)
	glClear(GL_STENCIL_BUFFER_BIT) 
	glDisable (GL_STENCIL_TEST)


	DrawImage imagedesktop,0,0
	
	x = MouseX()-maskwidth*0.5
	y = MouseY()-maskheight*0.5
	If x+maskwidth&gt;image2.width Then x = image2.width-maskwidth
	If y+maskheight&gt;image2.height Then y = image2.height-maskheight
	
	''set mask
	glEnable (GL_ALPHA_TEST)
	glEnable (GL_STENCIL_TEST)
	glStencilOp(GL_REPLACE, GL_REPLACE, GL_REPLACE)
	glStencilFunc (GL_ALWAYS, $ffffff,$ffffff)
	
	DrawImage maskimage,x,y
	'DrawPixmap LockImage(maskimage),x,y
	'DrawOval x,y,30,30

	''draw the revealed image
	glStencilOp(GL_KEEP, GL_KEEP, GL_KEEP)
	glStencilFunc (GL_EQUAL, $ffffff,$ffffff)
	glDisable (GL_ALPHA_TEST)

	DrawImage image2,0,0

	Flip
Wend

End

</pre><br><br>The negative side of this is that it does NOT draw nice feathered edges, even when loading a nice PNG image. This is because (as far as I understand) the stencil buffer rejects or draws the fragment.... so there's no inbetween.<br><br>The only other solution I can think of is to use register combiners and textures.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1087294"></a>

<a name="1087295"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Czar Flavius also has a similar solution <a href="/posts.php?topic=94692" target="_blank"><b>here</b></a><br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
