<!DOCTYPE html><html lang="en" ><head ><title >UTF-8</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >UTF-8</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >UTF-8</a><br><br>
<a name="775389"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hiya, just tried loading in a Russian localised file in UTF-8 file and my word wrapping code crashes.  Probably this is because Space and Carriage Return (CR) are not 32 and 13.  Anyone know what they are in UTF please?<br><br>Oh and what about Line Feed (LF) which is normally 10.  Thanks! <br><br></td></tr></table><br>
<a name="775392"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm sure that only ascii chars higher than 127 are different.<br><br>Its been ages since I did anything like this, but when I did the Polish version of Double Top I had all sorts of bother.  I recall having to find CE (central european) versions of the fonts I used.<br><br>Rather you than me. <br><br></td></tr></table><br>
<a name="775393"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think they are 10 + 13 or 13 + 10 depending on the platform. <br><br></td></tr></table><br>
<a name="775405"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, if they are the same then there must be a problem with my code, wonder what it is? ...<br><br>It's weird because with a file saved as txt it word wraps, but with UTF-8 the word wrapped text array is empty because it's failing to wrap it.  So what's so badly different between the file formats that causes the error I wonder? <br><br></td></tr></table><br>
<a name="775423"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> It can be the byte order mark that is confusing you program? <br><br></td></tr></table><br>
<a name="775576"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> What's that?  Better wiki it... <br><br></td></tr></table><br>
<a name="775579"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> The byte order mark is usually a 2 bytes mark that indicates if the file is stored in big endian or little endian. In case of UTF-8 it should be little endian. I think it was something like FE and FF, but if you take a look to the loadtext function of blitzmax, you'll see the exact byte order signature. <br><br></td></tr></table><br>
<a name="775598"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah, and that's at the start is it?  Maybe I should view the file with a hex editor...Hmm, seems the start of the file is EF BB BF.  That may be the problem, I'll check it out. Thanks. <br><br></td></tr></table><br>
<a name="775603"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why can't you load the file with TextStream? It checks the BOM and interprets the loading based on that... <br><br></td></tr></table><br>
<a name="775605"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Text Stream reads the byte order marks as characters. I would recomend using LoadText, or using a function derived from LoadText. There's no encoding detector text stream in BlitzMax (As far as I know) <br><br></td></tr></table><br>
<a name="775624"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> LoadText is the one! Thanks ziggy and thanks Brucy for the advice.  So I should read the manual a bit more! <br><br></td></tr></table><br>
<a name="775629"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK so LoadText reads the whole file into a giant string.  How practical is that for big files?<br><br>Also is there a quick way for splitting it into lines (stored in an array) based on CR LF?  Or do I have write some code to chop it up?  I'll write some code anyway... <br><br></td></tr></table><br>
<a name="775636"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hey, LoadText is internally using a Stream, but it makes the byte order check. Open the LoadText source code and in a few minutes you'll have a working text stream with encoding recognition. I've done mine, but I can't send it to you becouse I'm not at the office now. <br><br></td></tr></table><br>
<a name="775637"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> This seems to work:<br><br><pre class=code>
Strict

Graphics 800,600,0

Global Font:TImageFont = LoadImageFont("arial.ttf", 20)

Local File:TStream = OpenFile("Russian.txt") 'in UTF-8 format

Global TestText $ = ""

If File Then
	TestText = LoadText(File)
	CloseFile(File)
EndIf

Global Text$[]

'Split the TestLine into an array of Lines
Local line = 0
While TestText&lt;&gt;""
	'Get the CRLF position
	Local Pos = Instr(TestText,Chr(13)+Chr(10))
	Text = Text[..Len(Text)+1] 'expand the array
	'Was the end of the text reached?
	If Pos = 0 Then
		Text[line] = Mid(TestText,1,Len(TestText)) 'Copy the rest of the text into the new array slot
		TestText = ""
	Else		
		Text[line] = Mid(TestText,1,Pos-1) 'Copy the first line into the new array slot
		TestText= Mid(TestText,Pos+2,Len(TestText)) 'reduce the text we are reading from.
	EndIf
	line:+1 	
Wend

While Not KeyHit(KEY_ESCAPE)
	Cls
	SetImageFont Font
	Local y = 50
	'Print the lines from the array
	For Local  i = 0 To Len(Text)-1
		DrawText Text[i],10,y
		y:+20
	Next
	DrawText Len(Text)+" lines",10,10
	Flip
Wend
</pre> <br><br></td></tr></table><br>
<a name="775640"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes but you're loading the whole file into a string. It work, but if you want to use text streams with encoding recognition, I would recomend you to just take a look to the loadtext function source code. It will be less RAM demanding when working with very large files (I think).<br><br>Anyway, glad to see it works. :D <br><br></td></tr></table><br>
<a name="775643"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes good advice thanks.<br><br>For now I've added it to my framework as a simple function. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
