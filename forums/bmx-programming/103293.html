<!DOCTYPE html><html lang="en" ><head ><title >GMan's Zip module issue - poss file size?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >GMan's Zip module issue - poss file size?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >GMan's Zip module issue - poss file size?</a><br><br>
<a name="1242346"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ghost Dancer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm getting an unhandled exception on ZipReader.ExtractFileToDisk but the file is in the zip. This only happens on some zips so not sure why its failing. <br><br>I'm wondering if it is a size limit problem (one of the files is 4.5MB - not massive but this is the only real difference I can see). Does anyone know what the max file size  is for files being written/extracted with this mod? <br><br></td></tr></table><br>
<a name="1242349"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe you should try to do it in a debug-build.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1242353"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Henri</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I used 7zip commandline version for my backup program as it seemed more stable and no filesize limits. With Gman's mod it gave me an exception somewhere around 600 megs. But this was long time ago.<br><br>-Henri <br><br></td></tr></table><br>
<a name="1242354"></a>

<a name="1242355"></a>

<a name="1242356"></a>

<a name="1242358"></a>

<a name="1242363"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ghost Dancer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I did do a debug build, that's how I know it errored on ExtractFileToDisk - but I don't have time to debug the mod, esp if its just a limitation of it. <br><br>I'm nowhere near 600 MB but might be worth just trying 7zip and see if that works.<br><br>Edit: Is this the correct Blitz code for 7zip? <a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=2377" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=2377</a><br><br>Ideally I'd like to continue with Gman's mod as its gonna be a lot of work to replace it in my code (its a very complex app) <br><br></td></tr></table><br>
<a name="1242365"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Henri</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> As it's command line app you could use pub.Freeprocess to execute it or ShellExecute if only for Windows.<br><br>-Henri <br><br></td></tr></table><br>
<a name="1242367"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ghost Dancer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah right, thanks. <br><br></td></tr></table><br>
<a name="1242374"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Another alternative may be Koriolis' zipstream module <br><br></td></tr></table><br>
<a name="1242375"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just run your app and see at which code line it crashes in extractFileToDisk. Think when relying on 3rd party code in your app that time should be worth to get spend.<br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1242376"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grisu</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> GMan has a forum here: <a href="http://www.gprogs.com/viewforum.php?id=8" target="_blank">http://www.gprogs.com/viewforum.php?id=8</a><br>It might be worth dropping a line there. <br><br></td></tr></table><br>
<a name="1242693"></a>

<a name="1242694"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ghost Dancer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tried forum but register link just goes to a blank page so can't post there. Might have a crack at fixing the bug in GMan's code, but will prob have to resort to another zip module.<br><br>If GMan happens to see this post, this is my code:<br><br><pre class=code>
Local zrObject:ZipReader = New ZipReader

If zrObject.OpenZip(currentProject$) Then
	zrObject.ExtractFileToDisk(projectXmlFile$, tempPath$ + projectXmlFile$)    '&lt;-- error here
	zrObject.CloseZip()
End If
</pre><br><br>The error is 'Unhandled Exception: Attempt to access field or method of Null object.', and the debugger shows that in the getFileInfoByName function, m_zipFileList:TZipFileList = Null (which I am assuming is the cause of the error as its the only Null field I can see) <br><br></td></tr></table><br>
<a name="1242702"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Think that portion of code wont help that much.<br><br>When the debugger stops in (your programme crashes) you have seen that "m_zipFileList" is null.<br>So this object isnt filled/created correctly.<br><br>Means you now go back in history (on the right sided pane with the debug entries just move up and up and up...) until you reach the step which should create/pass/... m_zipFileList. Then check why it might not get created correctly.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1242708"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ghost Dancer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know how to debug a program :p I just don't want to waste time debugging someone else's code that might ultimately prove useless anyway.<br><br>I was just giving some info to point GMan in the right direction should he read this thread. <br><br></td></tr></table><br>
<a name="1242792"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ghost Dancer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK, I've fixed the errors in GMan's code. I searched zipengine.bmx for all 'm_zipFileList.' and made sure they were preceded by 'If m_zipFileList Then ', and ditto for 'info.' preceded by 'If info Then ' - this has made it more robust and prevents the unhandled exceptions.<br><br>It looks like those fields are null due to getting lots of 'I/O error : Too many open files'. Still investigating the cause of I/O errors - looks like its when I'm parsing the XML files (using libxml) extracted from the zip. <br><br></td></tr></table><br>
<a name="1242805"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> your "ifs" just secure it against crashing - but like you already described there seems to be another issue around.<br><br><br>Do you happen to be able to reproduce that I/O-error without the zip functionality? (just handling some hundred of xmls or so).<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1242936"></a>

<a name="1242937"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ghost Dancer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Indeed, but better to have robust code so it doesn't crash and/or give misleading errors (which is what was happening). The I/O error seems to be a libxml one, and I'm fairly certain it is causing the zip failure - zip is fine until xml is used. <br><br>I thought it might be a file/node limit of the xml mod, but that doesn't seem to be the case. <br>I'll write some code to try test libxml independently of the zip stuff to hopefully find out one way or the other. <br><br></td></tr></table><br>
<a name="1243080"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ghost Dancer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Finally found the problem. I was inadvertently loading a LOT of image fonts - this caused the too many open files error, which was also causing the zip to fail. Phew, problem solved. <br><br></td></tr></table><br>
<a name="1243091"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> That is why I pushed you to debug the problem :D<br><br><br>@open files error<br>is it just not returning valid handles - or does it raise a real error message?<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1243097"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ghost Dancer</td><td align="right"><font class=tiny>(Posted 2014)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> After fixing the zip mod, the only errors it gave were the 'too many open files' ones which I'm sure are from libxml, and occasionally a similar one stating it couldn't open the xml file. These were not runtime errors that ended execution (would have been a lot easier to find the prob if they did), but were only shown in the output window AFTER closing the app. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
