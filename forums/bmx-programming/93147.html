<!DOCTYPE html><html lang="en" ><head ><title >Elusive problem with string.tofloat()</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Elusive problem with string.tofloat()</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Elusive problem with string.tofloat()</a><br><br>
<a name="1063985"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pete Rigz</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> There's been a couple of reports of a strange problem on a few Macs that run my TimelineFX software. After a lot of head scratching I've narrowed it down to that fact that for some reason strings are not being converted to floats properly. For example something like 0.999 would be converted to 0, but a value of 1 would convert ok, almost like it's converting to integer instead. This leads to lot's of effects not working properly because a lot of the values for them are set to 0. Unfortunately it works perfectly fine on my Mac so I can't recreate it at all.<br><br>I've just tried compiling a new version where I've edited blitz_string.c to use strtod instead of atof just on the off chance that might make a difference, but I'm just wondering if anyone else has any ideas where I could look for clues?<br><br>Could it be a language issue, as they've pointed out they're using a french version of mac os, and the only other person to report the problem was italian. It wouldn't be a decimal point thing would it? I know German's use a "," instead of a "." for a decimal point, or am I grabbing at straws here?<br><br>I also asked them to download and try my vaders game and see if the effects work ok with that but it worked absolutely fine, so the mind's boggling at the moment!<br><br>Any help appreciated! :) <br><br></td></tr></table><br>
<a name="1063987"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah, the lovely unpredictability of floats :-). Have you tried doubles instead?<br><br>I don't think it has to do something with the delimiter. In the Netherlands we also use the notation of 0,999 instead of 0.999. And I've had no problems with this code:<br><br><pre class=code>Local a:String = "0.999"
Print a.ToFloat()
Print a.ToDouble()</pre><br>Which results in:<br><pre class=code>0.999000013
0.99900000000000000</pre><br><br>If I use Dutch notation (0,999) it converts to 0.00. <br><br></td></tr></table><br>
<a name="1063996"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>I don't think it has to do something with the delimiter<br> <br></div><br>Going by what you say below, it could still be that...<br><br><div class="quote"> <br>If I use Dutch notation (0,999) it converts to 0.00.<br> <br></div><br>If TimelineFX allows users to enter values, or reads values from the built-in Windows controls (which would use the separator chosen by the user via Windows' language settings), that <i>might</i> explain it. <br><br></td></tr></table><br>
<a name="1064026"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pete Rigz</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, I could try doubles I guess. It does allow you to enter values, but this is simply from reading values in an xml file. Maybe I could read the value twice, one with a "." and the other a "," and take the value that doesn't equal 0...<br><br>But I still can't figure out why the example game works fine, as that loads the effects files in exactly the same way.<br><br>Thanks for the suggestions so far! <br><br></td></tr></table><br>
<a name="1064030"></a>

<a name="1064033"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> but this is simply from reading values in an xml file <br></div><br>Maybe the XML-loading code is somehow to blame, respecting regional number formatting while raw BlitzMax ignores it.<br><br>As an experiment you could try telling Windows to use the French/Dutch/whatever formatting and see if you then get the same behavior.<br><br>EDIT: A bit of googling shows that XML files should be using the dot in any case, so my XML-loading guess is probably wrong.<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1064085"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >_JIM</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe a Replace(str, ",", ".").ToFloat() could fix it. <br><br></td></tr></table><br>
<a name="1064335"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pete Rigz</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well it seems that it's not ToString that's at fault it's actually the xml loading. I'm using libxml, a wrapper by Brucey, and it's somehow trying to be clever in being locale aware and parsing any numbers it finds accordingly. So numbers like 0.99292 are being converted to 0,00000. Not too helpful. Strangely it's only happening on some Macs it seems, and I've certainly sold a few to euro countries that use this formatting without any complaints. And if I set my Mac to french, and change the way it formats numbers on the OS I cannot recreate the error still. <br><br></td></tr></table><br>
<a name="1064398"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's interesting. You could try contacting Brucey, but he seems to have vanished from these forums. His last post was fourteen weeks ago. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
