<!DOCTYPE html><html lang="en" ><head ><title >More Memory Questions</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >More Memory Questions</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >More Memory Questions</a><br><br>
<a name="781335"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sean Doherty</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> The following code, compiled in non-debug mode, initially allocates 37K on memory.  However, as the it runs it show that it has 50K to 60K of allocated memory.<br><br>1) Why?<br>2) Is there a way to change the code so the memory allocated is static?<br><br><pre class=code>
SuperStrict


Global g_iInitialMemory:Int

Graphics 1024, 768,0, 0

'Reset &amp; store the initial memory value.
GCCollect()
g_iInitialMemory = GCMemAlloced()

Repeat

	SetBlend SOLIDBLEND
	
	DrawText("Initial Allocated Memory = " + g_iInitialMemory, 10, 10)
	DrawText("        Allocated Memory = " + GCMemAlloced(), 10, 25)

	Flip -1
	Cls
Until KeyHit(KEY_ESCAPE)
</pre><br><br>Thanks <br><br></td></tr></table><br>
<a name="781360"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JazzieB</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> GC doesn't work every frame unless you force it to, which is why your memory goes up to a certain point and then drops.  If you put a GCCollect in your main loop, you'll get a static value. <br><br></td></tr></table><br>
<a name="781363"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >CS_TBL</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> GC is weird. Why does the GC pile-up when hovering the mouse over a canvas? Why is RAM being consumed by just doing that? <br><br></td></tr></table><br>
<a name="781435"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SSS</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'd imagine it's because you're generating MOUSE_OVER events each frame or something. <br><br></td></tr></table><br>
<a name="781487"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> and because you are creating strings to output with drawtext. Also draw text may make things that consume memory. <br><br></td></tr></table><br>
<a name="781493"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Michael Reitzenstein</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> You really, really don't want to be worrying about this. The BlitzMax GC is optimised for actual programs rather than test demos like this, but it does work (except it doesn't handle circular references) and works well. I don't even know how much memory my game takes, because last time I checked I realised it just doesn't matter.<br><br>Finish the game and if it's slow, optimise then! <br><br></td></tr></table><br>
<a name="781543"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sean Doherty</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Michael, Is Darwin The Monkey a BlitzMax game?<br><br>I seems to matter in my game, I've used a lot of circular reference; things like world has a unit and unit is part of the world.  Does anyone know why circular references are not freed? <br><br></td></tr></table><br>
<a name="781546"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Does anyone know why circular references are not freed? <br></div><br>Because of the very fact that they are circular. ie. A points to B which points to A.<br><br>If B is a child of A, then you can build into your A.free() a case where it removes it's children, which in turn causes say, B.free() to be called, which you set to null out the reference to A.<br><br>Unless you build your code in such a way as you know that your own code will clean itself up properly, you should really stay clear of circular references if you can. (It's certainly possible to design code that doesn't need them) <br><br></td></tr></table><br>
<a name="781554"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sean Doherty</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Brucey, Don't other languages, such as Java, handle freeing circular references?  I'm thinking is A and B or only pointing at each other, the runtime should be able to free both references; or not? <br><br></td></tr></table><br>
<a name="781631"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> It depends how you implement the garbage collector.<br>Java didn't used to be able to handle circular references (in 1.1), but they changed it so that instead of just strong references, Java could handle different kinds - soft, weak and phantom. This way the garbage collector can determine if a specific object is accessible any more or if its status can be changed to allow it to be GC'd. (although it's up to the VM to decide when, if at all, it is GC'd).<br><br>I imagine that in BlitzMax all references are strong, and that's why, when you create a circular reference, you will have to break it yourself when you want the GC to clean up your objects - which isn't such a big deal if you build that capability into your design.<br><br>So in Max, read -&gt; circular references are a potential memory leak. <br><br></td></tr></table><br>
<a name="781671"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've requested weak references for BMax before, but no reply. I don't see any necessity for it to manage circular references though. If your design requires circular references ( and I accept that for the sake of speed, this does happen ) then you know you've done it, so you know you have to break them when you're finished with the objects involved.<br><br>Weak references would be handy for writing modules, libraries, etc where you may wish the module or library to hold internal references to objects which can also be used by the person using your library too. This way the person using your library can allow his or her own objects to be disposed as one should in a managed environment. If the engine needs a copy of those objects for it's internal purposes, they should be weak references or else they will never be collected and you have to have an explicit destroy method for your user to call, which defeats the object of having an automated GC. <br><br></td></tr></table><br>
<a name="781678"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Or you have to use funny hacks like object[-8] :- 1 ... <br><br></td></tr></table><br>
<a name="781679"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Darwin is Delphi.<br><br>But yeah I agree with Michael, I used to be very careful to manually free all this stuff up (old habits) and then I did some very thorough testing and realised that I didn't need to do any of it, the GC did it all for me.  The only use of freeing stuff up is if you want to free up some memory mid game (maybe when changing screens) and load the screen up dynamically each time. <br><br></td></tr></table><br>
<a name="781781"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Right, or the hacks with the object pointer. And they could stop working at any time, particularly with Mark working with reflection and meta information in types. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
