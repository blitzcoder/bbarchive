<!DOCTYPE html><html lang="en" ><head ><title >Making an installer with BMX</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Making an installer with BMX</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Making an installer with BMX</a><br><br>
<a name="1167537"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I want to make an installer program I can append data to and have it read it's own file contents and install the programs.  I want this to work AFTER the installer program is compiled.<br><br>It is possible to just append data to the end of the .exe file.  Then you write the start position of the data to the last four bytes of the .exe, and it actually works.  However, if the resulting .exe is very big, is takes a long time to start when you double-click it.  This is presumably because the entire file is being read into memory before the program starts.<br><br>Is there another way to pack files into an existing .exe, like in the resources section or something?  Or maybe it is possible to find the position of an incbinned file, and replace it with a block of raw data containing all your files, replacing the file size with the size of your data block?<br><br>Any other ideas? <br><br></td></tr></table><br>
<a name="1167539"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midimaster</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I always use Koriolis ZipStream. In combination with INCBIN you can include a ZIP file, that contains all your files.<br><br>This is smaller than INBCIN the files direct. <br><br></td></tr></table><br>
<a name="1167540"></a>

<a name="1167541"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> The files have to be added to the compiled .exe AFTER it is compiled.  I want to compile the .exe and reuse it as a template, adding different files to it to make different installers.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1167547"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tested with 2 gb on a non-SSD hard drive, and although there is a delay when it starts, it is maybe one or two seconds, and the process only uses 1500 kb memory.  So I think my original idea was safe to use. <br><br></td></tr></table><br>
<a name="1167549"></a>

<a name="1167550"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >zzz</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Afaik sections have to be explicitly defined in the pe headers for them to be mapped to memory, so just slapping on data at the end should work indeed.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1167552"></a>

<a name="1167553"></a>

<a name="1167554"></a>

<a name="1167555"></a>

<a name="1167556"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Then you write the start position of the data to the last four bytes of the .exe, and it actually works<br> <br></div><br>Is this your own method, whereby you seek to the last four bytes then read the offset? It might be quicker if you don't have to do that part, and <a href="http://support.microsoft.com/kb/84062" target="_blank">this article</a> shows (in some ancient form of BASIC) how to read the offset from the executable structure at the start of the file. (See third block of code.)<br><br><a href="/codearcs.php?code=2628" target="_blank">This Code Archives entry</a> uses the executable file structure, and I believe the IMAGE_DOS_HEADER type there equates to what's in that article. (I suspect the 'INTEGER' type of that old BASIC might have been two bytes.)<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1167599"></a>

<a name="1167600"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, I just ended up adding the data begin position at the end of the file.  I also added a few other things like the name of the program being installed and some images to show in the installer screens.<br><br>If you want to sort out the UAC issues on Windows, use this:<br><a href="http://www.restuner.com/howto-insert-trust-info-manifest.htm" target="_blank">http://www.restuner.com/howto-insert-trust-info-manifest.htm</a><br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1167638"></a>

<a name="1167640"></a>

<a name="1167641"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> (sorry I didn't read this whole thread and now what I wrote below is probably irrelevant)<br><br>I was working on a screensaver module for Unity and was using Blitz as a compilation wrapper thing ... what I did was, as you said, simply append extra data to the end of the exe file with a code at the end to tell me how big it was. Actually what I did was use the blitz LZMA module to compress several chunks of data and store them in reverse sequence (so that I could scan backwards to read them in order).<br><br>To my knowledge, the whole exe did NOT get loaded into memory up-front because the headers etc in the exe file format only told the o/s to read the main exe and its data .... or at least that what seemed to be happening. It's similar (I believe) to what happens when you run a really big app that shows a splash screen really early even though stuff keeps loading - it's because the main portion of the exe is already loaded and can start running and then it proceeds to read more data from the exe file. Correct me if I'm wrong or if the behavior has changed on more recent o/s versions. From what I could tell it seemed like the o/s was only loading the original amount of data, otherwise it should've taken longer.<br><br>Still, it sounds like you're encountering a long load so I'm not sure.<br><br>I would recommend using LZMA though to pack your data as then the disk load time is reduced and LZMA is quite fast at decompressing.<br><br>An idea for working with `incbin` depends on you knowing the final size of your data ahead of time, so this would work as a 1-off kind of thing. If you know the filesize at compile time, write a little utility that loads your file data into a memory bank starting at a slight offset, say 4 or 8 bytes into the bank. Write a codeword into the first few bytes of the bank to identify it - something that doesn't occur elsewhere in the final exe. Then save the bank. Then back in your installer, incbin the appended file. Now your installer can look through `itself` to find the codeword and then you know this is where your data begins in memory. Again I'd recommend combining this with LZMA compression (if it helps).<br><br>As far as being able to make a template that you can re-use etc that's much harder because now you have a variable payload size and blitz won't understand how to make the right amount of room for it in the exe. You'd have to recompile the installer each time for each product.<br><br><font class="tiny">Last edited 2012</font><br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1167666"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think when I tried this years ago, I must have been reading the file list at startup, and it was just the number of files that made it take so long to start.  I'm not experiencing any problems now, even with a 2 gb EXE.<br><br>This is the kind of thing I love about programming Windows stuff. <br><br></td></tr></table><br>
<a name="1167695"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Isn't this the sort of thing that will trigger some Anti-Virus programs? <br><br></td></tr></table><br>
<a name="1167697"></a>

<a name="1167698"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Josh: ya can do that on any OS its not just windows, I have done the base installers (data at end of exe) on Novell Netware, DOS, Linux, OSX and Windows 3.11/95/98/2000/NT/XP/7/8 and they all perform the same.<br><br>With each platform its how you lay out the data that gets the end results, on OSX its MUCH more fiddly now with the 'app' stuff BUT it can be done however I would recommend using one of the installer apps for that as sometimes OSX can throw a wobbly as the data doesnt match up with the compiled results.<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
