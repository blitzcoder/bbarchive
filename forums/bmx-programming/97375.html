<!DOCTYPE html><html lang="en" ><head ><title >Suggestion : Compiler Directive</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Suggestion : Compiler Directive</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Suggestion : Compiler Directive</a><br><br>
<a name="1130846"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is this still impossible to add your own compiler directives for  conditional compilation to BlitzMax ?<br><br>Maybe a pre-processor source code addon?<br><br>Try not to talk about constant, global or variable flag please. It's not a correct solution.<br><br><br>Maybe one of the last feature we could ask to Mark !? <br><br></td></tr></table><br>
<a name="1130851"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Oddball</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've been requesting this for ages. I doubt it'll ever get added. <br><br></td></tr></table><br>
<a name="1130878"></a>

<a name="1130879"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> the CE ide supports post scripts and I believe there's some directive stuff in there as well... when paired with brucy's BMK that is. Also cross compiling from MacOS...<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1131096"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> +10 for this please for this to be added, please Mark :) <br><br></td></tr></table><br>
<a name="1131532"></a>

<a name="1131535"></a>

<a name="1131536"></a>

<a name="1131537"></a>

<a name="1131540"></a>

<a name="1131541"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ProfJake</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, definitely.<br><br>This is one of those little neat features that I am really missing in Max.<br>It would be nice to at least be able to check if certain modules (and their functions, classes etc)<br>were imported, since there are no namespaces.<br><br>Maybe something along the lines of:<br><br><pre class=code>?Not Imported("brl.math")
' Provide own functions with the same API
?</pre><br><br>.. or alternatively just a test for a define (naming-scheme?):<br><br><pre class=code>?_MOD_BRL_MATH
' ..
?</pre><br><br>This would make for a much greater reusability of modules.<br><br>Pretty please? :)<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="1265047"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just bumping this. I guess there's still no way to create your own conditional compile time constants? I need this because I only want to import a library if the constant is true instead of having to manually comment it out (so I don't have to ship it with certain builds) <br><br></td></tr></table><br>
<a name="1265049"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> While bmk is easy enough to "fix", bcc would also require changes, which I find highly unlikely to occur in the near future. <br><br></td></tr></table><br>
<a name="1265066"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> :-(<br><br>Now I have to put rem end rem around the import and includes + use a standard Const for code I want to run. <br><br></td></tr></table><br>
<a name="1265251"></a>

<a name="1265252"></a>

<a name="1265256"></a>

<a name="1265260"></a>

<a name="1265346"></a>

<a name="1265347"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could try hacking the C preprocessor into Max, for full C-style macro support instead (and with it, #if/#endif). Here's an attempt:<br><br>1) rename bin/bmk to bin/bmk_real<br><br>2) save the following script as bin/bmk:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">#!/bin/bash
FILE="${!#}"

awk -F'"' -v OFS='"' '{ for (i=1; i&lt;=NF; i+=2) gsub("'"'"'", "//", $i) } { gsub("\r", "", $0) } 1' "$FILE" &gt; "$FILE".tmp.c
awk -v OFS="" '/^[ \t]*#/ {
	l = length($0);
	m = match($0, /^[ \t]*#[ \t]*([Ii]f|[If]f[Dd]ef|[Ee]lse|[Ee]lif|[Ee]nd[Ii]f)/);
	print tolower(substr($0, m, RLENGTH)), substr($0, RLENGTH + 1, l - RLENGTH); next
} 1' "$FILE".tmp.c &gt; "$FILE".tmp2.c

gcc -std=c99 -E "$FILE".tmp2.c &gt; "$FILE".tmp.bmx
sed -i '' -e '/^#/ d' "$FILE".tmp.bmx

DIR=$( cd "$( dirname "${BASH_SOURCE[0]}" )" &amp;&amp; pwd )
"$DIR"/bmk_real "$@".tmp.bmx

rm "$FILE".tmp.bmx "$FILE".tmp.c "$FILE".tmp2.c
</textarea><br><br>3) run program normally:<br><br><pre class=code>
'test
#define FOO 1
#define BAR "bar"
#define dbl(X) ((X) * 2)

#If FOO == 1
Print dbl(FOO)    'prints 2
#Else
#  If 1
Print BAR
#  EndIf
#EndIf</pre><br><br>I'm not experienced with awk so someone else could probably do a much better job, but surprisingly it actually seems to work (OSX, MaxIDE). No recompilation of Max tools required.<br><br>All it does is replace Max style 'comments with C-style //comments, and ensure that #if, #else etc. are capitalized correctly. It also removes the GCC annotations from the output (just running with -P would destroy line numbering). Note that while it corrects keyword capitalization (because the IDE won't let you write it without capitals), it doesn't change the expression syntax, so you still have to use ==, &amp;&amp; and so on.<br><br>A more advanced version could conceivably get rid of the conflict with #label, but I assume nobody uses that in practice. Since this version compiles file.bmx.tmp.bmx instead of file.bmx, it probably also plays absolute hell with quick builds and Import, so adding some lines to rename the generated assembly/object files (the hidden ones - final executables are named as expected) might be useful (or maybe that's the point where you ought to start modifying BMK itself, I don't know; thoughts?). <br><br></td></tr></table><br>
<a name="1265643"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Blimey, that's pretty advanced stuff there. Now if only BRL could make this kind of thing official, so useful! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
