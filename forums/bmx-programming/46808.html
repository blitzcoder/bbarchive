<!DOCTYPE html><html lang="en" ><head ><title >My idea for a network library</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >My idea for a network library</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >My idea for a network library</a><br><br>
<a name="520660"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeroen</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi there,<br><br>I am writing this idea down here, because I don't have the time to actually develop this concept. Perhaps we can start a dialogue here: is this a good idea, or is there a better way?<br><br>The code is in pseudo Blitz3D, but ofcourse the target language would be BlitzMax.<br>----------------------------------------------------------<br><br>CURRENT STATE OF BLITZ NETWORK LIBRARIES<br><br>The programmer sends and receives network messages by using a library like Blitzplay. By checking the message ID and sending values, you know what is going on 'on the other side' (e.g message id 5 is: the player died) and then you act accordingly to that signal (delete mesh, remove player record). This is cool and should be in, but sometimes it is not very practical.<br><br>SHARED OBJECTS<br><br>The concept is this: the whole network shares objects like normal variables.<br><br>Let's say all computers share the object:<br><pre class=code>
type human
  field head
  field intelligence
  field hair
  method deletePlayer()
    // delete this object
  end function
  method createPlayer
   // automaticly ran when creating record
end type
</pre><br><br>The "big" command that makes it a shared object:<br><pre class=code>
setSharedNetworkObject(human)
// make 'human' shared.
</pre><br><br>This tells the network module: the 'human' object is going to be shared across the network. Whenever something happens with an object (created,trigger,variables being set), the request and data is sent to all other computers, and is set (variables) or executed (methods, functions) over there as well.<br><br><pre class=code>
h.human = new human
h\head="red"
h\intelligence = 50
h\hair = "dark"
</pre><br>...If the human object is a shared object, it will contain the values above, on every connected computer!<br><br>The same would count for executing methods and functions in that object. E.g: human.shoot("shotgun");<br>or delete h (remove the instance on all computers).<br><br>----------------------------------------------------------<br><br>Now, I do not know if it's possible to do this in Blitzmax. Somehow you will need to write a module that somehow knows about Blitz' internal object creation/deletion mechanism.<br><br>Secondly, it would be nice to set exceptions for certain variables inside a shared object. You could "unshare" them.<br><br>Lastly, perhaps a network Player() object would be required in order to do things like:<br><pre class=code>
answer=isPlayerLocal(playerID)
if answer=1 then do collisionDetection
</pre> <br><br></td></tr></table><br>
<a name="520671"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's called "remoting" in dotNET and "Remote Method Invokation" in Java, and it's usually not the best approach for real-time applications.<br><br>It is an excellent sollution to software using a "thin-client / terminal server" deployment configuration, but it usually requires a considerably larger ammount of internet bandwidth then doing it oldskool, particularly because of sending redundant information. Considering your idea uses "full-blown" objects, and traditional remoting solutions only use interfaces, this would probably increase this problem further, additionally it introduces a syncronization, and object state problems. If two player fire near-simultaneously, both killing each other, who decides "who shot first", and should that player still die, since the other player was "technically" dead at the time.<br><br><div class="quote"> Now, I do not know if it's possible to do this in Blitzmax. <br></div>Not universally (that would require reflection), but you can do it locally by extending a "remoting object".<br><br>It's not a bad idea, really - it's just not very practical with the current state of most peoples hardware. With distributed systems <b>in theory</b> becomming mainstream appliances with the launch of the PS3, a system like this would become much more achievable - at least on the PS3. <br><br></td></tr></table><br>
<a name="520682"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeroen</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, thanks for the reply :-)<br><br>Your reply on object state problems; yes, that is something to worry about, but don't you have the same problem with normal messages?<br><br>In Dukatiers (UDP network game) we had diamonds, which could be picked up. Player A picks up a diamond, and the object is removed locally and remotely by sending a command.<br><br>Well, that wasn't smart of me, because it introduced the problems you described (syncronisation) when the object had to be added again. Players who connected later on could crash randomly because of different object states.<br><br>The answer was by hiding/showing the diamond entities, not removing/adding the objects while the game was running.<br>Players who joined during a game had to load all the information on diamond locations (X,Y,Z,hidden/shown).<br><br>What I'm trying to say here: what is the syncronisation difference between sending network messages (current way of doing) and remoting? It's basicly this: instead of ME handling the object mutation, the module does it FOR me :-)<br>When you look at the network design, it's almost the same.<br><br>BlitzPlay for example, converts the data to a string, and back from a string to variables. This is still happening internally, only with the difference that it would also take care of placing the data in the right objects for me.<br><br>---------------------------------------------------<br><br>Optimisation:<br><br>Perhaps, with optimization, the module could check which parts of the objects are mutated, and only send this change through the network. Also with "unsharing" parts of the objects this could be reduced.<br><br>In fact, the whole bandwidth issue is the programmers' responsibility. I would only use it for players (X,Y,Z, playerStatus (int), character_face_look and some other commands.<br><br>Here, it doesn't make a difference (syncronisation) which method I use.<br><br>I would "unshare" object data like references to entities or other unnessesary stuff.<br><br>-------------- <br><br></td></tr></table><br>
<a name="520691"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Zenith</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah alot of network libraries do this now, it will only send an object state that has changed, however.<br><br>An example of one that does this is Torque Network Library, by Garage Games. <br><br></td></tr></table><br>
<a name="520723"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Bot Builder</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep, Raknet has stuff builtin for syncing classes and blocks of memory.  Very cool stuff really.  In many network optimized games its not practical though.  It works very well and easily for stuff that must be sent and be the same on all comps, but for stuff that might not matter to the player, it just slows it down.  For instance, things totally outside the view or sound range of the player often times dont matter.  Even in the cases that its in the sound range, you might onlyu have to tell it that a certain sound is playing at a certain X,Y,Z, and not have to give unecessary details.<br><br>For stuff like player names, game state/messages this stuff is great though.<br><br>As far as optimizations go, we're a bit limited by the fact that there are no properties (methods that act like variables).  If we had them then it would be possible to easily keep track of modified variables.  Ideally it would be possible to automatically begin each property with stuff for networking, but this would likely require a preprocessor, or some interesting OOP stuff not seen in any other langauges.  Once enough variable changes had built up, or some short amount of time elapsed, it could send off a packet summarizing all the changes.<br><br>Another possibility is that when a method is called, send a packet that will call the same method with the same parameters in the other types.<br><br>There are problems with having links to other types in parameters or fields (you don't want to pass memory location pointers), however this could be fixed by having type IDs that are the same on all computers.  Then on passing it will convert the pointer to an ID. <br><br></td></tr></table><br>
<a name="520880"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeroen</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Bot Builder, Raknet sounds awesome! It sounds you did some research!<br><br><br>Is it possible in Blitzmax to do this?<br><br><pre class=code>
myString$ = "jeroen"
myClass.callMethod(myString$)
</pre><br><br>or<br><br><pre class=code>
myVar$= "health"
myValue = 50
myClass.setVar($myVar$)= myValue
</pre><br><br>? <br><br></td></tr></table><br>
<a name="521006"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> What you want in action games is usually speed, this means sending action-states (keypresses) and you can also interpolate the movement afterwards.<br><br>So to update another player you would send what keys he is holding down (action game) or where he clicks (strategy). This means you only send one byte for 8 keys! Actually it is wrong to think about keys because it more that you send their action state.<br>1.MoveForward 2.Back  3.TurnLeft.. 7.Jump 8.Fire<br>Same goes for AI-players<br><br>So you decide what actions the "player" has and then you make sure to update them - not the actuall data. <br><br>That's kinda how I'm doing it in my library. But there you have to manually pick the "actions" to update and build your program after that system. <br><br>It would be confortable to simple pick an object and the the library takes care of the rest. It would be fun to test to send data of an object (the change only) each time it changes. in this way you can get away with pretty small messages. Especially if you put eveything into packs. <br><br>But I don't know how to program an interface like that. Flameduck you mentioned extending an remoteobject, how did you mean? How would the library do to be able to check if any field in this object has been changed? <br><br></td></tr></table><br>
<a name="521060"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeroen</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> yes Wave, that seems logical. It's how I did it with Dukatiers. But, in this "new concept" you can do exact the same if you prepare your objects right.<br><br>E.g in pseudo code:<br><br>if keypress(LEFT)<br>  p\keypress=0<br>end if<br><br>...and the network library will only sync the "keypress" variable, which happens to be a byte in this case. So...in the end you have the same data traffic, not more, if you prepare your objects right.<br><br>I don't know how you'll be able to program this smart syncronisation. I don't think BlitzMax allows you to go THAT deep? <br><br></td></tr></table><br>
<a name="521072"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> How did you mean for the interface of the network lib to be? <br><br>This is how I do it now in simplified pseudo code:<br><br>Your Local Input.<br>If KeyDown(KEY_LEFT) P\Left = 1 else P\Left = 0<br>SendKeys(P\Up,P\Down,P\Left,P\Right)<br><br>Your received data of other players.<br>Each Msg<br> P = MsgFrom<br> P\Up = GetKeys(1)<br> P\Down = GetKeys(2)<br> P\Left = GetKeys(3)<br> P\Right = GetKeys(4)<br> del msg<br>next<br><br>Do you think I could add another interface on top of that, so that it can be even more simple to implend multiplayer? I mean the "user" (of the Netlibrary) can use a more intuitive command? <br><br>I had this idea from your idea =)<br><br>SyncKey( PLAYER1_MOVE_LEFT_KEY ) ' Creates a sync<br>SendKeys() 'Sends all your keys to all others<br><br>UpdateNet() 'Get message/sync<br><br>Each Player<br> If NetKeydown(KEY_LEFT)'Has this client this keydown?<br>   'If it is a local player then it calls the normal <br>KeyDown()<br>   'if the key is not in sync?<br>   'All clients must sync the same keys right?<br> Endif<br>next<br><br>The is there a problem when you have more than 1 player on each client connected or AI players? <br><br></td></tr></table><br>
<a name="521806"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeroen</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmm I prefer your "old" method.<br><br>Perhaps you could make use of a net_id (player ID on the net).<br><br>If you send to net_id 0, you send to ALL clients, if &gt;0 you send to one specific client. <br><br></td></tr></table><br>
<a name="521849"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why don't you just send/receive the raw user input over the network, ie pushing the joystick up, pressing the fire button. This is much simpler data than<br><br>a) receive the input<br>b) interpret the input and turn it into internal meaningfulness<br>c) encode meaningfulness into the packet<br>d) send it over the network<br>e) receive it from the network<br>f) decode it to something meaningful and interpret<br><br>It could just be<br><br>a) receive input<br>b) send input over network<br>c) receive input from network<br>d) process it the same as for local input <br><br></td></tr></table><br>
<a name="522076"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> AngelDaniel, if I get you right that would work for a game with max one player on each computer and no AI players. As Ai-players don't have input directly from the keyboard. And two players on one computer has different keys for the same actions.<br><br>And Jeroen thats how it works right now =)<br><b>SendUDP</b>( MsgType , DataString$ , OnlyToID=0 , NotToID=0 )<br>if OnlytoID = 0 (or not specified) send to all. NotToID is specified if you want to send to all but that ID.<br><br>I'm thinking about allowing for "local" clients. So that you can have several players on one computer. In that way you could match the client number with the AIplayers and RealPlayers on your computer and in that way specify the keysync of each. But I can't think af an easier way to do it. I actually want to make it even more simple but I don't know how (got any ideas?).<br><br>And even though you send keypresses (when changed) you need to send fullupdates once in a while because of latency. <br><br>This is how I'm thinking the interface will look when it's done:<br><pre class=code>
--- THIS IS NOT A WORKING EXAMPLE ---


'In main loop
For C = eachin localClient
    C.UpdateSend( 5 , [X,Y,Dir,Energy,Armor])
    ' 5 = Five times per sec - or once every 200ms

    C.UpdateKeysOnly( 0 ) 
    ' 0 =Always send keys if they have changed
Next


'In player input method (do this for each key)
C = GetClientID( player.ID ) 'Match with your type

 If Keydown( ~~~ )  

      'SetKeyToSend( KeyNR - From 0 to 7 , True or False )
      C.SetKeyToSend( 0 , True )  'Pressed

 Else

      C.SetKeyToSend( 0 , False ) 'Not down

 Endif



'in mainloop
If UpdateReceived() 'Check if you got any msg sent by UpdateSend()

    For C = Eachin RemoteClient 

       If C.ID = Player.ID ' match with your type

           'In the same order you sent them..
           Player.X = C.GetUpdate( 0 )
           Player.Y = C.GetUpdate( 1 )
           Player.Dir = C.GetUpdate( 2 )
           Player.Energy = C.GetUpdate( 3 )
           Player.Armor = C.GetUpdate( 4 )

       Endif
    Next

endif
</pre> So when you create a player you need to create an client equalent.<br><br>'In the New() method of your player type <br>    AddLocalClient( Name$ = "" , Info$ = "")  <br><br>'And in Delete() <br>    RemoveLocalClientwithID( Self.ID ) <br><br>When the Client connects to host (or when he himself host a game) the local clients will be given IDs by the Host. If you AddLocalClient() After host() or Join() it will announce itself to all others. Same goes if you change the name/info of any client by using yourClient.SetName( newName$ )<br><br>I'll probably notice that this doesn't work after trying to code it for X weeks, but it's the guideline I'm working after. Ideas are welcome =) <br><br></td></tr></table><br>
<a name="522171"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeroen</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> hi Wave,<br><br>Woops, I didn't see that my id=0 suggestion was already in :-)<br><br>To get back to your suggestion to use a different method for sending/receiving variables, perhaps for now your current method is the best, after reading this discussion again.<br><br>But, you could make an exception for player movement though.<br>What I mean is network prediction. It is something I suggested for Blitzplay as well. In this concept, prediction is done automaticly by the network library.<br>pseudo code:<br><br><pre class=code>
main loop
 for p.player = each player
   if syncposition(p\id)=false
     playerposition=calculatePrediction(p\id)
     positionentity myplayer, playerposition[0], playerposition[1], playerposition[2]
   else
     playerposition=getPosition(p\id)
     positionentity myplayer, playerposition[0], playerposition[1], playerposition[2]
   end if
 next

end main loop
</pre><br><br>What I mean with the above example is that sometimes the network library does not send/receive playerpositions, but calculates the position based on previous player positions. It predicts. The statement after the 'else' DOES receives the actual player coordinates.<br><br>How often the library predicts or not, can be then set using a constant: <br>PREDICT = 5 means the library predicts every pass, except pass 0. So changing this value into 10 means that the library predicts more, but syncs less. <br><br></td></tr></table><br>
<a name="522203"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good idea. I have to admit I haven't tried to implend movement prediction yet. (right now I see no gain in it) but when it comes to bad connections (which I will test when I get the basics working) then I'll look into it. And the prediction could actually be done in the update function from the example above. Which means you simply set the predition type and or frecvency before you start the game. EnableQubicPredition( 10 )<br>But as I said I don't know how hard it will be to include or if it will actually reduce/improve visual lag. <br>I would also need a 3D action shooter to it test on =) <br><br></td></tr></table><br>
<a name="522313"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeroen</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Cool!<br>Blitzplay source includes a Cubic Splines include which you can look into. <br><br>Is there a way for you to simulate a slow network connection?<br>If I need to help to test "on the other side", send me a mail!<br><br>Also a GNET kind of system will be nice. Blitzplay uses a DLL to avoid network hickups while doing a TCP request (sending "i am alive"), but this isn't cross platform. And, perhaps Blitzmax won't "hickup" doing this. <br><br></td></tr></table><br>
<a name="522508"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I hope we get GNet for BlitzMax, it would be great, perhaps it is easy to convert it. The hard thing with QuibicSplines are the implentation, which I think BlitzPlay doesn't do automatically (just a function for it, or?). The first version will only contain UDP, I guess I'll run into some problems when I add TCP, but I probably will because in some game it is of very good use. <br><br></td></tr></table><br>
<a name="522538"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jeroen</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> check out Mark's worklog: you'll get some competition, perhaps :-P <br><br>Blitzplay delivers you the function but the user needs to implement it some sort of way. That's illogical I think; player coordinates are always based on two or three axes. So why not implement it in a higher level? (e.g my example I mentioned in this post) <br><br></td></tr></table><br>
<a name="522545"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'll definetly go high-level for the user of the library. And that Mark is working on a network module probably only means more secure/stable networking with more features. Perhaps he is doing a [Blitz]MaxPlay Module? <br>He wrote in his log it was to be a "simple" module.<br>If he meant the module should be simple to use for the user, which I aim for, or simple to code for him I'm unsure of. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
