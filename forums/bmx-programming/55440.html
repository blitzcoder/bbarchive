<!DOCTYPE html><html lang="en" ><head ><title >12bpp -&gt; tPixMap</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >12bpp -&gt; tPixMap</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >12bpp -&gt; tPixMap</a><br><br>
<a name="617123"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MarkAM</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any one know how to convert a 12bpp memory buffer (from windows API) into a tPixMap object?<br><br>For 8/24/32 BPP would use CreateStaticPixmap(e.g. TempMap= CreateStaticPixmap (MemoryAdress, Width, Height, Width,PF_A8) ) <br><br></td></tr></table><br>
<a name="617228"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> 12 bits per pixel, you're saying?<br><br>So each component is 4 bits?<br><br>First find out if the pixmap has a `pitch`, ie if you need to skip at the end of each row.<br><br>Then you can set up a simple loop to go through the source data. Use a byte pointer and read 2 pixels at a time, then use AND's to isolate specific bits and shifts to move them and OR's to combine them. Make each component end up in a separate variable. Then write them out to the pixmap. You can write using a byte pointer, even if the data is stored in int's. <br><br></td></tr></table><br>
<a name="617235"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Something like..<br><br><pre class=code>
'Assumes the pixmap is RGBA format
Local Source:Int Ptr=Memory 'the address of the 12bpp data
Local Dest:Byte Ptr=PixmapPtr(pixmap) 'your pixmap object
Local Width:Int=PixmapWidth(pixmap)
Local Diff:Int=PixmapPitch(pixmap)-Width
Local Pixel,Red,Green,Blue,Alpha:Int
Alpha=1
For Local Y:Int=0 to PixmapHeight(pixmap)-1
   For Local X:Int=0 to (PixmapWidth/8)-1 Step 2
      Pixel=Source[x]
      Dest[x]=(Pixel &amp; $F0000000) Shr 28
      Dest[x+1]=(Pixel &amp; $0F000000) Shr 24
      Dest[x+2]=(Pixel &amp; $00F00000) Shr 20
      Dest[x+3]=Alpha
      Dest[x+4]=(Pixel &amp; $000F0000) Shr 16
      Dest[x+5]=(Pixel &amp; $0000F000) Shr 12
      Dest[x+6]=(Pixel &amp; $00000F00) Shr 8
      Dest[x+7]=Alpha
 
'etc
</pre><br><br>I guess you'd need to read in 4 whole 12bpp pixels because each is 1.5 bytes, so 2 would be 3 bytes, you could maybe work with 6 bytes ie 4 source pixels at a time, but not easily. Maybe better with 8 source pixels, 12 bytes, handle them as 3 int's. <br><br></td></tr></table><br>
<a name="618983"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MarkAM</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Angel<br><br>The conversion is for a frame from a webcam.<br><br>Played around with it a bit an found that the format is 12bit YUV.  I can get a image but the coluring is incorrect.  I am attempting to convert the 4 bit YUV values to 8 Bit RGB values (RGB888)<br><br>Any ideas?<br><br>Code Below:-<br><br><br>			 <br>			TempMap= CreatePixmap (width, Height,PF_RGB888)<br>			Local bnkPixels=CreateStaticBank(VideoMemoryAdress,width*Height*1.5)<br>		'	Local bnkTemp=CreateBank(width*Height*3)<br>			<br>			<br>			<br>			'Assumes the pixmap is RGB format<br>			Local sourcep:Byte Ptr=VideoMemoryAdress 'the address of the 12bpp YUV data<br>			Local Dest:Byte Ptr= PixmapPixelPtr(tempmap,0,0) 'your pixmap object<br>			Local Byte1:Byte  <br>			Local y1,u1,v1:Int  <br>			Local r,g,b :Int<br>			<br>		 	Local YUV:Byte[width*3,Height]   <br>		 	<br>		 	'Transfer into Array(W*H) (YUV in matrices of 3 widths for Y,U and V) - i.e <br>		 	For Local N:Int = 0 To Height -1<br>		 	 For Local n1:Int = 0 To (width*1.5)-1<br>		 		Byte1=sourcep[(N*width)+n1]<br>		 		yuv[(n1*2),N]=(Byte1 &amp;$0F) Shr 4 <br>		 		yuv[(n1*2)+1,n]=(Byte1 &amp;  $F0)<br>		 	 Next <br>		 	Next   <br>		 	<br>		 	<br>		 	Local Off1:Int=width 'start point for second set of values on row<br>		 	Local Off2:Int=width*2  'start point for thrid set of values on row<br>		    <br>		    	For Local x:Int=0 To Height-1      <br>			      For Local y:Int =0 To width-1<br>			      y1=yuv[y,x]<br>			      u1=yuv[OFF1+y,x]<br>			      u1=yuv[OFF2+y,x]<br>			      <br>			     	y1:-16<br>			    	u1:-128<br>			    	v1:-128<br>			     <br>			      <br>			     <br>			     R = ( 298 * y1 + 409 * v1 + 128)&amp; $ff<br>				 G = ( 298 * y1 - 100 * u1 - 208 * v1 + 128) &amp; $ff<br>                 B = ( 298 * y1 + 516 * u1 + 128) &amp; $ff<br>                 <br>				  <br>			    Dest[(((x*width)+y)*3)]=r<br>			    Dest[(((x*width)+y)*3)+1]=G<br>			    Dest[(((x*width)+y)*3)+2]=b<br>			      <br>			      <br>				Next<br>	<br>		Next <br><br></td></tr></table><br>
<a name="618999"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm . I don't know anything about YUV format or how it's stored, but I'm sure there's plenty on the web about it to help you convert it to RGB. <br><br></td></tr></table><br>
<a name="619031"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Regular K</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://en.wikipedia.org/wiki/YUV" target="_blank">http://en.wikipedia.org/wiki/YUV</a><br><br>Might help <br><br></td></tr></table><br>
<a name="619092"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MarkAM</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> K,<br><br>Thanks ... looked at this and used the Microsoft version but I think I am reading the bytes incorrectly. <br><br></td></tr></table><br>
<a name="628985"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MarkAM</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have updated the class to support 8bpp, 32 bpp and 12bpp YUV (typical for intel webcams).<br><br>The source can be found at <a href="http://www.kita.org.uk/software.html" target="_blank">http://www.kita.org.uk/software.html</a> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
