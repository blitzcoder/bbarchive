<!DOCTYPE html><html lang="en" ><head ><title >Faster Rand?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Faster Rand?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Faster Rand?</a><br><br>
<a name="774685"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is there a faster Rand function, or a faster way to get a random number between 2 given values? <br><br></td></tr></table><br>
<a name="774690"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why do you need faster random numbers? <br><br></td></tr></table><br>
<a name="774701"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Azathoth</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Make an array of random numbers? <br><br></td></tr></table><br>
<a name="774704"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Deleted <br><br></td></tr></table><br>
<a name="774707"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> How slow is it then? <br><br></td></tr></table><br>
<a name="774722"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DJWoodgate</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well if you look at the code Rand uses RndDouble. RndFloat is tighter if you can put up with the reduced precision and range. <br>so for a random number between 3.0 to 5.0<br>r#=3.0+RndFloat()*2.0 <br><br></td></tr></table><br>
<a name="774761"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Filling an Array with 50000 random numbers takes about one minute. Sorting it takes about 24 milliseconds... I need to fill this array to make some performance tests on a engine I'm developing. <br><br></td></tr></table><br>
<a name="774763"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try a <a href="http://en.wikipedia.org/wiki/Mersenne_twister" target="_blank">Mersenne twister</a>. <br><br></td></tr></table><br>
<a name="774772"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ziggy, are you using RAND (integer return) or RND (float/double) return? Filling an array with 50000 random numbers on my crappy laptop takes 12ms when using rnd so why would it take you a minute? <br>rndfloat is twice as fast. Have you got any code which shows your '50000 random number array in 1 min' issue? <br><br></td></tr></table><br>
<a name="774773"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not here, but I'll post it. It is not an array of floats, it is an array of types containing two folats, each one of them with a different dand, so at the end it is to fill an array with 100,000 rands. I'm using rand(MinValue, MaxValue). Is it any faster use MinValue + Rnd()*(MaxValue-MinValue)  ? <br><br></td></tr></table><br>
<a name="774779"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nelvin</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe you're more bound to the limits of the memory manager than to random number generation which usually is quite fast even using typical standard implementations.<br>Shouldn't take more than 1-2 minutes to create a test on your machine creating 100.000 rands into a simple float/int array. <br><br></td></tr></table><br>
<a name="774785"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> First thing, RAND returns integers doesn't it?<br>MinValue + Rnd()*(MaxValue-MinValue) was twice as fast on my system but... try it.<br>It took me 6 ms to fill a 50000 float array using that method so I can't believe doing 100000 will take 10 times longer &lt;edit&gt; sorry 10,000 times longer - I think.<br>My guess is this is going to be code specific. For some reason I think it's going to be GC related. <br><br></td></tr></table><br>
<a name="774794"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SculptureOfSoul</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, this really isn't like filling an array at all, when it comes to speed. You've got an array of objects with separate pointers to the fields for floats, so the 100,000 floats aren't going to be in a nice big hunk of contiguous memory like they would if they were actually in an array.<br><br>I still find it hard to believe that that would make it an order of magnitude slower, but I suppose it's possible. <br><br></td></tr></table><br>
<a name="774798"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Something like this?<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Type ttest
'	Field f1:Float = Rnd(3.0 , 5.0)
'	Field f2:Float = Rnd(3.0 , 5.0)
	Field f1:Float = 3.0 + RndFloat() * 2.0 
	Field f2:Float = 3.0 + RndFloat() * 2.0 
End Type
Local array:ttest[50000]
Local t1:Int=MilliSecs()
For Local loopy:Int = 0 To Len(array) - 1
	array[loopy] = New ttest
Next
Local t2:Int = MilliSecs()
Print t2-t1
</textarea><br>?<br>This takes 22ms as-is and 36 if I use standard rnd. <br>It really is going to need some code to show us what you're doing though. <br><br></td></tr></table><br>
<a name="774802"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> There was a bottleneck in the objects creation algorithm that were filling the array. Now it takes 74 millisecons to fill the array with rand, and 58 using rnd(). Debug enabled. So it is solved. Thanks to everybody! <br><br></td></tr></table><br>
<a name="774820"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Eureka.  OK I'll stop worrying about my occasional use of Rand then :-) <br><br></td></tr></table><br>
<a name="774990"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> See?  This is why I asked you why you needed faster random numbers.  I figured you must be doing something wrong! :-) <br><br></td></tr></table><br>
<a name="775275"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MrCredo</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> i posted this a time ago to bug-forum... but all people like this slow function and nothing happen...<br><br>so my tip is: DO NOT USE THIS SLOW BBMAX-RAND FUNCTION<br><br>instead just use gcc-rand-function<br><br><a href="http://www.blitzbasic.com/Community/posts.php?topic=65474#731786" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=65474#731786</a><br><br><br><div class="quote"> See? This is why I asked you why you needed faster random numbers. I figured you must be doing something wrong! :-) <br></div><br><br>why you need slow functions? <br><br></td></tr></table><br>
<a name="775288"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi MrCreado, your crnd function is way faster. Thanks <br><br></td></tr></table><br>
<a name="775305"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> comparison? <br><br></td></tr></table><br>
<a name="775329"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> here:<br><pre class=code>
Extern "C"
	Function crand:Int () = "rand"
End Extern

Function fastrand:Int (start:Int, ende:Int)
	Return crand() Mod (ende-start+1) + start
EndFunction

Local i:Int = 0
Local F:Int
Local M:Int = MilliSecs()
For i = 0 To 1000000
	f = fastrand(1,1000)
Next
Print "time to do fast rand: " + (MilliSecs()-M)

M= MilliSecs()
For i = 0 To 1000000
	f = Rand(1,1000)
Next
Print "time to do rand: " + (MilliSecs()-M)
</pre><br><br>in my computer:<br>time to do fast rand: 126<br>time to do rand: 410<br><br>This sample code was posted by MrCredo in another thread, and it seems to be about four times faster <br><br></td></tr></table><br>
<a name="775336"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> wow.  OK but is there a difference in the "Quality" of the random numbers?<br><br>Of course it could be speeded up more by inlining the actual rand function.  I wish BMax had the option to write INLINE after a function declaration... <br><br></td></tr></table><br>
<a name="775340"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> The only difference is that this fastrand function return a value between two integers, it is not using doubles. that's why it is faster (I think).<br><br>I think this is a better test:<br><pre class=code>
Extern "C"
Function _crand:Int () = "rand"
End Extern

Function IntRand:Int (start:Int, ende:Int)
	Return _crand() Mod (ende-start+1) + start
EndFunction

Local i:Int = 0
Local F:Int
Local M:Int 
Local Time1:Int
Local Time2:Int
Print "Doing test on 10 cicles of 100,000 iterations"
For Local K=1 To 10
	M= MilliSecs()
	For i = 0 To 1000000
		IntRand(1,1000)
	Next
	Time1 = MilliSecs()-M
	
	M= MilliSecs()
	For i = 0 To 1000000
		Rand(1,1000)
	Next
	Time2 = MilliSecs()-M
	Print "time to do rand: " + Time2 + " IntRand: " + Time1 + " Speed improvement: " + Int(((time2-time1)/Double(time2)) * 100) + "%"
	Next
Print "Done"
</pre><br>The results on my machine are:<br><div class="quote"> <br>Doing test on 10 cicles of 100,000 iterations<br>time to do rand: 429 IntRand: 143 Speed improvement: 66%<br>time to do rand: 433 IntRand: 138 Speed improvement: 68%<br>time to do rand: 429 IntRand: 139 Speed improvement: 67%<br>time to do rand: 431 IntRand: 143 Speed improvement: 66%<br>time to do rand: 431 IntRand: 139 Speed improvement: 67%<br>time to do rand: 432 IntRand: 137 Speed improvement: 68%<br>time to do rand: 435 IntRand: 138 Speed improvement: 68%<br>time to do rand: 431 IntRand: 139 Speed improvement: 67%<br>time to do rand: 470 IntRand: 137 Speed improvement: 70%<br>time to do rand: 432 IntRand: 139 Speed improvement: 67%<br>Done<br> <br></div> <br><br></td></tr></table><br>
<a name="775347"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlackSp1der</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> buuuut, you can't use  SeedRnd to change the numbers sequence. So it's not random at all. :S <br><br></td></tr></table><br>
<a name="775359"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> unless you add this to the source:<br><pre class=code>
Extern "C"
	Function crndseed:Int(val:Int) = "srand"
	Function _crand:Int () = "rand"
End Extern
Function FastRand:Int (start:Int, ende:Int)
	Return _crand() Mod (ende-start+1) + start
EndFunction
</pre><br>Adding this code, you can use the function cRndSeed(Value) to set the rand seed.<br><br>Example:<br><pre class=code>
Extern "C"
	Function crndseed:Int(val:Int) = "srand"
	Function _crand:Int () = "rand"
End Extern
crndseed(MilliSecs())
Function FastRand:Int (start:Int, ende:Int)
	Return _crand() Mod (ende-start+1) + start
EndFunction

For Local i = 0 To 10
	Print FastRand(1,10)
Next
</pre><br>run it several times to get different random numbers each time. <br><br></td></tr></table><br>
<a name="775377"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> well I'm gonna bookmark this one. <br><br></td></tr></table><br>
<a name="775523"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ziggy: What CPU do you have? On my core 2 Duo the differences appear even larger: a pretty solid 77%. (I had to increase the number of iterations though, the original finished way too quickly to have reliable comparisons)<br><br><div class="quote"> <br>Doing test on 10 cicles of 10,000,000 iterations<br>time to do rand: 792 IntRand: 177 Speed improvement: 77%<br>time to do rand: 792 IntRand: 177 Speed improvement: 77%<br>time to do rand: 791 IntRand: 179 Speed improvement: 77%<br>time to do rand: 790 IntRand: 177 Speed improvement: 77%<br>time to do rand: 791 IntRand: 178 Speed improvement: 77%<br>time to do rand: 793 IntRand: 185 Speed improvement: 76%<br>time to do rand: 793 IntRand: 177 Speed improvement: 77%<br>time to do rand: 791 IntRand: 176 Speed improvement: 77%<br>time to do rand: 791 IntRand: 176 Speed improvement: 77%<br>time to do rand: 791 IntRand: 177 Speed improvement: 77%<br> <br></div> <br><br></td></tr></table><br>
<a name="775531"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep, I just put this into the ZG BMax Framework.  Awesome guys. <br><br></td></tr></table><br>
<a name="775544"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >H&amp;K</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I wish BMax had the option to write INLINE after a function declaration...  <br></div><br><br><div class="quote"> well I'm gonna bookmark this one <br></div><br>Yep. And yep <br><br></td></tr></table><br>
<a name="775557"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> time to do rand: 792 IntRand: 177 Speed improvement: 77% <br></div><br><br>Actually... shouldn't that be a speed improvement of 440%? <br><br></td></tr></table><br>
<a name="775570"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> 337% cos you got to take off the first 100%.  e.g. 200 is a 100% increase on 100, not 200%. <br><br></td></tr></table><br>
<a name="775571"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you look to the source code, the percent is the time saving comparison. (Randtime - FastRandTime) / Randtime * 100 <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
