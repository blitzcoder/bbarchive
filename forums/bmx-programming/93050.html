<!DOCTYPE html><html lang="en" ><head ><title >Faster Collisions</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Faster Collisions</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Faster Collisions</a><br><br>
<a name="1062354"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WERDNA</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've noticed the ImagesCollide command, and <i> Especially </i> the<br>ImagesCollide2 command are pretty darn slow if you have a bunch<br>of Objects controlled by a For Loop colliding with something.<br><br>Is there something that is still relatively close to pixel perfect, but<br>much more efficient?<br><br>What about the CollideImage command, which I 'think' I understand,<br>but does seem mildly confusing.<br><br>Also between the following two scenarios, which would be quicker?<br><br>Scenario #1: Bullets and Ships. Both objects are controlled by a<br>For Eachin loop, and a second For loop testing for collisions between<br>bullets, and ships, is run inside the bullet loop.<br><br>Scenario #2: Global Bullets and Ships. All enemy ships\bullets that<br>might possibly appear within the game, are declared before hand<br>as Globals(I.e, Global Bullet1:Bullet = new Bullet, Global Bullet2:Bullet = new Bullet, etc),<br>and then seperate collision checks are run between each bullet and<br>enemy. Although a seemingly noob way to set things up, I'm just<br>wondering what the benefits of this might be. And then everytime<br>an enemy ship 'died' I would just hold that particular object in reserve<br>until I needed a new enemy ship to spawn, and simply change it's<br>stats.<br><br>Thanks,<br><br>W E R D N A <br><br></td></tr></table><br>
<a name="1062359"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could minimize the number of things you're testing collisions for with some pre-logic along the lines of if object 1 too far from object 2 don't bother, etc. I thing the collision routines do bounding box checking ahead of the pixel detection but if not you could add that as well... IMO simplest method is just to use he expensive routines less frequently, rather than trying to find an alternative as they're already pretty darn good as is.<br><br>Depending on the type of game, etc etc. it might be practical to have region groupings where you split the screen or game world into a grid essentially and track what's in what area and only compare collisions for things that are in the same and possibly adjacent areas depending on how you set it up, to handle collisions near edges... <br><br></td></tr></table><br>
<a name="1062361"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Another thought: if you could represent your graphics with a vector collision map there might be faster vector collision math...<br><br>and the obvious if you can declare their collisions by a circle you just need the distance and the 2 radiuses (radi-i?) to see if they overlap... <br><br></td></tr></table><br>
<a name="1062369"></a>

<a name="1062370"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Using layers with the ResetCollisions/CollideImage commands is an order of magnitude faster than multiple calls to the ImagesCollide commands. <br><br>Unfortunately the CollideImage example code only touches on how to best utilize the system.<br><br>The following tutorial may be useful even if it incorrectly attributes Mark as the author of BlitzMax's collision system:<br><br><a href="http://www.2dgamecreators.com/tutorials/gameprogramming/collision/T2%20Collision.html" target="_blank">http://www.2dgamecreators.com/tutorials/gameprogramming/collision/T2%20Collision.html</a><br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1062394"></a>

<a name="1062395"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have never used the built-in collisions!<br><br>I just do this<br><br><pre class=code>	Method collides:Int(size, location:TVec2)
		size = Max(size, get_size())/2
		Return (location.x + size &gt;= _position.x - size ..
			And location.x - size &lt;= _position.x + size ..
			And location.y + size &gt;= _position.y - size ..
			And location.y - size &lt;= _position.y + size)
	End Method</pre><br><br>Where get_size() gives the size of the current object. It does square checking, which isn't pixel perfect, but usually it doesn't matter. Make the size slightly smaller than the object's actual size, and it's harder to notice. In fact it can look better - the bullet will explode slightly into the image, and not just on the outskirts, adding a small bit of depth to the effect.<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1062405"></a>

<a name="1062406"></a>

<a name="1062407"></a>

<a name="1062408"></a>

<a name="1062409"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sometimes I do this:<br><br><pre class=code>
if RectsOverlap (x1,y1,w1,h1,x2,y2,w2,h2)
	if ImagesCollide (image1,x1,y1,image2,x2,y2)
		'BOOM!
	end if
end if

...

Function RectsOverlap:Int(x0:Float, y0:Float, w0:Float, h0:Float, x2:Float, y2:Float, w2:Float, h2:Float)
	If x0 &gt; (x2 + w2) Or (x0 + w0) &lt; x2 Then Return False
	If y0 &gt; (y2 + h2) Or (y0 + h0) &lt; y2 Then Return False
	Return True
End Function

</pre><br><br>So you get the fast rectsOverlap, if that is true then do the pixel perfect command..<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1062412"></a>

<a name="1062413"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jesse</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> SHMUPS rarely do pixel perfect collision. Most use bounding box detection for collision. it's used on the player ship as well.  the box is usually smaller then the image and the player bounding box is a lot smaller than the image itself. Ultimately it is up to the game designer to decide which size bounding box is best for the game. Some instances the object will have more than one bounding box. depending on the shape of the object. <br>An alternative is to use polygon collision which is faster than pixel perfect collision but still slower than bounding box collision. even Polygon collision is often used along with bounding box collision for speed. <br><br>and it really isn't that important to use pixel perfect collision. Realize that most bullet collision move so fast that it won't matter where along the object the bullet hit as long as it hit: disapear the bullet, disappear the ship and create the explosion/effect and that is all there is to it.<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1062417"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >matibee</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="/posts.php?topic=85634" target="_blank">Use this</a> or the Pete Rigz module <a href="http://www.blitzbasic.co.nz/Community/posts.php?topic=88512" target="_blank">here</a>. <br><br></td></tr></table><br>
<a name="1062434"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WERDNA</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  You could minimize the number of things you're testing collisions for with some pre-logic along the lines of if object 1 too far from object 2 don't bother, etc.  <br></div><br>I'm already using this one :)<br><br><div class="quote">  Using layers with the ResetCollisions/CollideImage commands is an order of magnitude faster than multiple calls to the ImagesCollide commands. <br><br>Unfortunately the CollideImage example code only touches on how to best utilize the system.<br><br>The following tutorial may be useful even if it incorrectly attributes Mark as the author of BlitzMax's collision system:<br><br><a href="http://www.2dgamecreators.com/tutorials/gameprogramming/collision/T2%20Collision.html" target="_blank">http://www.2dgamecreators.com/tutorials/gameprogramming/collision/T2%20Collision.html</a>  <br></div><br>Thanks skidracer. I'll definitely give this a read. I figured that CollideImage was<br>faster, but wasn't fully sure how to use it to it's best potential.<br><br><div class="quote">  Method collides:Int(size, location:TVec2)<br>		size = Max(size, get_size())/2<br>		Return (location.x + size &gt;= _position.x - size ..<br>			And location.x - size &lt;= _position.x + size ..<br>			And location.y + size &gt;= _position.y - size ..<br>			And location.y - size &lt;= _position.y + size)<br>	End Method  <br></div><br>Wow Czar this will be perfect!<br>I did something similar in my RoboAttack3D came, albeit, without the size variable,<br>so I think this should work out great :)<br><br><br>Lol, Jesse and therevills, both of you have been answering an aweful lot of my questions<br>lately, and always with good advice to. Major thanks to the both of you ^_^ <br>Although at this point, I think Czar's option<br>will be the very best ;)<br><br>Tis simple, and I <i> like </i> simple, above all other options, as long as it works.<br><br>@Matibee<br>Awesome suggestion. I'll try Czar's first, and see how well that serves my purposes,<br>but if I want  something else, I'll give yours(Or one of the numerous other options ;) a shot.<br><br>Thanks a bundle everyone.<br><br>This is what I really love about the blitz community. Sure we might fight sometimes,<br>and some of us(puki) are a tad weird, but there is no better place to come for expert<br>advice about how to bring out the full potential of the blitz languages.<br><br>W E R D N A <br><br></td></tr></table><br>
<a name="1062833"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Richard Betson</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am using this example as a basis for collision in Phoenix SS. Works good.<br><br><a href="http://www.blitzmax.com/codearcs/codearcs.php?code=998" target="_blank">http://www.blitzmax.com/codearcs/codearcs.php?code=998</a><br><br>L8r <br><br></td></tr></table><br>
<a name="1063049"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> You want to at least use some kind of spatial partitioning/acceleration structure even if it's just a grid of rectangles. As objects move and change which cell they're in you detach it from the linked list of the cell it was in and attach it to the linked list of the new cell. Then when you do collision tests you only have to tests against the items in the surrounding cells that are close enough to have a likely collision. This will massively speed up your collision tests. Then perhaps if you find that two items will likely collide, use ImagesCollide or similar to do the pixel-perfect. <br><br></td></tr></table><br>
<a name="1063160"></a>

<a name="1063161"></a>

<a name="1063162"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice one Czar.  Reminds me that I need to put some collision commands into my sprite module!<br><br><br>WERDNA since your game is a vertical scrolling game you could probably eliminate a lot from the collistion checking by doing a<br><br>If bullet.x&gt;ship.x (ship is eliminated, check next ship)<br><br>Something along those lines.<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1063163"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >shinkiro1</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tile your Area in Sections (ex in 4)<br>Ex: You have 100 Objects which could collide with each other.<br>100 * 100 = 10000 Checks<br><br>When tiling throw 4:<br>100/4 = 25<br>(25 * 25) = 625 Check in 1 Area<br>625 * 4 = 2500 Checks<br><br>Although, an Object can be in Multiple Areas too, then the number would be a little higher.<br>But it helps a lot ;D<br><br>Also when 1 of your Objects has checked against each other, remove it from the Checklist. This will cut the number of checks in half (around in half). <br><br></td></tr></table><br>
<a name="1063172"></a>

<a name="1063173"></a>

<a name="1063175"></a>

<a name="1063176"></a>

<a name="1063177"></a>

<a name="1063179"></a>

<a name="1063181"></a>

<a name="1063182"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Chroma</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good idea shinkiro1.  That reminds me of that SceneGraph thing that JoshK did awhile back.  That could probably be used and as I recall, his code was lightning fast.  I think the thread named was "Let's talk about scenegraphs".<br><br>Another idea that just hit me is split the checks up into 2 cycles or even 4 using multiple lists.  And when you're making enemies just alternate the list you assign them to.  Enemy1 goes to list 1, enemy2 to list 2, enemy3 to list 1, etc etc.<br><br><pre class=code>
colCheck :+ 1

If colCheck = 4 colCheck = 1

Select colCheck
   Case 1 CheckCollision(player,EnemyList1)
   Case 2 CheckCollision(player,EnemyList2)
   Case 3 CheckCollision(player,EnemyList3)
   Case 4 CheckCollision(player,EnemyList4)
End Select</pre><br><br>If you split them up into 4 lists that's all enemy collisions checked every 4 cycles.  Which if your logic is set to 100fps, all enemies are checked every .04 seconds.<br><br>So let's say you have 1000 objects on screen needing collision checking.  You'd be doing 250 collision checks a cycle instead of 1000.  In a shooter, I don't think the loss of precision would even be noticeable.<br><br><font class="tiny">Last edited 2010</font> <br><br></td></tr></table><br>
<a name="1063214"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dynaman</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> ImaginaryHuman had the best idea.  If each area is exactly the size of the largest sized item then you just need to check with each item in 9 areas (the one it is in and all those in the 8 adjacent areas).<br><br>Every time an object is moved you would need to update a list of what is in each area, removing it from the one it was in and adding it to the one it enters.  Unless you have a LOT of objects a simple array would probably suffice for it instead though. <br><br></td></tr></table><br>
<a name="1063231"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >WERDNA</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  WERDNA since your game is a vertical scrolling game you could probably eliminate a lot from the collistion checking by doing a<br><br>If bullet.x&gt;ship.x (ship is eliminated, check next ship)<br><br>Something along those lines.  <br></div><br>I already have that in there :)<br><br>I still haven't had a chance yet, with Christmas coming up and everything to try some<br>of these ideas out. Hopefully I'll have some time this morning.<br><br><br>Thanks everyone!<br><br>This will all help out tremendously.<br><br><br>W E R D N A <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
