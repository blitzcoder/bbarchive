<!DOCTYPE html><html lang="en" ><head ><title >Stopping Simultaneous File Access</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Stopping Simultaneous File Access</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Stopping Simultaneous File Access</a><br><br>
<a name="1151413"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Luke111</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello all,<br>I have a (quite large) application I am writing. It has a couple of problems, and I am not going to ask you to fix it. I just need some help with concepts.<br><br>This application (could) load from and save to the same file(s) at the same time. This is not the desired effect, of course.<br>Pretty much, I need a mutex on the file, kindof like a lockfile, which I believe only works for processes, not threads.<br><br>Should I make a type which contains the file name and a mutex, and instantiate that type on the first access of the file; then use that mutex to stop more than one operation on the file at any given time, saving all the instances of this type in a list with another mutex protecting it, stopping multiple threads from adding/retrieving the filename/mutex data from this list simultaneously? Or is there a better way?<br><br>Thanks!<br>Luke <br><br></td></tr></table><br>
<a name="1151414"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GfK</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you're using threads surely you can just use a mutex in your load/save functions to make sure they cannot both be happening at the same time?  Don't know enough about threads (or your code) to give any specific advice but that's the first thing that comes to mind. <br><br></td></tr></table><br>
<a name="1151420"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Uh, have you tested this? There's a reason why the "<a href="http://en.wikipedia.org/wiki/Lock_file" target="_blank">lock file pattern</a>" exists... and that is that the OS is already supposed to detect this sort of thing for you: it <i>should</i> fail to open a file that's already in use.<br><br>I could be being stupid and misremembering whether Blitz actually does this by default, but at any rate the service is certainly already <i>available</i> at the OS level, and if it's not default behaviour for files to be locked, then you can certainly achieve this using system calls instead. <br><br></td></tr></table><br>
<a name="1151424"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Luke111</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> GfK: Theoretically that's what I was thinking. The problem is that there is more than one file, so I wanted to do (basically) a list of mutexes that are associated with the each individual file. The application is my Minecraft clone, and the problem is loading and saving the data files. The way I am doing it is to run-length-encode each 16x128x16 blocks, then store them in a file as a string. Every chunk has it's own file for quick access. Once you go out of range of a chunk (thats 16x128x16 blocks), the chunk is sent to the disk and data is unloaded from the program. If you have been to a chunk before, it loads it from the file when you get close, otherwise it randomly generates a new one.<br><br>Also (I know, not the best idea) whenever you build or delete from a chunk, it saves it on the disk. But I plan to get rid of that shortly, making it more streamlined.<br><br>There is a thread for every chunk being loaded, and saved. That is where the problem is. If you delete a block, then run off the chunk fast, it may try to save it while saving it, or load it while saving it, or something weird like that. <br><br></td></tr></table><br>
<a name="1151429"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Luke111</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yasha: So, does that only apply to the process, or to the threads of the process? And I will look at the brl code to see if it does or does not lock the file from being accessed again. I believe that there is a parameter in the open file call that will say whether to or not. <br><br></td></tr></table><br>
<a name="1151448"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Use your own lockfiles (like libre/openoffice does)<br>1) user wants to open openfile.txt<br>2) writeable = file_exists(openfile.txt.lock) ? true : false<br>3) create openfile.txt.lock if not existing and writeable<br>4) save<br>5) quit ? delete openfile.txt.lock : ...<br><br><br>Should be enough.<br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
