<!DOCTYPE html><html lang="en" ><head ><title >Difference between garbage collectors?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Difference between garbage collectors?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Difference between garbage collectors?</a><br><br>
<a name="1331483"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I recently decided to do a threaded build of my engine and found that it crashes when the garbage collector collects.  Since threaded builds use a different gc, I'm wondering if anyone knows of any specific differences between them that I should be looking out for..? <br><br></td></tr></table><br>
<a name="1331720"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> That shouldn't happen, especially if all you've done is flick a compiler switch.<br>If you've done more then it could be your multi-thread code that's the issue.<br><br>Can you reproduce it with a smaller 'postable' example ? <br><br></td></tr></table><br>
<a name="1331724"></a>

<a name="1331726"></a>

<a name="1331737"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm not using any multi-thread code.  There is clearly a bug in my code somewhere, but memory issues can be hard to pin down.  The disparity is definitely between the threaded and non-threaded gc, but I don't know what they do differently (other than one handles circular references).  :/ <br><br></td></tr></table><br>
<a name="1331729"></a>

<a name="1331738"></a>

<a name="1331739"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Can you reproduce it with a smaller 'postable' example ? <br></div>Certainly, that is the next step, but not so easy to do.  At one point, my engine was working with no noticeable issues in an older NG, which (I think) uses the same garbage collector.  Had trouble getting the most recent version of NG to compile, though.  :( <br><br></td></tr></table><br>
<a name="1331760"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> The vanilla bmax GC for threaded apps is really bad, don't even bother using it unless you can guarantee that you wont be creating or destroying objects in a thread. It's very slow and unstable.<br><br>However, the threaded gc in bMax-NG is very stable and fast. I recomend that. <br><br></td></tr></table><br>
<a name="1331791"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, I thought they were the same (Boehm), but I guess that changed. <br><br></td></tr></table><br>
<a name="1331798"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> BlitzMax used Boehm GC for a few builds when Mark introduced thread support (around version 1.37 iirc), but later swapped it out for his own. <br><br></td></tr></table><br>
<a name="1331807"></a>

<a name="1331808"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah, I see.<br><br>This is a shot in the dark, but...<br><br>On another note that may or may not be related to the gc, I have one issue that's bitten me before and I've never understood.  The (vanilla) behavior of...<br><br>Int Ptr( Byte Ptr o )<br><br>...seems different than...<br><br>Float Ptr( Byte Ptr o )<br><br>...where o is just an Object.  The volatility only happens in release and debug seems okay.  Any idea why this might be? <br><br></td></tr></table><br>
<a name="1331809"></a>

<a name="1331810"></a>

<a name="1331813"></a>

<a name="1331814"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Side-stepping why the code behaves differently between Int Ptr/Float Ptr and more importantly, depending on why you have that code then you may need to manually add/remove a reference to the Object that the Byte Ptr points to - is it interacting with c/c++/asm code? If yes or no then that can also cause a problem.<br><br>What's the reason you're using a Byte Ptr for an Object? <br><br></td></tr></table><br>
<a name="1331811"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Any idea why this might be? <br></div><br>The debugger code is keeping a reference to the Object so that the gc doesn't reclaim it. In release builds there is plenty of code stripped out which will allow the gc to release the Object at a more opportune time. <br><br></td></tr></table><br>
<a name="1331815"></a>

<a name="1331816"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, it's not interacting with another language.  I am storing offsets to the fields in an object and modifying those fields.  Yes, I am aware that there are other ways to do it using reflection, but they are slow.<br><br>Yes, I know this way of doing it is potentially volatile.  Had this discussion before, you see...  :D<br><br>I have noticed that Int Ptr seems to be slightly different than Float Ptr, but I'm not sure how or why.  Had the same issue with passing an Int Ptr into a shader and found I had to do it as a Float Ptr to get it to work.  On the GLSL side, it still sees it as Int.<br><br>Anyway, 'wish I understood the GC better.  Everyone says that GC collects "when it wants to," but what does that mean?  Is it running in a separate thread? <br><br></td></tr></table><br>
<a name="1331820"></a>

<a name="1331821"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> The debugger code is keeping a reference to the Object so that the gc doesn't reclaim it. <br></div>Ah, that's helpful...but doesn't that imply the GC could try to reclaim a local in the middle of a method?  Having trouble making sense of that, but then I haven't given the full context.<br><br>I have a method that basically calls something like this...<br><br>Int Ptr( Byte Ptr o )[ offset ] = NewIntValue<br><br>Why would the reference to o get reclaimed (in the middle of executing the method)?  And why would this NOT happen if it's Float Ptr? <br><br></td></tr></table><br>
<a name="1331822"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, you need to be <b>very</b> careful about keeping pointer references to objects. If the object is not referenced as an object anywhere else, it will be flagged for collection.<br>As col notes, debug mode may increase the likelihood of a reference being maintained for longer, but should not be relied upon.<br><br>Otherwise, see blitz_gc.h with regards manually handling the reference count of objects (BBRETAIN/BBRELEASE) that are to be used outside of GC scope.<br>Once you head down this path, you need to be sure you are correctly tracking your own usage of the objects, and retaining/releasing as required.<br>wxMax uses this feature heavily in order to attach BlitzMax objects to wxWidgets objects.<br><br>Have fun! :-) <br><br></td></tr></table><br>
<a name="1331824"></a>

<a name="1331825"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Aaaah, yes.  The cloud is starting to dissipate!  Thanks for the lesson, guys! <br><br></td></tr></table><br>
<a name="1331826"></a>

<a name="1331827"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote">  Int Ptr( Byte Ptr o )[ offset ] = NewIntValue <br></div><br>Which is all well and good if you intend to stick to 32-bit "vanilla" land forever. But I guess you are happy with that.<br><br><div class="quote">  And why would this NOT happen if it's Float Ptr <br></div><br>Could be coincidence/luck/misfortune?<br>Have a look at the generated assembly and see if it does something wildly different?<br><br><div class="quote">  Everyone says that GC collects "when it wants to," but what does that mean? Is it running in a separate thread?  <br></div><br>Everything is done in a single thread (NG+Boehm has parallel collection on supported platforms)<br><br><br>When the GC attempts to create a new object, it checks to see if it wants to free up some space before allocating new blocks of memory for objects. If it does, it will run a collection, which may result in unused resources being freed/collected.<br>The GC is written in C. See blitz.mod/blitz_gc_ms.c or blitz_gc_rc.c for the implementations. See bbGCAllocObject(), and follow the logic.<br><br>Have more fun! ;-) <br><br></td></tr></table><br>
<a name="1331828"></a>

<a name="1331829"></a>

<a name="1331830"></a>

<a name="1331831"></a>

<a name="1331832"></a>

<a name="1331833"></a>

<a name="1331834"></a>

<a name="1331835"></a>

<a name="1331836"></a>

<a name="1331837"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Everything is done in a single thread <br></div>Hrrrmmm, so here's a method...<br><br>Method NewInt( o:Object, offset:Int, NewIntValue:Int )<br>  Int Ptr( Byte Ptr o )[offset] = NewIntValue<br>EndMethod<br><br>Why would o not have a reference?  Surely, being an argument to the function counts for something?  If not, then why would this not resolve it?<br><br>Local oc:Object = o<br>Local bp:Byte Ptr = Byte Ptr o<br>Local ip:Int Ptr = Int Ptr bp<br>ip[offset] = NewIntValue<br><br>Incidentally, I have externed versions of BBRETAIN/BBRELEASE.  Tried those, but it surprisingly didn't help.  Seems I'm still missing something.<br><br>Using the far less volatile reflection (FindField) works.  I've probably been overly concerned about performance and should just do it that way now.  Its actual use is mostly cloning and loading/saving.<br><br><div class="quote"> But I guess you are happy with that. <br></div>Yes and no. Apologies, Brucey, but the explanation is long and involved.  The short version is that I've been at this for a long time, having left a prosperous game dev job, and now the pressure is on to make something of it.  I won't be selling my engine. <br><br></td></tr></table><br>
<a name="1331855"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> The code above looks as though it *should* be ok.<br><br>Assuming that the parameters are all valid? You can verify with something old school such as...<br><pre class=code>
Method NewInt( o:Object, offset:Int, NewIntValue:Int )
	WriteStdOut("Entered NewInt: o: " + Hex(Int Byte Ptr(o)) + " offset: " + offset + "~n")
	Int Ptr( Byte Ptr o )[offset] = NewIntValue
	WriteStdOut("Leaving NewInt~n")
EndMethod
</pre><br><br>You can do the same for the code that's calling that function to make sure that the values are the same.<br><br>Does it crash at the same place every time? Or in code that looks similar to other code that's also causing a problem? <br><br></td></tr></table><br>
<a name="1331858"></a>

<a name="1331859"></a>

<a name="1331860"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Had the same issue with passing an Int Ptr into a shader and found I had to do it as a Float Ptr to get it to work. On the GLSL side, it still sees it as Int. <br></div><br><br>I did read that somewhere else too - not here but in the specs. If I recall correctly it had something to do compression within GLSL which also tied in with how GLSL interprets the data - normalized and/or un-normalised values spring to mind. Depending on which GL version you're using are you using the correct API function as GLSL has various *I* versions of it's shader functions, with the 'I' meaning that you're passing in an integer value as opposed to a float value. <br><br></td></tr></table><br>
<a name="1331871"></a>

<a name="1331872"></a>

<a name="1331873"></a>

<a name="1331874"></a>

<a name="1331875"></a>

<a name="1331876"></a>

<a name="1331877"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> The code above looks as though it *should* be ok. <br></div>Hrmm, then maybe it is and I'm barking up the wrong tree.  :(<br><br>I should add that this issue is not exactly the same as my OP.  This is another memory issue that seems related to the GC, but I can't say where it crashes <b>precisely</b> because it works fine in Debug mode.  If I replace that function with an equivalent use of reflection, the crash either stops or happens at a different time or place.  The engine runs, but crashes while I'm doing something else, but consistently from the same action.*<br><br>At the moment, this issue happens only in VR, unless I'm in threaded mode.  I was hoping that resolving the threaded issue would be a catch all...<br><br>* I have an in world gui and use my Vive controller as a laser pointer to select, etc.  That's where it's been failing lately.  I'll "laserover" something and...crashola!  Where that happens seems to change based on which functions I've replaced.  I'm convinced that it's happening in the GC somewhere.<br><br><div class="quote"> GLSL has various *I* versions <br></div>But not the one I'm using, which should be able to take GL_INT instead of GL_FLOAT. <br><br></td></tr></table><br>
<a name="1331878"></a>

<a name="1331891"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Out of curiosity which version are you using?<br><br>As to the issue... I'm sure you'll find the problem eventually. I've been in a similar situation ( c++ ) with bugs of this kind. My scenario was with over 70 threads all interacting and pushing gigs of data all over the place. Extensive logs were the only way to catch the bugger - you can never have too much data when trying to debug at the point of crashing. <br><br></td></tr></table><br>
<a name="1331883"></a>

<a name="1331932"></a>

<a name="1331933"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> which version are you using? <br></div>My BlitzMax change log says 1.52.<br><br>EDIT: Heh, you probably meant GL...  It's just an extension of Blitz' GL module.  I'm sticking to functions that work with 2.0 ES.  Nothing fancy, but the shaders look nice.<br><br><div class="quote"> 70 threads all interacting <br></div>Sounds scary to me!<br><br>Thanks, I will keep looking... <br><br></td></tr></table><br>
<a name="1332030"></a>

<a name="1332031"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Found an error in an initialization of one of my types.  Had changed a field and neglected to update the initialization of the offsets.  I had gone over them three times, but still missed one.  It *seems* to be working now.<br><br>OP is still valid, though.  Does not collect garbage properly in threaded mode.<br><br>Soooo...decided to give NG a try again.  I'd tried it a few days ago, but had an error building modules and didn't want to commit more time to it.  Now the modules are completely built with no errors, but the engine won't even start.<br><br>I get a pop-up that says, "Fatal Error in GC - Too many heap sections."  What the...? <br><br></td></tr></table><br>
<a name="1332033"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> (according to the internet) The GC thinks there no more space to allocate anything else.<br>Perhaps your objects aren't being collected or something - maybe you have references to them all ? <br><br></td></tr></table><br>
<a name="1332034"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> maybe you have references to them all <br></div>That's generally how it works, but I don't think that's 100% true.  Even if it was, why would that cause it to fail?  Shouldn't it just happily wait until something does come along to collect? <br><br></td></tr></table><br>
<a name="1332193"></a>

<a name="1332194"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, I rewrote the type to use reflection and still no dice.  Threaded mode lasts a lot longer before it fails, but it still does.  And NG still doesn't work at all.<br><br>The only non-standard thing I'm doing that I can think of is that I convert Byte Ptr to Object frequently in my glue code (almost exclusively Lua FFI calls).  Works fine in vanilla non-threaded.  :/<br><br>Perhaps I'm having a misunderstanding regarding RETAIN and RELEASE.  If I do this...<br><br>Local mo:MyType = MyType( GetBMaxObject( bp ) )<br><br>...where bp is a Byte Ptr to an object, shouldn't <b>Local mo</b> increase the ref count? <br><br></td></tr></table><br>
<a name="1332198"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> If it really is a GC issue, it might surface if you force a collection (after each new allocation for example).<br>Also, you could instrument the GC itself and log some stats on allocated/freed pointers and various totals.<br>But i would use GDB instead, that will at least give you the location of the crash and you can wind your way out to something relevant. <br><br></td></tr></table><br>
<a name="1332199"></a>

<a name="1332200"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> you could instrument the GC itself <br></div>I could if I had the slightest clue how to do that...<br><br><div class="quote"> i would use GDB instead <br></div>Never used it before, but may be worth looking into, thanks. <br><br></td></tr></table><br>
<a name="1332201"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> A lot depends on where you are getting "bp" from.<br>If you are storing a pointer to an Object somewhere, that doesn't count as a reference to the object. In this case, either you need to hold a reference to the Object in BlitzMax, or manually handle retain/release of the object while you hold a copy of it outside of the GC.<br>For each retain, you must release when you are no longer holding a copy of the reference - otherwise the Object will never be collected.<br><br>If you are having issues in the threaded build (and in NG), then chances are your code has bugs that happen not to show up when you are doing a standard build.<br>Of course, using offsets as you are to reference things, may not work in the same way on NG - so YMMV there. <br><br></td></tr></table><br>
<a name="1332202"></a>

<a name="1332203"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> using offsets as you are to reference things, may not work in the same way on NG <br></div>Changed that class so that I'm no longer using offsets and using reflection, instead.  However, the same system was in place last April and it worked with that version of NG.<br><br>/shrug <br><br></td></tr></table><br>
<a name="1332206"></a>

<a name="1332208"></a>

<a name="1332214"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> Your explanation fits my understanding.  I don't think I'm storing a Byte Ptr to an object anywhere.  It's just how objects get passed into the FFI functions and they always have references, since they are in object pools.<br><br>The only place I'm using RETAIN/RELEASE is when pushing objects to the Lua stack.  I might've just learned that RELEASE isn't getting called, but even so, I wouldn't expect that to cause a failure - just a slow memory leak.<br><br>EDIT: Nevermind, RELEASE is getting called.  'Been a long time since I looked at that code.  ;) <br><br></td></tr></table><br>
<a name="1332213"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> then chances are your code has bugs that happen not to show up when you are doing a standard build <br></div>In which case, it would be helpful to know how they differ.  :) <br><br></td></tr></table><br>
<a name="1332225"></a>

<a name="1332226"></a>

<a name="1332231"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> In which case, it would be helpful to know how they differ. <br></div><br><br>You said that you were warned in the past about using Byte Ptrs so maybe you know this and I'm repeating but anyway... :p<br><br>Imagine this scenario<br>The GC allocates from the system a pool of memory for itself - ie for Max to use. You create a ton of Objects using up some of the allocated memory. When you use Objects then the GC can track the usage of those Objects and their memory locations within the pool. If you start using BPs however then the GC doesn't know that you actually want to keep an Object instance alive. Because the GC isn't aware of this, then there is now the possibility of 0 references to some Objects and those objects will be marked for collection. What the collection process means is that the memory slot for the Object is allowed to be used again for another Object. No memory is returned to the system, its just returned to the pool ( the GC ). This means that the memory can still be safely accessed via a BP and cast to an Object and can still be used as an Object! although you *should* get BadRef warnings in the console window or editor output pane, point being is that the system won't complain of an Exception Access Violation because the address within the 'still allocated pool' is still valid to be used by the GC. But say you keep allocating Objects... eventually using up all of the memory in the pool. The GC will then do an automatic collection which means that it will run the Delete method of the Objects that were marked for collection ( if there is a Delete method ) and it will start to allow allocation at the now free memory address of the now freed Object. Over time, but still pretty quickly, some Objects that were working and safely being accessed via a Byte Ptr will be overwritten by newly allocated Objects - and bam all of a sudden you're getting crashes as the data at the memory address doesn't make sense for the purpose that your using it. Even an input event generates a new TEvent object which means a new allocation from the GC. So the GC is in constant use, allocating and deallocating, and also collecting when it feel that it needs to.<br><br>I hope that makes sense :p<br><br>Of course the above assumes that you are using Byte Ptr to hand objects to outside code/libs/dlls - anything not in YOUR 'Max source code and if you're not holding the Object in say a List or Array or something similar.<br>You say that youre not doing that anymore in which case the above is just useful information only and may not help solve the problem :p <br><br></td></tr></table><br>
<a name="1332232"></a>

<a name="1332233"></a>

<a name="1332234"></a>

<a name="1332251"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the detailed explanation and it does make sense.  :)<br><br>But yes, I understand that much about how it works.  And I'm sure there are objects being generated (like TEvent) that I'm not fully controlling and perhaps that's a problem, but it seems unlikely.  All of the objects that I'm passing as Byte Ptr are in an array somewhere.  All objects are part of a virtual directory and have a "path."  In other words, every object (that gets passed) has a parent and is part of its parent's child or member array.  I'm pretty confident they're not getting collected prematurely unless the GC is doing something unexpected.  What is the threaded mode GC doing differently from the standard?  That's what I'd like to understand better.<br><br>What I'm not doing anymore is using offsets to access data in a Blitz type.  Basically, I had an init function for each type that would put all of its field offsets into a Global that could be used to both clone the object and read/write its data to disk.  I've replaced that with a new version that uses reflection to store TField objects instead.  It works well enough, but is probably slower and I have some concerns about how the values are cast to/from Object.<br><br>It seemed to help a little in that threaded mode lasts longer before crashing, but it's hard to say.  My reason for assuming it was the GC is that <b>threaded mode was not crashing if I set GCSuspend</b>.<br><br>Since the change, that is no longer true.  :(<br><br>EDIT: Heh, but now threaded debug mode works.<br><br>EDIT2: Narrowed it down a bit.  Hopefully, the answer will come tomorrow. <br><br></td></tr></table><br>
<a name="1332357"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> So, I found a problem.  All of my math functions take Float Ptr arguments and I negligently used one that was too narrow (10 floats) for a shadow matrix calculation (needing 16, of course).  Silly error that, and there may be more, but...<br><br>Now it's working in Debug and Release, Threaded and Non-Threaded.  So it probably had nothing to do with the Byte Ptr to Object stuff we've been discussing.  Still, I suppose it's better to use reflection.  I am concerned that converting Float to String and back could cause accumulative precision errors...  :/<br><br>Even after the changes, it's still not working in NG.  I thought it might uncover more bugs to look into why, so I've been using the age-old method of removing things until it works as expected and then adding them back one-by-one until it doesn't.  The Lua script line that broke is a function that loads a font for my gui system.<br><br>&lt;sarcasm&gt;I thought, great!  That uses the two, and only two, NG modules in which I made slight changes (pub.freetype and brl.freetypefont).&lt;/sarcasm&gt;<br><br>Unfortunately,  I can't get the debugger to help me out because any DebugStop I put into the relevant parts causes a Debugger: Invalid Scope Kind error.  Incidentally, a Print function in the same place prints, but causes the same error.  I reread an old discussion we had about this error, but never really got an understanding of what it means. <br><br></td></tr></table><br>
<a name="1332365"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Silly error that, and there may be more <br></div><br>As I mentioned, you probably have bugs in your code which are causing all these issues.<br>If you use straight BlitzMax code - arrays, strings, math, etc - everything should be pretty solid. When you start bypassing BlitzMax's checks and balances (say, by passing arrays as ptrs) then you need to be extra sure your data is right - in debug, add your own boundary checks etc.<br><br><br><div class="quote"> Invalid Scope Kind <br></div><br>Most likely an error in your code is throwing off the debug scope stack, although of course I can't rule out an issue with NG itself. <br><br></td></tr></table><br>
<a name="1332378"></a>

<a name="1332379"></a>

<a name="1332380"></a>

<a name="1332381"></a>

<a name="1332382"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Most likely an error in your code <br></div>Last time, you fixed two issues in NG.  Both times, you fixed them without saying anything.  Perhaps I should not admit I make silly mistakes?  :P<br><br><div class="quote"> add your own boundary checks <br></div>Not sure how you'd do that in a case like this.  It was basically a clerical error. <br><br></td></tr></table><br>
<a name="1332384"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> Glad that you're on the right track to resolving it :O) <br><br></td></tr></table><br>
<a name="1332398"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, Dave. <br><br></td></tr></table><br>
<a name="1332413"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sadly, it does appear the threaded mode GC is probably not fast enough for my purposes.  :( <br><br></td></tr></table><br>
<a name="1332459"></a>

<a name="1332460"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> There seems to be a compatibility issue between NG and vanilla that I'm not aware of.  Any time I put a DebugStop in, I'm getting a Debugger Error:Invalid decl kind.  Only way I can debug is with Print statements. <br><br></td></tr></table><br>
<a name="1332467"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> You could debug bmk.<br><br>So you compile bmk.bmx with the params to build and execute your app in debug mode (there is a "command line" option in MaxIDE).<br><br><br>Of course Brucey will be able to tell you more about potential differences regarding debugging stuff in vanilla&lt;-&gt;NG.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1332468"></a>

<a name="1332469"></a>

<a name="1332470"></a>

<a name="1332471"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm not following, Derron.  My app is executing in Debug mode, but spitting out a message I don't understand.  Are you suggesting I look at the bmk source..?<br><br>Is there a master list of differences somewhere? <br><br></td></tr></table><br>
<a name="1332472"></a>

<a name="1332473"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> or bcc ... or whatever you think has a problem.<br><br>When you compile via MaxIDE it calls BMK with some params (eg. "bmk makeapp -x -d bla.bmx"). If you now put the bmk-sources in your blitzmaxng/bin-dir, you should be able to compile bmk in debug mode, and pss "makeapp -x -d bla.bmx" as commandline-param (via MaxIDE). It then compiles bmk in debug mode, executes bmk with the given command line (so bmk starts compiling/linking/... bla.bmx into a bla.debug - and then executes it).<br>If then the debugger is called from "bla.debug", bmk will handle it - and if it throws an error itself, then MaxIDE will highlight the corresponding things the bmk-sources.<br>(above might not be explained perfectly - think of it as a rough sketch).<br><br>The difference might be in the "layout" of objects - it is different in NG and vanilla (brucey added something - I believe at least - or he did use previously "empty" properties). So if you manipulate "blitzmax objects" this might be the reason.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1332476"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah, I see.  I'm actually not manipulating bmx objects now, but that still might turn something else up.  Thanks for the suggestion.  :) <br><br></td></tr></table><br>
<a name="1332480"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> Another way if you want to work on the debugger then the source for it is in brl.mod/appstub.mod/debugger....<br><br>You can throw in some print ( or writestdout ) statements to get it output values with any code that you want to debug. I'd advise against trying to put DebugStop in the debugger itself though :p<br><br>Or you could drum up a code sample that reproduces the failure, post here and/or also at the github repo, the repo is a more 'official' place for bugs. <br><br></td></tr></table><br>
<a name="1332652"></a>

<a name="1332653"></a>

<a name="1332654"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> After commenting a few things, I can get the render view to open, but glClear is not clearing.  Some rendering is happening, but not all.<br><br>On a hunch, I tried the same files with NG from April 2016 and it renders fine.  Hrmm. <br><br></td></tr></table><br>
<a name="1332655"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> glClear is not clearing <br></div><br>Make sure everything is up-to-date. There was an OpenGL bug introduced last week that was also then fixed. <br><br></td></tr></table><br>
<a name="1332662"></a>

<a name="1332781"></a>

<a name="1332783"></a>

<a name="1332784"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yup, that was it.  Woohoo!  And the threaded GC does seem to be a lot faster.  :)<br><br>EDIT:  Hmm, maybe not.  My fps drops significantly...  :/<br><br>EDIT 2:  Manual control drops significantly, leaving it be is fast, but results in hiccups.  Hopefully, that can be fine tuned.  Didn't think I was creating many objects, though.<br><br>EDIT 3:  Threaded/non-threaded both have hiccups, so I guess that's just how Boehm GC works. <br><br></td></tr></table><br>
<a name="1332773"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#49">[#49]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not the right place for this, I suppose, but I found an NG bug.  References to arrays, when passed as fields, don't get their assignments.<br><pre class=code>
Local sa:String[]
GetStringArray( sa )					'&lt;&lt;&lt; This works.

Local c:TContainer = New TContainer
GetStringArray( c._sa )					'&lt;&lt;&lt; This doesn't.

Function GetStringArray( _sa:String[] Var )

	Local sa:String[] = [ "one", "two", "three" ]
	_sa = sa

EndFunction

Type TContainer
	Field _sa:String[]
EndType</pre> <br><br></td></tr></table><br>
<a name="1332789"></a>

<a name="1332790"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#50">[#50]</a></td></tr></table></td></tr><tr ><td class="posttext"> A similar issue was fixed some weeks ago (I also had trouble with params). Having a look at the generated C-code might already expose what is missing.<br><br><br>@ GC<br>Couldn't you use some kind of "Pool" to reuse objects (handles or whatever)? <br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1332791"></a>

<a name="1332792"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#51">[#51]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes, I'm using pools, which is why it's strange.  Vanilla BMX is smooth, as long as it's not threaded.  I'm able to exercise more control over vanilla, though.  My render loop looks something like this (pseudo code)...<br><br>GCSetMode( 2 )<br>RenderStuff()<br>If Clock.TimesPerSecond( 1 ) Then GCCollect()<br>GCSetMode( 1 )<br><br>In NG, this slows things down a lot.  Like I said, there may be things I can do about that.  Perhaps there are objects getting created somewhere that I've forgotten about, etc.  But I do know that vanilla is performing better and that's to be expected. <br><br></td></tr></table><br>
<a name="1332907"></a>

<a name="1332908"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FireballStarfish</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#52">[#52]</a></td></tr></table></td></tr><tr ><td class="posttext"> GCSetMode doesn't work on NG. If you want to temporarily stop the GC, you'll have to use GCSuspend/GCResume instead. <br><br></td></tr></table><br>
<a name="1332913"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#53">[#53]</a></td></tr></table></td></tr><tr ><td class="posttext"> You must be creating and throwing away a *lot* of objects? <br><br></td></tr></table><br>
<a name="1332931"></a>

<a name="1332932"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#54">[#54]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> GCSetMode doesn't work on NG <br></div>Hmm, then why does it slow things down dramatically?  The GCCollect?<br><br><div class="quote"> You must be creating and throwing away a *lot* of objects? <br></div>Don't think so.  As I've said, all my objects are in pools (arrays).  But out of curiosity, what would you consider a lot?<br><br><br>I assume that this shouldn't cause any issues inside of a function in a (render) loop..?<br><pre class=code>Local this:TMyType = ArrayOfMyTypes[index]
this.DoSomething()</pre>I would expect that 'this' is incrementing a reference count and isn't throwing anything away until its slot in the array or the array itself are nullified... <br><br></td></tr></table><br>
<a name="1332943"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#55">[#55]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> But out of curiosity, what would you consider a lot? <br></div><br>I dunno... hundreds of thousands a second?<br><br>Have you profiled your app to get an idea of where your bottlenecks are?<br><br>I did some profiling of Derron's TVTower game and re-engineered it in places to do things more efficiently, especially with regards the GC. It made it a few % more CPU friendly.<br><br>Keeping hold of a reference is just what you think it is. As long as you have a reference to an Object somewhere, the GC won't touch it. But as soon as your Object is not referenced by anything, it becomes available for collection. When it gets collected depends on the GC and other factors, but it's likely to be collected at some point in the future. <br><br></td></tr></table><br>
<a name="1332947"></a>

<a name="1332948"></a>

<a name="1332949"></a>

<a name="1332950"></a>

<a name="1332953"></a>

<a name="1332964"></a>

<a name="1332965"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#56">[#56]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> hundreds of thousands a second? <br></div>That's what I would think.  Pretty sure I'm not doing that, but maybe I'm overlooking something.<br><br>The most likely candidates would be my (very inefficient) particle engine, Bullet physics, or skeletal animation.  I turn all of those off when I test, though.<br><br>The way Mana (engine's name) works is something I'm pretty proud of.  It's a system of nodes with update functions and ALL of them have a reference, so it seems unlikely to be causing this problem.  Some of the nodes run LuaJIT scripts, most of which access C functions using the FFI, which is fast.  However, I don't think LuaJIT is the problem, since it uses its own GC, and vanilla/NG shouldn't make a difference.<br><br>I haven't done extensive profiling, yet, so I'm not too worried.  I still have one crash bug for one of the scenes I'm trying to load.<br><br><div class="quote"> re-engineered it in places to do things more efficiently <br></div>Any tips? <br><br></td></tr></table><br>
<a name="1332955"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#57">[#57]</a></td></tr></table></td></tr><tr ><td class="posttext"> String concatenation could use Brucey's stringBuffer.  Maybe you create wrapper classes a dozen times per object (vec2 instead of x,y).<br><br>That lua scripts might call i to blitzmax and access things in a wrapping way (GetVec2 instead of GetX and GetY)... Such things.<br><br><br><br>Bye<br>Ron <br><br></td></tr></table><br>
<a name="1332959"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#58">[#58]</a></td></tr></table></td></tr><tr ><td class="posttext"> Good suggestions, Derron.  String concatenation *might* be a factor.  Don't think I'm doing much of the other things. <br><br></td></tr></table><br>
<a name="1333081"></a>

<a name="1333087"></a>

<a name="1333204"></a>

<a name="1333205"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#59">[#59]</a></td></tr></table></td></tr><tr ><td class="posttext"> My crash bug seems to be related to BRL.TGALoader.  On a larger scene with more textures, it kept having exceptions (in NG).  So, I converted them to BMP (ick) and switched to BRL.BMPLoader and everything now works.  BAH.FreeImage also seems fine, but I'd prefer to keep the .exe smaller (FreeImage doubles the size), for now. <br><br></td></tr></table><br>
<a name="1333089"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#60">[#60]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe the TGALoader is not threadsafe?<br>Or there are other issues with the module when using NG.<br><br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1333090"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#61">[#61]</a></td></tr></table></td></tr><tr ><td class="posttext"> Was happening in non-threaded NG, too.  Works in vanilla, but maybe the bug is just not showing up, for some reason.  Or, maybe something was missed in the conversion.  It does work, but crashes if too many pixmaps are loaded.<br><br>Suppose I can't know for sure it's the cause.  But all I did was:<br><br>1. Convert TGA files to BMP and update filenames.<br>2. Switch BRL.TGALoader for BRL.BMPLoader.<br>3. Add support for BGRA8888 in my texture upload, because that's the default pixmap format for BRL.BMPLoader and BAH.FreeImage.<br><br>And now it works in NG, both threaded and non-threaded. <br><br></td></tr></table><br>
<a name="1333215"></a>

<a name="1333216"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#62">[#62]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know this is off-topic, but...<br><br>Now BMPLoader and TGALoader are deprecated, which is disappointing for two reasons.  One, FreeImage makes my .exe more than twice as large.  Two, whenever I've tried to import it, I get crash bugs.  Not every time, but enough for me to question its stability.<br><br>Has anyone used it to make a full game, with lots of texture loading? <br><br></td></tr></table><br>
<a name="1333221"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#63">[#63]</a></td></tr></table></td></tr><tr ><td class="posttext"> Brucey uploaded a stbimage loader... You could try this out.<br><br><br>Bye<br>Ron <br><br></td></tr></table><br>
<a name="1333223"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#64">[#64]</a></td></tr></table></td></tr><tr ><td class="posttext"> You should still be able to import either of those, which are now just stubs, and fall through to BRL.STBImageLoader instead - which uses the stb_image lib ( <a href="https://github.com/nothings/stb/blob/master/stb_image.h" target="_blank">https://github.com/nothings/stb/blob/master/stb_image.h</a> ). It's about 260KB here on 64-bit OSX.<br><br>I couldn't see any obvious problems with the Max source for TGALoader, and I really don't want to be maintaining it - i.e. having to understand the TGA format, etc.<br>So the best thing I felt was to utilise another well-used and well-tested loader. <br><br></td></tr></table><br>
<a name="1333232"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#65">[#65]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, that's interesting.  Is STBImageLoader NG only? <br><br></td></tr></table><br>
<a name="1333236"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#66">[#66]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Well, that's interesting. Is STBImageLoader NG only?  <br></div><br><br>So far, but it shouldn't matter, as you simply import as you did before : Import BRL.TGALoader<br>Since it falls through to the other loader, you don't need to import the STB module directly, and therefore not change your code.<br><br>(i.e. TGALoader simply imports STBImageLoader now)<br><br>The image loader modules are just factory classes anyway - you never use them directly. By importing the ones you want image support for, when you call LoadPixmap() it cycles through each loader module until it is able to finally load the file - or eventually returns Null (having failed to do so). <br><br></td></tr></table><br>
<a name="1333241"></a>

<a name="1333243"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#67">[#67]</a></td></tr></table></td></tr><tr ><td class="posttext"> Right, I just realized that was kind of a dumb question.  Thanks for the response, though.  :) <br><br></td></tr></table><br>
<a name="1333244"></a>

<a name="1333245"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LT</td><td align="right"><font class=tiny>(Posted 2017)</font>&nbsp;<a href="#68">[#68]</a></td></tr></table></td></tr><tr ><td class="posttext"> . <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
