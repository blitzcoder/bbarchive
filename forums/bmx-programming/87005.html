<!DOCTYPE html><html lang="en" ><head ><title >Vector maths in lighting tutorial</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Vector maths in lighting tutorial</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Vector maths in lighting tutorial</a><br><br>
<a name="986100"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >spacerat</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> A friend and I have created a lighting engine using a guide, and we have the drawing side of it all completed, along with working shadows for rectangles. However, I am trying to follow <a href="http://www.gamedev.net/reference/programming/features/2dsoftshadow/page3.asp" target="_blank">http://www.gamedev.net/reference/programming/features/2dsoftshadow/page3.asp</a> this to get the lighting engine to work for any convex polygon, but it's not working.<br><br>Firstly, I'm not sure exactly what they mean by dot product. I've seen dot product defined as dot = (a.x * b.x + a.y * b.y), - which seems to be more prevalent in vector libraries - and I've seen it defined as dot = |a|*|b|*Cos(theta) - which is what most mathematics sites define it as - so I don't know which to use.<br><br>Secondly, you need "the vector to the light". Is this from the point you're looking at, or from the centre of the polygon?<br><br>Here is my code cut down to the problem area. For some reason, this is sometimes classifying the edges as back or front facing incorrectly.<br><pre class=code>
Local prevpoint:Vec2 = Vec2(Points.Last())
For local point:Vec2 = EachIn Points
	'Calculate normal of polygon edge
	Local nx:Float = point.y - prevpoint.y
	Local ny:Float = point.x - prevpoint.x
	Local normal:Vec2 = New Vec2.Init(nx, ny)

	'Get vector to light
	Local observer:Vec2 = New Vec2.Init(observerx - PrevPoint.x, observery - PrevPoint.y)
	
	'Calculate dot product
	Local frontfacing:Int = normal.DotProduct2(observer) &gt; 0
Next
</pre><br><br>Observer is a vector for light position. DotProduct2 is the dot product with Cos(theta) in it. The other dot product (a.x*b.x+a.y*b.y) doesn't work either.<br><br>Can anyone point me in the right direction here? If you want me to post more code, or a working example, then please do ask. <br><br></td></tr></table><br>
<a name="986102"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Floyd</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Although far from obvious the two definitions are equivalent.<br><br>Length*Length*Cos(angle) is what the dot product really means.<br><br>x1*x2 + y1*y2  ( + z1*z2 etc. for higher dimensions ) is the practical way to compute it.<br><br>Lengths are never negative so the dot product has the same sign as Cos(angle). This is positive for angles less the 90 and negative for greater than 90. A dot product of zero means the vectors are perpendicular. <br><br></td></tr></table><br>
<a name="986106"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >spacerat</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting, I didn't know that. So I'll use x1 * x2 + y1 * y2 for dot product. Unfortunately it still doesn't work. If the dot product of the normal of the edge and the vector the to light is positive, the edge should be detected as facing the light, but it seems to be almost random at the moment. <br><br></td></tr></table><br>
<a name="986136"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >spacerat</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, I solved it, by accident through trial and error really. For a start, it seems "normal" in that article was an error, because the code I've got, and in fact the code he supplies, is certainly not a normal. I think it's the perpendicular vector in mine. Here's the code:<br><pre class=code>
For local point:Vec2 = EachIn Points
	'Calculate "normal" (or not) of polygon edge		
	Local edge:Vec2 = Point.Copy()
	edge.SubtractVec(prevpoint)
	Local normal:Vec2 = New Vec2.Init(- edge.y, edge.x)
	
	'Get vector to light
	Local observer:Vec2 = New Vec2.Init(observerx - Point.x, observery - Point.y)

	'Calculate dot product
	Local frontfacing:Int = observer.DotProduct(normal) &lt; 0
Next</pre> <br><br></td></tr></table><br>
<a name="986150"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warpy</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> A normal is a perpendicular vector.<br><br>Edit: just realised where you were confused. A "normalised" vector is any vector that has been scaled down to have length 1, but a "normal" vector is one that is perpendicular to some other vector you're interested in.<br>It's confusing, which is why I prefer to call vectors of length 1 "unit vectors". <br><br></td></tr></table><br>
<a name="986336"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> got any screenshots? <br><br></td></tr></table><br>
<a name="986455"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Someone already made a mod for this type of 2d shadow. It was way back near the time when Bmax was first released so the code is probably GL based. That might help you understand the algorithms. <br><br></td></tr></table><br>
<a name="986500"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >spacerat</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the info Warpy. I've got a feeling that would have continued to confuse me for a long time if you'd not have told me that. <br><br>And yea, here's a screenshot<br><br><img src="http://img186.imageshack.us/img186/705/lites.png"><br><br>My friend did most of the technical work on the actual lighting. On top of making it work with any convex polygons (you can only see rectangles in the screenshot though) I persuaded him to untie the code from the rest of the game so that it can be used in other projects. Perhaps when it gets mature enough, and if my friend is ok with it, we'll release it on here along with the geometry module on which it relies. However, I think he wants to add soft-edges first, like in the second half of that tutorial. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
