<!DOCTYPE html><html lang="en" ><head ><title >XP Focus Bug with Full Screen</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >XP Focus Bug with Full Screen</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >XP Focus Bug with Full Screen</a><br><br>
<a name="932518"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Please compile and run this on XP:<br><br><pre class=code>
SuperStrict

Graphics 800,600,32

While Not KeyHit(key_escape)
	Cls
	DrawRect 100,100,100,100
	Flip 1
Wend
</pre><br><br>Then Alt+Tab out.  Make sure you have some other apps running.  Then use the tabs on the start bar to switch between apps.  Noticed how the compiled app's window keeps flashing as you switch between apps.  It seems like Windows XP is trying to focus the full-screen app temporarily but then focus is returned to the app that you clicked.  <br><br>This is weird, any idea why it would do it?  Perhaps full-screen apps are treated as modal and try to come to the front just in that split second between defocusing one app and focusing the next?<br><br>It doesn't happen in Vista.<br><br>It's causing a problem for me because I track EVENT_APPRESUME and EVENT_APPSUSPEND and do stuff like start and stop music.  This means as you change apps you keep hearing a slit second of the music as it resumes and suspends due receiving focus for a split second.<br><br>Also sometimes with my current game (but not with the example above) my whole game does completely resume full-screen even though another totally different app was clicked!  I don't know why as I don't have any code to tell it to do that, I'm just relying on BlitzMax (or Windows) to handle the focusing for me.  Also sometimes the game nearly focuses but doesn't and the music resumes permanently because the app never got the suspend message.  It's crazy and random seeming...<br><br>Anyone got any comments about this?  Thx. <br><br></td></tr></table><br>
<a name="932520"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Arowx</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> As a workaround you could place a short delay in the code to prevent any hiccups.<br><br>Sorry don't have XP to test this on! <br><br></td></tr></table><br>
<a name="932523"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jsp</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Confirmed, it flashes always when changing the focus. <br><br></td></tr></table><br>
<a name="932524"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks jsp.<br><br>@Merx: Yeah I considered having a delay before resuming music so I can double check if focus was REALLY returned to the game.  The problem is that sometimes focus does return fully even though it should not have!  It's very weird... <br><br></td></tr></table><br>
<a name="932534"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just have the game Pause when focus is lost and only resume on a keypress or mouseclick.<br><br>I have played other games and I like it that way.  I don't want the game to just come up running if it has any sort of action. I want to prepare myself, see what is on the screen, get my hands where I need them, think about what button I want to press the instant the action starts, etc. <br><br></td></tr></table><br>
<a name="932568"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah actually I do that now in full-screen mode, so you won't here the music restarting and stopping, but the fact remains that the window still flickers and sometimes it randomly goes back to full-screen even though you clicked some other app on the task bar. <br><br></td></tr></table><br>
<a name="932580"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't experience any flickering on 2 XP systems here. But at the least I would never have a loop like that either. I always check for AppSuspended() before doing any rendering.<br><br>Does this code still flicker (on those systems that flicker)  like the original when alt tab'ed?<br><br><pre class=code>
SuperStrict
Graphics 800,600,32
While Not KeyHit(key_escape)
 If AppSuspended()
  While AppSuspended()
   Delay(100)
  Wend  
 EndIf
 Cls
 DrawRect 100,100,100,100
 Flip 1
 '
Wend
</pre> <br><br></td></tr></table><br>
<a name="932594"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've now seen the same thing on non-Blitz max games like Turbo Pizza, so it's some kind of XP issue.  Also I found a link to a hotfix for it.<br><br>Also found out the reason my game was resuming was a single line that compared GetForegroundWindow() (which is a win api function: <a href="http://msdn.microsoft.com/en-us/library/ms633505(VS.85).aspx" target="_blank">http://msdn.microsoft.com/en-us/library/ms633505(VS.85).aspx</a> ) with the Window Handle.  When that line is in the game totally resumes instead of flickers and when it's out it just flickers.  How weird is that?  That function only returns a handle it doesn't do anything else... <br><br></td></tr></table><br>
<a name="932600"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jsp</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> @MGE<br>Your code 'flickers' the same as Greys on my system (XP Prof. SP2). I don't think the AppSuspended is even called at that time.<br><br><div class="quote"> <br>That function only returns a handle it doesn't do anything else... <br> <br></div><br>Wild guess?:) <br><br></td></tr></table><br>
<a name="932601"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> @jsp. Thanks! wow... talk about learning something new. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
