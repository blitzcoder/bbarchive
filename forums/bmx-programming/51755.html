<!DOCTYPE html><html lang="en" ><head ><title >How to copy a Type</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >How to copy a Type</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >How to copy a Type</a><br><br>
<a name="577807"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hotcakes</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Normally, I wouldn't have a problem with a memcopy between two types using VarPtr and SizeOf...  but what happens if there's a reference inside the type...<br><br>That gets memcopied, but there would be no way for the garbage collector to know that has happenned...  so I'm thinking there's probably some inbuilt way to copy a type, that for the life of me I can't find in the manual.  Does anyone know if that's the case/what it is?  =] <br><br></td></tr></table><br>
<a name="577817"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Azathoth</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think you need to make your own copy method. <br><br></td></tr></table><br>
<a name="577819"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ozak</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is standard in OOP systems. Implement a clone command or something :) <br><br></td></tr></table><br>
<a name="577822"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hotcakes</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> That sucks.  All these built in commands in the language and no CopyType...  how hard could it be... <br><br></td></tr></table><br>
<a name="577842"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jwe</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> You need a deepCopy Command, so that an objects returns copies of its object.<br>Normaly a simple task to code if it would be possible to access methodnames and fieldnames in a Type.<br>All you would need then is a deepCopy method in your superclass that iterates over Methods and calls them dynamically.<br>But i think this is only possible with an Interpreter Language or is there a way to call a function when i only have a string representation ?<br><br>Like  (psyeudocode)<br>func$="getName"<br>Object.call(func$) <br><br></td></tr></table><br>
<a name="577849"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="/posts.php?topic=42119&amp;hl=copytype" target="_blank"> Copytype </a><br><a href="/posts.php?topic=48391&amp;hl=type%20copy" target="_blank"> type copy </a><br><a href="/posts.php?topic=46889&amp;hl=type%20copy" target="_blank"> type copy2 </a> <br><br></td></tr></table><br>
<a name="578125"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hotcakes</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks tonyg, but all three of those methods use a straight memcopy, which suffers from new references not being picked up by the garbage collector.<br><br>I still don't understand why there isn't a built in method for this - surprisingly, FlameDuck's answer in one of those threads didn't help. <br><br></td></tr></table><br>
<a name="578191"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> how hard could it be... <br></div>Without runtime reflection? Impossible.<br><br><div class="quote"> FlameDuck's answer in one of those threads didn't help.  <br></div>Impossible. Here is a more thorough example:<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Strict

Type aType
	Field aField:Int
	
	Method deepClone:aType()
		Local temp:aType = New aType
		temp.aField = aField
		Return temp
	EndMethod
EndType

Type bType
	Field bField:Int
	
	Method deepClone:bType()
		Local temp:bType = New bType
		temp.bField = bField
		Return temp
	EndMethod
EndType


Type compositeType
	Field myAType:aType
	Field myBType:bType
	
	Function Create:compositeType( aVal , bVal )
		Local temp:compositeType = New compositeType
		temp.myAType = New aType
		temp.myAtype.aField = aVal
		temp.myBType = New bType
		temp.myBType.bField = bVal
		Return temp
	EndFunction

	Method toString:String()
		Return "aType.aField = " + myAType.aField + " - bType.bField = " + myBType.bField
	EndMethod'
	
	Method deepClone:compositeType()
		Local temp:compositeType = New compositeType
		temp.myAType = myAType.deepClone()
		temp.myBType = myBType.deepClone()
		Return temp
	EndMethod
EndType

Local compType1:compositeType = compositeType.Create( 1 , 2 )
Local compType2:compositeType = compType1.deepClone()
Print "Before alteration: "
Print "compType1: " + compType1.toString()
Print "compType2: " + compType2.toString()
compType2.myAType.aField = 3
compType2.myBType.bField = 4
Print 
Print "After alteration: "
Print "compType1: " + compType1.toString()
Print "compType2: " + compType2.toString()
End</textarea><br><div class="quote"> I still don't understand why there isn't a built in method for this <br></div>Because BlitzMAX doesn't support runtime reflection. <br><br></td></tr></table><br>
<a name="578280"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Without runtime reflection? Impossible. <br></div><br><br>I don't think you are talking about reflection, see this article: <a href="http://en.wikipedia.org/wiki/Reflection_(computer_science)" target="_blank">http://en.wikipedia.org/wiki/Reflection_(computer_science)</a> <br><br></td></tr></table><br>
<a name="578295"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ozak</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can't memcopy a class in any languages and it has nothing to do with reflection.<br>Even java which is heavily class based has a clone function that you have to override. <br><br></td></tr></table><br>
<a name="578325"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Without runtime reflection? Impossible. <br></div>Deeply wrong. Impossible for us BlitzMax users, certainly (without refelection). But not for Mark. A special command to copy an object is entirely doable. At least a shallow copy. For a deep copy, the problem is more that you'd need at least a way to tell the compiler which reference fields have to be taken into account in the deep copy (or else you'd very soon have an infinite recursion while deep-copying; not to say you are the only one to know which sub-objects would<br>simply make sense to deep copy).<br><div class="quote"> Because BlitzMAX doesn't support runtime reflection.  <br></div>So again, wrong. Especially interesting is the fact that what you quoted specifically mentions a "built-in" method, not something the BlitzMax users would write. <br><br></td></tr></table><br>
<a name="578345"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I don't think you are talking about reflection <br></div>I am. If you can examine the structure of the object you want to copy at runtime - you can deep clone it.<br><br><div class="quote"> You can't memcopy a class in any languages and it has nothing to do with reflection. <br></div>But if you had reflection, you could "rebuild" the class from scrap, and copy over it simple datatypes.<br><br><div class="quote"> Even java which is heavily class based has a clone function that you have to override.  <br></div>It has an interface (IClonable) that you have to implement. That doesn't mean that by using reflection you can't make your own "CloneAnything" functionality, as long as you're careful.<br><br><div class="quote"> A special command to copy an object is entirely doable. At least a shallow copy. <br></div>Is there some significant difference, between a "built-in" shallow copy, and the memcopy methods mentioned above? <br><br></td></tr></table><br>
<a name="578471"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Michael Reitzenstein</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> The new references will be visible to the garbage collector. <br><br></td></tr></table><br>
<a name="578718"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hotcakes</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes.  Thank you peoples, I'm not just dreaming here =]<br><br>I don't see any reason why the compiler can't crate a Clone method inside every type which could basically do a shallow copy exactly the same way we do it now - field by field.  The compiler can figure out which fields are going to be used as references and as a result the garbage collector can know when those references have been duplicated.<br><br>Would save a shedload of typing. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
