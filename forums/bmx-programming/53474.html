<!DOCTYPE html><html lang="en" ><head ><title >Can't get External Mesh Loader to work in irrBMAX</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Can't get External Mesh Loader to work in irrBMAX</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Can't get External Mesh Loader to work in irrBMAX</a><br><br>
<a name="597422"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, I can't seem to get things working.  I must be overlooking something.  Here's what I have so far.  Obviously, the engine is not calling isALoadableFileExtension() nor createMesh().<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Strict

Import gg.irrBMAX

Type T_chunk_header
 Field id:Byte[4]
 Field length:Long
End Type

Type B3DLoader Extends T_irrIMeshLoader
 Field ChunkHeader:T_chunk_header

 Method IsALoadableFileExtension:Int(Filename:String)
DebugLog("IsALoadableFileExtension")
  Return (Lower(Right(Filename,4)) = ".b3d")
 End Method

 
 Method createMesh:T_irrIAnimatedMesh(file:T_irrIReadFile)
DebugLog("createMesh")
  ChunkHeader = New T_chunk_header
  file.seek(0) 'seek to start of file
  ReadChunkHeader(file)

  If TestByteStringArray(ChunkHeader.id,"BB3D")
   Print "BB3D header found"
  Else
   Print "BB3D header not found"
  End If

 End Method

 Method TestByteStringArray:Int(test1:Byte Ptr,test2:String)
  Local t:Int
   
  For t = 1 To Len(test2)
   If Chr(test1[t-1]) &lt;&gt; Mid(test2,t,1) Then Return False
  Next
  Return True
 End Method

 Method ReadChunkHeader(file:T_irrIReadFile)
  file.read(String Ptr(Varptr ChunkHeader),8)
 End Method

 Function generate:T_irrIMeshLoader()
  Return T_irrIMeshLoader(New B3DLoader)
 End Function
  
End Type


Local device:T_irrIrrlichtDevice=T_irrIrrlichtDevice.create(EDT_DIRECTX9,T_irrDimension2d_s32.create(640,480),32,False,False,False,0)

device.setWindowCaption("Hello World! - Irrlicht Engine Demo")

Local driver:T_irrIVideoDriver=device.getVideoDriver()
Local smgr:T_irrISceneManager=device.getSceneManager()
Local guienv:T_irrIGUIEnvironment=device.getGUIEnvironment()

smgr.AddExternalMeshLoader(B3DLoader.generate())

guienv.addStaticText("Hello World! This is the Irrlicht Software renderer!",T_irrRect_s32.createFromVals(10,10,200,22),True)

Local mesh:T_irrIAnimatedMesh=smgr.getMesh("bridge.b3d")
Local node:T_irrIAnimatedMeshSceneNode=smgr.addAnimatedMeshSceneNode(mesh)
Local anim:T_irrISceneNodeAnimator
If node.handle&lt;&gt;0
    node.setScale(T_irrVector3df.createFromVals(100,100,100))
	node.setMaterialFlag(EMF_LIGHTING,False)
	node.setFrameLoop(0,310)
	node.setMaterialTexture(0,driver.getTexture("pebble2.jpg"))
	anim = smgr.createRotationAnimator(T_irrVector3df.createFromVals(.1,1,.5))
	node.addAnimator(anim)

EndIf

smgr.addCameraSceneNode(0,T_irrVector3df.createFromVals(0,30,-40),T_irrVector3df.createFromVals(0,5,0))

While (device.run())

	driver.beginScene(True,True,T_irrSColor.createFromVals(0,200,200,200))
	smgr.drawAll()
	guienv.drawAll()
	driver.endScene()

Wend

device.drop()</textarea> <br><br></td></tr></table><br>
<a name="597429"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> teaches me to go from memory :)  my apologies.  i misguided you on a few steps.  my changes are denoted with "GG":<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Strict

Import gg.irrBMAX

Type T_chunk_header
 Field id:Byte[4]
 Field length:Long
End Type

' GG - based on BMXIMeshLoader instead
Type B3DLoader Extends BMXIMeshLoader
 Field ChunkHeader:T_chunk_header

 Method IsALoadableFileExtension:Int(Filename:String)
DebugLog("IsALoadableFileExtension")
  Return (Lower(Right(Filename,4)) = ".b3d")
 End Method

 
 Method createMesh:T_irrIAnimatedMesh(file:T_irrIReadFile)
DebugLog("createMesh")
  ChunkHeader = New T_chunk_header
  file.seek(0) 'seek to start of file
  ReadChunkHeader(file)

  If TestByteStringArray(ChunkHeader.id,"BB3D")
   Print "BB3D header found"
  Else
   Print "BB3D header not found"
  End If

 End Method

 Method TestByteStringArray:Int(test1:Byte Ptr,test2:String)
  Local t:Int
   
  For t = 1 To Len(test2)
   If Chr(test1[t-1]) &lt;&gt; Mid(test2,t,1) Then Return False
  Next
  Return True
 End Method

 Method ReadChunkHeader(file:T_irrIReadFile)
  file.read(String Ptr(Varptr ChunkHeader),8)
 End Method
 ' GG - changed to return BMXIMeshLoader
 Function generate:BMXIMeshLoader()
  Return BMXIMeshLoader(New B3DLoader)
 End Function
  
End Type


Local device:T_irrIrrlichtDevice=T_irrIrrlichtDevice.create(EDT_OPENGL,T_irrDimension2d_s32.create(640,480),32,False,False,False,0)

device.setWindowCaption("Hello World! - Irrlicht Engine Demo")

Local driver:T_irrIVideoDriver=device.getVideoDriver()
Local smgr:T_irrISceneManager=device.getSceneManager()
Local guienv:T_irrIGUIEnvironment=device.getGUIEnvironment()

' GG - create the loader, convert it to a T_irrIMeshLoader and pass to addexternalmeshloader
Local loader:B3DLoader = B3DLoader(B3DLoader.create(B3DLoader.generate))
smgr.AddExternalMeshLoader(T_irrIMeshLoader.createFromHandle(loader.handle))

guienv.addStaticText("Hello World! This is the Irrlicht Software renderer!",T_irrRect_s32.createFromVals(10,10,200,22),True)

Local mesh:T_irrIAnimatedMesh=smgr.getMesh("bridge.b3d")
Local node:T_irrIAnimatedMeshSceneNode=smgr.addAnimatedMeshSceneNode(mesh)
Local anim:T_irrISceneNodeAnimator
If node.handle&lt;&gt;0
    node.setScale(T_irrVector3df.createFromVals(100,100,100))
	node.setMaterialFlag(EMF_LIGHTING,False)
	node.setFrameLoop(0,310)
	node.setMaterialTexture(0,driver.getTexture("pebble2.jpg"))
	anim = smgr.createRotationAnimator(T_irrVector3df.createFromVals(.1,1,.5))
	node.addAnimator(anim)

EndIf

smgr.addCameraSceneNode(0,T_irrVector3df.createFromVals(0,30,-40),T_irrVector3df.createFromVals(0,5,0))

While (device.run())

	driver.beginScene(True,True,T_irrSColor.createFromVals(0,200,200,200))
	smgr.drawAll()
	guienv.drawAll()
	driver.endScene()

Wend

device.drop()
</textarea> <br><br></td></tr></table><br>
<a name="597431"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hee hee, I tried out what you had and still couldn't get it to work.  But then I discovered that I didn't even have the bridge.b3d file in the right directory to begin with.  Moved the file and now it works. :)<br>Now to figure out how to actually get the file contents into an actual mesh.<br><br>ETA.  Opps, another problem.  The program hangs when it gets here:<br><pre class=code>  file.read(String Ptr(Varptr ChunkHeader),8)
</pre><br>I must be passing the parameters wrong or something.  Any ideas? <br><br></td></tr></table><br>
<a name="597436"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> i think there is some issues with the new GC and the way i was doing string reading.  could just be that we are approaching terrain that just hasnt been really hit yet by anyone.  <br><br>one cool thing about this is that you should be able to use BMAX streams to access the file instead if you wish.  just use the T_irrIReadFile to get the filename and then open a BMAX stream for the reading.  i will see if i can hash out the readfile stuff as soon as i can.  i also have some updated techniques i learned with the 3Impact wrapper so i may just implement those. <br><br></td></tr></table><br>
<a name="597438"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi sorry to butt in but the problem is your type<br><br>Type T_chunk_header<br> Field id:Byte[4]  &lt;------ this wont work<br> Field length:Long<br>End Type<br><br>You can do this though<br><br>Type T_chunk_header<br> Field id: Int ' this i 4 bytes<br> Field length:Long<br>End Type<br><br>or<br><br>Type T_chunk_header<br> Field id_1: Byte<br> Field id_2: Byte<br> Field id_3: Byte<br> Field id_4: Byte<br> Field length:Long<br>End Type<br><br>Hope that helps...<br><br>Hi Gman :)<br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="597442"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Budman, but actually I just figured that one out a few minutes ago on my own :-) <br>So I replaced it with Int but it still doesn't work.  The function that gman supplied expects a string ptr type.  So how would I pass my type so that the function will see it as an 8 byte string instead of the T_chunk_header type? <br><br></td></tr></table><br>
<a name="597456"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I assume you mean this function call?<br><pre class=code>
If TestByteStringArray(ChunkHeader.id,"BB3D")
   Print "BB3D header found"
  Else
   Print "BB3D header not found"
  End If
</pre><br><br>Change it to this<br><pre class=code>
If TestByteStringArray(varptr ChunkHeader,"BB3D")
   Print "BB3D header found"
  Else
   Print "BB3D header not found"
  End If
</pre><br><br>By taking the varptr of the type it returns a byte ptr to the first field.  So you will get effectivly a ptr to 8 byte array.<br><br>I dont have Irrlicht installed with 1.12 at the moment so I cant compile what you have.  <br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="597458"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Actually I was refering to this line<br><pre class=code>file.read(String Ptr(Varptr ChunkHeader),8)</pre><br>That's where the program would hang.  I've tried all different ways such as Varptr ChunkHeader.id, but it still wants to hang.  I'm getting a feeling that the problem is with wrapper itself.  Anyway, I temporarily fixed the problem by using BMax streams instead.  Would rather use IrrLicht since the engine already has opened a stream, but until I can figure out what's going on, that's the best I can do.<br><br>GMan:  when a mesh fails to load, what should createMesh return?  I tried returning Null, false, 0, T_irrIAnimatedMesh(0), etc... but everything gives me errors. <br><br></td></tr></table><br>
<a name="597459"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Tom,  <br><br>I see it now.  The BMX irrlicht wrapper is incorrect translation.  I never used the IO classes,  but reviewing the last version i have... I really need to get newer version.<br><br><pre class=code>
Method read:Int(out:String Ptr,sizeToRead:Int)
		Local outBuffer:Byte[sizeToRead]
		Local retval:Int=0
		retval=IrrIO_IReadFile_read(handle,Varptr(outBuffer),sizeToRead)
		Local temp:String=String.FromBytes(outBuffer,retval)
		out=Varptr(temp)
		Return retval
	EndMethod
</pre><br><br>Wont work.<br><br>GMAN I have a little time to play this weekend you want me to review/fix the IO Classes?<br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="597598"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, there seems to be very little documentation on this.  The way I figure it, in order to create a simple mesh, you need to create an instance of T_irrSMeshBuffer. Use T_irrSMeshBuffer.getVertices() to get a pointer to the vertex buffer and add your vertices there.  Then use T_irrSMeshBuffer.getIndices() to find the pointer of where you'll add the indices to.<br>set T-irrSMeshBuffer.Material to the material of the mesh and finally call T_irrSMeshBuffer.RecalculateBoundingBox() to set the bounding box of the mesh.<br><br>Am I right so far or am I way off?  Then I'd need to create an instance of T_irrSMesh and use T_irrSMesh.AddMeshBuffer() to add the previously created mesh.<br>Then create an instance of T_irrSAnimatedMesh and use T_irrSAnimatedMesh.addMesh() to add the earlier created mesh.  Then return the instance of T_irrSAnimatedMesh.<br><br>Do I have this right or am I completely off on this one? <br><br></td></tr></table><br>
<a name="597659"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Azathoth</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>file.read(String Ptr(Varptr ChunkHeader),8)</pre><br>Blitzmax types aren't like c structs, you just can't get a pointer and fill it like you would a struct. A better way would be using a Bank or MemAlloc. <br><br></td></tr></table><br>
<a name="597997"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, I'm getting closer.  The program I have down here will attempt to open a b3d file called bridge.b3d, but in reality, it's set up to just make a cube, just for testing purposes.  I did manage to get something to show on the screen, but not exactly what I expected.  Just point the bridge.b3d to point to your own b3d file.  Contents don't matter, you can even haev a .txt file renamed to .b3d since I don't have it reading from it yet anyway.<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Strict

Import gg.irrBMAX

Type T_chunk_header
 Field id:Int
 Field length:Int
End Type

' GG - based on BMXIMeshLoader instead
Type B3DLoader Extends BMXIMeshLoader
 Field ChunkHeader:T_chunk_header

 Method IsALoadableFileExtension:Int(Filename:String)
DebugLog("IsALoadableFileExtension")
  Return (Lower(Right(Filename,4)) = ".b3d")
 End Method

 
 Method createMesh:T_irrIAnimatedMesh(file:T_irrIReadFile)
  Local BMFile:TStream = ReadStream(file.getFileName())
DebugLog("createMesh")
  ChunkHeader = New T_chunk_header
  SeekStream(BMFile,0) 'seek to start of file
  ReadChunkHeader(BMFile)

  If TestByteStringArray(Varptr ChunkHeader.id,"BB3D")
   Print "BB3D header found"
  Else
   Print "BB3D header not found"
  End If

  Local Animmesh:T_irrSAnimatedMesh = T_irrSAnimatedMesh.create()
  Local Mesh:T_irrSMesh = T_irrSMesh.create()
  Local MeshBuffer:T_irrSMeshBuffer = T_irrSMeshBuffer.create()

  Local VertexBuffer:T_irrArray_S3DVertex = MeshBuffer.getVertices()
  VertexBuffer.reallocate(8)
  
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(1,1,1,1,1,1,T_irrSColor.createFromVals(255,255,0,0),0,0),0)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(1,1,-1,1,1,-1,T_irrSColor.createFromVals(255,255,255,0),0,0),1)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(-1,1,-1,-1,1,-1,T_irrSColor.createFromVals(255,0,255,0),0,0),2)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(-1,1,1,-1,1,1,T_irrSColor.createFromVals(255,0,255,255),0,0),3)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(1,-1,1,1,-1,1,T_irrSColor.createFromVals(255,0,0,255),0,0),4)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(1,-1,-1,1,-1,-1,T_irrSColor.createFromVals(255,255,0,255),0,0),5)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(-1,-1,-1,-1,-1,-1,T_irrSColor.createFromVals(255,255,255,255),0,0),6)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(-1,-1,1,-1,-1,1,T_irrSColor.createFromVals(255,0,0,0),0,0),7)

  Local IndexBuffer:T_irrArray_u16 = MeshBuffer.getIndices()
  IndexBuffer.reallocate(36)
  IndexBuffer.insert(0,0)
  IndexBuffer.insert(1,1)
  IndexBuffer.insert(2,2)
  IndexBuffer.insert(2,3)
  IndexBuffer.insert(3,4)
  IndexBuffer.insert(0,5)
  IndexBuffer.insert(4,6)
  IndexBuffer.insert(1,7)
  IndexBuffer.insert(1,8)
  IndexBuffer.insert(4,9)
  IndexBuffer.insert(5,10)
  IndexBuffer.insert(4,11)
  IndexBuffer.insert(4,12)
  IndexBuffer.insert(6,13)
  IndexBuffer.insert(7,14)
  IndexBuffer.insert(4,15)
  IndexBuffer.insert(5,16)
  IndexBuffer.insert(6,17)
  IndexBuffer.insert(7,18)
  IndexBuffer.insert(2,19)
  IndexBuffer.insert(3,20)
  IndexBuffer.insert(7,21)
  IndexBuffer.insert(6,22)
  IndexBuffer.insert(2,23)
  IndexBuffer.insert(2,24)
  IndexBuffer.insert(1,25)
  IndexBuffer.insert(5,26)
  IndexBuffer.insert(5,27)
  IndexBuffer.insert(6,28)
  IndexBuffer.insert(2,29)
  IndexBuffer.insert(0,30)
  IndexBuffer.insert(3,31)
  IndexBuffer.insert(4,32)
  IndexBuffer.insert(4,33)
  IndexBuffer.insert(3,34)
  IndexBuffer.insert(7,35)

  mesh.addMeshBuffer(T_irrIMeshBuffer(MeshBuffer))
  Animmesh.addMesh(T_irrIMesh(mesh))


  CloseStream(BMFile)
  Return T_irrIAnimatedMesh(Animmesh) 
 End Method

 Method TestByteStringArray:Int(test1:Byte Ptr,test2:String)
  Local t:Int
   
  For t = 1 To Len(test2)
   If Chr(test1[t-1]) &lt;&gt; Mid(test2,t,1) Then Return False
  Next
  Return True
 End Method

 Method ReadChunkHeader(file:TStream)
  DebugLog("ReadChunkHeader")
  ChunkHeader.id = Readint(file)
  Chunkheader.length = Readint(file)
  DebugLog("I got here")
  DebugLog(Chr((Varptr Chunkheader.id)[0]))
 End Method
 ' GG - changed to return BMXIMeshLoader
 Function generate:BMXIMeshLoader()
  Return BMXIMeshLoader(New B3DLoader)
 End Function
  
End Type


Local device:T_irrIrrlichtDevice=T_irrIrrlichtDevice.create(EDT_OPENGL,T_irrDimension2d_s32.create(640,480),32,False,False,False,0)

device.setWindowCaption("Hello World! - Irrlicht Engine Demo")

Local driver:T_irrIVideoDriver=device.getVideoDriver()
Local smgr:T_irrISceneManager=device.getSceneManager()
Local guienv:T_irrIGUIEnvironment=device.getGUIEnvironment()

' GG - create the loader, convert it to a T_irrIMeshLoader and pass to addexternalmeshloader
Local loader:B3DLoader = B3DLoader(B3DLoader.create(B3DLoader.generate))
smgr.AddExternalMeshLoader(T_irrIMeshLoader.createFromHandle(loader.handle))

guienv.addStaticText("Hello World! This is the Irrlicht Software renderer!",T_irrRect_s32.createFromVals(10,10,200,22),True)

Local mesh:T_irrIAnimatedMesh=smgr.getMesh("bridge.b3d")
If mesh.handle = 0 Then Print "Error in creating mesh"; End
Local node:T_irrIAnimatedMeshSceneNode=smgr.addAnimatedMeshSceneNode(mesh)
Local anim:T_irrISceneNodeAnimator
If node.handle&lt;&gt;0
    node.setScale(T_irrVector3df.createFromVals(10,10,10))
	node.setMaterialFlag(EMF_LIGHTING,False)
	node.setFrameLoop(0,310)
	'node.setMaterialTexture(0,driver.getTexture("pebble2.jpg"))
	anim = smgr.createRotationAnimator(T_irrVector3df.createFromVals(.1,1,.5))
	node.addAnimator(anim)

EndIf

smgr.addCameraSceneNode(0,T_irrVector3df.createFromVals(0,30,-40),T_irrVector3df.createFromVals(0,5,0))

While (device.run())

	driver.beginScene(True,True,T_irrSColor.createFromVals(0,200,200,200))
	smgr.drawAll()
	guienv.drawAll()
	driver.endScene()

Wend

device.drop()
</textarea> <br><br></td></tr></table><br>
<a name="598070"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> very nice so far TomToad :)  Budman is graciously reworking the IO read functionality to get it to work.  as for the disappearing box sides.  im no expert, but it almost seems that you need to adjust the normals since we can see the inside of the box and then that side disappears when it rolls around. <br><br></td></tr></table><br>
<a name="598138"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I sent fixes to gman so he can integrate an update to the irrlicht mod distro.  I also sent him your posted code recoded to read from the IFile reader interface.<br><br>Should work well for you now.   No you have the hard part parse the B3D file :)<br><br>If you want the changes before GMAN can get afixes up and can compile the mod shoot me an email @ doug_s@... and I will email the files to you that changed.<br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="598268"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, looks like the box sides disappeared because I was indexing the vertices in the wrong order.  I think I got one wrong and it just put all the rest out of whack.  But there's still a problem though.  Now I get a solid object, but it's nothing like a cube. :)<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Strict

Import gg.irrBMAX

Type T_chunk_header
 Field id:Int
 Field length:Int
End Type

' GG - based on BMXIMeshLoader instead
Type B3DLoader Extends BMXIMeshLoader
 Field ChunkHeader:T_chunk_header

 Method IsALoadableFileExtension:Int(Filename:String)
DebugLog("IsALoadableFileExtension")
  Return (Lower(Right(Filename,4)) = ".b3d")
 End Method

 
 Method createMesh:T_irrIAnimatedMesh(file:T_irrIReadFile)
  Local BMFile:TStream = ReadStream(file.getFileName())
DebugLog("createMesh")
  ChunkHeader = New T_chunk_header
  SeekStream(BMFile,0) 'seek to start of file
  ReadChunkHeader(BMFile)

  If TestByteStringArray(Varptr ChunkHeader.id,"BB3D")
   Print "BB3D header found"
  Else
   Print "BB3D header not found"
  End If

  Local Animmesh:T_irrSAnimatedMesh = T_irrSAnimatedMesh.create()
  Local Mesh:T_irrSMesh = T_irrSMesh.create()
  Local MeshBuffer:T_irrSMeshBuffer = T_irrSMeshBuffer.create()

  Local VertexBuffer:T_irrArray_S3DVertex = MeshBuffer.getVertices()
  VertexBuffer.reallocate(8)
  
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(1,1,-1,1,1,-1,T_irrSColor.createFromVals(255,255,0,0),0,0),0)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(1,1,1,1,1,1,T_irrSColor.createFromVals(255,255,255,0),0,0),1)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(-1,1,1,-1,1,1,T_irrSColor.createFromVals(255,0,255,0),0,0),2)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(-1,1,-1,-1,1,-1,T_irrSColor.createFromVals(255,0,255,255),0,0),3)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(1,-1,-1,1,-1,-1,T_irrSColor.createFromVals(255,0,0,255),0,0),4)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(1,-1,1,1,-1,1,T_irrSColor.createFromVals(255,255,0,255),0,0),5)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(-1,-1,1,-1,-1,1,T_irrSColor.createFromVals(255,255,255,255),0,0),6)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(-1,-1,-1,-1,-1,-1,T_irrSColor.createFromVals(255,0,0,0),0,0),7)

  Local IndexBuffer:T_irrArray_u16 = MeshBuffer.getIndices()

  IndexBuffer.reallocate(36)
  IndexBuffer.insert(0,0)
  IndexBuffer.insert(1,1)
  IndexBuffer.insert(2,2)
  IndexBuffer.insert(2,3)
  IndexBuffer.insert(3,4)
  IndexBuffer.insert(0,5)

  IndexBuffer.insert(4,6)
  IndexBuffer.insert(1,7)
  IndexBuffer.insert(0,8)
  IndexBuffer.insert(4,9)
  IndexBuffer.insert(5,10)
  IndexBuffer.insert(1,11)

  IndexBuffer.insert(4,12)
  IndexBuffer.insert(6,13)
  IndexBuffer.insert(5,14)
  IndexBuffer.insert(4,15)
  IndexBuffer.insert(7,16)
  IndexBuffer.insert(6,17)

  IndexBuffer.insert(7,18)
  IndexBuffer.insert(3,19)
  IndexBuffer.insert(2,20)
  IndexBuffer.insert(7,21)
  IndexBuffer.insert(2,22)
  IndexBuffer.insert(6,23)

  IndexBuffer.insert(2,24)
  IndexBuffer.insert(1,25)
  IndexBuffer.insert(5,26)
  IndexBuffer.insert(5,27)
  IndexBuffer.insert(6,28)
  IndexBuffer.insert(2,29)

  IndexBuffer.insert(0,30)
  IndexBuffer.insert(3,31)
  IndexBuffer.insert(4,32)
  IndexBuffer.insert(4,33)
  IndexBuffer.insert(3,34)
  IndexBuffer.insert(7,35)


  MeshBuffer.recalculateBoundingBox()

  mesh.addMeshBuffer(T_irrIMeshBuffer(MeshBuffer))
  Animmesh.addMesh(T_irrIMesh(mesh))


  CloseStream(BMFile)
  Return T_irrIAnimatedMesh(Animmesh) 
 End Method

 Method TestByteStringArray:Int(test1:Byte Ptr,test2:String)
  Local t:Int
   
  For t = 1 To Len(test2)
   If Chr(test1[t-1]) &lt;&gt; Mid(test2,t,1) Then Return False
  Next
  Return True
 End Method

 Method ReadChunkHeader(file:TStream)
  DebugLog("ReadChunkHeader")
  ChunkHeader.id = Readint(file)
  Chunkheader.length = Readint(file)
  DebugLog("I got here")
  DebugLog(Chr((Varptr Chunkheader.id)[0]))
 End Method
 ' GG - changed to return BMXIMeshLoader
 Function generate:BMXIMeshLoader()
  Return BMXIMeshLoader(New B3DLoader)
 End Function
  
End Type


Local device:T_irrIrrlichtDevice=T_irrIrrlichtDevice.create(EDT_OPENGL,T_irrDimension2d_s32.create(640,480),32,False,False,False,0)

device.setWindowCaption("Hello World! - Irrlicht Engine Demo")

Local driver:T_irrIVideoDriver=device.getVideoDriver()
Local smgr:T_irrISceneManager=device.getSceneManager()
Local guienv:T_irrIGUIEnvironment=device.getGUIEnvironment()

' GG - create the loader, convert it to a T_irrIMeshLoader and pass to addexternalmeshloader
Local loader:B3DLoader = B3DLoader(B3DLoader.create(B3DLoader.generate))
smgr.AddExternalMeshLoader(T_irrIMeshLoader.createFromHandle(loader.handle))

guienv.addStaticText("Hello World! This is the Irrlicht Software renderer!",T_irrRect_s32.createFromVals(10,10,200,22),True)

Local mesh:T_irrIAnimatedMesh=smgr.getMesh("bridge.b3d")
If mesh.handle = 0 Then Print "Error in creating mesh"; End
Local node:T_irrIAnimatedMeshSceneNode=smgr.addAnimatedMeshSceneNode(mesh)
Local anim:T_irrISceneNodeAnimator
If node.handle&lt;&gt;0
    node.setScale(T_irrVector3df.createFromVals(10,10,10))
	node.setMaterialFlag(EMF_LIGHTING,False)
	node.setFrameLoop(0,310)
	'node.setMaterialTexture(0,driver.getTexture("pebble2.jpg"))
	anim = smgr.createRotationAnimator(T_irrVector3df.createFromVals(.1,1,.5))
	node.addAnimator(anim)

EndIf

smgr.addCameraSceneNode(0,T_irrVector3df.createFromVals(0,30,-40),T_irrVector3df.createFromVals(0,5,0))

While (device.run())

	driver.beginScene(True,True,T_irrSColor.createFromVals(0,200,200,200))
	smgr.drawAll()
	guienv.drawAll()
	driver.endScene()

Wend

device.drop()
</textarea><br>I had an idea while at work, There's a function called ISceneManager-&gt;addTestSceneNode() which creates a cube.  I'll have a look in the irrLicht source and see if I can figure out what it's doing so I can get a better idea of how the meshes are created. <br><br></td></tr></table><br>
<a name="598295"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> After some experimenting, I'm finding that Vertex 0 is moving from 1,1,-1 to 0,1,-1.  You can even see it shift about 1/2 second after the program starts. <br><br></td></tr></table><br>
<a name="598664"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, this is what I have so far.  It's getting very close.  Only problem is that it seems that the first element of the first vertex (X pos) changes to 0 about half a second after the program begins running.  I don't know why.  Possibly a bug in the wrappers?  Or am I still missing something?<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Strict

Import gg.irrBMAX

Type T_chunk_header
 Field id:Int
 Field length:Int
End Type


' GG - based on BMXIMeshLoader instead
Type B3DLoader Extends BMXIMeshLoader
 Field ChunkHeader:T_chunk_header

 Method IsALoadableFileExtension:Int(Filename:String)
DebugLog("IsALoadableFileExtension")
  Return (Lower(Right(Filename,4)) = ".b3d")
 End Method

 
 Method createMesh:T_irrIAnimatedMesh(file:T_irrIReadFile)
  Local BMFile:TStream = ReadStream(file.getFileName())
DebugLog("createMesh")
  ChunkHeader = New T_chunk_header
  SeekStream(BMFile,0) 'seek to start of file
  ReadChunkHeader(BMFile)

  If TestByteStringArray(Varptr ChunkHeader.id,"BB3D")
   Print "BB3D header found"
  Else
   Print "BB3D header not found"
  End If

  Local Animmesh:T_irrSAnimatedMesh = T_irrSAnimatedMesh.create()
  Local Mesh:T_irrSMesh = T_irrSMesh.create()
  Local MeshBuffer:T_irrSMeshBuffer = T_irrSMeshBuffer.create()

  Local VertexBuffer:T_irrArray_S3DVertex = MeshBuffer.getVertices()
  VertexBuffer.reallocate(8)
  
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(1,1,-1,1,1,-1,T_irrSColor.createFromVals(255,0,0,0),0,0),0)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(1,1,1,1,1,1,T_irrSColor.createFromVals(255,255,0,0),0,1),1)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(-1,1,1,-1,1,1,T_irrSColor.createFromVals(255,255,0,255),1,1),2)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(-1,1,-1,-1,1,-1,T_irrSColor.createFromVals(255,0,255,0),1,0),3)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(1,-1,-1,1,-1,-1,T_irrSColor.createFromVals(255,0,255,255),1,0),4)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(1,-1,1,1,-1,1,T_irrSColor.createFromVals(255,255,0,255),1,1),5)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(-1,-1,1,-1,-1,1,T_irrSColor.createFromVals(255,255,255,0),0,1),6)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(-1,-1,-1,-1,-1,-1,T_irrSColor.createFromVals(255,255,0,0),0,0),7)

  Local IndexBuffer:T_irrArray_u16 = MeshBuffer.getIndices()

  IndexBuffer.reallocate(36)
  IndexBuffer.insert(0)
  IndexBuffer.insert(1)
  IndexBuffer.insert(2)
  IndexBuffer.insert(2)
  IndexBuffer.insert(3)
  IndexBuffer.insert(0)

  IndexBuffer.insert(4)
  IndexBuffer.insert(1)
  IndexBuffer.insert(0)
  IndexBuffer.insert(4)
  IndexBuffer.insert(5)
  IndexBuffer.insert(1)

  IndexBuffer.insert(4)
  IndexBuffer.insert(6)
  IndexBuffer.insert(5)
  IndexBuffer.insert(4)
  IndexBuffer.insert(7)
  IndexBuffer.insert(6)

  IndexBuffer.insert(7)
  IndexBuffer.insert(3)
  IndexBuffer.insert(2)
  IndexBuffer.insert(7)
  IndexBuffer.insert(2)
  IndexBuffer.insert(6)

  IndexBuffer.insert(2)
  IndexBuffer.insert(1)
  IndexBuffer.insert(5)
  IndexBuffer.insert(5)
  IndexBuffer.insert(6)
  IndexBuffer.insert(2)

  IndexBuffer.insert(0)
  IndexBuffer.insert(3)
  IndexBuffer.insert(4)
  IndexBuffer.insert(4)
  IndexBuffer.insert(3)
  IndexBuffer.insert(7)

  MeshBuffer.recalculateBoundingBox()
  
  mesh.addMeshBuffer(T_irrIMeshBuffer(MeshBuffer))
  MeshBuffer.Drop()
  MeshBuffer = Null
  Animmesh.addMesh(T_irrIMesh(mesh))
  Mesh.Drop()
  Mesh = Null

  Animmesh.RecalculateBoundingBox()


  CloseStream(BMFile)
  Return T_irrIAnimatedMesh(Animmesh) 
 End Method

 Method TestByteStringArray:Int(test1:Byte Ptr,test2:String)
  Local t:Int
   
  For t = 1 To Len(test2)
   If Chr(test1[t-1]) &lt;&gt; Mid(test2,t,1) Then Return False
  Next
  Return True
 End Method

 Method ReadChunkHeader(file:TStream)
  DebugLog("ReadChunkHeader")
  ChunkHeader.id = Readint(file)
  Chunkheader.length = Readint(file)
  DebugLog("I got here")
  DebugLog(Chr((Varptr Chunkheader.id)[0]))
 End Method
 ' GG - changed to return BMXIMeshLoader
 Function generate:BMXIMeshLoader()
  Return BMXIMeshLoader(New B3DLoader)
 End Function
  
End Type


Local device:T_irrIrrlichtDevice=T_irrIrrlichtDevice.create(EDT_OPENGL,T_irrDimension2d_s32.create(640,480),32,False,False,False,0)

device.setWindowCaption("Hello World! - Irrlicht Engine Demo")

Local driver:T_irrIVideoDriver=device.getVideoDriver()
Local smgr:T_irrISceneManager=device.getSceneManager()
Local guienv:T_irrIGUIEnvironment=device.getGUIEnvironment()

' GG - create the loader, convert it to a T_irrIMeshLoader and pass to addexternalmeshloader
Local loader:B3DLoader = B3DLoader(B3DLoader.create(B3DLoader.generate))
smgr.AddExternalMeshLoader(T_irrIMeshLoader.createFromHandle(loader.handle))

guienv.addStaticText("Hello World! This is the Irrlicht Software renderer!",T_irrRect_s32.createFromVals(10,10,200,22),True)

Local mesh:T_irrIAnimatedMesh=smgr.getMesh("bridge.b3d")


If mesh.handle = 0 Then Print "Error in creating mesh"; End
Local node:T_irrIAnimatedMeshSceneNode=smgr.addAnimatedMeshSceneNode(mesh)
Local anim:T_irrISceneNodeAnimator
If node.handle&lt;&gt;0
    'node.setScale(T_irrVector3df.createFromVals(10,10,10))
	node.setMaterialFlag(EMF_LIGHTING,False)
	'node.setFrameLoop(0,310)
	'node.setMaterialTexture(0,driver.getTexture("pebble2.jpg"))
	anim = smgr.createRotationAnimator(T_irrVector3df.createFromVals(.1,1,.5))
	node.addAnimator(anim)

EndIf

smgr.addCameraSceneNode(0,T_irrVector3df.createFromVals(0,0,-5),T_irrVector3df.createFromVals(0,0,0))

While (device.run())

	driver.beginScene(True,True,T_irrSColor.createFromVals(0,200,200,200))
	smgr.drawAll()
	guienv.drawAll()
	driver.endScene()

Wend

device.drop()
</textarea> <br><br></td></tr></table><br>
<a name="598719"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> That is strange bug.  I took a look at it tonight can say I see why the mesh is being changed.<br><br>Ill try writing it in C++ without the wrapper.<br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="598789"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> I had the same idea.  Then I could know if the problem is with my logic or possibly a bug in the wrappers.<br><br>ETA:<br>This is weird.  I decided to pare down the code to just the mesh creation before converting to c++ and this version actually works as expected.  So there must be something wrong with either my implementation of the mesh loader functions, or there's a bug in the mesh loader wrappers.<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Strict

Import gg.irrBMAX


  Local MeshBuffer:T_irrSMeshBuffer = T_irrSMeshBuffer.create()

  Local Animmesh:T_irrSAnimatedMesh = T_irrSAnimatedMesh.create()
  Local Mesh:T_irrSMesh = T_irrSMesh.create()

  Local VertexBuffer:T_irrArray_S3DVertex = MeshBuffer.getVertices()
  VertexBuffer.reallocate(8)
  
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(1,1,-1,1,1,-1,T_irrSColor.createFromVals(255,0,0,0),0,0),0)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(1,1,1,1,1,1,T_irrSColor.createFromVals(255,255,0,0),0,1),1)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(-1,1,1,-1,1,1,T_irrSColor.createFromVals(255,255,0,255),1,1),2)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(-1,1,-1,-1,1,-1,T_irrSColor.createFromVals(255,0,255,0),1,0),3)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(1,-1,-1,1,-1,-1,T_irrSColor.createFromVals(255,0,255,255),1,0),4)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(1,-1,1,1,-1,1,T_irrSColor.createFromVals(255,255,0,255),1,1),5)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(-1,-1,1,-1,-1,1,T_irrSColor.createFromVals(255,255,255,0),0,1),6)
  VertexBuffer.insert(T_irrS3DVertex.createFromVals(-1,-1,-1,-1,-1,-1,T_irrSColor.createFromVals(255,255,0,0),0,0),7)

  Local IndexBuffer:T_irrArray_u16 = MeshBuffer.getIndices()

  IndexBuffer.reallocate(36)
  IndexBuffer.insert(0)
  IndexBuffer.insert(1)
  IndexBuffer.insert(2)
  IndexBuffer.insert(2)
  IndexBuffer.insert(3)
  IndexBuffer.insert(0)

  IndexBuffer.insert(4)
  IndexBuffer.insert(1)
  IndexBuffer.insert(0)
  IndexBuffer.insert(4)
  IndexBuffer.insert(5)
  IndexBuffer.insert(1)

  IndexBuffer.insert(4)
  IndexBuffer.insert(6)
  IndexBuffer.insert(5)
  IndexBuffer.insert(4)
  IndexBuffer.insert(7)
  IndexBuffer.insert(6)

  IndexBuffer.insert(7)
  IndexBuffer.insert(3)
  IndexBuffer.insert(2)
  IndexBuffer.insert(7)
  IndexBuffer.insert(2)
  IndexBuffer.insert(6)

  IndexBuffer.insert(2)
  IndexBuffer.insert(1)
  IndexBuffer.insert(5)
  IndexBuffer.insert(5)
  IndexBuffer.insert(6)
  IndexBuffer.insert(2)

  IndexBuffer.insert(0)
  IndexBuffer.insert(3)
  IndexBuffer.insert(4)
  IndexBuffer.insert(4)
  IndexBuffer.insert(3)
  IndexBuffer.insert(7)

  MeshBuffer.recalculateBoundingBox()
  
  mesh.addMeshBuffer(T_irrIMeshBuffer(MeshBuffer))
  MeshBuffer.Drop()
  MeshBuffer = Null
  Animmesh.addMesh(T_irrIMesh(mesh))
  Mesh.Drop()
  Mesh = Null

  Animmesh.RecalculateBoundingBox()




Local device:T_irrIrrlichtDevice=T_irrIrrlichtDevice.create(EDT_OPENGL,T_irrDimension2d_s32.create(640,480),32,False,False,False,0)

device.setWindowCaption("Hello World! - Irrlicht Engine Demo")

Local driver:T_irrIVideoDriver=device.getVideoDriver()
Local smgr:T_irrISceneManager=device.getSceneManager()
Local guienv:T_irrIGUIEnvironment=device.getGUIEnvironment()


guienv.addStaticText("Hello World! This is the Irrlicht Software renderer!",T_irrRect_s32.createFromVals(10,10,200,22),True)



If Animmesh.handle = 0 Then Print "Error in creating mesh"; End
Local node:T_irrIAnimatedMeshSceneNode=smgr.addAnimatedMeshSceneNode(Animmesh)
Local anim:T_irrISceneNodeAnimator
If node.handle&lt;&gt;0
    'node.setScale(T_irrVector3df.createFromVals(10,10,10))
	node.setMaterialFlag(EMF_LIGHTING,False)
	'node.setFrameLoop(0,310)
	'node.setMaterialTexture(0,driver.getTexture("pebble2.jpg"))
	anim = smgr.createRotationAnimator(T_irrVector3df.createFromVals(.1,1,.5))
	node.addAnimator(anim)

EndIf

smgr.addCameraSceneNode(0,T_irrVector3df.createFromVals(0,0,-5),T_irrVector3df.createFromVals(0,0,0))

While (device.run())

	driver.beginScene(True,True,T_irrSColor.createFromVals(0,200,200,200))
	smgr.drawAll()
	guienv.drawAll()
	driver.endScene()

Wend

device.drop()
</textarea> <br><br></td></tr></table><br>
<a name="598819"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting...<br><br>I dont think the problem is with the loader class.  I have been playing with the manual control of GC and definitly something is gettting freed incorrectly.   Hope you dont mind my helping I always love a good bug hunt.<br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="598854"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is the fix.<br><br>The vertexbuffer was getting garbage collected.  GMAN had the comment forgot to pass FALSE<br><br>This should get it going :)<br><br>smeshbuffer.bmx<br><pre class=code>
' ------------------------------------------------------------------------------------
'  irr::scene::SMeshBuffer wrappers (parent is IMeshBuffer)
' ------------------------------------------------------------------------------------
Public

Type T_irrSMeshBuffer Extends T_irrIMeshBuffer Final

	Function create:T_irrSMeshBuffer()
		Return createFromHandle(IrrScene_SMeshBuffer_new(),True)
	EndFunction

	Function createFromHandle:T_irrSMeshBuffer(pHandle:Int,bMustDel:Int=False)
		Local oRetVal:T_irrSMeshBuffer=New T_irrSMeshBuffer
		oRetVal.attach(pHandle,bMustDel)
		Return oRetVal
	EndFunction
		
	Method getBoundingBox:T_irrAABbox3df()
		'  do Not Delete this pointer
		Return T_irrAABbox3df.createFromHandle(IrrScene_SMeshBuffer_getBoundingBox(handle),False)
	EndMethod
	
	Method getIndexCount:Int()
		Return IrrScene_SMeshBuffer_getIndexCount(handle)
	EndMethod
	
	Method getIndices:T_irrArray_u16()
		'  do not delete this pointer
		Return T_irrArray_u16.createFromHandle(IrrScene_SMeshBuffer_getIndices(handle),False)
	EndMethod
	
	Method getMaterial:T_irrSMaterial()
		'  do Not Delete this pointer
		Return T_irrSMaterial.createFromHandle(IrrScene_SMeshBuffer_getMaterial(handle),False)
	EndMethod
	
	Method getVertexCount:Int()
		Return IrrScene_SMeshBuffer_getVertexCount(handle)
	EndMethod
	
	Method getVertexType:Int()
		Return IrrScene_SMeshBuffer_getVertexType(handle)
	EndMethod
	
	Method getVertices:T_irrArray_S3DVertex()
		'  do not delete this pointer
		' Return T_irrArray_S3DVertex.createFromHandle(IrrScene_SMeshBuffer_getVertices(handle))
		' dbs changed should have passed false
		Return T_irrArray_S3DVertex.createFromHandle(IrrScene_SMeshBuffer_getVertices(handle),False)
	EndMethod

	Method recalculateBoundingBox()
		IrrScene_SMeshBuffer_recalculateBoundingBox(handle)
	EndMethod

EndType



</pre> <br><br></td></tr></table><br>
<a name="598858"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Success!  Thanks for the work Budman :)<br>Now I can get onto the next phase.  Actually writing the B3D parser. <br><br></td></tr></table><br>
<a name="598942"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DStastny</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> I still think there is a couple of lurking issues.  But I have to get with GMAN before I look at changing the code.  Not sure I remember his intent in the wrappers.<br><br>Good luck cant wait to see it.<br><br>Doug Stastny <br><br></td></tr></table><br>
<a name="599033"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, now that I'm actually getting somewhere on this project, I decided to start a worklog.<br><a href="http://www.blitzbasic.com/logs/userlog.php?user=7529&amp;log=589" target="_blank">http://www.blitzbasic.com/logs/userlog.php?user=7529&amp;log=589</a> <br><br></td></tr></table><br>
<a name="599154"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> good job TT :)  a big thank you to Budman for tracking down the issues.  a new release with the fixes is available in the worklog. <br><br></td></tr></table><br>
<a name="599284"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> k.  ive been chatting with Budman and i see the issue he alluded too in his last post.  in the createMesh() method, you need to be sure to call the grab() method on the instance of T_irrSAnimatedMesh before you return.  this will properly sync the instance counting between Irrlicht and BlitzMax and avoid a rather potentially nasty crash. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
