<!DOCTYPE html><html lang="en" ><head ><title >Functions in functions cause random memory errors</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Functions in functions cause random memory errors</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Functions in functions cause random memory errors</a><br><br>
<a name="827266"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have been struggling with a problem for two days.  Somewhere some of my code is randomly overwriting memory that happens to be in a block of memory where some texcoords are stored.  The error changes depending on what unrelated parts of code I compile, so it is definitely one of those untraceable memory problems.  I'll make a change that fixes it, then a few hours later it pops up again.<br><br>The only time I have ever seen this happen in BlitzMax is when functions within functions were used, with a global variable in the main function called in the nested function.<br><br>The only thing I can think to do is go through all my code and eliminate all functions in functions.  This is not a trivial task. <br><br></td></tr></table><br>
<a name="827270"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> you could as well cut the globals in the main functions, make them local and pass them.<br><br>This would guarantee that the frame pointer in the stack are not beeing messed up by the global ...<br><br>Don't know what steps BM actually takes for its func in func feature, but due to the GC, "local globals" and real globals there is a lot of potential to mess with the stack.<br><br>This is assuming that you are not calling func in func recursively, as this most likely guarantees that it will mess.<br><br>And it is a trivial task actually.<br><br>cut - paste, rename to mainfunction_subfunction(...) and you are done<br><br>By using regex / macro this potentially can even be automated <br><br></td></tr></table><br>
<a name="827277"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have no idea what is happening.  I keep making changes, the problem goes away, then it reappears again later. <br><br></td></tr></table><br>
<a name="827295"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> You shouldn't be using nested functions, just so you know.  It's more of a neat side-effect than anything supported.  In short, expect some degree of stack corruption if you're doing anything that shouldn't be done.<br><br>Of course, it could be that code buried in some deep, dark horrible section of whatever it is this is about is writing past what it should be.  Brings back memories of people using strcpy in C... <br><br></td></tr></table><br>
<a name="827296"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >REDi</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> You shouldn't be using nested functions <br></div><br>I might be wrong but I swear I've seen nested functions in the BRL modules somewhere.<br>*EDIT* cant seem to find any now tho <br><br></td></tr></table><br>
<a name="827300"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dmaz</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I use funcs within funcs a lot without any problems. I would have to go back and check if I use globals from the parent func though... <br><br></td></tr></table><br>
<a name="827301"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you accessing any variables outside its scope? Like fields if the function is inside a method?<br><br>If you treat them as any other global function (which they are really) there shouldn't be any problems. <br><br></td></tr></table><br>
<a name="827302"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am not sure this is the cause, but it is the only thing I have ever seen cause silent memory errors like this.<br><br>Every time I change something just to help debug the problem, the problem goes away, then reappears later. <br><br></td></tr></table><br>
<a name="827303"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Will</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've experienced random problems like this before - never figured it out though, now that I know it might be a function-in-function issue I hope I'll be able to resolve it. <br><br></td></tr></table><br>
<a name="827464"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TaskMaster</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> What the heck is function in function?  Nested functions? <br><br></td></tr></table><br>
<a name="827474"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> What the heck is function in function <br></div><br>I think you mean, what is this nonsense? ;-) <br><br></td></tr></table><br>
<a name="827479"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yah, never heard of this capability. How does it even make sense? Like, a local function which only the parent function can call? <br><br></td></tr></table><br>
<a name="827508"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Correct.<br>This function is only known to its parent function.<br><br>The only potential reason to do such a suicide attempt to "opt code" is cases where you want a sub function to use the same variable as the main function.<br><br>The reason for this thing most likely is that goto / gosub do not exist anymore which allowed this kind of stuff without nested functions.<br><br>But even then: its a very bad programming style to use this kind of functionality as the program flow becomes less clear and potentially even corrupted if you ever try to visualize it in some kind of usage case or the like to explain to someone else what it does.<br>So my above suggestion with mainfunction_subfunction would allow a far clearer structuring (and potential reuse)<br><br>The only place I know this feature was ever used was the brl.gl module where it was used in the calctexsize to get the nearest power of 2 value. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
