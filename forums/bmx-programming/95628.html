<!DOCTYPE html><html lang="en" ><head ><title >Light and shadow system</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Light and shadow system</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Light and shadow system</a><br><br>
<a name="1102799"></a>

<a name="1102800"></a>

<a name="1102801"></a>

<a name="1102802"></a>

<a name="1102803"></a>

<a name="1102804"></a>

<a name="1102805"></a>

<a name="1102806"></a>

<a name="1103671"></a>

<a name="1103672"></a>

<a name="1106160"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >UnderwoodNullium</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm working on a light and shadow system.  Each shadow is a polygon made with the angles between objects' edges and the lights.  The lights are LIGHTBLENDed together and form a cool effect.  There's also a line of sight part which blacks out 'walls' also, using the same way as the shadows.  Also I wanted to have images that are only visible within the lights (I'm using SHADEBLEND right now).<br><br>Everything's fine except for a few things.<br><br>1) The images should be blended with the lights so that any image outside the lights is blackened by darkness.  I did this with SHADEBLEND, but I need to have lots of images with transparency drawn before this.  How it is now, images are mashed together no matter the alpha.<br><br>2) I want the shadows to 'disappear' as that part of the polygon is further from the light.  I think I need to use a gradient circle (like my light image used) and blend it to the shadow somehow.  I did something close once.<br><br>I really am a noob with the blend modes, most of the work was trial and error.<br><br>That's about all I can think of.  The code's below, with the images.  Any help would be amazing!<br><br>nullium.fileave.com/Random/Shadow.zip<br><br><font class="tiny">Last edited 2011</font><br>I'm not worried about 2) anymore above.<br><br><img src="http://nullium.fileave.com/Random/1.PNG"><br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1102808"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Very cool, hope to see more! <br><br></td></tr></table><br>
<a name="1102809"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >UnderwoodNullium</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the post ima, it's gonna be for a top-down zombie game (like nazi zombies but more to do, like moving furniture to block doorways, etc) soon.  I was going to possibly make a library for people to use after I get these few issues I'm having fixed.<br><br>Any ideas guys? <br><br></td></tr></table><br>
<a name="1102829"></a>

<a name="1102830"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hiya.<br>Very good start:)<br><br>One method to fix your shadow issues is to construct the shadow volumes to confine only in the area that is lit. You are extending the shadows infinitely, then when another light crosses this extended shadow volume its getting lit which is incorrect.<br><br>EDIT:- To do this, give each light a 'distance' variable and use it to construct a shadow volume for the polys.<br><br>Looks good, very promising.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1102831"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >UnderwoodNullium</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks col!  I'm trying desperately to do exactly that, but I want a kind of gradual dissipation of the shadow from the light, like a gradient for the shadow.  I'm trying to do it with the different blends (and blend the shadow with it's light with a larger distance)...  It's all driving me mad.  ;) <br><br></td></tr></table><br>
<a name="1102870"></a>

<a name="1102876"></a>

<a name="1102879"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're thinking along the correct lines.<br><br>Try this...<br>The light image is 150x150, use 150 as the radius, or if you scale it then scale the radius too, then...<br>In the DrawShadowsAndLights(...) function, instead of multiplying the shadow poly verts by LARGENUMBER, use the radius. This should build the shadow volume within the constraints of the of the light image. Remeber, you only want to create a shadow volume within the lit area, not in the dark areas.<br><br>Then blend, using LIGHBLEND to light or SHADEBLEND to darken.<br><br>EDIT:- Sorry slight bullshit above :D<br>You need to make the shadow the radius from the centre of the light source to its radius. So when you build the shadow volume and you generate the verts, you need to know the distance from the corner to the light source centre, then subtract that distance from the radius to give you the remaining distance from the corner to the lights radius. Use that second distance instead of the LARGENUMBER.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1103256"></a>

<a name="1103257"></a>

<a name="1103258"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >UnderwoodNullium</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks again Dave.  Basically I'm not as worried about the shadows so much as I'm worried about the images being draw correctly 'under the lights', if I could get that working correctly I'd be a happy camper!  Haha.<br><br>Basically exactly how it looks now, except I don't think it's correct.  All I really want is the whole level, complete with some transparent images and some nontransparent ones, being illuminated only if any light source is overlapping it.  I can achieve that effect kinda with what I have now, but the images I had to SHADEBLEND after all the lights were LIGHTBLENDed.  This leads to a weird effect and the images don't have transparency.<br><br>I know I'm not making any sense, haha.  Basically I'm trying to get it to work where the images that make up the whole level (including transparent ones, are 'shown' through the lights, like this.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Function DrawShadowsAndLights()

	Local p3x#,p3y#,p4x#,p4y#
	Local shaded#[]


		UpdateLights()				' all the lightblended lights

		SetAll(shadeBLEND,1,255,255,255,0,1,1)							' shadeblend everything in the house? (not part of lighting system...)
		TileImage(floorimage,0,0)

		SetAll(shadeBLEND,1,155,155,155,0,1,1)							' shadeblend everything in the house? (not part of lighting system...)
		DrawImage(stoveimage,600,600)



	For s:shadow = EachIn shadowlist						' draw over everything else with LOS system (basically black out anything out of the line of site)

		If s.kind = 1

			p3x = s.p2x + (Cos(GetAngle(camx,camy,s.p2x,s.p2y)) * LARGENUMBER)
			p3y = s.p2y + (Sin(GetAngle(camx,camy,s.p2x,s.p2y)) * LARGENUMBER)
			p4x = s.p1x + (Cos(GetAngle(camx,camy,s.p1x,s.p1y)) * LARGENUMBER)
			p4y = s.p1y + (Sin(GetAngle(camx,camy,s.p1x,s.p1y)) * LARGENUMBER)

			shaded = [s.p1x,s.p1y,s.p2x,s.p2y,p3x,p3y,p4x,p4y]

			SetAll(alphablend,1,0,0,0,0,1,1)
			DrawPoly(shaded)
		EndIf
	Next


End Function
</textarea><br><br>That's the main light function.  It works kinda, but not the way I want.  At first, the lights are LIGHTBLENDed together, the I draw the images that are shown through the lights using SHADEBLEND, the the line of sight part.  Unfortunately SHADEBLEND isn't what I'm looking for I think... Any ideas?  I really do appreciate it.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1103430"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >col</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Unless I'm mistaken.... I think what you are after there will need some kind of multipass which BMax can't do natively, Or maybe some kind of trick with overlaying a quad to darken?? There are lots of other ways to do in a single pass :) but it would mean using the gl driver and the raw gl.. commands which BMax can do easily :) Of course you need to learn OpenGL to do that :P <br><br></td></tr></table><br>
<a name="1103449"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >UnderwoodNullium</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was afraid of that.  ;)  Thanks again though, I'll pour over some gl stuff soon and hopefully get this project jumping.  Thanks Dave, I appreciate it. <br><br></td></tr></table><br>
<a name="1103511"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >UnderwoodNullium</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Man, I've been pouring over tons of stuff in the forums and can't really find anything.  I found one gl example that used a mask and it let me see underneath the lights (and what was under was perfect), but the mask didn't support smooth transparent images for lights.  Just one color...  Hmm.  I must be missing something. <br><br></td></tr></table><br>
<a name="1103540"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Underwood, I didn't quite understand what you're trying to achieve. <br><br>I mean, the environment is really only showing through the parts that are lit, consequence of you drawing things with ALPHA or LIGHTBLEND, then later drawing what you want to be occluded with SHADEBLEND.<br><br>Check this post: <a href="/posts.php?topic=94237#1080698" target="_blank">2D Flashlight Effect</a>.<br><br>Is there any way you can mockup in your fav. image editing program how you want it to be displayed? <br><br></td></tr></table><br>
<a name="1103670"></a>

<a name="1103675"></a>

<a name="1103676"></a>

<a name="1103677"></a>

<a name="1103678"></a>

<a name="1103680"></a>

<a name="1103681"></a>

<a name="1103682"></a>

<a name="1103684"></a>

<a name="1103685"></a>

<a name="1103686"></a>

<a name="1103687"></a>

<a name="1103688"></a>

<a name="1103690"></a>

<a name="1103691"></a>

<a name="1103692"></a>

<a name="1106161"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >UnderwoodNullium</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the link Kryzon, and that's pretty much how far I've gotten it so far, but I'm still having a problem with the SHADEBLEND part...  It's mixing my two 'shown through the lights' images (the floor and a crate), which I think col said Blitz won't allow (since I want them some images to have transparency, others not).<br>I noticed in your example you created an image of all the rects that are on screen before any blending (I'm guessing to blend everything in one go), I also tried grabbing the whole screen to process that one image (after everything was alphablended the way I neeed it) but it was too slow (but worked).<br>Here's the crate and floor how it is currently, I can't figure out how to <u>not</u> make the crate blend with the floor (maybe it's doing this because the floor and crate are SHADEBLENDed in one pass together?) but still have the same lighting effect.  Thanks for helping, you have no idea how appreciative I am!  :)<br><pre class=code>
	UpdateLights()

	SetAll(shadeBLEND,1,255,255,255,0,1,1)
	TileImage(floorimage,0,0)

	SetAll(shadeBLEND,1,155,155,155,0,1,1)
	DrawImage(stoveimage,600,600)
</pre><br>The SetAll function just does this: SetAll(blendmode,alpha,r,g,b,rotation,scalex,scaley)<br><br><img src="http://nullium.fileave.com/Random/shade.PNG"><br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1103729"></a>

<a name="1103730"></a>

<a name="1103731"></a>

<a name="1103732"></a>

<a name="1103733"></a>

<a name="1103914"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmm, I understand. It's complicated indeed; you'll need to use a framebuffer - this is equal to making another "backbuffer" to which you can draw stuff into.<br>With an extra framebuffer you'll be able to achieve this level of composition.<br><br>It shouldn't be too hard. The hardest part should be finding the right sequence of steps and interfacing with Max2D's images. <br>Most of the hassle of implementing FBO's has already been covered <a href="/posts.php?topic=85608" target="_blank">in this thread</a> (most posts have some useful information or instruction on using the shared code). <br>Low-level use of FBO's can be read <a href="http://www.gamedev.net/page/resources/_//feature/fprogramming/opengl-frame-buffer-object-101-r2331" target="_blank">Here</a>.<br><br>With an extra framebuffer you'll have two buffers to draw to: the default backbuffer and this extra framebuffer you created.<br>Every frame you do this (in the order presented):<br><pre class=code>
•Bind the extra framebuffer {

 -&gt; CLS

 -&gt; Draw your environment and characters with all the blendings you want

}


•Unbind the extra framebuffer { 

 -&gt; This gets you back to the backbuffer

}


•Draw normally as you would {

 -&gt; CLS

 -&gt; Draw all the light-shapes with any blending you want (preferably ALPHA) to
 set up the visibility.

 -&gt; SetBlend SHADEBLEND

 -&gt; Draw a fullscreen rect. Use a custom DrawRect() function that binds the
 framebuffer's color attachment texture to use as its own. Since this texture holds 
 the game environment and characters, they'll be blended against the light-shapes.

}
</pre>This would work just like that "2D Flashlight Effect", but now you can have animated backgrounds with moving characters etc.<br>The original effect didn't need a framebuffer because the screen was static, so it could just be grabbed once into a pixmap and drawn forever. <br><br>Since grabbing things is slow for real-time purposes, we use a framebuffer. If the framebuffer technique doesn't work, you can resort to GrabPixmap() or GrabImage() anyway.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1103769"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >UnderwoodNullium</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the links and pseudo code.  I'll do as much research on FBOs, it looks like what I need.  I'll write in a day or two how it went.  Thanks again! <br><br></td></tr></table><br>
<a name="1104115"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >UnderwoodNullium</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I researched as much as I could, and I'm still pretty lost when it comes to FBOs.  I understand the principle, but I've unfortunately haven't expanded into OpenGL or even using other's modules much.  I always want to code stuff on my own but man, it seems beyond my reach a bit.  I apologize.  I would appreciate any more help anyone could give.  After it starts to work I'll clean my messy bad code a bit and maybe put it in the archives for others to use. <br><br></td></tr></table><br>
<a name="1105556"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >UnderwoodNullium</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've been trying tons of alternatives, but I know this can be done.  Any ideas? <br><br></td></tr></table><br>
<a name="1105656"></a>

<a name="1105657"></a>

<a name="1105658"></a>

<a name="1105659"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VomitOnLino</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why don't you use Render2Texture, I think TonyG fixed Indiepath's module and made it work with DirectX 7/9.<br><br>I myself took a good long look at Indiepath's code and wrote (for port-abilities sake) a closely similar OpenGL implementation. It works even on the GMA 900 and it is dead simple to use.<br><br>Basically: Init RTT, Draw into RTT buffer, Cls, Draw other stuff, Draw RTT texture on top; or do whatever else with it. Repeat.<br><br>You should be able to find it by searching these forums for "Render to Texture" or some variation thereof.<br><br>If you're still stuck then I guess I could slice out that part of my game's source, I guess that's only fair as I wouldn't have been able to do it without Indiepath's module for insight. The advantage of "my" implementation is that it works nicely with Oddballs ODD2 module and Blitz' own VirtualResolution.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1105683"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >UnderwoodNullium</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks so much for the comment Vomit.  I have been doing SO much research lately on OpenGL stuff and etc... there's so much info out there.  I'm so used to just using blitzmax commands and not really expanding out much.  I got it working correctly using pixmaps, but it's still pretty slow (10-15 fps).  It's almost use-able!  I'll continue working on it and report back. <br><br></td></tr></table><br>
<a name="1105802"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >VomitOnLino</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well if you are dead set on using only Blitz native stuff then I guess pixmaps are as good as it's going to get.<br><br>Have you considered using small/tiny pixmaps. As the lightning and the shadows are blurry (I'd even go so far and say that's desirable) you can probably get away with rendering to a 128x128 or 256x256 pixmap.<br><br>Even so I still think pixmaps will only get you so far, so I'd still really recommend checking out this thread (Dug it up for you):<br><a href="http://www.blitzbasic.com/Community/posts.php?topic=73223#867195" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=73223#867195</a> <br><br></td></tr></table><br>
<a name="1105827"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Taron</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> The issue I found with openGL is that vertical blank flipping doesn't take on many windows laptops for some odd reason. I otherwise love it and it's fairly easy to do the wildest things with it. <br><br>Once you wrap your mind around setting up a framebuffer, which can be super easy, you can go nuts with effects and it's faster than the render to texture approach, if I'm not mistaken. I did a bunch of fun tests with it a while back...<br><a href="http://www.blitzmax.com/Community/posts.php?topic=88944#1010487" target="_blank">http://www.blitzmax.com/Community/posts.php?topic=88944#1010487</a><br><br>Anyhow, the flip 1 ignoring with openGL framework on laptops still gives me grief. <br><br></td></tr></table><br>
<a name="1105833"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >*</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would love to see code that would allow multiple layers of images and lighting, I have a game in the offing that has torches everywhere that require lighting up the surrounding area but atm the way I work it is do luminance checks on the areas around the torches and if the square isnt in there i lower it to ambient level and if it is I set it to max. When I render it I paste a sprite over the torch this works ok but I cant have torches together as the images overlap.<br><br> I would like to see some simple code that would allow torches to be together :)<br><br>I will look at FBO's when I have time but atm its rather limited. <br><br></td></tr></table><br>
<a name="1106038"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Noobody</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Since the images you posted seem to have 404'd, I'm not exactly sure what look you were going for, but I tried to come up with something based on your description:<br><br><img src="http://www.noobody.org/Data/Lighting.png"><br><br>It uses an FBO to allow correct blending of multiple lights, meaning that basically the intensities of lights add up and that shadows cast by one light source really only occlude that light source and none of the others. Since we're already using an FBO, I added soft shadows as a small gimmick. It's basically a GLSL gaussian blur, the radius of which depends on the distance to the next light source.<br><br>It requires two full-screen RGBA textures, which is a reasonable cost, and should run fast enough. It should also integrate well with Max2D (although I didn't thoroughly test that), and there are no requirements over the blendmodes you have to use to render your normal scene.<br><br>Here's the source code with the additional required files: <a href="http://noobody.org/Data/SoftShadows2D.zip" target="_blank">Link</a><br><br>For good measure, I also added a version without soft shadows ("2D Hard Shadows.bmx") if you don't want that and a simpler version that just renders lights without shadows, which will only require one full-screen texture ("2D Lighting.bmx").<br><br><br>There are compatiblity issues with FBOs (or there used to be, at least), so you might want to implement a version without them to have something to fall back on if everything else fails. If the code is to your liking and you're interested, I'll see whether I can write a DX9 version for better compatibility (no guarantees for DX7 though - never worked with it and never will). <br><br></td></tr></table><br>
<a name="1106128"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Taron</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Uh, I'm shocked that all the texture calls in the GLSL sections won't bring it to a grinding hold. It's still quite quick! Curious. Very nice, of course! Thanks for sharing. :) <br><br></td></tr></table><br>
<a name="1106130"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Noobody</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, 14 texture lookups per pixel aren't really that costly. If you consider a typical 3D game scene, there's enough overdraw to exceed that number quite easily :)<br><br>Or, in the words of a friend of mine, "The GPU is a huge interpolation machine" - it is made for these kind of things. <br><br></td></tr></table><br>
<a name="1106385"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Taron</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> I might've done something funky back in the day, because I had a pretty big slowdown after a bunch of calls. Not sure what went wrong then. Anyway, it's comforting to see and hear! Thanks! :} <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
