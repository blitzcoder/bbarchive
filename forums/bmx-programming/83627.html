<!DOCTYPE html><html lang="en" ><head ><title >BLitzmax - LUA ?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >BLitzmax - LUA ?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >BLitzmax - LUA ?</a><br><br>
<a name="943328"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does anyone know where I can download an LUA mod?<br><br>or any other scripting language.<br><br>I tried BriskVm but it crashes when I use lists. <br><br></td></tr></table><br>
<a name="943335"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I *think* this is the latest.<br><br><a href="http://www.blitzbasic.com/Community/posts.php?topic=69429" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=69429</a> <br><br></td></tr></table><br>
<a name="943367"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> And from the Lua-users wiki: <a href="http://lua-users.org/wiki/BlitzMax" target="_blank">http://lua-users.org/wiki/BlitzMax</a><br><br>I've got a local copy I updated to use Lua-5.1.4. If you want I can post it here. <br><br></td></tr></table><br>
<a name="943389"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks both of y'all<br><br>yeh could I have the 5.1.4 please? <br><br></td></tr></table><br>
<a name="943470"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here you go: <a href="http://www.htbaa.com/download/axe.mod.lua.mod-5.1.4.zip" target="_blank">http://www.htbaa.com/download/axe.mod.lua.mod-5.1.4.zip</a><br>You still need to compile it though, I hope that's not a problem. I wasn't sure which files needed to be included for that. I presume the .a and .i files? <br><br></td></tr></table><br>
<a name="943558"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks,<br><br>has anyone got a tutorial or set of examples ? <br><br></td></tr></table><br>
<a name="943563"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.lua.org/pil/" target="_blank">http://www.lua.org/pil/</a> is a nice book. The 1st edition is available online. I've got a hardcopy of the 2nd edition myself.<br><br>What exactly do you want to know? Lua is fairly new for me as well but I've been playing quite a bit with making Lua and BlitzMax interact.<br><br>Here a small example to help you started, to expose a BlitzMax function to Lua:<br><br><pre class=code>
LuaState:Byte Ptr
LuaState = luaL_newstate()
luaL_openlibs(LuaState)

lua_register(LuaState, "bmxCameraMove", LuaCameraMove)
luaL_dostring("bmxCameraMove(100,200)")
lua_close(LuaState)

Function LuaCameraMove:Int(LuaState:Byte Ptr)
	Local x:Int = luaL_checkinteger(LuaState, 1)
	Local y:Int = luaL_checkinteger(LuaState, 2)
	TCamera.GetInstance().RemoveFocus()
	TCamera.GetInstance().SetPosition(x, y)
	Return 0
End Function
</pre><br><br>Important to know, every BlitzMax function exposed to Lua must return an integer containing the amount of values you pushed on to the stack.<br><br>Have fun with Lua. <br><br></td></tr></table><br>
<a name="943621"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> thanks,<br><br>An ideal tutorial would consist of<br>1.blitzmax code as above - to expose functions<br>2.a small sample LUA script just to see things running<br>3.blitzmax code to run the script<br><br>I tried this but nothing was printed:<br><pre class=code>
Import axe.lua
Import axe.luascript

Local LuaState:Byte Ptr
LuaState = luaL_newstate()
luaL_openlibs(LuaState)

lua_register(LuaState, "bmxCameraMove", LuaCameraMove)
luaL_dostring(luastate,"bmxCameraMove(100,200)")
lua_close(LuaState)

Function LuaCameraMove:Int(LuaState:Byte Ptr)
Local x:Int = luaL_checkinteger(LuaState, 1)
	Local y:Int = luaL_checkinteger(LuaState, 2)
 Print "x "+x+" y "+y
	Return 0
End Function</pre> <br><br></td></tr></table><br>
<a name="943640"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I ran it without axe.luascript (I don't have that module) and it worked fine. <br><br></td></tr></table><br>
<a name="943694"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> i tried without luascript module and it didnt work, ah dunno why man<br><br>The program ran but nothing was printed<br><br><br>Could someone make a small tutorial please please please? <br><br></td></tr></table><br>
<a name="943719"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Try compiling it with the GUI flag on. <br><br></td></tr></table><br>
<a name="943723"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I tried experimenting with all the flags but no joy<br><br>You are just running that blitzmax code with no external scripts? <br><br></td></tr></table><br>
<a name="943724"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes. I tried it in BLIde and MaxIDE.<br><br>Are you sure mod.lua compiled without errors/warnings? <br><br></td></tr></table><br>
<a name="943728"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> yeah it compiles and executes, then the output cursor just blinks until I press the red stop button on the IDE <br><br></td></tr></table><br>
<a name="943761"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why do you need to press the stop button? It justs runs and quits...? <br><br></td></tr></table><br>
<a name="943774"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> It runs but doesnt quit by itself<br><br>Maybe we are using different versions of axe.lua ??<br><br>I downloaded the one supplied by Gabriel first and I was using that one,<br><br>I downloaded the one you supplied and it worked! sorry for the confusion<br><br>Thanks for the help <br><br></td></tr></table><br>
<a name="943792"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> do you know how to debug a script?<br><br>e.g. get the line that caused the error? <br><br></td></tr></table><br>
<a name="943794"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> When you execute a lua script with lua_pcall, lua_dofile, lua_dostring or something like that, the return value will be 0 if the function executed correctly. If the result is non-zero, the error is placed on the stack. You can get it back off the stack with lua_tostring() <br><br></td></tr></table><br>
<a name="943795"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> lua_tostring() retrieves a string from the stack? - EDIT oh yeah it does thanks<br><br>also how do you return a value from a blitzmax function in Lua? (put it onto the stack)<br><br>e.g.<br><br>Function luakeyhit:Int(luastate:Byte Ptr)<br>Local key:Int=lual_checkinteger(luastate,1)<br>lua_pushinteger (luastate,KeyHit(key))<br>Return 1<br>EndFunction<br><br>the above function just returns 1 all the time <br><br></td></tr></table><br>
<a name="943799"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> also how do you return a value from a blitzmax function in Lua? (put it onto the stack) <br></div>Read <a href="http://www.lua.org/pil/26.1.html" target="_blank">http://www.lua.org/pil/26.1.html</a> <br><br></td></tr></table><br>
<a name="943803"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> ive tried several things<br><br>LUACODE<br>if keyhit(1)==1<br>then<br>end_game()<br>end;<br><br>BLITZCODE<br>Function luakeyhit:Int(luastate:Byte Ptr)<br>Local key:Int=lual_checkinteger(luastate,1)<br>lua_pushinteger (luastate,KeyHit(key))<br>Return 1<br>EndFunction<br><br>EDIT it turns out that booleans dont work and escape is keycode 27 not keycode 1 like it used to be in bltiz3d <br><br></td></tr></table><br>
<a name="943804"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> You know that 1 is not KEY_ESCAPE, right? <br><br></td></tr></table><br>
<a name="943806"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> yep just figured that out he he he he <br><br></td></tr></table><br>
<a name="943811"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> For the sake of example, see this: <a href="http://gist.github.com/79663" target="_blank">http://gist.github.com/79663</a><br><br>And for the sake of a vaguely complicated example, see this: <a href="http://github.com/nilium/bmax-misc/blob/1d0953d886051eaa1f93bd572b447077221f69ad/lua-reflection/lua-reflection.bmx" target="_blank">http://github.com/nilium/bmax-misc/blob/1d0953d886051eaa1f93bd572b447077221f69ad/lua-reflection/lua-reflection.bmx</a> <br><br></td></tr></table><br>
<a name="943867"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> what would be a good LUA script to use with the first example?<br>That would help me understand what it does<br><br>EDIT - OOPS I just noticed it at the bottom of the page<br><br>Is it possible to have multiple scripts with the same function?<br><br>e.g.<br><br>Cast_spell()<br><br>If I wanted to make ten different spells (lets say they do 10 different damages) then in BriskVM you can create 10 scripts with the same function name but each function is different. The functions are loaded at execution and mapped to the name of the spell.<br><br>e.g. <br>1.magicmissile.lua would have the function cast_Spell() which returns a random number from 1-6<br>2.Freeze.lua would have the function cast_spell() which returns a random number from 1-10<br><br><br>The Luareflection looks interesting, I made this small program to test it out:<br><pre class=code>
Import axe.lua
Import axe.luareflect

Local LuaState:Byte Ptr
LuaState = luaL_newstate()
luaL_openlibs(LuaState)

Type wizard {expose}
Field x,y,health
EndType

lua_implementtypes(luastate)

If luaL_dostring(luastate,"???")&lt;&gt;0
Print lua_tostring(luastate,1)
EndIf</pre><br><br>What would I put in place of the question marks or what would be a good script to test it out? <br><br></td></tr></table><br>
<a name="943946"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> Something like<br><pre class=code>
local wizard
wizard = Newwizard()
wizard.x = 5
wizard.y = 10
wizard.health = 100
</pre><br><br>Anything else you do with it, that's mostly up to you.  Helps to capitalize the first letter of the type name, also, since it'll look odd otherwise.<br><br>As for the functions with the same name, that's a bad idea in the first place (same name for a global function, that is).  You'd probably have to have multiple VMs, give them different names, or put them in a table and get the functions through that.<br><br>Latter option:<br><pre class=code>-- function table..

spells = {}
-- options:
-- function spells.magic_missile
-- spells["magic_missile"]
-- there is also the syntactic sugar function spells:magic_missile(), where the function has a hidden self argument.
spells.magic_missile = function()
    return 20 -- damage
end
spells.chain_lightning = function()
    return 12 -- damage
end
spells.firebolt = function()
    return 22 -- damage
end

</pre> <br><br></td></tr></table><br>
<a name="943977"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> newwizard() is a blitz function that returns an integer handle?<br><br>That spell table that has different functions looks good, how would you call one of those functions from blitz?<br><br>The  example 3 posts above calls global functions but these functions are in a table. <br><br></td></tr></table><br>
<a name="943990"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> Newwizard (case is important) is a generic function implemented by the Lua reflection code that has a few upvalues to know which type of object to allocate when you call it.  In this case, it would have the TTypeId for wizard associated with it, as well as cached values for the type's metadata (expose, noclass, etc.).  That function allocates an object of type wizard and adds it to the code that retains references to BMax objects (since ordinarily, once an object is created in Lua and not accessed by BMax, it will be unreferenced by BMax- I'm currently looking at manually incrementing/decrementing the object's reference count, but that's experimental for now) until they're either freed or collected by Lua's GC.<br><br>In the case of the spells table:<br><pre class=code>
lua_pushstring(lvm, "spells")
lua_gettable(lvm, LUA_GLOBALSINDEX)

lua_pushstring(lvm, "magic_missile")
lua_gettable(lvm, -2)

lua_pcall(lvm, 0, 1, 0) ' Ignoring error code here
Local damage:Int = Int lua_tonumber(lvm, -1)
lua_pop(lvm, 2) ' Pop return value (-1) and table (-2)
</pre> <br><br></td></tr></table><br>
<a name="944392"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> do you have to pop every table and value from the stack?<br><br>I thought you could just do lua_tonumber and that popped it automatically.<br><br>thanks for the example <br><br></td></tr></table><br>
<a name="944463"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> The only values that are automatically popped are functions and their arguments, the key/value pairs for when you call lua_settable, and the key value for when you get a value from a table.<br><br>lua_to* functions don't pop values, seeing as how that would be rather troublesome. <br><br></td></tr></table><br>
<a name="944478"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> ok thanks <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
