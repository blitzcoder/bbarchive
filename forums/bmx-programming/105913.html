<!DOCTYPE html><html lang="en" ><head ><title >Would You Like To Supersize It ? (Source Included)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Would You Like To Supersize It ? (Source Included)</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Would You Like To Supersize It ? (Source Included)</a><br><br>
<a name="1297695"></a>

<a name="1297700"></a>

<a name="1297702"></a>

<a name="1298196"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Years ago I had a chance to see some vectored images scale up and down in a program on the Commodore Amiga. While it wouldn't take pixeled images, I wondered if it was possible to write code that would correctly slope jaggies in a picture that was pixel enlarged.<br><br>Sitting down on graph paper I drew a series of two boxes connected to each other by only their edge. I asked myself what could be done to improve it ? I couldn't see anything, there wasn't enough room.<br><br>So then I drew 8-boxes. One in a 2x2 block and the other also in a 2x2 block but connected diagonally just at the ending tip.<br><br>And then it came to me. To fix a jaggy I just need to create a crutch, and in my head I was very much thinking of the very item that you use to help you walk.<br><br>So I took my pencil and filled in the square just above and filled an additional one to the left of where they met in the middle, and there I had it. I fixed the jaggy and made a smooth slope !<br><br><img src="http://www.writerscafe.org/uploads/rte/719408d17d1efc1801d287961e28e813.png"><br><br>Now for some reason in my coding, when I tried to fix the jaggy in the other direction it just made a mess on the screen. Fidgeting with it, I finally found a solution. If I go BACKWARDS, that is starting from the bottom-right-hand corner to the top-left-hand corner, it works ! And - I'm glad that fixes both of them.<br><br>Also I don't know - today is this considered a unique and original enlarging procedure ? It is, then please give credit if you use this code or method in your projects.<br><br>Enjoi !<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Strict
'     ________________________________________
'    //                                     //
'   // "David's Smart Edge Enlarge"        //
'  // Version: "Hitting The Slopes"       //
' // Written by David W (dw817) 03/01/16 //
'//_____________________________________//
'
' Neatly enlarges an image and you can keep enlarging it too.
'
Global _img,pic:TPixmap
Local i,j,c1,c2,c3,c4,z

SetGraphicsDriver GLMax2DDriver(),0 ' necessary for intense pixel work
Graphics 800,600
SetBlend alphablend
SetScale 2,2 ' all images plotted will be double-size
For i=0 To 1
  Cls
  If i
    DrawText "2x BLOCK ENLARGE",0,570
    _img=0 ' set to show no filter
  Else
    _img=filteredimage ' set to show normal filter
    DrawText "2x FILTERED IMAGE ENLARGE",0,570
  EndIf
  DrawImage LoadImage(LoadBank("http::blog.dna.xyz/wp-content/uploads/2015/05/chara.png"),_img),0,0
  Flip 0
  WaitKey
Next

For z=0 To 3 ' show 4 enlarges

If z Then DrawImage LoadImage(pic,0),0,0 ' draw it if we've already done the first

pic=GrabPixmap(0,0,768,512) ' we need to work with this area

Cls
For i=0 Until 512 Step 2
  For j=0 Until 768 Step 2
    c1=ReadPixel(pic,j,i)&amp;$ffffff ' read in top-left corner, remove alpha
    c2=-1 ; c3=-1 ; c4=-1
    If j&lt;766 Then c2=ReadPixel(pic,j+2,i)&amp;$ffffff ' read in top-right corner
    If i&lt;510 Then c3=ReadPixel(pic,j,i+2)&amp;$ffffff ' read in bottom-left corner
    If j&lt;766 And i&lt;510 Then c4=ReadPixel(Pic,j+2,i+2)&amp;$ffffff ' read in bottom-right corner
    If c1=c4 And c1&gt;0 And (c1&lt;&gt;c2 Or c1&lt;&gt;c3) ' If there's a jaggy, fill it in
      WritePixel pic,j+2,i+1,c1|$ff000000 ' force alpha to max
      WritePixel pic,j+1,i+2,c1|$ff000000 ' here too
    EndIf
  Next
Next

For i=510 To 0 Step -2 ' necessary to go backwards on this search
  For j=766 To 0 Step -2
    c1=ReadPixel(pic,j,i)&amp;$ffffff ' same as above
    c2=-1 ; c3=-1 ; c4=-1
    If j&lt;766 Then c2=ReadPixel(pic,j+2,i)&amp;$ffffff
    If i&lt;510 Then c3=ReadPixel(pic,j,i+2)&amp;$ffffff
    If j&lt;766 And i&lt;510 Then c4=ReadPixel(Pic,j+2,i+2)&amp;$ffffff
    If c2=c3 And c2&gt;0 And (c2&lt;&gt;c1 Or c2&lt;&gt;c4) ' also check to see if there's a jaggy here
      WritePixel pic,j+1,i+1,c2|$ff000000 ' and fill it in
      WritePixel pic,j+2,i+2,c2|$ff000000
    EndIf
  Next
Next
    
DrawText "* MY SMART IMAGE ENLARGE *",0,570 ' announce the difference

DrawPixmap pic,0,0
Flip 0
WaitKey
Next
</textarea><br><br><img src="http://www.writerscafe.org/uploads/rte/d3243a2c5c81c3ed5c77e51ce9e4fa91.png"> <br><br></td></tr></table><br>
<a name="1297809"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamStrange</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> mmm, block looks good.<br>The most important thing here is the alpha channel - which has a real nasty halo on everything but the block enlarge<br><br>so using the sprite images everything would look real sh*tty apart from block! <br><br></td></tr></table><br>
<a name="1297810"></a>

<a name="1297811"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Seems to create similar results to all the other scalers out there.<br>They all work more or less on the same principle, of creating "tiles" out of 2x2 or similar patterns like a graphics filter.<br><br>Yours looks good in 2x though, as it still keeps some hard edges.<br>And the algorithm seems fairly simple, which is a plus :)<br>I guess the real test would be doing it in realtime hehe<br><br>For the others, I like Scale2x for keeping that pixelated feel and Hq2x for that more highrez look.<br>Those two also seem to handle scaling larger than 2x pretty well, many of the others tend to smooth out too much.<br>One that also looks good is xBR/xBRZ, but few use it.<br><br>Check out this page for some comparisons and algorithm info: <a href="http://www.datagenetics.com/blog/december32013/index.html" target="_blank">http://www.datagenetics.com/blog/december32013/index.html</a><br>Note that EPX in that article is basically ScaleX. <br><br></td></tr></table><br>
<a name="1297813"></a>

<a name="1297814"></a>

<a name="1297815"></a>

<a name="1297816"></a>

<a name="1297817"></a>

<a name="1297820"></a>

<a name="1297821"></a>

<a name="1297863"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> At first glance i thought it did scaling, but it only beautifies pre-scaled images.<br>And it seems to produce similar results to 2xSai and variants, which does produce artifacts in some instances. Still nice though :)<br><br>My test suite with a little more control. Moving, Zooming etc.<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SuperStrict

Graphics 800,600

'images from ScalerTest: <a href="http://sourceforge.net/projects/xbrz/files/ScalerTest.zip" target="_blank">http://sourceforge.net/projects/xbrz/files/ScalerTest.zip</a>
'Local image:TImage  = LoadImage("c:\ScalerTest\zelda.png", DYNAMICIMAGE)
'Local image:TImage  = LoadImage("c:\ScalerTest\alien.png", DYNAMICIMAGE)
'Local image:TImage  = LoadImage("c:\ScalerTest\doom.png", DYNAMICIMAGE)
'Local image:TImage  = LoadImage("c:\ScalerTest\solar winds.png", DYNAMICIMAGE)
'Local image:TImage  = LoadImage("c:\ScalerTest\chrono trigger3.png", DYNAMICIMAGE)
'Local image:TImage  = LoadImage("c:\ScalerTest\ultima 5.png", DYNAMICIMAGE)
'Local image:TImage  = LoadImage("c:\ScalerTest\sample i.png", DYNAMICIMAGE)   ' this one is are great for testing shapes
'Local image:TImage  = LoadImage("c:\ScalerTest\sample ii.png", DYNAMICIMAGE)  ' -|-

'Local image:TImage  = LoadImage( LoadBank("http::blog.dna.xyz/wp-content/uploads/2015/05/chara.png"), DYNAMICIMAGE) ' produces artifacts for some reason
Local image:TImage  = LoadImage( LoadBank("http::www.angelfire.com/rpg2/josh95073/RPG%20Site/monster2.png"), DYNAMICIMAGE)
Local scaled:TImage = LoadImage( scale2x(image), DYNAMICIMAGE)

SetBlend ALPHABLEND
Local scale:Int = 2
Local zoom:Int = 0
Local x:Int,y:Int
Repeat
	' original
	SetViewport 0,0, MouseX(),GraphicsHeight()
	SetScale scale + (zoom * scale),scale + (zoom * scale)
	SetColor 255,255,255
	DrawImage image, x,y

	' scaled
	SetViewport MouseX(),0, GraphicsWidth()-MouseX(),GraphicsHeight()	
	SetScale 1 + zoom,1 + zoom
	SetColor 255,255,255
	DrawImage scaled, x,y
	
	' dont draw line
	If Not MouseDown(1) Then
		SetColor 255,0,0
		DrawLine MouseX(),0, MouseX(),GraphicsHeight()
	EndIf
	
	' move
	Global mb2:Int
	If MouseDown(2) Then		
		If Not mb2 Then
			mb2 = True
			MouseXSpeed()
			MouseYSpeed()
		EndIf
		x :+ MouseXSpeed()
		y :+ MouseYSpeed()
	Else
		mb2 = False
	EndIf
		
	' zoom
	zoom :+ Sgn( MouseZSpeed())
	If zoom &lt; 0 Then zoom = 0
	
	' double
	If KeyHit(KEY_SPACE) Then
		scaled = LoadImage( scale2x(scaled), DYNAMICIMAGE)
		scale :* 2
	EndIf
	
	' reset
	If KeyHit(KEY_BACKSPACE) Then
		x = 0
		y = 0
		zoom = 0
		scale = 2
		scaled = LoadImage( scale2x(image), DYNAMICIMAGE)
	EndIf

	
	SetViewport 0,0, GraphicsWidth(),GraphicsHeight()
	SetScale 1,1
	SetColor 255,255,255	
	DrawText "scale=" + scale + " zoom=" + zoom, 0,0
	
	Flip
	Cls
		
Until AppTerminate() Or KeyHit(KEY_ESCAPE)
End



'
' dw817 scaler
' 	<a href="http://www.blitzmax.com/Community/posts.php?topic=105913" target="_blank">http://www.blitzmax.com/Community/posts.php?topic=105913</a>
'
Function scale2x:TPixmap( src:TImage)
	Local pic:TPixmap = src.Lock( 0, 1,0)
	If pic.Format &lt;&gt; PF_RGBA8888 Then pic = pic.Convert(PF_RGBA8888)
	
'	Local dst:TPixmap = ResizePixmap( pic, pic.Width * 2, pic.Height * 2) ' does smoothing, not what we want
	Local dst:TPixmap = DoublePixmap(pic)

	Local w:Int = dst.Width
	Local h:Int = dst.Height
	
	For Local y:Int = 0 Until h Step 2
		For Local x:Int = 0 Until w Step 2
			Local c1:Int = ReadPixel( dst, x,y) &amp; $ffffff ' read in top-left corner, remove alpha
			Local c2:Int = -1
			Local c3:Int = -1
			Local c4:Int = -1
			If x &lt; w - 2 Then c2 = ReadPixel( dst, x+2,y) &amp; $ffffff ' read in top-right corner
			If y &lt; h - 2 Then c3 = ReadPixel( dst, x,y+2) &amp; $ffffff ' read in bottom-left corner
			If x &lt; w - 2 And y &lt; h - 2 Then c4 = ReadPixel( dst, x+2,y+2) &amp; $ffffff ' read in bottom-right corner
			If c1 = c4 And c1 &gt; 0 And (c1 &lt;&gt; c2 Or c1 &lt;&gt; c3) Then
				' if there's a jaggy, fill it in
				WritePixel dst, x+2,y+1, c1 | $ff000000 ' force alpha to max
				WritePixel dst, x+1,y+2, c1 | $ff000000 ' here too
			EndIf
		Next
	Next
	
	' necessary to go backwards on this search	
	For Local y:Int = h - 2 To 0 Step -2
		For Local x:Int = w - 2 To 0 Step -2
			Local c1:Int = ReadPixel( dst, x,y) &amp; $ffffff
			Local c2:Int = -1
			Local c3:Int = -1
			Local c4:Int = -1
			If x &lt; w - 2 Then c2 = ReadPixel( dst, x+2,y) &amp; $ffffff
			If y &lt; h - 2 Then c3 = ReadPixel( dst, x,y+2) &amp; $ffffff
			If x &lt; w - 2 And y &lt; h - 2 Then c4 = ReadPixel( dst, x+2,y+2) &amp; $ffffff
			If c2 = c3 And c2 &gt; 0 And (c2 &lt;&gt; c1 Or c2 &lt;&gt; c4) Then
				WritePixel dst, x+1,y+1, c2 | $ff000000
				WritePixel dst, x+2,y+2, c2 | $ff000000
			EndIf
		Next
	Next
	
	Return dst
EndFunction

Function DoublePixmap:TPixmap( src:TPixmap)
	Assert src.Format = PF_RGBA8888
	
	Local dst:TPixmap = CreatePixmap( src.Width * 2, src.Height * 2, src.Format)	
	Local yy:Int
	For Local y:Int = 0 Until src.Height
		Local s:Int Ptr = Int Ptr src.PixelPtr( 0,y)
		Local d1:Int Ptr = Int Ptr dst.PixelPtr( 0,yy)
		Local d2:Int Ptr = Int Ptr dst.PixelPtr( 0,yy + 1)
		Local xx:Int
		For Local x:Int = 0 Until src.Width
			Local p:Int = s[x]
			d1[xx] = p
			d1[xx + 1] = p
			d2[xx] = p	
			d2[xx + 1] = p
			xx :+ 2
		Next
		yy :+ 2
	Next
	Return dst
EndFunction
</textarea> <br><br></td></tr></table><br>
<a name="1297858"></a>

<a name="1297860"></a>

<a name="1297861"></a>

<a name="1297862"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Trying out your code, Grable. Wow. Damn. That is REALLY neat ! :D It crashes in debug mode, but without it runs REALLY well ! There's quite a bit I can learn from reading what you wrote here too.<br><br>Adam Strange, yes, it's odd. Sprites create this weird halo effect when you use normal dither. I have no idea where it comes from.<br><br>Would be awesome if BlitzMAX had internal ALL filters for enlarging. Then I could compare 2xSai with mine. I think though 2xSai has a smidge of blur to it and likely added just at the right place.<br><br>. . .<br><br>I am trying out the XBRZ filter from the Scaler Testing Tool. Is this written in BlitzMAX and/or is the source code available for download ?<br><br>. . .<br><br>Looking I am seeing it is not scaling black. I guess there is no reason it shouldn't. Changed a few lines, seems to run better:<br><br><b>LINE 114<br>If c1 = c4 And c1 &gt;= 0 And (c1 &lt;&gt; c2 Or c1 &lt;&gt; c3) Then<br></b><br><br><b>LINE 132<br>If c2 = c3 And c2 &gt;= 0 And (c2 &lt;&gt; c1 Or c2 &lt;&gt; c4) Then<br></b><br>I know I can take out the C2 comparison entirely, but I want to leave it in, just in case there are problems or further comparison adjustments later. <br><br></td></tr></table><br>
<a name="1297864"></a>

<a name="1297866"></a>

<a name="1297867"></a>

<a name="1297868"></a>

<a name="1297874"></a>

<a name="1297877"></a>

<a name="1297962"></a>

<a name="1297964"></a>

<a name="1297967"></a>

<a name="1297968"></a>

<a name="1298016"></a>

<a name="1298033"></a>

<a name="1298038"></a>

<a name="1298045"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> . <br><br></td></tr></table><br>
<a name="1298049"></a>

<a name="1298050"></a>

<a name="1298051"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I forgot to change Pitch into Format in DoublePixmap ;) so the assertion would always fire hehe. Fixed now.<br><br>EDIT:<br>Source to xBR/Z is here: <a href="https://sourceforge.net/projects/xbrz/files/xBRZ/xBRZ_1.4.zip/download" target="_blank">https://sourceforge.net/projects/xbrz/files/xBRZ/xBRZ_1.4.zip/download</a><br>But its in C++, and NOT very pretty or easy to understand :(<br><br>EDIT2: Removed sample.<br>See post <a href="/post.php?topic=105913&amp;post=1298037" target="_blank">#10</a> for better comparison. <br><br></td></tr></table><br>
<a name="1297932"></a>

<a name="1297955"></a>

<a name="1297956"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Grable.<br><br>This last one is not very fair in comparison. If you zoom, you are showing what my 2x2 filter does in an already zoomed picture of 4x4 or 8x8 without taking into account working it up (2x2) one step at a time for each level as you did in the previous code.<br><br><b>"NOT very pretty or easy to understand"</b> Coming from you it must be an absolute nightmare. I'll stick with BlitzMAX code 10quverymuch ! :) <br><br></td></tr></table><br>
<a name="1297959"></a>

<a name="1297963"></a>

<a name="1297965"></a>

<a name="1297966"></a>

<a name="1297969"></a>

<a name="1297970"></a>

<a name="1297971"></a>

<a name="1297984"></a>

<a name="1298046"></a>

<a name="1298047"></a>

<a name="1298048"></a>

<a name="1298052"></a>

<a name="1298053"></a>

<a name="1298054"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <strike>There is no extra scaling in this one, as the shader is locked.<br>But somehow it ended up being x3 for the shader not x2 as i initially though.<br><br>It probaby has something to do with the texture not being the same size as the image, as Max2D resizes them to fit power of 2 in both directions.<br><br>Updated the sample for a more true comparison, using x4 for your scaler instead.<br>Their pixels are not 100% the same size, but its close enough.<br><br>This again makes it slightly unfair towards the shader scaler though, as its more of an x3.1 or something.<br>It seems to be the same in most instances, only the scaling does weird things to the pixels, so counting them isnt straight forward.<br><br>EDIT: Seems im downscaling d817's x4 to x3 to fit the shaders x3. Havent been able to get the shader to do anything other than x3 either, as its dimensions does not fit what Max2D uses for some reason.<br>That is the reason dw817's look weird, as scaling x4 to x3 will produce artifacts.</strike> <br><br></td></tr></table><br>
<a name="1297985"></a>

<a name="1298015"></a>

<a name="1298032"></a>

<a name="1298037"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Heres an updated version with a proper Scale2x shader, for a real comparison :)<br>Press 1 and 2 to change left/right modes.<br><br>Now there isnt that much difference between the two, Scale2x keeps more detail in some cases and dw817_x2 smooths more in others.<br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SuperStrict

Const GLSL_VERSION:Int = 130


SetGraphicsDriver GLMax2DDriver()
Graphics 800,600

'images from ScalerTest: <a href="http://sourceforge.net/projects/xbrz/files/ScalerTest.zip" target="_blank">http://sourceforge.net/projects/xbrz/files/ScalerTest.zip</a>
'Local image:TImage  = LoadImage("c:\ScalerTest\zelda.png", DYNAMICIMAGE)
'Local image:TImage  = LoadImage("c:\ScalerTest\alien.png", DYNAMICIMAGE)
'Local image:TImage  = LoadImage("c:\ScalerTest\doom.png", DYNAMICIMAGE)
'Local image:TImage  = LoadImage("c:\ScalerTest\solar winds.png", DYNAMICIMAGE)
'Local image:TImage  = LoadImage("c:\ScalerTest\chrono trigger3.png", DYNAMICIMAGE)
'Local image:TImage  = LoadImage("c:\ScalerTest\ultima 5.png", DYNAMICIMAGE)
'Local image:TImage  = LoadImage("c:\ScalerTest\sample i.png", DYNAMICIMAGE)   ' this one is are great for testing shapes
'Local image:TImage  = LoadImage("c:\ScalerTest\sample ii.png", DYNAMICIMAGE)  ' -|-
Local image:TImage  = LoadImage( LoadBank("http::www.angelfire.com/rpg2/josh95073/RPG%20Site/monster2.png"), DYNAMICIMAGE)
Local texture:Int = GetGLTextureName(image)

Local scaled2:TImage = LoadImage( dw817_scale2x(image), DYNAMICIMAGE)
Local scaled4:TImage = LoadImage( dw817_scale2x(scaled2), DYNAMICIMAGE)

Local VertexSource:String =	"varying vec2 texcoord;~n" + ..
										"void main(void) {~n" +..
										"	gl_Position = ftransform();~n" + ..
										"	texcoord = gl_MultiTexCoord0;~n" + ..
										"}~n"
										
Local PixelSource2:String = 	"#version "+GLSL_VERSION+"~n" + ..
										"uniform sampler2D tex;~n" + ..
										"~n" + ..
										"varying vec2 texcoord;~n" + ..
										"~n" + ..
										"void main(void) {~n" + ..
										"	vec2 tmp = texcoord * textureSize( tex, 0);~n" + ..
										"	ivec2 uv = ivec2(tmp);~n" + ..
										"	vec2 p = fract(tmp);~n" + ..
										"~n" + ..
										"	vec4 B = texelFetch( tex, uv + ivec2( 0, +1), 0);~n" + ..
										"	vec4 D = texelFetch( tex, uv + ivec2( -1, 0), 0);~n" + ..
										"	vec4 E = texelFetch( tex, uv, 0);~n" + ..
										"	vec4 F = texelFetch( tex, uv + ivec2( +1, 0), 0);~n" + ..
										"	vec4 H = texelFetch( tex, uv + ivec2( 0, -1), 0);~n" + ..
										"~n" + ..
										"	vec4 r;~n" + ..
										"	if( p.x &gt; 0.5) {~n" + ..
										"		if( p.y &gt; 0.5)	r = (B == F &amp;&amp; B != D &amp;&amp; F != H) ? F : E;~n" + ..
										"		else					r = (H == F &amp;&amp; D != H &amp;&amp; B != F) ? F : E;~n" + ..
										"	} else {~n" + ..
										"		if( p.y &gt; 0.5)	r = (D == B &amp;&amp; B != F &amp;&amp; D != H) ? D : E;~n" + ..
										"		else					r = (D == H &amp;&amp; D != B &amp;&amp; H != F) ? D : E;~n" + ..
										"	}~n" + ..
										"~n" + ..
										"	gl_FragColor = r;~n" + ..
										"}~n"

Local PixelSource3:String = 	"#version "+GLSL_VERSION+"~n" + ..
										"uniform sampler2D tex;~n" + ..
										"varying vec2 texcoord;~n" + ..
										"~n" + ..
										"void main(void) {~n" + ..
										"	vec2 tmp = texcoord * textureSize( tex, 0);~n" + ..
										"	ivec2 uv = ivec2(tmp);~n" + ..
										"	vec2 p = fract(tmp);~n" + ..
										"~n" + ..
										"	vec3 E = texelFetch( tex, uv, 0).rgb;~n" + ..
										"	vec3 D = texelFetch( tex, uv + ivec2( -1, 0), 0).rgb;~n" + ..
										"	vec3 F = texelFetch( tex, uv + ivec2( +1, 0), 0).rgb;~n" + ..
										"	vec3 H = texelFetch( tex, uv + ivec2( 0, -1), 0).rgb;~n" + ..
										"	vec3 B = texelFetch( tex, uv + ivec2( 0, +1), 0).rgb;~n" + ..
										"	vec3 A = texelFetch( tex, uv + ivec2( -1, +1), 0).rgb;~n" + ..
										"	vec3 C = texelFetch( tex, uv + ivec2( +1, +1), 0).rgb;~n" + ..
										"	vec3 G = texelFetch( tex, uv + ivec2( -1, -1), 0).rgb;~n" + ..
										"	vec3 I = texelFetch( tex, uv + ivec2( +1, -1), 0).rgb;~n" + ..
										"~n" + ..
										"	vec3 r = E;~n" + ..
										"~n" + ..
										"  	if (D == B &amp;&amp; B != F &amp;&amp; D != H) {~n" + ..
										"		if(p.x&lt; 0.33 &amp;&amp; p.y&gt;=0.66)											r = D;~n" + ..
										"		if(p.x&gt;=0.33 &amp;&amp; p.x&lt;0.66 &amp;&amp; p.y&gt;=0.66 &amp;&amp; E != C)	r = B;~n" + ..
										"		if(p.x&lt; 0.33 &amp;&amp; p.y&gt;=0.33 &amp;&amp; p.y&lt;0.66 &amp;&amp; E != G)		r = D;~n" + ..
										"	}~n" + ..
										"~n" + ..
										"	if (B == F &amp;&amp; B != D &amp;&amp; F != H) {~n" + ..
										"		if(p.x&gt;=0.66 &amp;&amp; p.y&gt;=0.66)										r = F;~n" + ..
										"		if(p.x&gt;=0.33 &amp;&amp; p.x&lt;0.66 &amp;&amp; p.y&gt;=0.66 &amp;&amp; E != A)	r = B;~n" + ..
										"		if(p.x&gt;=0.66 &amp;&amp; p.y&gt;=0.33 &amp;&amp; p.y&lt;0.66 &amp;&amp; E != I)	r = F;~n" + ..
										"	}~n" + ..
										"~n" + ..
										"	if (D == H &amp;&amp; D != B &amp;&amp; H != F) {~n" + ..
										"		if(p.x&lt; 0.33 &amp;&amp; p.y&lt; 0.33)											r = D;~n" + ..
										"		if(p.x&lt; 0.33 &amp;&amp; p.y&gt;=0.33 &amp;&amp; p.y&lt;0.66 &amp;&amp; E != A)		r = D;~n" + ..
										"		if(p.x&gt;=0.33 &amp;&amp; p.x&lt;0.66 &amp;&amp; p.y&lt;0.33 &amp;&amp; E != I)		r = H;~n" + ..
										"	}~n" + ..
										"~n" + ..
										"	if (H == F &amp;&amp; D != H &amp;&amp; B != F) {~n" + ..
										"		if(p.x&gt;=0.66 &amp;&amp; p.y&lt;0.33)											r = F;~n" + ..
										"		if(p.x&gt;=0.66 &amp;&amp; p.y&gt;=0.33 &amp;&amp; p.y&lt;0.66 &amp;&amp; E != C)	r = F;~n" + ..
										"		if(p.x&gt;=0.33 &amp;&amp; p.x&lt;0.66 &amp;&amp; p.y&lt;0.33 &amp;&amp; E != G)		r = H;~n" + ..
										"	}~n" + ..
										"~n" + ..
										"	gl_FragColor = vec4( r, 1.0);~n" + ..
										"}~n"

Local Scale2x:TShader = TShader.Create( VertexSource, PixelSource2, "Scale2x")
If Scale2x.Failed() Then Print Scale2x.GetLogs(); End
Scale2x.SetUniform1i Scale2x.GetUniform("tex"), texture

Local Scale3x:TShader = TShader.Create( VertexSource, PixelSource3, "Scale3x")
If Scale3x.Failed() Then Print Scale3x.GetLogs(); End
Scale3x.SetUniform1i Scale3x.GetUniform("tex"), texture


Global lmode:Int
Global rmode:Int

SetBlend ALPHABLEND
Local zoom:Int = 0
Local x:Int,y:Int
Repeat
	SetColor 255,255,255

	' left
	SetViewport 0,0, MouseX(),GraphicsHeight()
	Select lmode
		Case 0
			' original
			SetScale 2 + (zoom * 2), 2 + (zoom * 2)
			DrawImage image, x,y		
		Case 1
			' dw817 x2
			SetScale 1,1
			DrawImageRect scaled2, x,y, image.Width * (2 + zoom * 2), image.Height * (2 + zoom * 2)

		Case 2
			' dw817 x4
			SetScale 1,1
			DrawImageRect scaled4, x,y, image.Width * (2 + zoom * 2), image.Height * (2 + zoom * 2)
	EndSelect

	' right
	SetViewport MouseX(),0, GraphicsWidth()-MouseX(),GraphicsHeight()	
	Select rmode
		Case 0
			' scale2x
			Scale2x.Start()
			SetViewport MouseX(),0, GraphicsWidth()-MouseX(),GraphicsHeight()	
			SetColor 255,255,255
			SetScale 1 + zoom,1 + zoom
			DrawImageRect image, x,y, image.Width * 2, image.Height * 2
			Scale2x.Stop()
		Case 1
			' scale3x
			Scale3x.Start()
			SetColor 255,255,255
			SetScale 1 + zoom,1 + zoom
			DrawImageRect image, x,y, image.Width * 2, image.Height * 2
			Scale3x.Stop()
		Case 2
			' original
			' original
			SetScale 2 + (zoom * 2), 2 + (zoom * 2)
			DrawImage image, x,y	
	EndSelect
	
	' dont draw line
	If Not MouseDown(1) Then
		SetColor 255,0,0
		DrawLine MouseX(),0, MouseX(),GraphicsHeight()
	EndIf
	
	' move
	Global mb2:Int
	If MouseDown(2) Then		
		If Not mb2 Then
			mb2 = True
			MouseXSpeed()
			MouseYSpeed()
		EndIf
		x :+ MouseXSpeed()
		y :+ MouseYSpeed()
	Else
		mb2 = False
	EndIf
		
	' zoom
	zoom :+ Sgn( MouseZSpeed())
	If zoom &lt; 0 Then zoom = 0
	
	' switch mode
	If KeyHit(KEY_1) Then lmode = (lmode + 1) Mod 3
	If KeyHit(KEY_2) Then rmode = (rmode + 1) Mod 3
	
	' reset
	If KeyHit(KEY_BACKSPACE) Then
		x = 0
		y = 0
		zoom = 0
	EndIf
	
	SetViewport 0,0, GraphicsWidth(),GraphicsHeight()
	SetBlend SOLIDBLEND
	SetScale 1,1
	SetColor 255,255,255
	Global ls:String[] = [ "original", "dw817_x2", "dw817_x4" ]
	Global rs:String[] = [ "scale2x", "scale3x", "original" ]	
	DrawText " zoom=" + zoom + "  left=" + ls[lmode] + "  right=" + rs[rmode] + " ", 0,0
	SetBlend ALPHABLEND	
	
	Flip
	Cls
		
Until AppTerminate() Or KeyHit(KEY_ESCAPE)
End


'
' dw817 scaler
' 	<a href="http://www.blitzmax.com/Community/posts.php?topic=105913" target="_blank">http://www.blitzmax.com/Community/posts.php?topic=105913</a>
'
Function dw817_scale2x:TPixmap( src:TImage)
	Local pic:TPixmap = src.Lock( 0, 1,0)
	If pic.Format &lt;&gt; PF_RGBA8888 Then pic = pic.Convert(PF_RGBA8888)
	
'	Local dst:TPixmap = ResizePixmap( pic, pic.Width * 2, pic.Height * 2) ' does smoothing, not what we want
	Local dst:TPixmap = DoublePixmap(pic)

	Local w:Int = dst.Width
	Local h:Int = dst.Height
	
	For Local y:Int = 0 Until h Step 2
		For Local x:Int = 0 Until w Step 2
			Local c1:Int = ReadPixel( dst, x,y) &amp; $ffffff ' read in top-left corner, remove alpha
			Local c2:Int = -1
			Local c3:Int = -1
			Local c4:Int = -1
			If x &lt; w - 2 Then c2 = ReadPixel( dst, x+2,y) &amp; $ffffff ' read in top-right corner
			If y &lt; h - 2 Then c3 = ReadPixel( dst, x,y+2) &amp; $ffffff ' read in bottom-left corner
			If x &lt; w - 2 And y &lt; h - 2 Then c4 = ReadPixel( dst, x+2,y+2) &amp; $ffffff ' read in bottom-right corner
'			If c1 = c4 And c1 &gt; 0 And (c1 &lt;&gt; c2 Or c1 &lt;&gt; c3) Then
			If c1 = c4 And c1 &gt;= 0 And (c1 &lt;&gt; c2 Or c1 &lt;&gt; c3) Then
				' if there's a jaggy, fill it in
				WritePixel dst, x+2,y+1, c1 | $ff000000 ' force alpha to max
				WritePixel dst, x+1,y+2, c1 | $ff000000 ' here too
			EndIf
		Next
	Next
	
	' necessary to go backwards on this search	
	For Local y:Int = h - 2 To 0 Step -2
		For Local x:Int = w - 2 To 0 Step -2
			Local c1:Int = ReadPixel( dst, x,y) &amp; $ffffff
			Local c2:Int = -1
			Local c3:Int = -1
			Local c4:Int = -1
			If x &lt; w - 2 Then c2 = ReadPixel( dst, x+2,y) &amp; $ffffff
			If y &lt; h - 2 Then c3 = ReadPixel( dst, x,y+2) &amp; $ffffff
			If x &lt; w - 2 And y &lt; h - 2 Then c4 = ReadPixel( dst, x+2,y+2) &amp; $ffffff
'			If c2 = c3 And c2 &gt; 0 And (c2 &lt;&gt; c1 Or c2 &lt;&gt; c4) Then
			If c2 = c3 And c2 &gt;= 0 And (c2 &lt;&gt; c1 Or c2 &lt;&gt; c4) Then
				WritePixel dst, x+1,y+1, c2 | $ff000000
				WritePixel dst, x+2,y+2, c2 | $ff000000
			EndIf
		Next
	Next
	
	Return dst
EndFunction

Function DoublePixmap:TPixmap( src:TPixmap)
	Assert src.Format = PF_RGBA8888
	
	Local dst:TPixmap = CreatePixmap( src.Width * 2, src.Height * 2, src.Format)	
	Local yy:Int
	For Local y:Int = 0 Until src.Height
		Local s:Int Ptr = Int Ptr src.PixelPtr( 0,y)
		Local d1:Int Ptr = Int Ptr dst.PixelPtr( 0,yy)
		Local d2:Int Ptr = Int Ptr dst.PixelPtr( 0,yy + 1)
		Local xx:Int
		For Local x:Int = 0 Until src.Width
			Local p:Int = s[x]
			d1[xx] = p
			d1[xx + 1] = p
			d2[xx] = p	
			d2[xx + 1] = p
			xx :+ 2
		Next
		yy :+ 2
	Next
	Return dst
EndFunction


' for some reason frames arent initialized in DebugMode, so we do it ourselves
Function GetGLTextureName:Int( image:TImage, frame:Int = 0)
?debug
	Return TGLImageFrame(image.Frame(frame)).name
?Not debug
	Return TGLImageFrame(image.frames[frame]).name
?
EndFunction



Type TShader
	Global init:Int = False 'Set to true if glew is initialized
	
	Field ProgramObject:Int 'Store the program object
	Field Name:String 'the name of this shader
	Field VSfail:Int, VSlog:String
	Field FSfail:Int, FSlog:String
	Field Lfail:Int, Llog:String


	'this function will create the shader.  
	'VertexSource is the GLSL source of the vertex shader
	'PixelSource is the GLSL source of the Pixel (Fragment) Shader
	'Name is the name you wish to give this shader	
	Function Create:TShader(VertexSource:String, PixelSource:String, Name:String = "")
		Local Shader:TShader = New TShader 'Create the shader type
		
		If Name = ""
			Local id:TTypeId = TTypeId.ForObject(Shader)
			Name = id.Name()
		End If
		Shader.Name = Name 'copy the name
		
		If Not init 'Check if glew is initialized
			glewInit
			init = True
		End If
		
		Local VS:Byte Ptr = VertexSource.ToCString() 'CString of Vertex shader source
		Local VL:Int = VertexSource.Length
		Local PS:Byte Ptr = PixelSource.ToCString() 'CString of Pixel Shader Source
		Local PL:Int = PixelSource.Length
		
		Shader.ProgramObject = glCreateProgramObjectARB() 'Create the Shader Program Object
		Local VertexShaderObject:Int = glCreateShaderObjectARB(GL_VERTEX_SHADER_ARB) 'Create the Vertex Shader Object
		Local PixelShaderObject:Int = glCreateShaderObjectARB(GL_FRAGMENT_SHADER_ARB) 'Create The Pixel Shader Object
		
		glShaderSourceARB(VertexShaderObject,1,Varptr VS, Varptr VL) 'Upload the Vertex Shader source to the compiler
		MemFree VS 'No longer need the CString, free the memory
		glCompileShaderARB(VertexShaderObject) 'Now compile the source
		glGetShaderiv( VertexShaderObject, GL_COMPILE_STATUS, Varptr Shader.VSfail)
		Shader.VSfail = Not Shader.VSfail

		glShaderSourceARB(PixelShaderObject,1,Varptr PS, Varptr PL) 'Same thing as before, but for the Pixel Shader Source
		MemFree PS
		glCompileShaderARB(PixelShaderObject)
		glGetShaderiv( PixelShaderObject, GL_COMPILE_STATUS, Varptr Shader.FSfail)
		Shader.FSfail = Not Shader.FSfail
		
		glAttachObjectARB(Shader.ProgramObject,VertexShaderObject) 'Now we will attach the shaders to the Program Object
		glAttachObjectARB(Shader.ProgramObject,PixelShaderObject)
		glLinkProgramARB(Shader.ProgramObject) 'And link everything together
		glGetProgramiv( Shader.ProgramObject, GL_LINK_STATUS, Varptr Shader.Lfail)
		Shader.Lfail = Not Shader.Lfail

		If Shader.VSfail Then Shader.VSlog = GetLogInfo( VertexShaderObject, name+":")
		If Shader.FSfail Then Shader.FSlog = GetLogInfo( PixelShaderObject, name+":")
		If Shader.Lfail Then Shader.Llog = GetLogInfo( Shader.ProgramObject, name+":")

		glDeleteObjectARB(VertexShaderObject) 'No longer need these objects
		glDeleteObjectARB(PixelShaderObject)
		
		Return Shader
	End Function
	
	'This will start the shader program running
	Method Start()
		glUseProgramObjectARB(ProgramObject)
	End Method
	
	'Get the location of a shader uniform type
	Method GetUniform:Int(UniformName:String)
		Local CString:Byte Ptr = UniformName.ToCString()
		Local Uniform:Int = glGetUniformLocationARB(ProgramObject,CString)
		MemFree CString
		Return Uniform
	End Method
	
	Method SetUniform1f(Uniform:Int,Value:Float)
		glUniform1fARB(Uniform,Value)
	End Method

	Method SetUniform2f(Uniform:Int, x:Float, y:Float)
		glUniform2fARB(Uniform, x, y)
	End Method

	Method SetUniform3f(Uniform:Int, x:Float, y:Float, z:Float)
		glUniform3fARB(Uniform, x, y, z)
	End Method
	
	Method SetUniform1i(Uniform:Int,Value:Int)
		glUniform1iARB(Uniform,Value)
	End Method
	
	'This will stop all shader programs from running
	Function Stop()
		gluseProgramObjectARB(0)
	End Function

	Method Failed:Int()
		Return VSfail Or FSfail Or Lfail
	EndMethod
	
	Method GetLogs:String()
		Local s:String
		If VSfail Then s :+ VSlog
		If FSfail Then s :+ "~n" + FSlog
		If Lfail Then s :+ "~n" + Llog
		Return s
	EndMethod
	
	Function GetLogInfo:String(Obj:Int, Tag:String = Null)
		Local InfoLogLength:Int = 0
		Local charsWritten:Int = 0
		Local InfoLog:Byte[]
		Local s:String = Tag
		glGetObjectParameterivARB(Obj, GL_OBJECT_INFO_LOG_LENGTH_ARB, Varptr infologLength)
		If InfoLogLength &gt; 0 Then
			InfoLog = New Byte[InfoLogLength]
			glGetInfoLogARB(obj, InfoLogLength, Varptr charsWritten, InfoLog )
			If s Then s :+ "~n"
			s :+ String.FromBytes(InfoLog,charsWritten)
		EndIf
		Return s
	EndFunction
EndType
</textarea> <br><br></td></tr></table><br>
<a name="1297987"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I only get an error on those. Any chance of some screenshots? I´m curious how they compare.<br><br>Scale2x:<br>ERROR: 0:4: Incompatible types (vec2 and vec4) in assignment (and no available implicit conversion)<br><br>Scale2x:<br>ERROR: 0:6: Invalid call of undeclared identifier 'textureSize'<br>ERROR: 0:7: Use of undeclared identifier 'tmp'<br>ERROR: 0:8: Use of undeclared identifier 'tmp'<br>ERROR: 0:10: Use of undeclared identifier 'uv'<br>ERROR: 0:11: Use of undeclared identifier 'uv'<br>ERROR: 0:12: Use of undeclared identifier 'uv'<br>ERROR: 0:13: Use of undeclared identifier 'uv'<br>ERROR: 0:14: Use of undeclared identifier 'uv'<br>ERROR: 0:17: Use of undeclared identifier 'p'<br>ERROR: 0:18: Use of undeclared identifier 'p'<br>ERROR: 0:18: Use of undeclared identifier 'B'<br>ERROR: 0:18: Use of undeclared identifier 'F'<br>ERROR: 0:18: Use of undeclared identifier 'B'<br>ERROR: 0:18: Use of undeclared identifier 'D'<br>ERROR: 0:18: Use of undeclared identifier 'F'<br>ERROR: 0:18: Use of undeclared identifier 'H'<br>ERROR: 0:18: Use of undeclared identifier 'F'<br>ERROR: 0:18: Use of undeclared identifier 'E'<br>ERROR: 0:19: Use of undeclared identifier 'H'<br>ERROR: 0:19: Use of undeclared identifier 'F'<br>ERROR: 0:19: Use of undeclared identifier 'D'<br>ERROR: 0:19: Use of undeclared identifier 'H'<br>ERROR: 0:19: Use of undeclared identifier 'B'<br>ERROR: 0:19: Use of undeclared identifier 'F'<br>ERROR: 0:19: Use of undeclared identifier 'F'<br>ERROR: 0:19: Use of undeclared identifier 'E'<br>ERROR: 0:21: Use of undeclared identifier 'p'<br>ERROR: 0:21: Use of undeclared identifier 'D'<br>ERROR: 0:21: Use of undeclared identifier 'B'<br>ERROR: 0:21: Use of undeclared identifier 'B'<br>ERROR: 0:21: Use of undeclared identifier 'F'<br>ERROR: 0:21: Use of undeclared identifier 'D'<br>ERROR: 0:21: Use of undeclared identifier 'H'<br>ERROR: 0:21: Use of undeclared identifier 'D'<br>ERROR: 0:21: Use of undeclared identifier 'E'<br>ERROR: 0:22: Use of undeclared identifier 'D'<br>ERROR: 0:22: Use of undeclared identifier 'H'<br>ERROR: 0:22: Use of undeclared identifier 'D'<br>ERROR: 0:22: Use of undeclared identifier 'B'<br>ERROR: 0:22: Use of undeclared identifier 'H'<br>ERROR: 0:22: Use of undeclared identifier 'F'<br>ERROR: 0:22: Use of undeclared identifier 'D'<br>ERROR: 0:22: Use of undeclared identifier 'E'<br><br>Scale2x:<br>ERROR: One or more attached shaders not successfully compiled <br><br></td></tr></table><br>
<a name="1297991"></a>

<a name="1297992"></a>

<a name="1297999"></a>

<a name="1298001"></a>

<a name="1298002"></a>

<a name="1298003"></a>

<a name="1298004"></a>

<a name="1298005"></a>

<a name="1298006"></a>

<a name="1298007"></a>

<a name="1298008"></a>

<a name="1298009"></a>

<a name="1298010"></a>

<a name="1298011"></a>

<a name="1298018"></a>

<a name="1298034"></a>

<a name="1298055"></a>

<a name="1298056"></a>

<a name="1298057"></a>

<a name="1298058"></a>

<a name="1298059"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> This depends on which version of GLSL your driver defaults to. My AMD drivers default to the highest supported by the gpu, well sortof. It is probably still 1.10 but with all extensions enabled.<br>Nvidia may not be as permissive.<br><br>textureSize and texelFetch came in 1.30 which is rather old by modern standards. But if your on older Intel gpus (like netbooks) you might be stuck at 1.10 :p<br><br><strike>Try sticking <b>#version 130 compatibility</b> at the top of the GLSL code.<br>If that doesnt work, try 150 which supports the full extensions to the functions (even though i dont use those).</strike><br>EDIT: Added <b>#version 130</b> to the sample above, so you dont have to ;)<br><br>Check out <a href="https://www.opengl.org/wiki/Core_Language_%28GLSL%29" target="_blank">https://www.opengl.org/wiki/Core_Language_%28GLSL%29</a> for more info on OpenGL vs GLSL versioning.<br><br>Some screens if you still cant run the GLSL code.<br><a href="https://sites.google.com/site/grable0/images/dw817_x2.png" target="_blank">dw817_x2</a> vs <a href="https://sites.google.com/site/grable0/images/scale2x.png" target="_blank">scale2x</a><br><a href="https://sites.google.com/site/grable0/images/dw817_x2_2.png" target="_blank">dw817_x2_2</a> vs <a href="https://sites.google.com/site/grable0/images/scale2x_2.png" target="_blank">scale2x_2</a><br><br>EDIT: Made images into links, they were too big. <br><br></td></tr></table><br>
<a name="1298060"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Works great here, Grable. No errors at all. I can see my filter does not leave a dangler. That's what I'm going to call it. Any pixel that is left from a triangle. Mine smooths it out whereas the Scale2x filter does not and it sticks out ugly.<br><br>Mine also smooths too much whereas Scale2x sometimes smooths too little.<br><br>So - I could certainly see if it's possible to make improvements to my formula. :)<br><br>Casaber, I get no errors at all. If the variables aren't being recognized or something, maybe take out Superstrict so they don't need to be defined ? <br><br></td></tr></table><br>
<a name="1298062"></a>

<a name="1298063"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> The error is GLSL related, the shader langauge.<br>Im guessing he has an Nvidia gpu, as their GLSL compiler is way more strict than AMD. AMD is almost too permissive in what i allows sometimes.<br><br>Im hoping manually setting the version helps, but there can be more incompatibilities.. So let me know of any errors and i will fix them :)<br><br>Yeah, the quality all depends on the art. I use many different scalers for the different emulators and their games.<br><br>I made a complete package including images and external glsl files for easier hacking (made it for a friend but posting it here as well)<br><a href="https://drive.google.com/open?id=0BzVLNZSckvfhVXFMVEJBZ2toc0U" target="_blank">ScaleShader.7z</a> press F1 for help. <br><br></td></tr></table><br>
<a name="1298065"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Grable. Trying out your ScaleShader. Yes ! This is great. I can definitely see a good comparison now. Hit SPACE to show a new picture. Mouse Scroll to scale and keys "1" and "2" to change filters.<br><br>Looks like the best images for the scaler I wrote is RPG sprites, and that's fine with me. I can definitely work that into future code. <br><br></td></tr></table><br>
<a name="1298092"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks, and that looks great. <br><br>Are those the same or similiar as this one seem to have got hefty headlines of being groundbreaking?<br><a href="http://www.extremetech.com/gaming/84040-depixelizing-pixel-art-upscaling-retro-8bit-games" target="_blank">http://www.extremetech.com/gaming/84040-depixelizing-pixel-art-upscaling-retro-8bit-games</a> <br><br></td></tr></table><br>
<a name="1298093"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Casaber</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Really love this. It's so much fun to follow this forum when these kinds of quality things pops up. Great work. <br><br></td></tr></table><br>
<a name="1298103"></a>

<a name="1298205"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Casaber. Yep, but I don't think mine is so groundbreaking. Let me see if I can reproduce that fish output.<br><br>...<br><br>Nope. That's a nice bit of rescaling they are doing there. I can't reproduce to that quality, not w my current code.<br><br>Other items look good with it though, as long as you don't scale too high.<br><br><img src="http://www.writerscafe.org/uploads/rte/732f4872fd98398dace8d5537c4bfce8.png"><br><br><b>Latest filter, big improvements !</b><br><br><img src="http://www.writerscafe.org/uploads/rte/a173ce85646c4739023978eb1f2c0733.png"> <br><br></td></tr></table><br>
<a name="1298197"></a>

<a name="1298200"></a>

<a name="1298201"></a>

<a name="1298203"></a>

<a name="1298204"></a>

<a name="1298217"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Grable:<br><br>Here is your scaler using an alternative method I'm trying. Instead of reading pixels for what got modified it only reads pixels from an unmodified source and saves to a final result picture.<br><br>Thus it won't build pixels developed from previously changed ones.<br><br>Here is the code:<br><br><b>WOAH ! Wait a sec ... this should be a dramatic improvement ... changing the code a bit, working ...</b><br><br>Okay, here it is. Try the "ALIEN.PNG," the gun muzzle is a perfect slope !<br>Also permanently removes the 'half pixel' artefact.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SuperStrict
' Wow ! Compare my new code with 'alien.png' big difference !
' What's up ??
' Changed code so it works with ORIGINAL image only and saves only DESTINATION
' No reading &amp; writing to &amp; from same image, makes a big difference !

Graphics 800,600

Local path$="c:\david\dls\scalertest"
Local file$="bio menace"

Local image:TImage=LoadImage(path$+"\"+file$+".png",dynamicimage)
Local scaled:TImage = LoadImage( scale2x(image), DYNAMICIMAGE)

SetBlend ALPHABLEND
Local scale:Int = 2
Local zoom:Int = 0
Local x:Int,y:Int
Repeat
	' original
	SetViewport 0,0, MouseX(),GraphicsHeight()
	SetScale scale + (zoom * scale),scale + (zoom * scale)
	SetColor 255,255,255
	DrawImage image, x,y

	' scaled
	SetViewport MouseX(),0, GraphicsWidth()-MouseX(),GraphicsHeight()	
	SetScale 1 + zoom,1 + zoom
	SetColor 255,255,255
	DrawImage scaled, x,y
	
	' dont draw line
	If Not MouseDown(1) Then
		SetColor 255,0,0
		DrawLine MouseX(),0, MouseX(),GraphicsHeight()
	EndIf
	
	' move
	Global mb2:Int
	If MouseDown(2) Then		
		If Not mb2 Then
			mb2 = True
			MouseXSpeed()
			MouseYSpeed()
		EndIf
		x :+ MouseXSpeed()
		y :+ MouseYSpeed()
	Else
		mb2 = False
	EndIf
		
	' zoom
	zoom :+ Sgn( MouseZSpeed())
	If zoom &lt; 0 Then zoom = 0
	
	' double
	If KeyHit(KEY_SPACE) Then
		scaled = LoadImage( scale2x(scaled), DYNAMICIMAGE)
		scale :* 2
	EndIf
	
	' reset
	If KeyHit(KEY_BACKSPACE) Then
		x = 0
		y = 0
		zoom = 0
		scale = 2
		scaled = LoadImage( scale2x(image), DYNAMICIMAGE)
	EndIf

	
	SetViewport 0,0, GraphicsWidth(),GraphicsHeight()
	SetScale 1,1
	SetColor 255,255,255	
	DrawText "scale=" + scale + " zoom=" + zoom, 0,0
	
	Flip
	Cls
		
Until AppTerminate() Or KeyHit(KEY_ESCAPE)
End



'
' dw817 scaler
' 	&lt;a href="http://www.blitzmax.com/Community/posts.php?topic=105913" target="_blank"&gt;http://www.blitzmax.com/Community/posts.php?topic=105913&lt;/a&gt;
' updated 03/04/16
Function scale2x:TPixmap( src:TImage)
	Local pic:TPixmap = src.Lock( 0, 1,0)
	If pic.Format &lt;&gt; PF_RGBA8888 Then pic = pic.Convert(PF_RGBA8888)
	
'	Local dst:TPixmap = ResizePixmap( pic, pic.Width * 2, pic.Height * 2) ' does smoothing, not what we want
	Local dst:TPixmap = DoublePixmap(pic)
	Local org:TPixmap=dst ' New ! Read only from original

	Local w:Int = dst.Width
	Local h:Int = dst.Height
	
	For Local y:Int = 0 Until h Step 2
		For Local x:Int = 0 Until w Step 2
			Local c1:Int = ReadPixel(org,x,y)&amp;$ffffff ' read in top-left corner, remove alpha
			Local c2:Int = -1
			Local c3:Int = -1
			Local c4:Int = -1
			If x &lt; w - 2 Then c2 = ReadPixel(org,x+2,y) &amp; $ffffff ' read in top-right corner
			If y &lt; h - 2 Then c3 = ReadPixel(org,x,y+2) &amp; $ffffff ' read in bottom-left corner
			If x &lt; w - 2 And y &lt; h - 2 Then c4 = ReadPixel(org,x+2,y+2)&amp;$ffffff ' read in bottom-right corner
			If c1&gt;=0 And c1 = c4 And c2 &lt;&gt; c3 and c2&gt;=0 and c3&gt;=0 Then
				' if there's a jaggy, fill it in
				WritePixel dst, x+2,y+1, c1 | $ff000000 ' force alpha to max
				WritePixel dst, x+1,y+2, c1 | $ff000000 ' here too
			EndIf
		Next
	Next
	
	' necessary to go backwards on this search	

	For Local y:Int = h - 2 To 0 Step -2
		For Local x:Int = w - 2 To 0 Step -2
			Local c1:Int = ReadPixel(org,x,y)&amp;$ffffff
			Local c2:Int = -1
			Local c3:Int = -1
			Local c4:Int = -1
			If x &lt; w - 2 Then c2 = ReadPixel(org,x+2,y)&amp;$ffffff
			If y &lt; h - 2 Then c3 = ReadPixel(org,x,y+2)&amp;$ffffff
			If x &lt; w - 2 And y &lt; h - 2 Then c4 = ReadPixel(org,x+2,y+2)&amp;$ffffff
			If c2&gt;=0 And c2 = c3 And c1&lt;&gt;c4 and c1&gt;=0 and c4&gt;=0 Then
				WritePixel dst, x+1,y+1, c2 | $ff000000
				WritePixel dst, x+2,y+2, c2 | $ff000000
			EndIf
		Next
	Next
	
	Return dst
EndFunction

Function DoublePixmap:TPixmap( src:TPixmap)
	Assert src.Format = PF_RGBA8888
	
	Local dst:TPixmap = CreatePixmap( src.Width * 2, src.Height * 2, src.Format)	
	Local yy:Int
	For Local y:Int = 0 Until src.Height
		Local s:Int Ptr = Int Ptr src.PixelPtr( 0,y)
		Local d1:Int Ptr = Int Ptr dst.PixelPtr( 0,yy)
		Local d2:Int Ptr = Int Ptr dst.PixelPtr( 0,yy + 1)
		Local xx:Int
		For Local x:Int = 0 Until src.Width
			Local p:Int = s[x]
			d1[xx] = p
			d1[xx + 1] = p
			d2[xx] = p	
			d2[xx + 1] = p
			xx :+ 2
		Next
		yy :+ 2
	Next
	Return dst
EndFunction
</textarea> <br><br></td></tr></table><br>
<a name="1298209"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dw817</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Here is one that keeps stray pixels at the cost of blurring others.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Strict
' Here is a different method, it keeps stray pixels at the cost
' of blurring others. I like the other method better, but here
' is one to try out and see how it stacks up to the others

Graphics 800,600

Local path$="c:\david\dls\scalertest"
Local file$="alien"

Local image:TImage=LoadImage(path$+"\"+file$+".png",dynamicimage)
Local scaled:TImage = LoadImage( scale2x(image), DYNAMICIMAGE)

SetBlend ALPHABLEND
Local scale:Int = 2
Local zoom:Int = 0
Local x:Int,y:Int
Repeat
	' original
	SetViewport 0,0, MouseX(),GraphicsHeight()
	SetScale scale + (zoom * scale),scale + (zoom * scale)
	SetColor 255,255,255
	DrawImage image, x,y

	' scaled
	SetViewport MouseX(),0, GraphicsWidth()-MouseX(),GraphicsHeight()	
	SetScale 1 + zoom,1 + zoom
	SetColor 255,255,255
	DrawImage scaled, x,y
	
	' dont draw line
	If Not MouseDown(1) Then
		SetColor 255,0,0
		DrawLine MouseX(),0, MouseX(),GraphicsHeight()
	EndIf
	
	' move
	Global mb2:Int
	If MouseDown(2) Then		
		If Not mb2 Then
			mb2 = True
			MouseXSpeed()
			MouseYSpeed()
		EndIf
		x :+ MouseXSpeed()
		y :+ MouseYSpeed()
	Else
		mb2 = False
	EndIf
		
	' zoom
	zoom :+ Sgn( MouseZSpeed())
	If zoom &lt; 0 Then zoom = 0
	
	' double
	If KeyHit(KEY_SPACE) Then
		scaled = LoadImage( scale2x(scaled), DYNAMICIMAGE)
		scale :* 2
	EndIf
	
	' reset
	If KeyHit(KEY_BACKSPACE) Then
		x = 0
		y = 0
		zoom = 0
		scale = 2
		scaled = LoadImage( scale2x(image), DYNAMICIMAGE)
	EndIf

	
	SetViewport 0,0, GraphicsWidth(),GraphicsHeight()
	SetScale 1,1
	SetColor 255,255,255	
	DrawText "scale=" + scale + " zoom=" + zoom, 0,0
	
	Flip
	Cls
		
Until AppTerminate() Or KeyHit(KEY_ESCAPE)
End



'
' dw817 scaler
' 	&lt;a href="http://www.blitzmax.com/Community/posts.php?topic=105913" target="_blank"&gt;http://www.blitzmax.com/Community/posts.php?topic=105913&lt;/a&gt;
' updated 03/04/16
Function scale2x:TPixmap( src:TImage)
  Local r1,g1,b1,r2,g2,b2,r3,g3,b3,r4,g4,b4,z1,z2
	Local pic:TPixmap = src.Lock( 0, 1,0)
	If pic.Format &lt;&gt; PF_RGBA8888 Then pic = pic.Convert(PF_RGBA8888)
	
'	Local dst:TPixmap = ResizePixmap( pic, pic.Width * 2, pic.Height * 2) ' does smoothing, not what we want
	Local dst:TPixmap = DoublePixmap(pic)
	Local org:TPixmap=dst ' New ! Read only from original

	Local w:Int = dst.Width
	Local h:Int = dst.Height
	
	For Local y:Int = 0 Until h Step 2
		For Local x:Int = 0 Until w Step 2
			Local c1:Int = ReadPixel(org,x,y)&amp;$ffffff ' read in top-left corner, remove alpha
			Local c2:Int = -1
			Local c3:Int = -1
			Local c4:Int = -1
			If x &lt; w - 2 Then c2 = ReadPixel(org,x+2,y) &amp; $ffffff ' read in top-right corner
			If y &lt; h - 2 Then c3 = ReadPixel(org,x,y+2) &amp; $ffffff ' read in bottom-left corner
			If x &lt; w - 2 And y &lt; h - 2 Then c4 = ReadPixel(org,x+2,y+2)&amp;$ffffff ' read in bottom-right corner
			
      r1=c1 Shr 16&amp;$ff ; g1=c1 Shr 8&amp;$ff ; b1=c1&amp;$ff
      r2=c2 Shr 16&amp;$ff ; g2=c2 Shr 8&amp;$ff ; b2=c2&amp;$ff
      r3=c3 Shr 16&amp;$ff ; g3=c3 Shr 8&amp;$ff ; b3=c3&amp;$ff
      r4=c4 Shr 16&amp;$ff ; g4=c4 Shr 8&amp;$ff ; b4=c4&amp;$ff

      z1=(b1+b2)/2|(g1+g2)/2 Shl 8|(r1+r2)/2 Shl 16
      z2=(b1+b3)/2|(g1+g3)/2 Shl 8|(r1+r3)/2 Shl 16
			
			If c1&gt;=0 And c1 = c4' And c2 &lt;&gt; c3 Then
				' if there's a jaggy, fill it in
				WritePixel dst, x+2,y+1, z1 | $ff000000 ' force alpha to max
				WritePixel dst, x+1,y+2, z2 | $ff000000 ' here too
			EndIf
		Next
	Next
	
	' necessary to go backwards on this search	

	For Local y:Int = h - 2 To 0 Step -2
		For Local x:Int = w - 2 To 0 Step -2
			Local c1:Int = ReadPixel(org,x,y)&amp;$ffffff
			Local c2:Int = -1
			Local c3:Int = -1
			Local c4:Int = -1
			If x &lt; w - 2 Then c2 = ReadPixel(org,x+2,y)&amp;$ffffff
			If y &lt; h - 2 Then c3 = ReadPixel(org,x,y+2)&amp;$ffffff
			If x &lt; w - 2 And y &lt; h - 2 Then c4 = ReadPixel(org,x+2,y+2)&amp;$ffffff
			
      r1=c1 Shr 16&amp;$ff ; g1=c1 Shr 8&amp;$ff ; b1=c1&amp;$ff
      r2=c2 Shr 16&amp;$ff ; g2=c2 Shr 8&amp;$ff ; b2=c2&amp;$ff
      r3=c3 Shr 16&amp;$ff ; g3=c3 Shr 8&amp;$ff ; b3=c3&amp;$ff
      r4=c4 Shr 16&amp;$ff ; g4=c4 Shr 8&amp;$ff ; b4=c4&amp;$ff

      z1=(b2+b1)/2|(g2+g1)/2 Shl 8|(r2+r1)/2 Shl 16
      z2=(b2+b4)/2|(g2+g4)/2 Shl 8|(r2+r4)/2 Shl 16

			If c2&gt;=0 And c2 = c3' And c1&lt;&gt;c4 Then
				WritePixel dst, x+1,y+1, z1 | $ff000000
				WritePixel dst, x+2,y+2, z2 | $ff000000
			EndIf
		Next
	Next
	
	Return dst
EndFunction

Function DoublePixmap:TPixmap( src:TPixmap)
	Assert src.Format = PF_RGBA8888
	
	Local dst:TPixmap = CreatePixmap( src.Width * 2, src.Height * 2, src.Format)	
	Local yy:Int
	For Local y:Int = 0 Until src.Height
		Local s:Int Ptr = Int Ptr src.PixelPtr( 0,y)
		Local d1:Int Ptr = Int Ptr dst.PixelPtr( 0,yy)
		Local d2:Int Ptr = Int Ptr dst.PixelPtr( 0,yy + 1)
		Local xx:Int
		For Local x:Int = 0 Until src.Width
			Local p:Int = s[x]
			d1[xx] = p
			d1[xx + 1] = p
			d2[xx] = p	
			d2[xx + 1] = p
			xx :+ 2
		Next
		yy :+ 2
	Next
	Return dst
EndFunction
</textarea><br><br>While I'm not very fond of it, you can certainly figure it into the other methods I've already written. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
