<!DOCTYPE html><html lang="en" ><head ><title >Mac OpenGL rendering Glitch</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Mac OpenGL rendering Glitch</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Mac OpenGL rendering Glitch</a><br><br>
<a name="1113611"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi<br><br>My game is running at around 300~450 FPS<br>I'm using a Fixed Rate Logic set to 60 FPS under OpenGL with Box2d and BlitzMax vSync on (or flip 1 if you prefer).<br><br>Everything run smoothly on windows desktops, mainly because the refresh rate is higher than 60 hertz (most of the time 85 hertz, but even if I'm setting all CRT down to 60 hertz it's drawing and running smoothly at fullscreen and window mode).<br><br>The problem is on Mac system.<br>On a Macbook Air, the LCD is refreshing at 60 hertz (like with many laptop LCD). What I describe is not typical screen tearing (and since vSync is on it shouldn't happen anyway, no the graphic card isn't vSync disabled, why changing this default setting anyway ?).<br><br>On desktop, in-game FPS is strictly identical to the screen refresh rate (no more, no less). But on the Macbook Air, you never get 60 FPS every time...<br><br><b>I don't know why but every ~3 seconds my FPS counter drop to 49~52 FPS and at that very moment some game objects in movement are visually stuttering (not correctly drawn).</b><br><br>It's not extremely perceptible but certainly not tolerable (it last 2 or 3 frames).<br>I try to match greater FPS, use delta-timing instead of fixed rate logic (but it's certainly not the problem), turned off the garbage collector, shutdown every background task, but even without vSync turned on (at 450 FPS) the problem persist!<br><br>It's maybe related to box2D under Mac (since nothing happen in Windows) but I didn't found any problem related to it while searching on the Internet (and anyway there is so much different optimized version out there that no comparison can be made anymore).<br><br>I try to run a few similar 2d games to see if something like this happening but of course the answer is not...<br><br>Does anyone already experience this before ?? <br><br></td></tr></table><br>
<a name="1113612"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would suspect a cleanup routine in the mac end of box2D personally. If you can make a portable sample to demonstrate the issue (if possible) you're more likely to get some more specific help. <br><br></td></tr></table><br>
<a name="1113622"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Maybe you're doing too much processing (especially with lots of physics) and not giving the o/s a chance to do what it needs, so it has to take cpu time from you suddenly.... maybe if you put in a Delay 1 in your main loop it might have time to do what it wants more smoothly? <br><br></td></tr></table><br>
<a name="1113640"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> @ImaginaryHuman<br><br>I tried but it's not a "suffocating" CPU, no luck :(<br><br>@Ima747<br>Possibly, but then why should I notice this under a new MacBook Air and not under my old PC ?<br>The engine is so big I would literally have to write another game to post a sample. So I know it's a bit hard to help this way :(<br><br>It's probably totally unrelated due to the experimental nature of HTML5 but I already saw something similar on some Monkey examples : <a href="http://www.into-games.com/sledgenet/files/Multi-scrapper/MonkeyGame.swf" target="_blank">http://www.into-games.com/sledgenet/files/Multi-scrapper/MonkeyGame.swf</a> <br><br></td></tr></table><br>
<a name="1113677"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ima747</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> you would see it on the mac but not the PC because of the way they both handle memory, specifically cleanup. You noted you disabled the garbage collector but that is specifically the blitz GC, not the OS level cleanup routine. Things handled internally by Box2D would be released by Box2D, and as such would be handled between box and the OS. I'm unfamiliar with box so I don't know if this is a legitimate possibility in this case or not, but it's certainly technically possible...<br><br>A simple example can be demonstrated under iOS where there is no GC. All memory must be manually managed, and that means explicitly freeing things when your done, however there's 2 ways to free things... you can either free them immediately or que them for collection on the next pass of the main thread by tagging them with autorelease which puts them in a collection pool... Why this is relevant: if you loop for a long time creating and freeing objects, but you're actually autoreleasing them rather than freeing them, the main loop never gets a chance to clean the pool and you can run out of memory... if you don't run out of memory but you've created a LARGE release pool it can cause a hiccup when the pool gets cleared. You can make the pool large enough the OS can't do it in one pass because it would take too long... <br><br>With that said, factor in the overhead of a garbage collector, and the structure of the MacOS kernel compared to the windows kernel and how they manage things internally and there's tons of room for differences.<br><br>On the other hand maybe it has nothing to do with Box. Maybe it's something with the openGL drivers on the macbook. Maybe you're triggering a lot of memory paging to the graphics card. Maybe your PC has more VRAM, or a better pipe for texture loading... maybe there's a background process on your mac, a service, etc. This is why tearing it apart is the only way to get a real solution, otherwise all you can do is guess and poke and hope you find it, which is usually good enough :0) <br><br></td></tr></table><br>
<a name="1113724"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Damned !<br>ima747 you point in the right direction !<br><br>I'm now more confidant in the fact that it's the Mac version of Box2d that is responsible of that lag.<br>I can clearly reproduce this problem while my player is moving on a fast treadmill or jumping high thanks to a giant spring.<br><br>This is bad :(<br>I'm sure I am not releasing or creating any physical body object around the moment this lag appears. But like you said it's maybe hidden deeper in the Box2d library. Which is bad because I'm not up to date and probably never be.<br><br>I will have to release a demo version of my game and ask a few Mac owner to try on their machine (but one of the specificity of Apple is that every machine isn't so different one from another, so the lag will probably occur anyway). I hope for a background process or services but I seriously doubt about it.<br><br>No that I can concentrate my research on something, I will head up to the box2d forum to see if I found solutions.<br><br><div class="quote"> otherwise all you can do is guess and poke and hope you find it, which is usually good enough :0)  <br></div><br>You are right, hopefully there is knowledgeable peoples on this community that can greatly help the brainstorming ^^ <br><br></td></tr></table><br>
<a name="1113887"></a>

<a name="1113888"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xcessive</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> What card are you using, sounds like micro-stuttering - <a href="http://en.wikipedia.org/wiki/Micro_stuttering" target="_blank">http://en.wikipedia.org/wiki/Micro_stuttering</a><br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1114195"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Gloups... I hope not !<br><br>It's a new <b>MacBook Air</b> with an<b> Intel HD Graphics 3000 384 MB5</b> and the SSD harddrive.<br>I robbed twelve Belgian grannies to pay me this machine in order to support Mac Os folks for my game.<br><br>It's working perfectly under Windows in every window mode and on 3 different machines; <br>working better in Fullscreen mode under Mac Os X Lion but it's atrocious in window mode...<br>By the end of the week I could probably produce a little demonstration to let you try, think is I know practically nobody here with Mac. It's considered as a no gaming deluxe computer where I live ^^ <br><br></td></tr></table><br>
<a name="1127331"></a>

<a name="1127332"></a>

<a name="1127333"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Old thread but since I found the answer to this question I answer myself.<br><br>I'm using a fixed rate logic.<br>Because of Box2d most movement are physics based.<br>I tough first it would be enough but <b>you still need to interpolate values</b> (tween them) from old position/rotation to new one before rendering!<br><br>The micro-stuttering was only appearing with a few tick delays on 60hz which is rather tight with a 60 FPS Fixe Rate Logic.<br><br>I hooked this interpolation process to my overly modified scrollable camera and to moving objects as well and now everything is smooth as silk EVERYWHERE :)<br>Doing this at the end is quite a pain and messing my framework a bit. Mainly with object composed of multiple shapes (you have to hold every shapes rotation/position, it's dirty).<br><br>I will remember this on the next project for sure !<br><br><font class="tiny">Last edited 2012</font> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
