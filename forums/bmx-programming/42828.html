<!DOCTYPE html><html lang="en" ><head ><title >Byte Ptr -&gt; Function</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Byte Ptr -&gt; Function</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Byte Ptr -&gt; Function</a><br><br>
<a name="479284"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N3m</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Blitzmax converts a Function tu a Byte Ptr automaticly, but how can i convert a Byte Ptr back to a Function? <br><br></td></tr></table><br>
<a name="479321"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, I found that I couldn't get it to work directly. There might be a way but from what I could tell BlitzMax won't let you put a BytePointer or any other kind of pointer (except another function pointer) in a function pointer. Maybe this is a features that they can add in a future release.<br><br>I did however figure out a way to sneak behind Blitz's back (with regards to type checking)...<br><br><pre class=code>
Local mytempfunction() 'function pointer
Local mybytepointer:Byte Ptr=WhereverYouWant

'then to turn the machine code at the Byte Ptr into a callable function:
Local where:Int Ptr=Int Ptr(Byte Ptr(VarPtr(mytempfunction)))
mytempbank:TBank=StaticBank(where,4) 'not sure on the syntax - make it look at the function pointer memory 4-bytes
PokeInt where,Int(Int Ptr(mybytepointer)) 'not sure on syntax - overwrite the function pointer content with a byte pointer
mytempfunction() 'call it
</pre><br>Something like that - I don't remember the syntax for creating a static bank or doing the PokeInt off-hand. Basically what you're trying to do here is get the location of the function pointer using VarPtr (which actually works) - and btw you have to first turn a functionpointer into a bytepointer and then into an intpointer (that's the only way it would accept it for me anyway). Then you cludge a static bank onto the memory area of the function pointer variable itself, and write to that memory the pointer that you want the function to represent. Then you call the function. It should then jump to whatever routine you are pointing your byte pointer at - so it better be something executable. You can point it at the byte-pointer version of another function's function pointer if you like, but then you might as well do myfunction()=otherfunction. So I hope whatever you're pointing it at is valid executable code that can run and return to Blitz okay.<br><br>I think that's pretty much how I found to do it. BlitzMax wouldn't let me convert the function pointer to anything other than a byte pointer (if I remember rightly), and certainly wouldn't let something be put into the function pointer except for other function pointers. You might need to play with the type casting a little bit if this doesn't work exactly as is.<br><br>Hey Mark &amp; Co, whatever happened to good old Peek and Poke without needing a bank? Trying to encourage good programming practice? ;-) <br><br></td></tr></table><br>
<a name="479342"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BlitzSupport</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>whatever happened to good old Peek and Poke without needing a bank?<br> <br></div><br>Memory protection on modern OSes will slap your app down if you try to access anything other than the app's own memory -- banks are just a way of allocating that memory. <br><br></td></tr></table><br>
<a name="479364"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well ya, we knew that ;-) I was about to say why can't you let them work with some memory that the coder allocates, but then again - that's what a bank is :-D *doh* AHhhhhhh, the good old days.<br><br>How about a PokeVar and PeekVar commands then, that specifically let you write to variable content memory? That memory is already allocated. It'd be more elegant than having to define a bank just to change 4 bytes. ??? <br><br></td></tr></table><br>
<a name="479619"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N3m</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> the reason why i wan't to do this is:<br><br>I want to create somthing like an eventsystem, so i have a function called AddEventHandler wich takes the  event name and the callback function as parameters. But not each event gives the same information to the callback function, and so the functions don't have the same parameters. And the problem is i cant create a function pointer as parameter for AddEventHandler wich takes every function. So i tried to take a Byte Ptr and cast it to the relevant function (depending on the event name).  Maybe someone got another solution for this problem?<br><br>(sorry for my crappy english) <br><br></td></tr></table><br>
<a name="479658"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Umm, yea, it is a problem if you want to use function pointers because you can only copy the pointer to another function defined with the same number of parameters.<br><br>(I'm also seeming to find that Int(Int) is how BlitzMax refers to a function pointer - an int pointer)<br><br>Maybe you can have seperate versions of your function, one each for a given number of parameters, and call the appropriate one.<br><br>Or maybe instead of having varying parameters being passed, you can set up an array of parameters and just pass two paramaters to the function - array pointer and number of elments. That way the function can always take 2 parameters - needing only one function. You would put all your variables in the array and pass the pointer to it which the function then deciphers. <br><br></td></tr></table><br>
<a name="479668"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N3m</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmm yes. i think i will do it thisway. thanks <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
