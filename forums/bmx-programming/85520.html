<!DOCTYPE html><html lang="en" ><head ><title >Never declare a type in a function!</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Never declare a type in a function!</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Never declare a type in a function!</a><br><br>
<a name="967655"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Never declare a type in a function.  It will compile and run, but it will cause random memory errors down the line.  I spent about four hours finding the source of a mem leak, and this was it.<br><br>For that matter, you should stay away from functions in functions as well. <br><br></td></tr></table><br>
<a name="967660"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <img src="http://blogs.warwick.ac.uk/images/jmiles/2008/07/08/vaderno.jpg"> <br><br></td></tr></table><br>
<a name="967661"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Never declare a type in a function. <br></div><br>Why would you want to? <br><br></td></tr></table><br>
<a name="967666"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Htbaa</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why would it even be possible? I think it's strange the compiler doesn't complain about it. But even so, I agree, why would you want to? Anonymous/private types or something? <br><br></td></tr></table><br>
<a name="967677"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> What if you make it global? Can you declare it global in the function? <br><br></td></tr></table><br>
<a name="967682"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> What if you make it global? Can you declare it global in the function?  <br></div><br><br>A global inside a function becomes a static variable, not a global in the traditional sense. <br><br></td></tr></table><br>
<a name="967703"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Why would you want to? <br></div><br>I had a type for a DDS header structure that was only used in my DDS load function. <br><br></td></tr></table><br>
<a name="967704"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >markcw</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh that's right, I wasn't sure if it applied to types.<br><br>What if you Null all local types before the function ends? Does it still leak? <br><br></td></tr></table><br>
<a name="967706"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> It's not a regular leak, though.  It can run perfectly fine without causing a leak.  When combined with other commands, sometimes it can leak.  Sometimes it won't.  I experienced something similar with functions in functions with a global variable in the main function, like this:<br><pre class=code>Function foo()
	Global thing:Int=3
	do()
	
	Function do()
		Print thing
	EndFunction
	
EndFunction</pre><br>It appears to work fine, but will cause random memory overwrites.  At least, in older versions of BMX it did.<br><br>I've occasionally been getting a bad refs error, and I think my type in a function was the cause.  These are the worst things to debug, because their behavior changes when you change the code.  But I am reasonably certain this was the cause, since I can now load and free complex objects in a loop with no leaks.  I've got a pretty uniform approach to code, for the most part, and this was one place where I deviated from my norm. <br><br></td></tr></table><br>
<a name="967769"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wiebo</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting. Lately, I've been using functions in methods.. Anyone ever had problems with that? I have not so far. <br><br></td></tr></table><br>
<a name="967778"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I've been using functions in methods.. <br></div><br><br>You mean, like this?<br><br><pre class=code>
Method blah()

    Function doodah()

        Print "Yippee!"

    End Function

    doodah()

End Method
</pre><br><br>I wouldn't advise it. <br><br></td></tr></table><br>
<a name="967787"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have had no trouble with Functions within Functions or Methods..<br>There should be no difference in the generated code, as they are all static.<br>(just dont go messing with fields, globals are ok though) <br><br></td></tr></table><br>
<a name="967790"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think there was some piece of BRL code which actually declared functions within functions, so presumably that works okay? <br><br></td></tr></table><br>
<a name="967793"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I think there was some piece of BRL code which actually declared functions within functions, so presumably that works okay?  <br></div>Yeah, I think functions inside of functions/methods works fine.<br><br>Although, I was under the impression that the encapsulated function was just renamed to "encapsulator_name" + "_" + "encapsulated_name" (or something of the such) when it compiled.<br>If you look at the assembly code... that isn't at all how it works. Bummer. <br><br></td></tr></table><br>
<a name="967829"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wiebo</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I wouldn't advise it.  <br></div><br>Why not Brucey? I value your opinion but I also need facts =]<br><br>But it would be nice to an official answer to this.. It's very intriguing. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
