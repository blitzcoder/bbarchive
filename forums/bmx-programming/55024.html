<!DOCTYPE html><html lang="en" ><head ><title >Reading/Writing File formats</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Reading/Writing File formats</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Reading/Writing File formats</a><br><br>
<a name="612795"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gellyware</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does anyone have example(s) of how to read/write bmp, jpg, png files? <br><br>I'm looking at the wotsit.org site and although intrigued at all of the usefull file formats, I am not sure what to do with them. <br><br>Any help of reading/writing byte by byte information would be great.<br><br>Thanks. <br><br></td></tr></table><br>
<a name="612853"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> See in the manual,..<br><br>LoadPixmap<br>LoadImage<br>SavePixmapPNG<br><br>Max automatically can load jpeg png and bmp and can save png <br><br></td></tr></table><br>
<a name="612854"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> As to reading and writing files that's a different matter. See streams. <br><br></td></tr></table><br>
<a name="612928"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gellyware</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I believe there is a miscommunication.<br><br>I am not talking about the normal blitz way of loading images... I am talking about reading and writing raw (bytes) in the jpg,png (etc) format. <br><br></td></tr></table><br>
<a name="612931"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://www.wotsit.org/" target="_blank">http://www.wotsit.org/</a><br><br>Have fun. <br><br></td></tr></table><br>
<a name="612955"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert Cummings</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> File : TStream commands in the manual. ReadFile, readbyte etc. <br><br></td></tr></table><br>
<a name="613049"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gellyware</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am looking for code that reads in byte by byte information. I know of the blitz commands and the wotsit site.... what I am asking for is if anyone has written a png, jpg, bmp, reading/writing program(using bytes). I would like to see examples of what someone has done with info found at the wotsit site. <br><br>Examples Examples Examples.<br><br>Thanks. <br><br></td></tr></table><br>
<a name="613066"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Scott Shaver</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> here is some java code to read a bmp file<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
/**
 * Handles dealing with windows bitmap files. This class doesn't handle palettized files.
 * +--------------------------------------+
 * | Bitmap File Header                   |
 * +--------------------------------------+
 * | Bitmap Information Header            |
 * +--------------------------------------+
 * | Palette Data (only in 8 bit files)   |
 * +--------------------------------------+
 * | Bitmap Data                          |
 * +--------------------------------------+
 *
 * @author Scott Shaver
 */
public class WindowsBitmapFile implements com.xith3d.imaging.ImageFile {

  private int    FHsize            =    0;
  private short  FHreserved1       =    0;
  private short  FHreserved2       =    0;
  private int    FHoffsetBits      =    0;

  private int    IHsize            =    0;
  private int    IHwidth           =    0;
  private int    IHheight          =    0;
  private short  IHplanes          =    0;
  private short  IHbitCount        =    0;
  private int    IHcompression     =    0;
  private int    IHsizeImage       =    0;
  private long   IHxpelsPerMeter   =    0;
  private long   IHypelsPerMeter   =    0;
  private int    IHcolorsUsed      =    0;
  private int    IHcolorsImportant =    0;
  private int    filePointer       =    0;
  private byte[] fileContents      = null;

  private byte[] data = null;

    public WindowsBitmapFile() {
    }

    public byte[] getData() {
        return data;
    }

    public int getWidth() {
        return IHwidth;
    }

    public int getHeight() {
        return IHheight;
    }

    public int getBPP() {
        return IHbitCount;
    }

    public int getDataLength() {
        return data.length;
    }

    public static BufferedImage getBufferedImage(String filename){
      WindowsBitmapFile loader = new WindowsBitmapFile();
      loader.load(filename);

      int width  = loader.getWidth(),

          height = loader.getHeight();

      BufferedImage bufferedImage = new BufferedImage(width, height, BufferedImage.TYPE_INT_ARGB);

      byte[] imageData = loader.getData();
      for(int j = height - 1; j &gt;= 0; j--)
        for(int i = 0; i &lt; width; i++) {
          int index = ((height - 1 - j)* width + i) * 3,
              color= (        255          &amp; 0xFF) &lt;&lt; 24|
 (imageData[index + 2] &amp; 0xFF) &lt;&lt; 16|
 (imageData[index + 1] &amp; 0xFF) &lt;&lt;  8|
 (imageData[index + 0] &amp; 0xFF);
          bufferedImage.setRGB(i,j, color);
        }
      return bufferedImage;
	}

    public void printHeaders() {
        System.out.println("-----------------------------------");
        System.out.println("File Header");
        System.out.println("-----------------------------------");
        System.out.println("            File Size:"+FHsize);
        System.out.println("           Reserved 1:"+FHreserved1);
        System.out.println("           Reserved 2:"+FHreserved2);
        System.out.println("          Data offset:"+FHoffsetBits);
        System.out.println("-----------------------------------");
        System.out.println("Info Header");
        System.out.println("-----------------------------------");
        System.out.println("     Info Header Size:"+IHsize);
        System.out.println("                Width:"+IHwidth);
        System.out.println("               Height:"+IHheight);
        System.out.println("               Planes:"+IHplanes);
        System.out.println("                  BPP:"+IHbitCount);
        System.out.println("          Compression:"+IHcompression);
        System.out.println("           Image size:"+IHsizeImage);
        System.out.println("     Pels Per Meter X:"+IHxpelsPerMeter);
        System.out.println("     Pels Per Meter Y:"+IHypelsPerMeter);
        System.out.println("     # of Colors Used:"+IHcolorsUsed);
        System.out.println("# of Important Colors:"+IHcolorsImportant);
    }

    public void load(String filename) {
        // reset everything
        FHsize            = 0;
        FHreserved1       = 0;
        FHreserved2       = 0;
        FHoffsetBits      = 0;
        IHsize            = 0;
        IHwidth           = 0;
        IHheight          = 0;
        IHplanes          = 0;
        IHbitCount        = 0;
        IHcompression     = 0;
        IHsizeImage       = 0;
        IHxpelsPerMeter   = 0;
        IHypelsPerMeter   = 0;
        IHcolorsUsed      = 0;
        IHcolorsImportant = 0;
        filePointer       = 0;

        InputStream  dis = ClassLoader.getSystemResourceAsStream(filename);

        try
        {
            if( dis == null)
              dis = new FileInputStream(filename);


            fileContents = new byte[dis.available()];
            dis.read(fileContents);
            try{dis.close();}catch(Exception x){}

            short magicNumber = readShort();

         //   FHtype
            // make sure it's windows bitmap file
            if(magicNumber != 19778)
            {
                fileContents = null;
                return;
            }

            // read the file header
            FHsize       = readInt();
            FHreserved1  = readShort();
            FHreserved2  = readShort();
            FHoffsetBits = readInt();

            // read the info header
            IHsize            = readInt();
            IHwidth           = readInt();
            IHheight          = readInt();
            IHplanes          = readShort();
            IHbitCount        = readShort();
            IHcompression     = readInt();
            IHsizeImage       = readInt();
            IHxpelsPerMeter   = readInt();
            IHypelsPerMeter   = readInt();
            IHcolorsUsed      = readInt();
            IHcolorsImportant = readInt();

            // allocate memory for the pixel data
            data = new byte[IHsizeImage];

            System.arraycopy(fileContents, FHoffsetBits, data, 0, IHsizeImage);
            fileContents = null;

            // swap the R and B values to get RGB, bitmap color format is BGR
            for(int loop=0;loop&lt;IHsizeImage;loop+=3)
            {
                byte btemp = data[loop];
                data[loop] = data[loop+2];
                data[loop+2] = btemp;
            }
        }
        catch(Exception x)
        {
            x.printStackTrace();
            System.out.println(x.getMessage());
        }
    }

  private short readShort(){
    int s1 = (fileContents[filePointer++] &amp; 0xFF),
        s2 = (fileContents[filePointer++] &amp; 0xFF) &lt;&lt; 8;
    return ((short)(s1 | s2));
  }

  private int readInt(){
    return (fileContents[filePointer++] &amp; 0xFF)      |
 (fileContents[filePointer++] &amp; 0xFF) &lt;&lt;  8|
 (fileContents[filePointer++] &amp; 0xFF) &lt;&lt; 16|
 (fileContents[filePointer++] &amp; 0xFF) &lt;&lt; 24;
  }


    public static void main(String[] args) {
        WindowsBitmapFile bf = new WindowsBitmapFile();
        bf.load(args[0]);
        bf.printHeaders();
    }
}
</textarea><br><br>here is a little snippet of blitz code reading a binary tilemap file.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
	Function Load:LayeredTileMap(filename:String)
		Local majorVer=1
		Local MinorVer=0
		Local newmap:LayeredTileMap = Null
		
		Local in:TStream = ReadStream(filename)
		If Not in RuntimeError "Failed to open a ReadStream to file "+filename
		Local mfs:TStream = LittleEndianStream(in)
			
		' read the file header
		Local fileid:String = Null
		fileid = ReadString(mfs,6)
		If fileid &lt;&gt; "SASMEF" RuntimeError filename+" is not an SAS Map Editor map file."
		majorVer = ReadInt(mfs)
		minorVer = ReadInt(mfs)

		' read version 1.0 of the map format
		If majorVer=1 And minorVer=0
			' read the map header
			Local mapid:String = Null
			mapid = ReadString(mfs,6)
			If mapid&lt;&gt;"SASMHD" RuntimeError filename+" is corrupt, unable to locate the SASMHD block."
			Local titleLen:Int = ReadInt(mfs)
			Local title:String = ReadString(mfs,titleLen)
			Local editLen:Int = ReadInt(mfs)
			Local edit:String = ReadString(mfs,editLen)
			Local creatorLen:Int = ReadInt(mfs)
			Local creator:String = ReadString(mfs,creatorLen)
			Local layerCount:Int = ReadInt(mfs)
			Local mcw:Int = ReadInt(mfs)
			Local mch:Int = ReadInt(mfs)
			
			' Read Tile Image
			Local nameLen:Int = ReadInt(mfs)
			Local name:String = ReadString(mfs,nameLen)
			Local frames:Int = ReadInt(mfs)
			Local cpw:Int = ReadInt(mfs)
			Local cph:Int = ReadInt(mfs)
		
			Local index:Int = filename.FindLast("/")
			Local path:String = ""
			If index&lt;&gt;-1 Then	path=filename[..index]
			Local TileImage:TImage = LoadAnimImage(path+"/"+name,cpw,cph,0,frames,FILTEREDIMAGE|MASKEDIMAGE)
		
			' create the new map object
			newmap = LayeredTileMap.Create(TileImage,frames,layerCount,mcw,mch,cpw,cph)

			newmap.imageName = name
			newmap.mapTitle = title
			newmap.mapCreator = creator
			newmap.mapLastEdit = edit
			newmap.imageTileCount = frames
		
			' read in layers
			For Local l=0 Until layerCount
				' read layer header
				Local layerid:String = Null
				layerid = ReadString(mfs,6)
				If layerid&lt;&gt;"SASLHD" RuntimeError filename+" is corrupt, unable to locate the SASLHD block for layer "+l+"."
				
				Local px:Int = ReadInt(mfs)
				Local py:Int = ReadInt(mfs)
				newmap.CreateLayer(l,px,py)
			
				' this is a speed optimization, istead of reading each int one at a time
				' we read them in in blocks, much faster but we have to deal with the endian stuff
				' ourselves
				Local temp:Int[] = New Int[mcw]
				Local bptr:Byte Ptr = Varptr temp[0]
				' cell tile index data
				For Local y:Int=0 Until mch
					'FlushMem
					mfs.ReadBytes( bptr,mcw*4 )
					For Local x:Int=0 Until mcw
?BigEndian
						Local t ' only do the byte swapping if on a big endian system, file is little endian
						t=bptr[(x*4)];bptr[(x*4)]=bptr[(x*4)+3];bptr[(x*4)+3]=t
						t=bptr[1];bptr[(x*4)+1]=bptr[(x*4)+2];bptr[(x*4)+2]=t
?
						newmap.layers[l].tiles[x,y]=temp[x]
					Next
				Next
				
				Local btemp:Byte[] = New Byte[mcw]
				bptr = Varptr btemp[0]
				' cell alpha data
				For Local y:Int=0 Until mch
					'FlushMem
					mfs.ReadBytes( bptr,mcw )
					For Local x:Int=0 Until mcw
						newmap.layers[l].alpha[x,y]=btemp[x]
					Next
				Next
			Next
		ElseIf majorVer=1 And minorVer=1
			' read the map header
			Local mapid:String = Null
			mapid = ReadString(mfs,6)
			If mapid&lt;&gt;"SASMHD" RuntimeError filename+" is corrupt, unable to locate the SASMHD block."
			Local titleLen:Int = ReadInt(mfs)
			Local title:String = ReadString(mfs,titleLen)
			Local editLen:Int = ReadInt(mfs)
			Local edit:String = ReadString(mfs,editLen)
			Local creatorLen:Int = ReadInt(mfs)
			Local creator:String = ReadString(mfs,creatorLen)
			Local layerCount:Int = ReadInt(mfs)
			Local mcw:Int = ReadInt(mfs)
			Local mch:Int = ReadInt(mfs)
			
			' Read Tile Image
			Local nameLen:Int = ReadInt(mfs)
			Local name:String = ReadString(mfs,nameLen)
			Local frames:Int = ReadInt(mfs)
			Local cpw:Int = ReadInt(mfs)
			Local cph:Int = ReadInt(mfs)
			Local transRed:Int = ReadInt(mfs)
			Local transGreen:Int = ReadInt(mfs)
			Local transBlue:Int = ReadInt(mfs)
		
			Local index:Int = filename.FindLast("/")
			Local path:String = ""
			If index&lt;&gt;-1 Then	path=filename[..index]
			SetMaskColor(transRed,transGreen,transBlue)
			Local TileImage:TImage = LoadAnimImage(path+"/"+name,cpw,cph,0,frames,FILTEREDIMAGE|MASKEDIMAGE)
		
			' create the new map object
			newmap = LayeredTileMap.Create(TileImage,frames,layerCount,mcw,mch,cpw,cph)

			newmap.imageName = name
			newmap.mapTitle = title
			newmap.mapCreator = creator
			newmap.mapLastEdit = edit
			newmap.imageTileCount = frames
			newmap.imageTransRed = transRed
			newmap.imageTransGreen = transGreen
			newmap.imageTransBlue = transBlue
		
			' read in layers
			For Local l=0 Until layerCount
				' read layer header
				Local layerid:String = Null
				layerid = ReadString(mfs,6)
				If layerid&lt;&gt;"SASLHD" RuntimeError filename+" is corrupt, unable to locate the SASLHD block for layer "+l+"."
				
				Local px:Int = ReadInt(mfs)
				Local py:Int = ReadInt(mfs)
				newmap.CreateLayer(l,px,py)
			
				' this is a speed optimization, istead of reading each int one at a time
				' we read them in in blocks, much faster but we have to deal with the endian stuff
				' ourselves
				Local temp:Int[] = New Int[mcw]
				Local bptr:Byte Ptr = Varptr temp[0]
				' cell tile index data
				For Local y:Int=0 Until mch
					'FlushMem
					mfs.ReadBytes( bptr,mcw*4 )
					For Local x:Int=0 Until mcw
?BigEndian
						Local t ' only do the byte swapping if on a big endian system, file is little endian
						t=bptr[(x*4)];bptr[(x*4)]=bptr[(x*4)+3];bptr[(x*4)+3]=t
						t=bptr[1];bptr[(x*4)+1]=bptr[(x*4)+2];bptr[(x*4)+2]=t
?
						newmap.layers[l].tiles[x,y]=temp[x]
					Next
				Next
					
				Local btemp:Byte[] = New Byte[mcw]
				bptr = Varptr btemp[0]
				' cell alpha data
				For Local y:Int=0 Until mch
					'FlushMem
					mfs.ReadBytes( bptr,mcw )
					For Local x:Int=0 Until mcw
						newmap.layers[l].alpha[x,y]=btemp[x]
					Next
				Next
			Next
		Else
			 RuntimeError filename+" has an unknown version of "+majorVer+"."+minorVer
		EndIf
					
		CloseStream in
		Return newmap
	End Function
	
</textarea><br><br>together they should give you an idea of how to go about it. <br><br></td></tr></table><br>
<a name="613253"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >gellyware</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Scott :) I'm going to go through these now.<br><br>Any other examples anyone? I like a lot of examples. <br><br></td></tr></table><br>
<a name="613259"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> The file format references are all you should need to read these formats like those. <br><br></td></tr></table><br>
<a name="613437"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Beaker</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> You might want to take a look at the bmax source code for loading images:<br>C:\Program Files\BlitzMax\mod\brl.mod\pngloader.mod\pngloader.bmx<br>C:\Program Files\BlitzMax\mod\brl.mod\bmploader.mod\bmploader.bmx<br>etc <br><br></td></tr></table><br>
<a name="613634"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Probably you'll have to write it yourself. As far as I know the jpeg and png loaders are based on external C code. I'd be surprised if anyone has yet written a jpeg or png loader/saver in purely blitzmax code. I'm going to try doing it at some point for my project but not right now. It can be pretty complicated depending on the file format. <br><br></td></tr></table><br>
<a name="613714"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> JPG and GIF are hideously complex formats, mostly thanks to the bizarre compression routines &amp; hash tables.<br><br>I did make a 256 color PCX writer for PowerBASIC 3.x (DOS) 8 years ago, based on the fileformat description from Wotsit. But PCX compression is much easier than JPG, since all it uses is a basic RLE (Run-Length encoding) algorithm, similar to BMP.<br><br>Probably won't be of much use in today's true-color world, but just in case:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
' PB-PCX for PowerBASIC 3.x
' (C) February 1998 | Freeware, by Marc van den Dikkenberg
' <a href="http://www.xlsior.org" target="_blank">http://www.xlsior.org</a>
$LIB ALL -
$DYNAMIC
DEFINT A - Z

TYPE Pcxheader
	Mfg AS BYTE
	Ver AS BYTE
	Enc AS BYTE
	Bpp AS BYTE
	Xmin AS INTEGER
	Ymin AS INTEGER
	Xmax AS INTEGER
	Ymax AS INTEGER
	Hres AS INTEGER
	Vres AS INTEGER
	Pal AS STRING * 48
	Resrv AS BYTE
	Colpl AS BYTE
	Bpl AS INTEGER
	Paltyp AS INTEGER
	Filler AS STRING * 58
END TYPE
DIM Header AS SHARED Pcxheader
DIM Times AS SHARED BYTE
DIM Chunksize AS SHARED WORD
DIM Maxscrnptr AS SHARED WORD
DIM Textofst AS SHARED WORD
DIM Handle AS SHARED INTEGER
DIM Buffer AS SHARED STRING * 32256
Chunksize = 32256

' Screen 13 (320 x 200 x 256)
   ! MOV AX,&amp;H13
	! INT &amp;H10
	DEF SEG=&amp;HA000

' Put some lines on the screen
	for t=0 to 199 step 2
	   poke$ t*320,string$(160,t)
	next t
	Sound 420,.5
	a$=input$(1)

SUB PCXSave(F$)
	header.mfg=10
	header.ver=5
	header.enc=1
	header.bpp=8
	header.xmin=0
	header.ymin=0
	header.xmax=319
	header.ymax=199
	header.hres=300
	header.vres=300
	header.pal=string$(48,0)
	header.Resrv=0
	header.colpl=1
	header.bpl=320
	header.paltyp=1
	header.filler=string$(58,0)

   filhandle=freefile
	open f$ for binary as #filhandle
	put$ #filhandle,header

	DEF SEG=&amp;HA000
	for t=header.YMin to Header.YMax
	   temp$=peek$(t*320+header.XMin,Header.bpl)

' ****************
      poke$ t*320+header.xmin,string$(header.bpl,0)
'     Erase the current line from the screen
' ****************

	   count=0
	   while len(temp$)&gt;0
		   CheckFor$=left$(temp$,1)
		   while left$(temp$,1)=CheckFor$ and count&lt;63
			   count=count+1
	         temp$=mid$(temp$,2)
		   wend
	      if count=1 then
	         if CheckFor$&gt;chr$(191) then
	            put$ #filhandle,chr$(val("&amp;B11000001"))+CheckFor$
	         else
   	         put$ #filhandle,CheckFor$
	         end if
   	   else
      	   temp2$=bin$(count)
	         while len(temp2$)&lt;6
	            temp2$="0"+temp2$
	         wend
		      put$ #filhandle,chr$(val("&amp;B11"+temp2$))+CheckFor$
	      end if
      	count=0
   	wend
	next t
	put$ #filhandle,chr$(12)'						Start of Palette Marker
	OUT &amp;H3C7, 0
	FOR T = 0 TO 255
		R = (INP(&amp;H3C9) * 65280) \ 16128
		G = (INP(&amp;H3C9) * 65280) \ 16128
		B = (INP(&amp;H3C9) * 65280) \ 16128
	   PUT$ #filhandle,chr$(R)
	   PUT$ #filhandle,chr$(G)
	   PUT$ #filhandle,chr$(B)
	NEXT T
	close #filhandle
END SUB

END
</textarea><br><br>Anyway, if you're looking for some source material that you could possibly adapt, I suggest searching around a bit for the old ABC releases ("All Basic Code"). If I recall correctly, it had a bunch of image file readers &amp; writers over the years, mostly written in QuickBASIC. It might be easier to adapt to Blitz than some of the Java/C code? <br><br></td></tr></table><br>
<a name="613852"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> An IFF/ILBM loader/saver is fairly easy to do, if you want something to practice on.<br><br>I agree that some of these formats are hideously complex, I don't think I would even be able to understand all the math involved in jpeg, for example, or to even `get` what all the articles about it are trying to say. Also PNG and GIF are pretty complicated and highly detailed. I still don't understand their compression either.<br><br>That's why people sometimes opt for simple ones like PCX, BMP, IFF, etc<br><br>Or do a direct raw graphics dump ;-D <br><br></td></tr></table><br>
<a name="613949"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> That's why people sometimes opt for simple ones like PCX, BMP, IFF, etc <br></div><br><br>Yup - When I last looked into it, PCX and BMP were the only 'mainstream' formats that looked easy enough to understand for me to tackle...<br>Just looking at the JPG file format description made my head hurt. <br><br></td></tr></table><br>
<a name="613964"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I prefer custom formats.  Keeps most people from messing with my stuff. <br><br></td></tr></table><br>
<a name="614011"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Custom formats are great when you want to keep your info locked up, (like game graphics, etc.) but they won't do you a whole lot of good when you are creating a paint program for example, where you <i>need</i> to be able to read/write other common file formats to interface with the outside world. Not being able to do so would severely limit the usefulness of such an application. <br><br></td></tr></table><br>
<a name="614013"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Custom formats are great when you want to keep your info locked up, (like game graphics, etc.) but they won't do you a whole lot of good when you are creating a paint program for example <br></div><br><br>Well, this <i>is</i> a game programming language, so it's a fair assumption that one is making a game using it.  As for me, I like to make random modules that're neat (mostly so I'm not bored) and then share them.<br><br>Anyhow, that's a different subject. <br><br></td></tr></table><br>
<a name="614166"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> A custom file format can be a good idea if your application has features which you want to store that wouldn't be supported by any other formats, such as photoshop saving a file that preserves all the layers and information etc. Also if your application intends to be successful and widely used, a custom format is a good idea as it will then be adopted by other people to support files of that kind. After all, before photoshop there were no photoshop files.<br><br>I don't think Blitz is necessarily just a game programming language, I think that's just what it is geared towards and is mostly used for. If it were impossible to write anything other than games in it, I would call it a game language. But it's not exclusive. I am also working on something along the lines of a paint program in BlitzMax.<br><br>You could maybe look into using the existing C code of those file loaders and savers, but change them in some way to get access to the data in the way that you want to. Also maybe look around for existing libraries of file-format support that you could translate. <br><br></td></tr></table><br>
<a name="614168"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> BM in its core or GUI working is for 3D at least and not 2D because all drawing etc is in 3D. And have requirements with XXMB 3D cards aren't that good for 2D programs normally ;-)<br>You would need to implement own drivers for GDI+ / WinFX and the Linux / OSX parts to make it really 2D ...<br><br>I would call Blitz (not only BM) a multifunctional media language ... there is more in 3D than just games after all and the best commercial showcase apps for b3d for example weren't games at all ... <br><br></td></tr></table><br>
<a name="614353"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hotcakes</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> An IFF/ILBM loader/saver is fairly easy to do, if you want something to practice on. <br></div><br>Yeh but that would be reinventing the wheel, now =]<br><br>@lucid: Check out the brl.bmploader module.  That's the best basic example of byte-reading a picture file in that there could possibly be. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
