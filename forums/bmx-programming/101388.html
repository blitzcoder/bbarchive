<!DOCTYPE html><html lang="en" ><head ><title >Remove images from memory</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Remove images from memory</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Remove images from memory</a><br><br>
<a name="1203760"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ravl</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I read some topics from the forums about this but I still have some issues/questions.<br><br>My game has 80 scenes, hundreds of objects, 120 additional graphics files and some animations.<br><br>I want to keep a low memory usage, so i am loading the graphics for a scene only when i am entering that scene. I have a class: TScene and only 1 instance of this class is used.<br><br>But for my additional graphics and animations i have separate objects. I observed that while playing the game my memory is going up to 600 mb so I guess that is somethign wrong.<br><br> I am using:<br><br><pre class=code>
imageAdditionalGraphics[x] = null
</pre><br><br>to unload an image.<br><br>Is there another way to do that? <br><br></td></tr></table><br>
<a name="1203761"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I observed that while playing the game my memory is going up to 600 mb so I guess that is somethign wrong. <br></div><br><br>Does it stay there or does it grow infinitely if you keep unloading and reloading scenes?<br><br>Bear in mind that even if you free your resources properly, many programs (especially those with any kind of automatic memory manager like a GC) don't actually give the underlying space back to the OS unless they're forced to do so. BlitzMax could be holding onto it with the expectation that you'll be needing that memory again shortly for the next scene; no point giving it back and immediately requesting it from the system again.<br><br>So if the memory usage stays constant across several scene loads/unloads, there isn't necessarily a bug, it could just be that you're using a lot of space for that scene stuff, and you need to optimise rather than fix.<br><br><br>That said graphics resources normally need to be explicitly freed rather than just GC'd, don't they? (I don't know) <br><br></td></tr></table><br>
<a name="1203764"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ravl</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I just hit 800 in a scene with a lot of animations which is bad.<br><br>If I am going back and forward between 2 simple scenes, the memory usage stays constant.<br><br>Also I have these minigames. I never "unload the images" after finishing them, so I assume I could do that..<br><br>I observed there 2 big issues here.<br>Music (for now i am using only 1 track) and animations.<br><br>Some of my animation are made from 40-50 files (400x200 pixels / file)<br>I assume these one are not the best practice..<br><br>So image = null it's correct to be used in order to free the image, right? <br><br></td></tr></table><br>
<a name="1203787"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> When you null the image, the resources are freed, but not necessarily right away.  As Yasha said, BMax can hang onto the space for quite a while, possibly till the end of the program.  You can try GCCollect() to force the GC to free memory.  It may take multiple calls as GCCollect doesn't seem to collect everything all at once.  Maybe add the below to your program, when memory usage gets large, press the hotkey and see if memory usage drops after a few seconds.<br><pre class=code>If KeyHit(KEY_F1)
    For Local GCLoop:Int = 1 To 3 
        GCCollect()
    Next
End If
</pre> <br><br></td></tr></table><br>
<a name="1203788"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >TomToad</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just had one more thought to consider.  Images tend to be expanded when loading into Blitzmax.  A 100K, 10 frame animated png image can possibly end up being 500K by the time it is loaded into memory.  If you load in enough images, it could possibly be taking up 800 MB even if it only occupies 100MB on your hard drive. <br><br></td></tr></table><br>
<a name="1203794"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Same for music, it gets uncompressed in memory. <br><br></td></tr></table><br>
<a name="1203838"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Ravl</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I made some optimization.<br><br>I had some minigames. After completing them now I free those images, too. Also I am calling the CGCollect after these minigames.<br><br>I played the whole game. Except the scenes with big animation, I have between 300-400 mb.. I think it is ok for now. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
