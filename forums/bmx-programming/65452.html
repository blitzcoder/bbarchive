<!DOCTYPE html><html lang="en" ><head ><title >Why does this work?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Why does this work?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Why does this work?</a><br><br>
<a name="731001"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Leiden</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>
Local i:Float[]
Test(i)
Print i[9999]

Function Test(t:Float Ptr)
	t[9999] = t[9999] + 100
End Function
</pre><br><br>Shouldnt that give a Unhandled Memory Exception? That array (i) should be empty. <br><br></td></tr></table><br>
<a name="731008"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Who was John Galt?</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you running in debug mode? <br><br></td></tr></table><br>
<a name="731014"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Leiden</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know that it gives an error in debug, but its printing the correct value and running fine in release. It doesnt make sense? <br><br></td></tr></table><br>
<a name="731032"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> You haven't told Blitz how big the array should be, all you have is an empty `float array pointer` with no data space defined. It's an empty array with no space to store anything, as if i:Float[0] or i=Null<br><br>Local i:Float[10000]<br><br>for example should remove the error<br><br>Or add a line:<br><br>i=i[..10000]<br><br>which creates a new i array and then the old i float ptr becomes garbage <br><br></td></tr></table><br>
<a name="731039"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Leiden</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know that its an empty array, I'm just wondering why I'm able to index outside of its bounds in release mode. If its a null array and I'm setting t[9999] (non-existant reference) to 100 and its then returning 100 from the non-existant index, well... that doesn't make sense :/<br><br>t[9999] presumably has no memory allocated, so how is 100 getting stored? Why is 100 being printed? Shouldnt it crash? <br><br></td></tr></table><br>
<a name="731049"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SculptureOfSoul</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I noticed a problem similar..well, related perhaps... to this a while back when I was whipping up a tile engine. In debug mode the game would crash when walking off the edge of the map, and in release it was wrapping around to the other side of the array (only when exiting the map vertically though, strangely enough)<br><br>Of course, that was an older version of Blitzmax. <br><br></td></tr></table><br>
<a name="731051"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brendane</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> The debug version has bounds checking built in. The release version does not. <br><br>The code Local i:Float[] <br>creates an array object and assigns it with the 'empty array' (an internal global empty array object - this exists as a static object in memory).<br><br>Now, if you read values from this array they are indexed from this empty array's address... anything which follows it in memory may or may not be a valid address for the process. If it is, you get the value at the address - if not you will get an access violation exception. <br><br></td></tr></table><br>
<a name="731055"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Leiden</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah ok, so Max has a built in empty array that it just assigns the i:float[] to point to until it is constructed?<br><br>I tried the same thing in C++ and it gave me "i : unknown size". Thats in release. I would prefer it if Max did check bounds in release -- but there must be a good reason it doesnt. <br><br></td></tr></table><br>
<a name="731068"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> In release you are taking away the checking by not doing debug mode. Thats the whole point, you should use debug to check for bugs like this and then release mode when you're sure YOUR code is safe.<br><br>In the past writing to an undefined offset in an empty array would've written somewhere in memory and caused a crash. <br><br></td></tr></table><br>
<a name="731071"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Leiden</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <img src="http://img382.imageshack.us/img382/3493/picer3.png"><br><br>So to acurately describe what is happening above, say, Orange is my actual array and size, lets say one byte. Green is free memory that currently isnt being allocated anywhere. Red is memory that has been allocated by some other program, or some other variable in the program.<br><br>So is it correct to say, if I write outside of the arrays index, to a green area of memory, it would still function as if the array was large enough to have that variable in index, provided the program doesnt assign some data to that area as it doesnt know its being referenced. But if I went and tried to write data to the array that happened to be in the red area, that would give me an Unhandled Memory Exception right? <br><br></td></tr></table><br>
<a name="731076"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brendane</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> In Windows at least, every process has it's own address space. This is accomplished by virtual memory, every process can (theoretically) use all 4gb of addressable memory (in a 32bit system). The windows memory manager handles the mapping of the virtual addresses to physical addresses as and when those memory addresses are required to be accessed. (using the swap file)<br><br>That said, in your diagram the red blocks wouldn't exist (because every process has no knowledge of the virtual addresses allocated by another process, nor does it care).<br><br>It is correct to say that some memory is allocated to your process (the exe itself and all it's data areas are mapped in), the process itself has thread storage areas, it's own process heap, and dynamically allocated memory etc etc. <br><br>To answer your question, any memory *allocated* to your application can be accessed (in your case, the exe contains a data section containing the emptyarray which is simply mapped into virtual memory - ie allocated to your process). <br><br>If you read/write to any unallocated area, or write to an allocated but readonly area you will get an access violation. <br><br></td></tr></table><br>
<a name="731082"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Leiden</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> So I can write in memory allocated to my program? That said, Say the diagram is the total memory allocated to my program, green blocks are free memory space, orange is occupied with my array, and red is allocated to some other variables. Now, in my program, can I write outside of my arrays bounds (a single block in this case) and into the green blocks, not legally, but is this the case of whats happening when I am able to read/write to 't[9999]'. That said, I can continue to write to my array until I reach a allocated block (red) then it will MAV? <br><br></td></tr></table><br>
<a name="731112"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Perhaps it MAVs, perhaps not. But your data will for nearly sure be bogus, because you have to know why you do such trash in your code, not Windows.<br>Which means: don't write on references you haven't initialized or be aware that you are doing something highly critical (and stupid)<br><br>Windows will throw a MAV if you try to access / modify data that does not exist (after file load) or which you aren't allowed to access (kernel memory and protected memory, as well as trying to access your apps code in memory which is forbidden as well)<br><br>As mentioned above: Use debug mode, this will show you all errors.<br>And step back from using Ptr within BM. They exist, but they are not the prefFered nor the stable way of using BM. References are similar to pointers, but they are type safe and managed and thus will never lead to problems like the one were are actually talking about here.<br>Thats something thats more or less a C++ hacker problem (hacker because one thats programs this way in C++ can't be seen as a programmer even on noobish level) <br><br></td></tr></table><br>
<a name="731122"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I would prefer it if Max did check bounds in release -- but there must be a good reason it doesnt. <br></div>Speed. <br><br></td></tr></table><br>
<a name="731163"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you want debug checks, do all your calls in Try - Catch blocks ... that way at least some errors will throw something catchable ... but you will lose quite some speed.<br><br>And no, Array and Loops won't fire errors there, as their debug modules are not compiled into the release version (which means, theoretically you could check if you can add it through manual import) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
