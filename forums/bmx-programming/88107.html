<!DOCTYPE html><html lang="en" ><head ><title >BufferedGLMax2D</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >BufferedGLMax2D</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >BufferedGLMax2D</a><br><br>
<a name="1000051"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> <b><a href="http://github.com/nilium/cower.bufferedglmax2d" target="_blank">BufferedGLMax2D</a></b> is my Max2D implementation that crams data into vertex arrays and then draws using those.  Nothing is drawn until either Flip or GrabPixmap is called (the latter is not implemented).  I don't currently have speed tests, I don't know yet if this implementation is faster than Brl.GlMax2D.  I should hope it is, especially when dealing with rendering complex scenes, but that has yet to be seen.  There's no glBegin/glEnd in sight.  The module also <b>requires <a href="http://github.com/nilium/cower.renderbuffer" target="_blank">cower.renderbuffer</a></b>, since I've decided to split the code for that off into a new project, so grab that too.<br><br>So far, most of the driver is implemented, there are still a few things left out - DrawOval, GrabPixmap, DrawPixmap - mostly the useless functions that I don't care about.  Comments are few and far inbetween and cryptic if not completely nonsensical.<br><br>The module should be able to replace GLMax2D for most uses right now… unless you happen to use DrawOval or GrabPixmap, in which case you should re-evaluate your life decisions if it came to that.  I haven't personally encountered any bugs in testing it, I have no doubt there are bugs, it's probably not thread-safe and I have no intention of making it thread-safe because it's all inherently unsafe in the first place.<br><br>So, if you griped about GLMax2D's use of glBegin/glEnd or anything else, do hack on BufferedGLMax2D.  It's open source under the MIT license, it's on Github so you can easily fork it and contribute however you may.  However, the difference between this and GLMax2D is you can make changes and they will get added to the code if I think they're good enough.  So, if you start whining about how this doesn't have something or other and it's within your ability to change that and you don't, I will personally add clauses to the license to restrict your use of the module.<br><br>This post feels so disorganized.<br><br><b>By the way, if you find a bug and can't fix it, but can reproduce it</b> please add an issue to the project on github.  It doesn't take long, it's free, etc.  Keeping the issues on the project page lets me mark issues complete when making commits and gives me a way to keep discussion of each individual issue separate from another, making it a heck of a lot easier to parse any information about a problem.  As usual, include operating system, graphics chipset, and if possible whether your GPU has discrete video memory or if it's shared with system memory (this tends to not affect anything, but just to be safe).<br><br><i>Note:</i> This isn't a modified GLMax2D - do not move it to Module Tweaks.  Cheers.  Oh, and this isn't really a showcase thing, so don't move it there either - it's incomplete, this is more of a "look at this, please contribute" sort of deal. <br><br></td></tr></table><br>
<a name="1000059"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nate the Great</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> :( my internet has been acting up lately, I get an "This page has become unresponsive" error :/ <br><br></td></tr></table><br>
<a name="1000061"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Works fine for me, and my connection is about on par with a 14.4kbit/s modem right now. <br><br></td></tr></table><br>
<a name="1000064"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nate the Great</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> well mine is like 1 or 2 mbps so idk :/ do I need git to see it? could that be my problem? regardless sounds interesting. <br><br></td></tr></table><br>
<a name="1000066"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pete Rigz</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> hmm, very interesting :) will give this a proper look tomorrow, I didn't get very far with a very quick test:<br><br><pre class=code>
SuperStrict

Import cower.bufferedglmax2d

SetGraphicsDriver BufferedGLMax2DDriver()

Graphics 800, 600

Cls

Flip

WaitKey()
</pre><br><br>It throws an EXCEPTION_ACCESS_VIOLATION and highlights line 157 of the module:<br><br><pre class=code>
state.Bind()
</pre><br><br>I have an nVidia 8800gt running windows 7 64bit. Looking forward to trying this out in more detail with TimelineFX. <br><br></td></tr></table><br>
<a name="1000071"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Unusually, but it seems my use of an array of callbacks has really, really pissed off BlitzMax.  Might be a bug with the compiled code, who knows.  Either way, it seems the address of the state variable was being changed - how the heck that works is beyond me, but whatever, I have a reasonable idea of how to fix it now. <br><br></td></tr></table><br>
<a name="1000072"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dmaz</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I did the same thing a long while back and found the speed gains negligible in the tests I did.  my hope that older drivers and hardware would show larger gains but that didn't materialize.  Now, some people swear that this should give you large gains... maybe that would be the case with tens of thousands of vertexes?  I got the greatest speed gain (for 2d)from keeping texture swapping to a minimum.<br><br>more power to you though as I hope I just did something incorrectly. <br><br></td></tr></table><br>
<a name="1000074"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Fixed the above bug to the best of my knowledge.  Dinner is in order.<br><br><div class="quote"> more power to you though as I hope I just did something incorrectly. <br></div>Considering most folks using BlitzMax are making corny little match-3 games (or whatever the trend is now), I expect any speed gain would be negligible.  The most gain would probably be with heavy use of particle systems and other effects where you'll probably render the same image many, many times over per frame, allowing you to have minimal state change and probably some gain by batch-rendering all of the particles at once.<br><br>The main benefit this module gives me is that the renderer is a lot more flexible in some respects than the existing GLMax2D implementation.  I can render 3D objects, complex shapes, just about anything I want without worrying too much about screwing up state because I can go through the TRenderBuffer object (if I make it public).  It makes some of the work I'm doing in my spare time a lot easier as a result (the render buffer stuff was from a previous project and was a lot simpler back then, but the way it works hasn't changed that much). <br><br></td></tr></table><br>
<a name="1000076"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DavidDC</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sounds great Noel, thanks for making it available. <br><br></td></tr></table><br>
<a name="1000079"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nate the Great</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> The most gain would probably be with heavy use of particle systems and other effects  <br></div><br><br>thats where I need the most speed! in my game flood, it displays 3000 particles sometimes and it takes several millisecs of precious cpu time with max2d... would be interesting to do a speed test to prove yours is faster <br><br></td></tr></table><br>
<a name="1000080"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you get around to testing it, I'd be interested to see how that turns out.  It might be feasible to have a certain threshold where the renderer switches over to vertex buffer objects instead of vertex arrays as well, possibly gaining more speed... but then I don't think you'd really see much of a speed increase in doing that. <br><br></td></tr></table><br>
<a name="1000083"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nate the Great</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> If you get around to testing it, I'd be interested to see how that turns out. It might be feasible to have a certain threshold where the renderer switches over to vertex buffer objects instead of vertex arrays as well, possibly gaining more speed... but then I don't think you'd really see much of a speed increase in doing that. <br> <br></div><br><br>its kinda hard when that page wont load ;p<br><br>but when it does ill definitely try. <br><br></td></tr></table><br>
<a name="1000086"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah, far as I can tell you're the only one having problems seeing it. <br><br></td></tr></table><br>
<a name="1000087"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nate the Great</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ill try safari...<br><br>edit: works in safari! stupid google chrome addon I didnt know about was giving an error on firefox and ie... how on earth did it get there? idk <br><br></td></tr></table><br>
<a name="1000088"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's... bizarre.  I didn't know Chrome could use addons yet - the Mac version has them hidden for now. <br><br></td></tr></table><br>
<a name="1000089"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nate the Great</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> impressive but im a little confused as to how to use it, a short example would be great and I dont know how navigate github :/<br><br>edit: no I wasnt using addons in chrome, it was something that made sites that only work for chrome work for ie and firefox so I can stick with 2 browsers lol <br><br></td></tr></table><br>
<a name="1000090"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Click the "download" button next to the project name, grab zip file, extract source code in BlitzMax/mod/cower.mod/bufferedglmax2d.mod, run 'bmk makemods cower.bufferedglmax2d', and in your code import the module and call "SetGraphicsDriver(BufferedGLMax2DDriver())". <br><br></td></tr></table><br>
<a name="1000093"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nate the Great</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> so can I just use the draw image and all those commands as normal after I do that? <br><br></td></tr></table><br>
<a name="1000094"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes.  It's just a Max2D driver, not a new API. <br><br></td></tr></table><br>
<a name="1000101"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting. <br><br></td></tr></table><br>
<a name="1000102"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tommo</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> A real time texture packer can help speed up max2d too, especially DrawText with imagefont.<br><br>I use a binary tree structure for this, it looks like this:<br><img src="http://www.indie-g.com/files/screenshots/tex/tree.png"><br><br>And the generated texture is like this (9 textures(256x256) generated):<br><img src="http://www.indie-g.com/files/screenshots/tex/test.jpg"><br><br>Because you don't have a unlimited single texture, so a texture pack group is used.<br>When you add a new texture, it will try insert the texture into available packs (older first, to reduce space wasting), if no space in all packs, a new texture pack will get created.<br><br>I've integrated this into my customed GLMax2D driver. It works fine so far. <br><br></td></tr></table><br>
<a name="1000105"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's too intelligent for me.  I'll let someone else concern themselves with hacking that in.<br><br>Edit: Ok, just fiddled around with packing - it's simple if you don't try to do anything intelligent.  Would work well enough for reducing the creation of multiple textures where possible. <br><br></td></tr></table><br>
<a name="1000114"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> Please create a benchmark test, drawing 2000 tiles (or allowing the user to press a key to add more, etc, etc.) in each version so we can see if there is any speed increase. Thanks for taking this on, this is the test alot of us would love to see running...once and for all. ;) <br><br></td></tr></table><br>
<a name="1000117"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> What's stopping you from writing the test? <br><br></td></tr></table><br>
<a name="1000118"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sounds pretty cool, I throw around a lot of particles in my "corny little match-3 games" so a faster render is always welcome.  It would be neat to have some nice buffering like this in DX9 too. <br><br></td></tr></table><br>
<a name="1000126"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tommo</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Would work well enough for reducing the creation of multiple textures where possible. <br></div><br><br>And it also uses less memory than plain max2d images.<br>The only drawback is that you can't use GL_REPEAT flag with packed texture, but I think there's no problem for max2d.<br><br>Here is the code of the tree I'm using.<br>You can use sNode.draw()(it's commented out) to see the result visually.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Strict

Module tommo.stree

Import brl.linkedlist

Type sNode
	GLOBAL EDGE_TOLERENCE = 10
	function setEdgeTolerence(t:Int)
		EDGE_TOLERENCE = t
	End Function
	
	Field parent:sNode
	Field x:Float, y:Float
	Field w:Float, h:Float
	Field dia:Float
	
	Field childA:sNode
	Field childB:sNode
	
	Field isSplited
	
	Field rotated:Int
	Field childOccupied:Int
	Field isOccupied:Int
	
	Method init(x:Float, y:Float, w:Float, h:Float)
		Self.w = w
		Self.h = h
		Self.x = x
		Self.y = y
		dia = w * w + h * h
	End Method
	
	Method splitH:sNode(splitW)
		
		If splitW &gt; w Return Null
		If splitW = w Return Self
			
		
		Assert Not isSplited
		
		childA = New sNode
		childA.init(Self.x, Self.y, splitW, h)
		childA.parent = Self
		
		Local ww = w - splitW
		childB = New sNode
		childB.init(Self.x + splitW, Self.y, ww, h)
		childB.parent = Self
		
		If ww &lt; EDGE_TOLERENCE
			childB.isOccupied = 3
		End If
		
		isSplited = True
		Return childA
	End Method
	
	Method splitV:sNode(splitH)
		If splitH &gt; H Return Null
		If splitH = h Return Self
		
		Assert Not isSplited
		
		childA = New sNode
		childA.init(Self.x, Self.y, w, splitH)
		childA.parent = Self
		
		childB = New sNode
		Local hh = h - splith
		
		childB.init(Self.x, Self.y + splitH, w, hh)
		childB.parent = Self
		If hh &lt; EDGE_TOLERENCE
			childB.isOccupied = 3
		End If
		
		isSplited = True
		Return childA
	End Method
	
	Method updateChildOccupied()
		If issplited
			Local i = childA.isOccupied + childB.isOccupied
			Select i
			Case 2, 4
				Self.setOccupied(True)
				
			Case 0, 3
				Self.isSplited = False
				Self.setOccupied(False)
				
			Case 1
				Self.setOccupied(False)
				
			EndSelect
		End If
	End Method
	
	Method setOccupied(s:Int = True)
		If isOccupied = s Return
		isOccupied = s
		If Not parent Return
		parent.updateChildOccupied()
	End Method
	
	Method similar:Float(w:Int, H:Int)
		Local p:Float
		If Self.w = w
			p = w
		End If
		Return p
	End Method
	
	Method findNode:sNode(w:Int, h:Int)
		If Self.isOccupied Return Null
		If Not (Self.w &gt;= w And Self.h &gt;= h) Return Null
		
		If isSplited
			Local n1:sNode = childA.findNode(w, h)
			Local n2:sNode = childB.findNode(w, h)
			
			If n1 And n2
				If n1.dia &lt; n2.dia
					Return n1
				Else
					Return n2
				EndIf
			EndIf
			
			If n1 Return n1
			If n2 Return n2
			
		Else
			Return Self
		EndIf
		
		Return Null
	End Method
	
'	Method draw()
'	
'		If isOccupied
'			If rotated
'				SetColor(0, 255, 0)
'			Else
'				SetColor(255, 0, 0)
'			EndIf
'			SetAlpha(0.5)
'			
'			If isOccupied = 3
'				SetColor(0, 0, 255)
'			End If
'			
'			DrawRect(x, y, w, h)
'		EndIf
'		
'		SetColor(255, 255, 255)
'		SetAlpha(0.5)
'		drawBox(x, y, x + w, y + h)
'		
'		If isSplited
'			childA.draw()
'			childB.draw()
'		End If
'		
'		Function drawBox(x1, y1, x2, y2)
'			DrawLine(x1, y1, x2, y1)
'			DrawLine(x2, y1, x2, y2)
'			DrawLine(x2, y2, x1, y2)
'			DrawLine(x1, y2, x1, y1)
'		End Function
'	End Method
	
End Type

Type sTree
	Field root:sNode
	Field occupiedNodes:TList = New TList
	Field w:Int, h:Int
	Method insert:sNode(w:Int, h:Int, allowRotate:Int = True)
		
		Local N:sNode = root.findNode(w, h)
  	Local n1:sNode
		Local rot:Int
		
		If allowRotate And w &lt;&gt; h
			n1 = root.findNode(h, w)
		  If n1
				If (n And (n1.dia &lt; n.dia)) Or (Not n)
				 	n = n1
					Local c = w
					w = h
					h = c
					rot = True
				EndIf
			EndIf
		End If
		
		If n
			If n.w &gt; n.h
				n = n.splitH(w)
				n = n.splitV(h)
			Else
				n = n.splitV(h)
				n = n.splitH(w)
			EndIf
			
			n.setOccupied(True)
			occupiednodes.AddFirst(n)
			If rot n.rotated = True
			Return n
		EndIf
		
		Return Null
	End Method
	
	Method init(w:Int, h:Int)
		Self.w = w
		Self.h = h
		Self.clear()

	End Method
	
	Method clear()
		root = New sNode
		root.init(0, 0, w, h)
		occupiednodes = New TList
	End Method
	
	Method reinsert()
		Function compare:Int(n1:Object, n2:Object)
			Local a1:Float = sNode(n1).dia
			Local a2:Float = sNode(n2).dia
			If a1 &gt; a2 Return 1
			If a1 &lt; a2 Return - 1
			Return 0
		End Function
		Local l:TList = occupiednodes
		
		l.Sort(False, compare)
		
		Self.clear()
		
		For Local n:sNode = EachIn l
			If n.rotated Self.insert(n.h, n.w) Else Self.insert(n.w, n.h)
		Next
	End Method
End Type
</textarea><br><br>Sorry for lacking of comment.:) <br><br></td></tr></table><br>
<a name="1000134"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looks sort of similar to the code I just put together to test stuff:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">Strict

'Import Cower.BufferedGLMax2D
'SetGraphicsDriver(BufferedGLMax2DDriver())

Function Swap(A% Var, B%Var)
	Local C% = A
	A = B
	B = C
End Function

Type Pack
	Field width:Int, height:Int
	Field filled:Int = False
	Field right:Pack
	Field bottom:Pack
	Field parent:Pack
	Field cr%,cg%,cb%
	
	Method New()
		cr = Rand(128,255)
		cg = Rand(128,255)
		cb = Rand(128,255)
	End Method
	
	Method GetHeight:Int()
		Local h:Int
		Local i:Pack = Self
		While i
			h :+ i.height
			i = i.bottom
		Wend
		Return h
	End Method
	
	Method GetWidth:Int()
		Local w:Int
		Local i:Pack = Self
		While i
			w :+ i.width
			i = i.right
		Wend
		Return w
	End Method
	
	Method Area%()
		Return width*height
	End Method
	
	Method Root:Pack()
		Local r:Pack = Self
		While r.parent
			r = r.parent
		Wend
		Return r
	End Method
	
	Method Fill%(w%, h%)
		If filled Then
			Local r:Int = False
			If right And bottom Then
				Local ra:Int, ba:Int
				ra = right.Area()
				ba = bottom.Area()
				
				If ra &lt; ba Or bottom.width = w Then
					r = bottom.Fill(w,h)
					If Not r Then r = right.Fill(w,h)
				Else
					r = right.Fill(w, h)
					If Not r Then r = bottom.Fill(w, h)
				EndIf
			ElseIf right
				r = right.Fill(w,h)
			ElseIf bottom
				r = bottom.Fill(w,h)
			EndIf
			Return r
		EndIf
		
		If width &lt; w Or height &lt; h Then
			Return False
		EndIf
		
		right = New Pack
		bottom = New Pack
		If height-h &lt; width-w Then
			right.width = width-w
			right.height = height
			bottom.width = w
			bottom.height = height-h
		Else
			right.width = width-w
			right.height = h
			bottom.width = width
			bottom.height = height-h
		EndIf
		
		If right.width = 0 Or right.height = 0 Then
			right = Null
		Else
			right.parent = Self
		EndIf
		
		If bottom.width = 0 Or bottom.height = 0 Then
			bottom = Null
		Else
			bottom.parent = Self
		EndIf
		
		width = w
		height = h
		filled = True
		
		Return True
	End Method
	
	Method XY%(x% Var, y% Var)
		Local p:Pack = parent
		Local lp:Pack = Self
		x = 0
		y = 0
		While p
			If p.right = lp Then
				x :+ p.width
			Else
				y :+ p.height
			EndIf
			lp = p
			p = p.parent
		Wend
	End Method
End Type

Local p:Pack = New Pack

Graphics 800, 600, 0, 0

p.width = GraphicsWidth()
p.height = GraphicsHeight()

Local misses:Int = 100
Local t:Int = Millisecs()

Function DrawAndRecurse(x%, y%, p:Pack)
	If Not p Then Return
	
	SetBlend(AlphaBlend)
	
	SetAlpha(.8)
	If p.filled Then
		SetColor(p.cr, p.cg, p.cb)
	Else
		SetColor(32,32,32)
	EndIf
	DrawRect(x, y, p.width, p.height)
	
	SetColor(255, 255, 255)
	SetAlpha(1)
	DrawLine(x,y, x+p.width,y)
	DrawLine(x+p.width,y, x+p.width,y+p.height)
	DrawLine(x,y+p.height, x+p.width,y+p.height)
	DrawLine(x,y, x,y+p.height)
	
	DrawAndRecurse(x+p.width, y, p.right)
	DrawAndRecurse(x, y+p.height, p.bottom)
End Function

Local go:Int = False

'buildopt:gui
While Not AppTerminate()
	Cls
	
	go = go Or KeyHit(KEY_SPACE)
	
	DrawAndRecurse(0, 0, p)
	If Millisecs()-t &gt; 25 And go Then
		p.Fill(2^Rand(4,7), 2^Rand(4,7))
		t = Millisecs()
	EndIf
	
	Flip
Wend
</textarea><br>(Press space)<br><br>Mine's not pretty code, nor even immediately useful, but it gives me a decent idea of how to go about doing it.  I like the rotation bit in your code, that's not something I'd considered, so I'll probably borrow that idea. <br><br></td></tr></table><br>
<a name="1000139"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tommo</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looks neat. :)<br><br>If you plan to go with non 2^n sized texture, you'd better set a minimal split size (like EDGE_TOLERENCE in my code). To abandon the areas (by mark it as used) which are too small can save a lot of searching time, because these small pieces are always located very deep in the tree. <br><br></td></tr></table><br>
<a name="1000143"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> "What's stopping you from writing the test? "<br><br>If I was the author of the module, I would make available a benchmark so developers could see any potential benefit before taking the time to download, code, test, retest, etc. <br><br></td></tr></table><br>
<a name="1000146"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> So, what's stopping you?  If I were the author, and I am, and I wouldn't be interested in writing benchmarks when I've got the module itself to work on - you can see above there's still work to do, including the possible addition of packing multiple images into single textures.<br><br>Benchmarks seem to interest you.  How about you write the benchmarks?  You should be able to write a working one with current Max2D implementations and use it with this as well to determine whether or not something is implemented properly and if there's a speed benefit.<br><br>My point is that this is a free and open-source implementation and something I am currently doing alone.  If you want something that is not currently in my list of goals, and benchmarks/example code (I'm not sure what example code anyone would want though - there is only one function of interest) are not.  Like I say in the initial post, hack it yourself and I'll look at adding any patches submitted.  See a typo in the code and fix it?  Send me a patch, I'll check it, add it if it passes.  Want to add comments around the code?  Send patch, I check, I add if it passes.<br><br>Want to add a benchmarks/ directory to the module?  Go on github, fork the module, make your changes/additions, and send me a pull request so I know to look.  Hopefully I've made it abundantly clear that if you want something and I'm not working on that, you should be doing it yourself for the benefit of you and everyone else. <br><br></td></tr></table><br>
<a name="1000171"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> Isn't the entire idea of your project based on one possible statistic which is "increased performance"? I would think a benchmark would be your first order of business.<br><br>And I'll be the first to say "wow...hell yah..thank you..where's the tip jar" if the end result is stable and improves graphics rendering performance.<br><br>So yah...get a benchmark going that proves your tech, and you'll probably be the envy of the entire forum! And if you don't realize it, this is one of the forum's most anticipated requests so fingers are crossed you pull it off! ;) <br><br></td></tr></table><br>
<a name="1000180"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >slenkar</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> any chance of a setimagevertices command? to position image vertices?<br><br>Ill put it in myself if I can, but I thought id ask first if its a simple job for you. <br><br></td></tr></table><br>
<a name="1000181"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> If I was the author of the module ... <br></div><br><br>Ah, but Noel is.<br>Do you really want to be walking down that dark path?<br><br>Best to just leave it and move on, MGE... :-) <br><br></td></tr></table><br>
<a name="1000215"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Isn't the entire idea of your project based on one possible statistic which is "increased performance"? <br></div><br>Quoting myself:<br><div class="quote"> The main benefit this module gives me is that the renderer is a lot more flexible in some respects than the existing GLMax2D implementation. <br></div><br><br>So no, you go get a benchmark going and you'll probably be the envy of the entire forum (that sounds like a horrible punishment). <br><br></td></tr></table><br>
<a name="1000227"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think I probably would include a demo/test also. Nilium your posts sound kind of bitter. I'm not sure why you're sharing this with the public because what you've said has undertones of not really caring about what's important to other people. Your initial post almost sounds like `here, figure it out yourselves, it's your fault if it doesn't work`. I agree with MGE that if you're going to offer something helpful to people it would be further helpful to make it easier for them to know if it's worth using, rather than like `bite me`.<br><br>On another note I have found that vertex arrays can be twice as fast as immediate mode rendering when you're doing a larger number of objects, and especially when you're doing lots of particles. But it seems to depend on the gpu/driver. <br><br></td></tr></table><br>
<a name="1000235"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> No thanks, I don't have time either. Perhaps someone else will take the time to download, install, compile your code, test, create a benchmark test so we can all see how it performs. <br><br></td></tr></table><br>
<a name="1000250"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I think I probably would include a demo/test also. <br></div>Here's a demo/test:<br><pre class=code>Import Cower.BufferedGLMax2D
SetGraphicsDriver(BufferedGLMax2DDriver())</pre><br>Put it in your code, see if it works, test/demo complete.  This isn't a new API, it's a Max2D implementation, you don't need demos to see what this does, because nothing will visibly change (unless you use DrawOval/GrabPixmap/DrawPixmap).<br><br><div class="quote"> Nilium your posts sound kind of bitter. <br></div>Frustrated would be better.  The code is open source for the purpose of being able to modify it and contribute to it.  MGE wants something (benchmarks), which isn't what I'm interested in doing, so I ask why he won't do them.  The code is there, you want a change?  Make it.  You want a test?  Write it.<br><br>What I would like to see is all the people requesting something they think will make everything better and help others to make an effort to actually do it themselves.  Don't just sit on your hands and go "this sure sounds like a nice idea."<br><br><div class="quote"> I'm not sure why you're sharing this with the public because what you've said has undertones of not really caring about what's important to other people. <br></div>I care about what's important to other people, but I would like much more to see people help themselves.  The code's open source for a reason, I want to see people working to improve things and sharing those changes openly to benefit everyone else, as I've tried to do in releasing the code for the module.  It's not that I'm going to go "bite me" to people who want something, but I don't want to just be the suggestion box that everyone lines up to and goes "I want shaders" or "I want benchmarks."  The code is <i>right there</i>, go do it!  You're programmers for Christ's sake, what's stopping you?<br><br>After you've decided that you're capable of doing something and start writing code and making changes, I will come in and help.  I'm not just saying "you're on your own," ask questions about what something does if you need to, if something seems to not work, mention it and maybe file an issue.  This is a work in progress, so the <i>main point</i> I'm trying to get across is that I want to see open-source work in this community (I'm an idealist, I would like to believe that you would sacrifice your time for the benefit of others).  I don't want to be the only one writing code while everyone else does nothing while expecting everything. <br><br></td></tr></table><br>
<a name="1000258"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I don't want to be the only one writing code while everyone else does nothing while expecting everything. <br></div><br>But I like sitting on my hands, doing nothing.<br><br>btw, you aren't doing yourself any favours :-)<br>I'd suggest you might want to market yourself a little differently, but I know, you're a programmer, for Christ's sake, it's not your job to market yourself. :-p<br><br>Just say something like, "Well, I'm busy at the moment, but you can simply try it out by dropping it in place of the usual module, and give it a go. Let me know if you see any improvements."<br><br>Alienating the potential audience may not be what you really want? or perhaps it is... :-) <br><br></td></tr></table><br>
<a name="1000277"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GaryV</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> Noel:  No good deed goes unpunished ;) <br><br></td></tr></table><br>
<a name="1000305"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >theHand</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> Improvements are always welcome; that's just their way of saying thank you.  Open source! :) <br><br></td></tr></table><br>
<a name="1000308"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pete Rigz</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> All working fine now here! Here's an extremely crude bench test thingy:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SuperStrict

Import cower.bufferedglmax2d

SetGraphicsDriver BufferedGLMax2DDriver()
'SetGraphicsDriver GLMax2DDriver()
'SetGraphicsDriver D3D7Max2DDriver()
'SetGraphicsDriver D3D9Max2DDriver()

Graphics 800, 600

Local pixmap:TPixmap = CreatePixmap(128, 128, PF_RGBA8888)
For Local x:Int = 0 To pixmap.width - 1
	For Local y:Int = 0 To pixmap.height - 1
		WritePixel(pixmap, x, y, (255 Shl 24) | (x Shl 16) | (y + 128 Shl 8) | x + y)
	Next
Next

Local image:TImage = LoadImage(pixmap)

Global FPSLASTUPDATETIME:Int
Local time:Int = MilliSecs()

SetBlend ALPHABLEND

While Not KeyDown(KEY_ESCAPE)
	Cls
	For Local c:Int = 1 To 10000
		SetScale 0.1, 0.1
		SetAlpha 0.75
		DrawImage(image, Rnd(GraphicsWidth()), Rnd(GraphicsHeight()))
	Next
	
	time = MilliSecs()
	SetScale 2, 2
	
	DrawText "FPS: " + FPS(), 0, 0
	
	Flip 0
	FPSLASTUPDATETIME = FPSLASTUPDATETIME + (MilliSecs() - time)
Wend

Function FPS:Float(frequency:Int = 200)
	Global FPSFRAMECOUNT:Int
	Global FPSLASTCOUNT:Float
	Local time:Int = MilliSecs()
	FPSFRAMECOUNT=FPSFRAMECOUNT+1
	Local elapsed:Float = time - FPSLASTUPDATETIME
	If elapsed&gt;=frequency
		FPSLASTCOUNT=FPSFRAMECOUNT/elapsed*1000.0
		FPSFRAMECOUNT=0
		FPSLASTUPDATETIME=time
	EndIf
	Return FPSLASTCOUNT
End Function 
</textarea><br><br>rem out the drivers as necessary. Not the greatest test by any stretch of the imagination but gives a rough idea :). I got:<br><br>BufferedGLMax2DDriver(): 100fps<br>GLMax2DDriver()        : 160fps<br>D3D7Max2DDriver()      : 83fps<br>D3D9Max2DDriver()      : 137fps<br><br>brl.gl still fastest for me, it will be interesting if this can be optimised further, as it seems to me that vertex arrays would be faster in theory. Admittedly though, my knowledge of opengl has a lot of holes :) <br><br></td></tr></table><br>
<a name="1000325"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#42">[#42]</a></td></tr></table></td></tr><tr ><td class="posttext"> Using Pete Rigz code:<br>BGLM2D: ~95fps<br>GLM2D: ~51fps<br>D3D7: ~37fps<br>D3D9: ~37fps <br><br></td></tr></table><br>
<a name="1000330"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#43">[#43]</a></td></tr></table></td></tr><tr ><td class="posttext"> I managed to get a 100fps speed increase over GLMax2d's count in release mode after making some changes to both modules.  I'll push the commits later once I clean some of the changes up.<br><br>Debug mode suffers, however, at 20fps less than GLMax2D.  Not sure why, but I'm willing to accept a lower FPS in debug mode if it means performance is improved in release (where it would hopefully count for something). <br><br></td></tr></table><br>
<a name="1000370"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#44">[#44]</a></td></tr></table></td></tr><tr ><td class="posttext"> Some changes pushed that should show a speed increase.  I think the 100fps was lost somewhere and somehow - not sure, but at the very least it's now faster on my system, although only in release mode (I can only guess that mine makes more function/method calls, resulting in more strain coming from the debugger). <br><br></td></tr></table><br>
<a name="1000377"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#45">[#45]</a></td></tr></table></td></tr><tr ><td class="posttext"> The benchmark showed what I've seen back in 1.3.2 days when I created a buffered driver. If the cpu is weak enough so the drivers can't do optimization on the sent data, then the buffered driver is able to perform better.<br>But if the cpu is somewhere current, the buffered driver can only lose as the stuff is handled twice.<br>Potentially important to mention that I'm on an NVIDIA card and current drivers ( win7 x64, card is a gtx280, just to give others the possibility to estimate performance of cards inbetween)<br>But you did a great job on this module :)<br>Will later edit in benchmarks from osx where the drivers are known to be a magnitude crappier and see what impact it has.<br><br>BGLM2D: ~333FPS<br>GLM2d: ~375FPS<br>D3D7: ~135FPS<br>D3D9: ~230FPS<br><br><br>Here are also numbers for the updated benchmark below that does not try to kill the driver with the state settings in the 10000 draw loop, which shows that the driver is only one component in performant rendering.<br><br>BGLM2D: ~475FPS<br>GLM2d: ~545FPS<br>D3D7: ~170FPS<br>D3D9: ~230FPS<br><br> <textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">SuperStrict

Import cower.bufferedglmax2d

'SetGraphicsDriver BufferedGLMax2DDriver()
SetGraphicsDriver GLMax2DDriver()
'SetGraphicsDriver D3D7Max2DDriver()
'SetGraphicsDriver D3D9Max2DDriver()

Graphics 800, 600

Local pixmap:TPixmap = CreatePixmap(128, 128, PF_RGBA8888)
For Local x:Int = 0 To pixmap.width - 1
	For Local y:Int = 0 To pixmap.height - 1
		WritePixel(pixmap, x, y, (255 Shl 24) | (x Shl 16) | (y + 128 Shl 8) | x + y)
	Next
Next

Local image:TImage = LoadImage(pixmap)

Global FPSLASTUPDATETIME:Int
Local time:Int = MilliSecs()

SetBlend ALPHABLEND

While Not KeyDown(KEY_ESCAPE)
	Cls		
	SetScale 0.1, 0.1
	SetAlpha 0.75
	For Local c:Int = 1 To 10000
		DrawImage(image, Rnd(GraphicsWidth()), Rnd(GraphicsHeight()))
	Next
	
	time = MilliSecs()
	SetScale 2, 2
	
	DrawText "FPS: " + FPS(), 0, 0
	
	Flip 0
	FPSLASTUPDATETIME = FPSLASTUPDATETIME + (MilliSecs() - time)
Wend

Function FPS:Float(frequency:Int = 200)
	Global FPSFRAMECOUNT:Int
	Global FPSLASTCOUNT:Float
	Local time:Int = MilliSecs()
	FPSFRAMECOUNT=FPSFRAMECOUNT+1
	Local elapsed:Float = time - FPSLASTUPDATETIME
	If elapsed&gt;=frequency
		FPSLASTCOUNT=FPSFRAMECOUNT/elapsed*1000.0
		FPSFRAMECOUNT=0
		FPSLASTUPDATETIME=time
	EndIf
	Return FPSLASTCOUNT
End Function 

</textarea><br><br><br>EDIT: OK here now OSX 10.6.2 data (mbp with 8600GT)<br><br>BGLM2D: ~340FPS<br>GLM2d: ~270FPS <br><br></td></tr></table><br>
<a name="1000378"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#46">[#46]</a></td></tr></table></td></tr><tr ><td class="posttext"> Interesting that Mac OS performs better while Windows (seems to be specific to Windows Vista and up?) doesn't.  I wonder what the cause of that is...<br><br>Edit: On the upside, I am very, very happy to see both OpenGL drivers significantly outperforming the Direct3D drivers. <br><br></td></tr></table><br>
<a name="1000380"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tommo</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#47">[#47]</a></td></tr></table></td></tr><tr ><td class="posttext"> Result here (Win32 Release mode):<br><br>BGL: ~230 fps<br>GL:  ~178 fps<br><br>D3D7: ~45 fps<br>D3D9: ~45 fps <br><br></td></tr></table><br>
<a name="1000391"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#48">[#48]</a></td></tr></table></td></tr><tr ><td class="posttext"> Using Dreamora's code under Ubuntu 9.10 (release):<br>BGL: ~175-190fps<br>GL: ~135fps <br><br></td></tr></table><br>
<a name="1000422"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#49">[#49]</a></td></tr></table></td></tr><tr ><td class="posttext"> So far so good! Does setting a different blend mode or drawing images from other textures, before every DrawImage cause any problems? <br><br></td></tr></table><br>
<a name="1000451"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#50">[#50]</a></td></tr></table></td></tr><tr ><td class="posttext"> One thing to bear in mind is that when you draw with a vertex array you can't change textures mid-draw, so if you want to draw lots of individual images from different textures it won't be able to be any faster. But if you are re-drawing the same image or portions of the same texture it should be good. <br><br></td></tr></table><br>
<a name="1000467"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#51">[#51]</a></td></tr></table></td></tr><tr ><td class="posttext"> When I get the image packing for textures implemented, that should save on texture changes by quite a bit as well.  I have some ideas for sorting/merging batches based on texture/whether or not alpha is used (the latter is not as useful as it sounds, since most people don't seem to switch to solid blending when alpha is unneeded, but is still required) and then having OpenGL sort the rendered primitives using simple depth testing. <br><br></td></tr></table><br>
<a name="1000473"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#52">[#52]</a></td></tr></table></td></tr><tr ><td class="posttext"> IH - Perhaps some kind of code based solution of a "StartBatch", "EndBatch" function could be used then. You start/end every time you switch textures.? <br><br></td></tr></table><br>
<a name="1000497"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#53">[#53]</a></td></tr></table></td></tr><tr ><td class="posttext"> The renderbuffer code already handles stuff like that to minimize state changes and so as much as possible (without sorting the data) can be rendered in a single call to MultiDrawArrays.  More can be done, so the current system is doing pretty well given that it's not as optimized as it could be. <br><br></td></tr></table><br>
<a name="1000516"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#54">[#54]</a></td></tr></table></td></tr><tr ><td class="posttext"> Does the MultiDrawArrays let you apply a different texture to each array range? <br><br></td></tr></table><br>
<a name="1000521"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#55">[#55]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, my point was that if you draw the same image a bunch of times in a row without changing blend mode or something, that's one call to MultiDrawArrays. <br><br></td></tr></table><br>
<a name="1000569"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Robert Cummings</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#56">[#56]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not sure if this is helpful but aligning along a boundary sure sped up my ogl iphone stuff up:<br><br>A structure similar to:<br><br>struct Vertex<br>{<br>	GLshort x , y , z;<br>	GLshort pad1; //padding for optimised alignment<br>	GLubyte r,g,b,a;<br>	GLshort u,v;<br>};<br><br>Sorry if its something you've covered. <br><br></td></tr></table><br>
<a name="1000574"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#57">[#57]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not sure what you're talking about, considering it's not applicable- additionally, interleaved arrays are sort of bad, and it appears you're using them. <br><br></td></tr></table><br>
<a name="1000586"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#58">[#58]</a></td></tr></table></td></tr><tr ><td class="posttext"> On the iphone interleaved arrays are much more usefull than on the desktop due to the different hardware (OpenGL ES, tile based, ...), especially as there is no cpu and driver to help in the back.<br><br>But the other reason that padding there helps is the 32bit alignement of the things on the hardware. Again a thing where the driver on desktops jumps in. <br><br></td></tr></table><br>
<a name="1000589"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#59">[#59]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ah, my apologies, then - I'm not familiar with OpenGL ES or developing for the iPhone beyond simple GUI applications. <br><br></td></tr></table><br>
<a name="1000780"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#60">[#60]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just wrote/pushed the texture packing code (despite this being finals week - I'm really bad at focusing on what I'm supposed to be doing).  For an interesting test, take this modified copy of Dreamora's code:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">SuperStrict

'buildopt:release
'buildopt:gui

Import cower.bufferedglmax2d

SetGraphicsDriver BufferedGLMax2DDriver()
'SetGraphicsDriver GLMax2DDriver()
'SetGraphicsDriver D3D7Max2DDriver()
'SetGraphicsDriver D3D9Max2DDriver()

Graphics 800, 600

Local pixmap:TPixmap = CreatePixmap(128, 128, PF_RGBA8888)
For Local x:Int = 0 Until pixmap.width
	For Local y:Int = 0 Until pixmap.height
		WritePixel(pixmap, x, y, (255 Shl 24) | (x Shl 16) | (y + 128 Shl 8) | x + y)
	Next
Next

Local images:TImage[64]
For Local i:Int = 0 Until images.Length
	images[i] = LoadImage(pixmap)
Next

Global FPSLASTUPDATETIME:Int
Local time:Int = MilliSecs()

SetBlend ALPHABLEND

While Not KeyDown(KEY_ESCAPE)
	Cls		
	SetScale 0.1, 0.1
	SetAlpha 0.75
	For Local c:Int = 1 To 10000
		DrawImage(images[Rand(0, images.Length-1)], Rnd(GraphicsWidth()), Rnd(GraphicsHeight()))
	Next
	
	time = MilliSecs()
	SetScale 2, 2
	
	DrawText "FPS: " + FPS(), 0, 0
	
	Flip 0
	FPSLASTUPDATETIME = FPSLASTUPDATETIME + (MilliSecs() - time)
Wend

Function FPS:Float(frequency:Int = 200)
	Global FPSFRAMECOUNT:Int
	Global FPSLASTCOUNT:Float
	Local time:Int = MilliSecs()
	FPSFRAMECOUNT=FPSFRAMECOUNT+1
	Local elapsed:Float = time - FPSLASTUPDATETIME
	If elapsed&gt;=frequency
		FPSLASTCOUNT=FPSFRAMECOUNT/elapsed*1000.0
		FPSFRAMECOUNT=0
		FPSLASTUPDATETIME=time
	EndIf
	Return FPSLASTCOUNT
End Function 

</textarea><br><br>The only changes are that it will load 64 textures and randomly draw them each frame (also some syntactical thingies that bugged me).  Chances are GLMax2D will be a bit crippled when you run it with that driver, by the way.  Your results will vary, but with my driver, I get a ~300 FPS increase over GLMax2D.<br><br>Just for the hell of it, could someone run that with the D3D drivers as well? <br><br></td></tr></table><br>
<a name="1000783"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#61">[#61]</a></td></tr></table></td></tr><tr ><td class="posttext"> MBP with 8600GT:<br><br>BGLM2D: ~130fps<br>GLM2D: ~30fps<br><br>so a performance raise of over 400% <br><br></td></tr></table><br>
<a name="1000785"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#62">[#62]</a></td></tr></table></td></tr><tr ><td class="posttext"> Win32, with ATI Radeon 2600:<br><br>BGLM2D: ~150fps<br>GLM2D: ~30fps<br>D3D7: ~20fps<br>D3D9: ~17fps (fairly solid) <br><br></td></tr></table><br>
<a name="1000786"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#63">[#63]</a></td></tr></table></td></tr><tr ><td class="posttext"> Results on my MBP (using the 9400M, not the 9600M GT) were about ~305 FPS for BGLM2D and ~40fps for GLMax2D, so I'm getting over 750% on my end.<br><br>Edit: Direct3D results are hilarious. <br><br></td></tr></table><br>
<a name="1000789"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#64">[#64]</a></td></tr></table></td></tr><tr ><td class="posttext"> bglm2d: ~242<br>glmx2d: ~40<br>d3d7: ~55<br>d3d9: ~88<br><br>Interesting.<br><br>Unlike most of the other people that posted numbers here, I'm getting a higher FPS in DX7 and DX9 than in the unbuffered GLM2D driver... Yet the buffered one blows then all out of the water.<br><br>Windows 7 x64, ATI Radeon HD4670 <br><br></td></tr></table><br>
<a name="1000791"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#65">[#65]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Unlike most of the other people that posted numbers here, I'm getting a higher FPS in DX7 and DX9 than in the unbuffered GLM2D driver... <br></div>Has to do with the video card mostly, I think.<br><br>EDIT: Well, that, and I think Win7 is optimized for DirectX somehow. <br><br></td></tr></table><br>
<a name="1000794"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#66">[#66]</a></td></tr></table></td></tr><tr ><td class="posttext"> A buffered D3D9 driver would probably beat the buffered GL driver for Windows, but I'll leave the task of writing that nightmare to someone else (mainly because I don't have any code editors for Windows that are as good as TextMate anymore - don't suggest alternatives, they won't be good enough).  A buffered D3D7 driver is probably hopeless, and I'm not entirely sure why the D3D7 implementation is even still around.  Probably all of the paranoid people who think it's critical to have for older systems. <br><br></td></tr></table><br>
<a name="1000801"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jur</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#67">[#67]</a></td></tr></table></td></tr><tr ><td class="posttext"> bglm2d: ~36<br>glml2d: ~43<br>dx7 and dx9 : ~1<br><br>Vista, Amd X2, NVidia 7300 <br><br></td></tr></table><br>
<a name="1000803"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#68">[#68]</a></td></tr></table></td></tr><tr ><td class="posttext"> Something is wrong with your system if you're getting rates like that - especially with D3D9 under Vista.  Either that or you're compiling in debug mode. <br><br></td></tr></table><br>
<a name="1000808"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tommo</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#69">[#69]</a></td></tr></table></td></tr><tr ><td class="posttext"> Win32 Release<br><br>bgl: ~187<br>gl:  ~38<br><br>dx9: ~22<br>dx7: ~22<br><br><br>Nice result, isn't it? :) <br><br></td></tr></table><br>
<a name="1000810"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >MGE</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#70">[#70]</a></td></tr></table></td></tr><tr ><td class="posttext"> Will this work with the new draw commands?<br><br>DrawSubImage<br>DrawSubImageRect <br><br></td></tr></table><br>
<a name="1000817"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jur</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#71">[#71]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yep, I compiled in debug mode.<br><br>Here are the release mode results:<br><br>bglm2d: ~144<br>glm2d: ~147<br>dx7 and dx9: ~1<br><br>Looks that I have installed one interesting driver... great OGL (for my gfx card) and bad DX.<br><br><br>Vista, Amd X2, NVidia 7300 <br><br></td></tr></table><br>
<a name="1000821"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#72">[#72]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm sorry but I would like to try this but I get this compiling error :<br><br><pre class=code>bmk makemods cower.bufferedglmax2d
Compiling:bufferedglmax2d.bmx
Compile Error: Overriding method differs by type
[C:/BlitzMax/mod/cower.mod/bufferedglmax2d.mod/bufferedglmax2d.bmx;73;2]
Build Error: failed to compile C:/BlitzMax/mod/cower.mod/bufferedglmax2d.mod/buf
feredglmax2d.bmx</pre><br><br>I'm using BlitzMax 1.34 and I have downloaded both modules :<br>mod/cower.mod/renderbuffer.mod<br>mod/cower.mod/bufferedglmax2d.mod<br><br><b>EDIT</b> Hum... I suppose it's for 1.36 only :( <br><br></td></tr></table><br>
<a name="1000822"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tommo</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#73">[#73]</a></td></tr></table></td></tr><tr ><td class="posttext"> The Max2D has been modified since 1.35 for virtual resolution and subimage support.<br>If you have to stick with 1.34, you can tweak the code easily. They are just some small changes. <br><br></td></tr></table><br>
<a name="1000825"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#74">[#74]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah<br>(I really should upgrade to 1.36 but I read so many bugs everywhere...)<br><br>I replace the draw method at 73;2 <br><pre class=code>Method Draw(x0#, y0#, x1#, y1#, tx#, ty#, sx#, sy#, sw#, sh#)</pre><br>with :<br><pre class=code>Method Draw(x0#, y0#, x1#, y1#, tx#, ty# )
	local sx#=0.0
	local sy#=0.0
	local sw#=_texture._pwidth
	local sh#=_texture._pheight</pre><br><br>I suppose it's ok...<br><br>The example provided here work well (a little faster than normal GLMAX2D)<br><br>I had to change any <b>TGLImageFrame</b> casting with <b>TGLBufferedImageFrame</b><br>and of course every reference to UV in _texture<br><br>But what is exactly _gseq (GraphicsSeq) and <b>how to use glBindTexture now since I need a reference to the texture</b> ?<br>Is this <b>_texture._owner._name</b> ?<br><br>GrabImage isn't available anymore too since grabPixmap isn't implemented :(<br>(But I know that render to texture isn't correctly supported on every graphic card, what's the solution then ?)<br><br>Anyway, even without including GrabImage in my game (and maybe because of my poor hack on Draw()) <b>many things are incorrectly rendered</b> and my fps drop from 330 to 260:-(<br><br>Maybe there is things to do with <b>setTransformation()</b> ? everything was incorrectly scaled with. <br><br></td></tr></table><br>
<a name="1000837"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#75">[#75]</a></td></tr></table></td></tr><tr ><td class="posttext"> From what I could see, GraphicsSeq is a way of determining when the driver/resolution/context/etc. has changed in such a way that your resources will be lost.  Could be wrong, but this stuff isn't documented, so not a lot to do about that other than trust that using it the same way the default implementations would is correct.<br><br>To set the texture, you have to use TRenderState.SetTexture(_texture._Name()).  You absolutely should not call glBindTexture.  If you want to render something using OpenGL, you should first call driver._buffer.Render(); driver._buffer.Reset(), or use the driver's TRenderBuffer to do the drawing (the latter will be faster).<br><br>If you're calling glBindTexture or changing GL state without reverting it to its previous state, and/or (if you're using glBegin/glEnd to draw stuff) not telling the driver's RenderBuffer instance to draw and reset itself, or you've modified other code that breaks something, things will be drawn incorrectly.  This is how things work with GLMax2D, more or less (the texture packing changes things a bit), and it's not going to change for the buffered driver.<br><br>I don't plan on supporting render to texture/framebuffers since 1) Max2D does not work well with them and 2) I see no reason to.  The issue isn't hardware support - I haven't seen any modern hardware that doesn't support render to texture in some form.  I would highly discourage any use of GrabPixmap because that will be a bottleneck regardless of the driver you use.<br><br>SetViewport is also not implemented, which depending on your use of it may also introduce artifacts.  You decided not to show a picture to illustrate exactly what is incorrect, so I can't really do much more than guess. <br><br></td></tr></table><br>
<a name="1000855"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#76">[#76]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks<br>It probably come from the SetViewport since I use it often (artifacts indeed).<br>Probably from a wrong direct call to OpenGL too :)<br><br>Well I'm not using RTT because I only grabImage some specific constructed texture at the level loading.<br>No need for real time RTT for now, but I will probably search a solution for that. <br><br></td></tr></table><br>
<a name="1001200"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pete Rigz</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#77">[#77]</a></td></tr></table></td></tr><tr ><td class="posttext"> Got around to taking another look at this and threw another test at it. I made a particle effect to give it plenty of different state changes to think about and whatever. Here is the download link: <a href="http://www.rigzsoft.co.uk/files/GFXTest.zip" target="_blank">http://www.rigzsoft.co.uk/files/GFXTest.zip</a> It inlcudes an exe for windows and the source, but you'll need my <a href="http://www.rigzsoft.co.uk/index.php?option=com_content&amp;view=article&amp;id=6&amp;Itemid=23" target="_blank">timelinefx</a> module to run it. I'll upload a mac version in a bit.<br><br>Here are my results:<br><br>brl.opengl: 155<br>brl.dx7: 81<br>brl.dx9: 132<br>cower.bufferedgl: 44<br><br>I'm quite surprised by those results, but quite a bit a bit slower. I guess it could be that if you want to take advantage of the buffered mode, a little rethinking about how you render stuff is in order? The engine isn't doing anything special, just setting states then drawing each particle as necessary. Hmm, will test on the mac, maybe it's a windows 7 thing. <br><br></td></tr></table><br>
<a name="1001209"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#78">[#78]</a></td></tr></table></td></tr><tr ><td class="posttext"> No, doesn't seem to be a Windows 7 thing.  Curious.. I don't have time to look at this now, but I'll have to keep it in mind.  In the meantime, if anyone wants to cram some profiling code into the module, that'd be handy. <br><br></td></tr></table><br>
<a name="1016253"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#79">[#79]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm not exactly fond of bumping my old posts, but this may or may not warrant it.<br><br>I've updated the renderbuffer module with a new implementation that isn't actually written in BlitzMax - it's C++ now.  The reason for this is mainly because dealing with a lot of data in BlitzMax <i>doesn't work</i> in practice.  There is an upper limit to how much you can throw at BlitzMax before either the GC or the tons of allocations made will bog it down (this is why the last implementation of renderbuffer avoided arrays like the plague, because the GC would take a huge toll on the speed).  So, for the most part, the renderbuffer module is C++.  There are some types that wrap the C++ API, and that's it.  The TRenderBuffer wrapper only gets allocated once.  There <i>may</i> be some overhead with it being a wrapper and making function calls that way, I don't know for certain since I didn't feel like swapping out the existing API for the C++.<br><br>Also added is scissor testing to the renderbuffer code, but that's not really significant in any way.  It's faster, or should be faster.  I'm debating about whether or not I'll remove the use of the STL altogether right now, since there's probably some overhead associated with using std::vector (the typename says deque in the source code, you can browse through the commits to see why that is).  I don't know for certain yet, but it helped get the implementation done quickly, so that's what's important.  I have a lot of bad things to say about the way the the <i>new</i> operator works in C++, but that's for another time and only after a lot of testing (my fixation on malloc is probably unhealthy).<br><br>There are a few bug fixes and what-not.  I guess those would just be expected.  Anyhow, if you're still even vaguely interested in this, give it a try.  There ought to be an improvement with Rigz's test, although how much of an improvement you'll see will obviously vary between systems.  There's a bit more parity between implementations in that particular case, but I'm not really sure how to address the situation there in the first place. <br><br></td></tr></table><br>
<a name="1016256"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >xlsior</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#80">[#80]</a></td></tr></table></td></tr><tr ><td class="posttext"> Nice! <br><br></td></tr></table><br>
<a name="1016363"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#81">[#81]</a></td></tr></table></td></tr><tr ><td class="posttext"> Added GrabPixmap/DrawPixmap and fixed another bug.  Nothing really interesting right now.  Edit: Also tweaked some other things, at least in the TimelineFX test and on my system, both drivers seem to be more or less even.  Whether or not this will always be the case is, as usual, indeterminable without actually seeing the module in use somewhere. <br><br></td></tr></table><br>
<a name="1017819"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LAB[au]</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#82">[#82]</a></td></tr></table></td></tr><tr ><td class="posttext"> Altough the renderbuffer and bufferedglmax2d modules compile fine, I have this error while importing the module in the test code:<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80"> Building test
Compiling:test.bmx
flat assembler  version 1.68  (1947950 kilobytes memory)
3 passes, 3792 bytes.
Linking:test.exe
C:/Program Files/BlitzMax/mod/cower.mod/renderbuffer.mod/renderbuffer.release.win32.x86.a(renderbuffer.cpp.release.win32.x86.o):renderbuffer.cpp:(.text+0x103e): undefined reference to `_imp____glewLockArraysEXT'
C:/Program Files/BlitzMax/mod/cower.mod/renderbuffer.mod/renderbuffer.release.win32.x86.a(renderbuffer.cpp.release.win32.x86.o):renderbuffer.cpp:(.text+0x1081): undefined reference to `_imp____glewUnlockArraysEXT'
C:/Program Files/BlitzMax/mod/cower.mod/renderbuffer.mod/renderbuffer.release.win32.x86.a(renderbuffer.cpp.release.win32.x86.o):renderbuffer.cpp:(.text+0x114d): undefined reference to `_imp____glewMultiDrawArrays'
Build Error: Failed to link C:/Program Files/BlitzMax/mod/cower.mod/bufferedglmax2d.mod/test.exe
Process complete</textarea><br><br>Using latest Blitzmax and recommanded MinGW, I have a fairly old graphic card (NVidia GeForce 7600GT).<br><br>Any idea?<br><br>Thanks <br><br></td></tr></table><br>
<a name="1017843"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >N</td><td align="right"><font class=tiny>(Posted 2010)</font>&nbsp;<a href="#83">[#83]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm afraid I've tried dealing with this bug before and don't have a fix.  You'll have to work on fixing it yourself since I'm really far too busy right now. <br><br></td></tr></table><br>
<a name="1125132"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#84">[#84]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know it's old but I step into the same issue and was wondering if nobody ever found a solution for this before ?<br>I don't even know where comes the <b>_imp____glewLockArraysEXT</b> and <b>_imp____glewMultiDrawArrays</b> I run into.<br><br>Would be useful to have something like this for particles engine rendering. <br><br></td></tr></table><br>
<a name="1125446"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AdamRedwoods</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#85">[#85]</a></td></tr></table></td></tr><tr ><td class="posttext"> he may be using the glew library, which isn't with mingw. you can try finding a prebuilt glew.dll (may not be the real filename) somewhere and that may work. <br><br></td></tr></table><br>
<a name="1134016"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Derron</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#86">[#86]</a></td></tr></table></td></tr><tr ><td class="posttext"> Armitage - have you found a solution?<br>Does the module work for you in threaded mode (it crashes the app on my linux build)<br><br>Until it compiles in windows:<br><br>?Win32<br>SetGraphicsDriver GLMax2DDriver()<br>?not Win32<br>SetGraphicsDriver BufferedGLMax2DDriver()<br>?<br><br>bye<br>Ron <br><br></td></tr></table><br>
<a name="1135213"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Armitage 1982</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#87">[#87]</a></td></tr></table></td></tr><tr ><td class="posttext"> I stop trying this early and never test anything in threaded mode yet.<br>I changed so many things here and there that I'm no more able to use most of the tweak found for the rendering part of Max2D.<br>I wonder if learning OpenGL and forget about Max2D is not the best solution  for speed improvement. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
