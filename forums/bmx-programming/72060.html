<!DOCTYPE html><html lang="en" ><head ><title >sounds in code ?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >sounds in code ?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >sounds in code ?</a><br><br>
<a name="805439"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >QuietBloke</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ive looked around but I cant see anyone here who has done this so I thought Id ask just on the off-chance.<br><br>Im looking for a way to create a sound file on the fly in code. Something like the old games from my youth ( space invaders, galaxians, pacman, defender, asteriods, etc etc ).<br>What Im after is a way of creating a wav or whatever by supplying start/end freq, start/end volume/ duration maybe also the option of noise so I can do them explosion sounds. Of course most sounds will be made up of a sound  getting louder, playing for a bit and fading so I thought if I had an option to append a sound on the end of an existing sound this will give me all I need to create simple sounds on the fly.<br><br>Why do I want this ?.. well.. I never seem to write anything cause I get bogged down with trying to create the flashy graphics, the special effects, trying to get hold of the sound files etc. To this end I've decided the next game I write will have zero external media. <br><br>Well.. its something to do isnt it !? <br><br></td></tr></table><br>
<a name="805479"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >QuietBloke</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> errm.. OK.. just read what I wrote and I figured it needs explaining what Im after...<br><br>I have looked at the TAudioSample and seen some examples of it but I just dont get it.<br>The examples I have seen dont seem to be change the volume of a sample which is one thing Im after.. but also.. I just dont get it.. for example in the help you have a this explanation <br>'length is the number of samples to allocate for the sample' ??.. eh ?<br><br>frequency I suppose is the sampling frequency.. fine.. but then what does the data you put into the sample actually mean ?<br><br>can I define the volume of the sound ?<br>can someone here explain what the data you supply mean in a way even I can understand ? <br><br></td></tr></table><br>
<a name="805480"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Boulderdash</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> ''Create_Audio_Samples()<br><br>''Function Create_Audio_Samples()<br>Local fr:Long=14000<br>Local f:Long<br>Local k:Long<br><br>fr=frt[0]<br>Global sample_000:TAudioSample=CreateAudioSample( 32,fr,SF_MONO8 )<br>For k=0 Until 32<br>f=0<br>If k&gt;15 Then f=127<br>sample_000.samples[k]=f<br>Next<br>Global Sound_000:TSound=LoadSound( sample_000,True )<br><br>fr=frt[1]<br>Global sample_001:TAudioSample=CreateAudioSample( 32,fr,SF_MONO8 )<br>For k=0 Until 32<br>f=0<br>If k&gt;15 Then f=127<br>sample_001.samples[k]=f<br>Next<br>Global Sound_001:TSound=LoadSound( sample_001,True )<br><br>fr=frt[2]<br>Global sample_002:TAudioSample=CreateAudioSample( 32,fr,SF_MONO8 )<br>For k=0 Until 32<br>f=0<br>If k&gt;15 Then f=127<br>sample_002.samples[k]=f<br>Next<br>Global Sound_002:TSound=LoadSound( sample_002,True )<br><br>fr=frt[3]<br>Global sample_003:TAudioSample=CreateAudioSample( 32,fr,SF_MONO8 )<br>For k=0 Until 32<br>f=0<br>If k&gt;15 Then f=127<br>sample_003.samples[k]=f<br>Next<br>Global Sound_003:TSound=LoadSound( sample_003,True ) <br><br></td></tr></table><br>
<a name="805481"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Boulderdash</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> This is some code cut from my emulator, it is not complete <br>but it may help quide you.<br><br>I just made the length of the samples 32 no particular reason,yes you can change the volume!<br><br>Do you want a noise channel also?<br><br>I can make retro tones (square wave or I can code to make sin wave) <br><br></td></tr></table><br>
<a name="805482"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Boulderdash</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> If Pitch=0 Then Sound_handle2=PlaySound(Sound_000)<br>If Pitch=1 Then Sound_handle2=PlaySound(Sound_001)<br>If Pitch=2 Then Sound_handle2=PlaySound(Sound_002)<br>If Pitch=3 Then Sound_handle2=PlaySound(Sound_003)<br><br>SetChannelVolume(Sound_handle,Your_Volume_variable)<br><br>OK so you are going to need some elaborate coding to make it happen, I had to repeat tonnes of instructions becuase loops would not work for this when creating the samples maybe someelse could shed some light on this?<br><br>Here is a link to my working program complete with spacey's sounds from the 80's<br><br><a href="http://software.wizz.googlepages.com/Emulator2001_t.exe" target="_blank">http://software.wizz.googlepages.com/Emulator2001_t.exe</a><br><br>how many tones do you want 128 or 256 maybe, I can help<br><br>You wont have files on your drive with samples.<br><br>A noise channel:<br>Global sampleb:TAudioSample=CreateAudioSample( 22232,fr,SF_MONO8 )<br>For k=0 Until 22232<br>If T=0 Then f=Rand(0,255)<br>T:+1<br>If T=8 Then T=0<br>sampleb.samples[k]=f<br>Next<br>Global soundb:TSound=LoadSound( sampleb,True )<br>Sound_handleb=CueSound(soundb)<br>SetChannelVolume(Sound_handleb,0)<br>noise_cued=1 <br><br></td></tr></table><br>
<a name="805487"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >QuietBloke</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Gav,<br><br>thanx for the reply.. its a bit late this evening to try your code out.. Ill have a go tommorow... Im also on the Mac tonight so I cant try your emulator out but ill also run that tommorow..<br>I'm thinking Im not going to get my head round this until I try tweaking the values and seeing what happens.. <br>Can you elaborate on what you needed to do to change the volume ? <br><br></td></tr></table><br>
<a name="805496"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Boulderdash</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> I will have to make a working "retro organ" to demo how to do this.<br><br>Give me a day or two to get round to it<br><br>Do you intend on making sound effects as well as music?<br><br>If you are making sound effects that change frequencies rapidly (like every frame or 2) then you may need my "Software enhancement" of sound sample to dramatically improve the sound quality\\<br><br>So I need to know if you are making music or sound effects for your game, I use a value of 0-128 for pitch so you may be limited unless you mod it yourself once i send it to you<br><br><br>So i will post some examples soon, since other bmaxers might want retro sound also.<br><br>There are many benifits from sound samples:<br><br>1 no media files<br>2 no gap as a sound loops<br>3 you can make any wave form <br><br></td></tr></table><br>
<a name="805498"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> This was my first ever foray into BMax sound generation:<br><a href="http://www.blitzbasic.com/Community/posts.php?topic=71061#794654" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=71061#794654</a> <br><br></td></tr></table><br>
<a name="805575"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >QuietBloke</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think my requirements have not quite been understood... I do not want to actually generate the sounds on the fly.... what I am after is a way of creating a sound file using code.<br><br>So.. instead of loading sounds at the start of my App I build them using simple method calls : say for example :<br><br>shootingSound:TSound = CreateSound(1,10000,12000,0,255)<br><br>woud create a soundbank that playes a sound rising from 10000hz to 12000hz and volume rising from 0 to max over a timespan of 1/10 second.<br><br>AppendSound(shootingSound,5,12000,12000,255,255)<br><br>would append the the soundbank a sound of 12000hz and full volume for 5/10 seconds.<br><br>AppendSound(shootingSound,10,12000,8000,255,0)<br><br>would append to the soundbank a sound with a freq falling from 12000 to 8000, volumne falling from max to zero for 10/10 seconds.<br><br>then in my game I can just PlaySound(shootingSound)<br><br>Its really just for sound effects.<br>Is this easily possible using the Audio lib supplied with BMax ? <br><br></td></tr></table><br>
<a name="805587"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I keep meaning to update my sound system so it doesnt generate WAVS  but I still think this might be of use:<br><br><a href="http://www.blitzbasic.com/Community/posts.php?topic=70022#783679" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=70022#783679</a> <br><br></td></tr></table><br>
<a name="805622"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >QuietBloke</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Cygnus,<br><br>well .. I only had a chance to glance over the code and I must say.. its all completely over my head.<br>Does it actually generatae sounds from scratch ?<br>I tried running the musicusage.bmx file but it fails with load of wav failed..<br><br>Is it cause Im running on a Mac ?.. it has generated files s0.wav to s8.wav but these are unplayable.<br><br>Ill try it later on a PC.<br><br>thanx for all the help so far.. I still dont understand any of it ! lol <br><br></td></tr></table><br>
<a name="805969"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >QuietBloke</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK.. I think Im getting to grips with the Audio commands. Thanx again for the replies.. seems my problem is not as complex as I thought.. it was just I didnt understand what I was doing ( it happens a lot ).<br><br>Still.. just in case its of any help to anyone else who wants to create sounds in code heres my quick and dirty test code I knocked up tonight.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SuperStrict

Local sound:TSound

'sound = createsound(1,1,11025,100,100)
sound = createsound(1,8000,1000,100,0)

PlaySound(sound)

Input



Function createsound:TSound(duration:Float,startfrequency:Float,endfrequency:Float, startvolume:Float, endvolume:Float)
	Local sample:TAudioSample
	Local totalsamples:Int
	Local freqAngle:Float	
	Local volume:Float
	Local multiplier:Float
	Local k:Float
	Local angle:Float
	Local currentFreq:Float
		
	totalsamples = 11025*duration

	sample = CreateAudioSample( totalsamples,11025,SF_MONO8 )
	
	For k=0 Until totalsamples
		multiplier = k / totalsamples
		volume = ( startvolume - ( ( startvolume-endvolume ) * multiplier ) )  * 127.5 / 100
		
		currentFreq = startfrequency + ( ( endfrequency-startfrequency ) * multiplier )
		freqAngle = currentFreq/11025*180
		Print "freqangle ; " + freqangle
		angle :+ freqAngle
		angle = angle Mod 360

		sample.samples[k]=Sin(angle)*volume+127.5
	Next
	
	Local sound:TSound=LoadSound( sample,False )
	
	Return sound
End Function
</textarea><br><br>This is basically the first part of what I was after. <br>Im not convinced the sound itself is actually the frequency of the sound but its good enough for now.<br>The createsound function will create a TSound. The first param is duration in seconds, then you supply start and end frequencie ( 0-11025 ) and start/end volume ( 0-100%).<br><br>Now I need a way of supplying a list of these params so I can create sounds made of any number of these chanks of sounds.<br><br>Maybe when I get that working I can apply effects to the sound... so I can do them there explosion sounds. <br><br></td></tr></table><br>
<a name="806132"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >QuietBloke</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> took a bit of time over lunch today and came up with this.<br><br>I added parameters to create noise and a square wave.. stil a bit iffy but at the bottom I create a sound and play it.. its a little bit like the pacman death noise created with just a handful of commands. <br>Maybe not impressive to many of you but Im chuffed.. a bit of cleaning up and I can get on with knocking a simple something up using no media. :)<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
SuperStrict

Type TSoundEffect
	Field blocks:TList
	Field totalSamples:Int
	
	Method New()
		blocks = CreateList()
	End Method
	
	Method AddBlock(duration:Float, startFreq:Float, endFreq:Float, startVol:Float, endVol:Float, noise:Float, waveType:Int)
		Local block:TSoundEffectBlock
		block = TSoundEffectBlock.Create(duration, startFreq, endFreq, startVol, endVol,noise, waveType )
		totalSamples :+ duration*11025
		ListAddLast(blocks, block)
	End Method
	
	Method MakeSound:TSound()
		Local sample:TAudioSample
		Local currentBlock:TSoundEffectBlock
		Local startSample:Int
		Local endSample:Int
		Local samplesInBlock:Int
		
		Local freqAngle:Float	
		Local volume:Float
		Local multiplier:Float
		Local k:Float
		Local angle:Float
		Local currentFreq:Float
		
		Local noiseValue:Float
		Local waveType:Int
		
		startSample = 0
		endSample = 0 

Print "total samples: " + totalsamples

		sample = CreateAudioSample( totalSamples,11025,SF_MONO8 )
		For currentBlock = EachIn blocks
Print "processing block duration : " + currentBlock.duration
		
			noiseValue = currentBlock.noise/100

			waveType = currentBlock.waveType

			startSample = endSample
			samplesInBlock = currentBlock.duration * 11025
			endSample = startSample + samplesInBlock
			
Print "start sample : " + startSample + " end sample : " + endSample
		
			For k = startSample Until endSample
			
				multiplier = (k-startSample) / samplesInBlock
				volume = ( currentBlock.startvol - ( ( currentBlock.startvol-currentBlock.endvol ) * multiplier ) )  * 127.5 / 100
				
				currentFreq = currentBlock.startfreq + ( ( currentBlock.endfreq-currentBlock.startfreq ) * multiplier )
				freqAngle = currentFreq/11025*180

				angle :+ freqAngle
				angle = angle Mod 360
				
				Local writesample:Float
				writesample = Sin(angle)*volume+127.5

				If writesample &gt; 127.5 Then
					writesample :- Rnd()*(writesample-127.5)*noisevalue
				Else
					writesample :+ Rnd()*writesample * noisevalue
				End If
				
				If waveType = 1 Then
					If writeSample &gt; 127.5 Then
						writeSample = 255
					Else
						writeSample = 0
					End If
				End if
				
Print "k = " + k + " angle : " + angle + " volumne : " + volume
				sample.samples[k]=writesample
			Next
		Next
		
		Local sound:TSound=LoadSound( sample,False )
	
		Return sound

	End Method
End Type

Type TSoundEffectBlock
	Field duration:Float
	Field startFreq:Float
	Field endFreq:Float
	Field startVol:Float
	Field endVol:Float
	Field noise:Float
	Field waveType:Int
	
	Function Create:TSoundEffectBlock(duration:Float, startFreq:Float, endFreq:Float, startVol:Float, endVol:Float, noise:Float, waveType:Int)
		Local this:TSoundEffectBlock
		this = New TSoundEffectBlock
		this.duration = duration
		this.startFreq = startFreq
		this.endFreq = endFreq
		this.startVol = startVol
		this.endVol = endVol
		this.noise = noise
		this.waveType = waveType	
		Return this
	End Function
End Type

Local sound:TSound
Local soundEffect:TSoundEffect

soundEffect = New TSoundEffect

soundEffect.AddBlock(.1,600,1000,100,100,0,0)
soundEffect.AddBlock(.25,1000,600,100,100,0,0)

soundEffect.AddBlock(.1,400,800,100,100,0,0)
soundEffect.AddBlock(.25,800,400,100,100,0,0)

soundEffect.AddBlock(.1,200,600,100,100,0,0)
soundEffect.AddBlock(.25,600,200,100,100,0,0)

soundEffect.AddBlock(.05,3000,1000,100,0,0,0)
soundEffect.AddBlock(.15,1000,3000,100,0,0,0)
sound = soundEffect.MakeSound()

Print "made sound"

PlaySound(sound)

Input

</textarea> <br><br></td></tr></table><br>
<a name="806136"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> QuietBloke: It's untested on Mac<br><br>the code generates the wav files in windows format. The code does need converting so that it does not need to generate wav files (ie in memory) At that point it'll be cross platform I think!<br><br>When it works you'll have access to the old 6502 era machines music systems (not quite c64, more BBC/NES with sample channels...)<br><br>You have Vol envelope, Pitch envelope, LFOs etc. you just have to ensure updatesound() is called often enough (this could be setup with events if needed...)<br><br><br>[edit]<br><br>OK It seems to be an Endian problem. I may look over this at the weekend. <br><br></td></tr></table><br>
<a name="806154"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >QuietBloke</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Cygnus,<br><br>Ill take another look at your code now I have vague understanding of whats going on in terms of the data.<br><br>In the meantime at least I have something workable.<br><br>cheers. <br><br></td></tr></table><br>
<a name="806375"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> its use is pretty simple and I think theres a max demo included? (havent checked since i've been away from home..) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
