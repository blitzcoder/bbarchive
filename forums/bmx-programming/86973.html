<!DOCTYPE html><html lang="en" ><head ><title >Any known bugs in TMap since 1.30?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Any known bugs in TMap since 1.30?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Any known bugs in TMap since 1.30?</a><br><br>
<a name="985815"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm having some problems with TMaps in 1.30 on Windows. Specifically, I'm iterating through one with EachIn and Values() and it's finding the same object twice, even though it's only ever added once. I've got debug checks in place to ensure that only five objects are ever added, and to be doubly sure, immediately before the bug occurs, I iterate through the Keys() and call GetKeyForValue() and this confirms that only the five objects are in there.<br><br>As you can imagine, this is a real pain in the butt. I don't really want to patch it up by checking for the same one twice because it's treating the symptoms instead of the causes. Trouble is, I don't know what the causes are. So I'm wondering if any bugs have been reported or fixed since 1.30 which might explain this?<br><br>I've tried the bug forum and there's nothing there. <br><br></td></tr></table><br>
<a name="985823"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BladeRunner</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Only thing I remember ist that mixing Strings and Objects in a Map messes it up. <br><br></td></tr></table><br>
<a name="985825"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tommo</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> There's only one change according to versions.txt:<br><div class="quote"> <br>1.32<br>Null keys no longer allowed in TMaps. Asserts have been added to guard against this.<br> <br></div> <br><br></td></tr></table><br>
<a name="985855"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Mahan</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Gabriel:<br>I know it's a tiresome phrase but I'd really recommend that you try to pinpoint the problem by writing some small code that reproduces the defect. Since you got the project that causes these symptoms (and thus know what you usually feed the map with, when strange things occur) you are the one with the best knowledge to write such a test application. <br><br></td></tr></table><br>
<a name="985856"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks guys. I already wrote my own wrapper to ensure that Null keys are not used. When you talk about strings and objects, do you mean using them as keys or values? As far as I know, I'm only using strings as keys and objects as values.<br><br>I'm currently working under the assumption that something is happening inside the For..EachIn loop which interferes with the iterator, but I can't see anything which should affect that. AAMOF, I thought that returning an iterator as Values() does was precisely to ensure that you couldn't mess with it.<br><br><div class="quote"> @Gabriel:<br>I know it's a tiresome phrase but I'd really recommend that you try to pinpoint the problem by writing some small code that reproduces the defect. Since you got the project that causes these symptoms (and thus know what you usually feed the map with, when strange things occur) you are the one with the best knowledge to write such a test application.<br> <br></div><br>It's not a tiresome phrase, it just takes more time to break down a game spread over nearly 400 include files down into a fifteen line demo of the problem than some people seem to think. It's not for the want of trying that I haven't managed it so far. <br><br></td></tr></table><br>
<a name="985888"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I didn't even know you could use eachin with maps! For each thing I want in a map, I have a management type that has a list of string ids and the map. Whenever I add an item, it puts the id in the list and adds to the map under the id. The reason I did this, is I can then eachin the list of ids to access each item from the map. <br><br></td></tr></table><br>
<a name="985890"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Post an example. <br><br></td></tr></table><br>
<a name="985913"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>I've got debug checks in place to ensure that only five objects are ever added<br> <br></div><br><br>I would be worried about adding AND removing objects while using the result of MapKeys(). Both ops will make such an array out of date:<br><br><pre class=code>
Global m:TMap=New TMap

MapInsert m,"a","1"
MapInsert m,"b","2"
MapInsert m,"c","3"
MapInsert m,"d","4"

For k$=EachIn MapKeys(m)
	j$=String(MapValueForKey(m,k))
	If k="c" MapRemove m,"d"
	Print k+","+j
Next
</pre><br><br>Oh, keys is an iterator not an array, that's kind of unexpected (and new?)... <br><br>If keys is going to return an iterator then I would consider both Add and Remove ops could be made safe rather than the chaos output above. <br><br></td></tr></table><br>
<a name="985914"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm not adding any objects while using the result of MapKeys, but I am removing them. I was under the impression that keys was always an iterator, but I may be wrong about that. If remove isn't presently safe then that's probably the problem. Thanks for the explanation. I'll move over to marking for removal at a later date and that should fix it. <br><br></td></tr></table><br>
<a name="985916"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes I find deathlists are always best :) <br><br></td></tr></table><br>
<a name="985923"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> There is this:<br><a href="http://www.blitzbasic.com/codearcs/codearcs.php?code=2544" target="_blank">http://www.blitzbasic.com/codearcs/codearcs.php?code=2544</a><br><br>I could swear that i remeber someone writing a Tmap replacement that claimed to be faster. i cant seem to find it though.<br><br>Edit: Here it is.<br><a href="http://www.blitzmax.com/codearcs/codearcs.php?code=1907" target="_blank">http://www.blitzmax.com/codearcs/codearcs.php?code=1907</a> <br><br></td></tr></table><br>
<a name="985927"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> So maps aren't safe for random adding and removing? <br><br></td></tr></table><br>
<a name="985928"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> So maps aren't safe for random adding and removing?  <br></div><br>Don't you mean, "So, while using a map iterator, maps aren't safe for random adding and removing?" <br><br></td></tr></table><br>
<a name="986063"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't know! ;)<br><br>I'm just using the Insert and Remove methods of TMap.. I've never directly used an iterator and wouldn't know how to if I wanted to.<br><br>I was using TLists before to store my game objects, but I often found myself having to pick out an individual object frequently to update, using their id. (This is mainly because it is a multiplayer game, and alas you can't send object references over the network and expect it to work ;o so I have to use a system of IDs instead to receive orders). I could use arrays, but objects are created and destroyed regularly.. so I found TMaps to be the ideal compromise.<br><br>So is it safe to use them for this purpose? My whole game will kind of depend upon this fact :O <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
