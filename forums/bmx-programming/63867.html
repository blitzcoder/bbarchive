<!DOCTYPE html><html lang="en" ><head ><title >quick string to tbank</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >quick string to tbank</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >quick string to tbank</a><br><br>
<a name="712804"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PantsOn</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi<br><br>Is the a quick way/command to convert a string to a bank, apart from creating a bank and then poking each character into the bank.<br><br>I've even tried i:tbank = tbank("hello") just incase ;-)<br><br>cheers<br>Rich <br><br></td></tr></table><br>
<a name="712809"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> CreateStaticBank() and toCString() should do the trick. <br><br></td></tr></table><br>
<a name="712813"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PantsOn</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> cheers for the quick response.<br><br>not sure if createstaticbank would work in my situation as the string will be deleted but the bank wants to keep alive (i think)<br>I will double check later.<br><br>not sure what toCstring() does as it doesn't highlight as a command. I am running v1.22<br><br>cheers<br>Rich <br><br></td></tr></table><br>
<a name="712875"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fabian.</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> String.ToCString calls MemAlloc with the string's length + 1 as parameter, then copies the string data to the returned memory block and returns it. You should use MemFree to free the block of memory returned by String.ToCString.<br><br>If the string stays valid all the time the TBank does, and if you don't write to the bank you could create a static bank just onto the string, otherwise you can create a bank a then copy all bytes to it, as you said in your first post. <br><br></td></tr></table><br>
<a name="712879"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AlexO</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>
local bank:TBank = createbank(1)
local stream:TBankStream = createBankStream(bank)
writestring(stream, "hello world")
closestream(stream)
</pre><br>sure beats poking each character in individually. <br><br></td></tr></table><br>
<a name="712883"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Could you use CreateBankStream and write to it as if it were a file? <br><br></td></tr></table><br>
<a name="712888"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AlexO</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> As far as I know, you can. I've used it extensively for writing out map files and then compressing the bank, then writing that to an actual file. It extends TStream so all functions work exactly the same. I created a bank of 1 byte in size but the writing automatically makes it bigger if it exceeds the size, so no need to worry about overflow. <br><br></td></tr></table><br>
<a name="712890"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fabian.</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> writestring(stream, "hello world")<br>...<br>sure beats poking each character in individually. <br></div>I'd guess it's much faster to copy each single byte. <br><br></td></tr></table><br>
<a name="712892"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >AlexO</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>I'd guess it's much faster to copy each byte.<br> <br></div><br><br>I don't know which is faster. If I had to guess I'd say that pokeByte would be rather than writeString(). But most of the time when writing out a bank, speed isn't a crucial issue for me (the Tstream interface is plenty fast for my needs), and the stream writing method is much less error prone than pushing bits and bytes. <br><br></td></tr></table><br>
<a name="713046"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PantsOn</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> in this case speed is quite important.<br>I think CreateStaticBank works for me at the mo.<br><br>Cheers for all your help.<br><br>At least I have other methods to choose if CreateStaticBank doesn't work. <br><br></td></tr></table><br>
<a name="713051"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SculptureOfSoul</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not sure if this is faster, but here's another method. Unlike  CreateStaticBank, you should still be able to resize this bank should the need arise.<br><br><textarea class=codebox name="code" wrap=OFF readonly="true" rows="15" cols="80">
Strict


Global testbank:tbank
Global teststring:String

testbank = CreateBank( 100 )
teststring = "this is just a test"

'Varptr gets the address of teststring, Bankbuf returns a byte ptr to the banks buffer.
MemCopy( Varptr teststring, BankBuf(testbank), teststring.length)

</textarea> <br><br></td></tr></table><br>
<a name="713116"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >PantsOn</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> memcopy works really well.<br>Millisecs of a test copying 50000 bytes of data, 1000 times.<br>pokebyte = 11895<br>memcopy  = 111<br><br>not bad.<br><br>many thanks <br><br></td></tr></table><br>
<a name="713326"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SculptureOfSoul</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Wow, that's a bigger difference than I expected.<br><br>I'm assuming the savings in your test are because of the magnitude of difference in the function calls.<br><br>50,000 per loop iteration versus one (well, okay, 3 - Memcopy(), BankBuf(), and length()).<br><br>Did you happen to test the CreateStaticBank() or any other methods? I'd be curious to see the results. <br><br></td></tr></table><br>
<a name="713327"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SculptureOfSoul</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Oh, one more thing to note. String.length returns the length of the string - not the length + 1. Also, unless you explicitly add a /0 to the end of the string, it won't be there (the only reason I didn't use teststring.toCstring() is because that calls memalloc for the new string therefore introducing more overhead. I figured it would be faster, and easy enough, to just add the null character yourself. <br><br></td></tr></table><br>
<a name="721455"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Fabian.</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Varptr teststring <br></div>I guess you don't want to have a pointer to a variable containing an object (which you're doing with Varptr), because such pointers are normally not useful. I think you wanted to get a pointer to the string data itself, so better use code like this:<pre class=code>Short Ptr Byte Ptr Object str + 2 'works, but is also not the proper solution</pre>Also note that MemCopy's first parameter is the destination, so<div class="quote"> MemCopy( Varptr teststring, BankBuf(testbank), teststring.length) <br></div>would surely cause a memory exception. I'd suggest you better to use String.ToCString which is much more safety. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
