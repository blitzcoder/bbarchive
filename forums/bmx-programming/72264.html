<!DOCTYPE html><html lang="en" ><head ><title >Local variable lifetime</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Local variable lifetime</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Local variable lifetime</a><br><br>
<a name="807582"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have a function... OnPaint()<br><br>Which is required to create an instance of a Paint object, which is used to draw with.<br><br>C++ creates a local variable, so that when the OnPaint function is finished, the variable loses scope and is removed from the stack immediately.<br><br>When I create a local BlitzMax variable, it will last well beyond the scope of the function (in memory... Delete isn't called until GC decides to).<br>Having this around after the OnPaint causes issues on Windows.<br><br>I have worked a way around it, by making a call to my Paint object's Free() method, which frees the under-lying data, and removes the problem.<br><br>Without explicitly asking the GC to cleanup, I guess there is no way around the problem, is there?<br><br>I'm happy enough using Free(), if that's what it takes. <br><br></td></tr></table><br>
<a name="807585"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Local variables are cleaned up on the next automatic GC call if they went out of scope.<br>But this happens ONLY when you are in Strict or SuperStrict.<br><br>Without Strict, you don't have any local reference checking and using local might cause quite some interesting stuff.<br><br><br>What I actually don't see is why it should cause problems.<br>You can't use the object anymore after it went out of scope, so how should it interfer at all, unless you gave it some automatic "handling" which is a quite bad idea on a local object that is meant to life within a "time box" (ie from start to the end of the function at max with no interaction to the outside, otherwise it wouldn't be a local) <br><br></td></tr></table><br>
<a name="807587"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Couldn't it be a problem when the GC deletes the already deleted object?<br><br><div class="quote"> Having this around after the OnPaint causes issues on Windows. <br></div><br>Wich issues? It sounds very strange without more info. don't get me wrong, I believe you, it is just a matter of curiosity as I've never get this kind of things with BlitzMax. Is this variable pointing something 'outside' the blitzmax code (a pointer used from internally called C or C++ code)? <br><br></td></tr></table><br>
<a name="807602"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Is this variable pointing something 'outside' the blitzmax code <br></div><br>Yes, which is required not to exist any more at the end of the OnPaint() function.<br>In C++, this variable would be GC'd away automatically, because it is created on the local "temporary" stack.<br><br>I may stick with the "make sure you call Free() when you are done" method, for ease of implementation. <br><br></td></tr></table><br>
<a name="807616"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> In C++ nothing is GCed, as C++ has no GC, so a little strange comparision :)<br><br>It will just be freed due to the fact that its whole stack frame is removed.<br>Thats a major difference between managed and not managed languages.<br><br>But yes if you use external objects you need to be free for sure at the end of the function, do it manually.<br><br>As the documentation clearly states: never do anything, that needs to be done at a specific moment within the delete as there is no execution order guarantee nor execution time guarantee for the cleanup through the GC.<br>Or to make it worse: if you call end within your app, NO further delete methods will be called! <br><br></td></tr></table><br>
<a name="807637"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Russell</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just a nerdy question related to GC: Is GC a thread that examines your variables' states periodically parallel to program execution or is it compiler inserted code that does the same but while the code is halted, if this makes sense.<br><br>How many languages have no GC at all? That is, how many require you to clean your mess(es) yourself? Are there advantages to this? (Other than being able to say that you are using a truly pure language that only compiles YOUR actual code without any 'fluff'). ;)<br><br>Russell <br><br></td></tr></table><br>
<a name="807638"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Ok, That was the only situation I could thing of. Could this be releated to the GDI+ library? GDI+ architecture is not exactly managed code friendly...<br><br>I don't know exactly what are you at, but I managed to solve  this on C# by creating the variable in the function 'caller' passing it as a parameter, and the same function caller 'frees' the variable inmediatly after the function call. That makes the unmanaged functioning of the variable transparent to managed code (in this case, the module user).  I supose OnPain is a sort of event or 'event connector' on wxWidgets, so this could be doable. If I'm wrong, just forget it. :D <br><br></td></tr></table><br>
<a name="807672"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> creating the variable in the function 'caller' passing it as a parameter, and the same function caller 'frees' the variable immediately after the function call. <br></div><br>:-)<br>That was one way I considered too, but that requires me to add a lot more logic in order to work for a specific event (namely the paint event). So yes, you were right ;-)<br><br>And... at the moment I have too much other code to sort out before I need to worry too much about this - I can always come back to it and apply that kind of logic if it's going to be better for everyone. <br><br></td></tr></table><br>
<a name="807680"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Czar Flavius</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Or to make it worse: if you call end within your app, NO further delete methods will be called!  <br></div><br><br>Oh dear. I always put End on the last line of my program, just for completeness. Is that ok? <br><br></td></tr></table><br>
<a name="807691"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Azathoth</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> As long as no important code that has to be called is in any delete method. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
