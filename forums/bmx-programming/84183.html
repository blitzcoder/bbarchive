<!DOCTYPE html><html lang="en" ><head ><title >Steam wrapper?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Steam wrapper?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Steam wrapper?</a><br><br>
<a name="950739"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't know how good my chances of getting my game on Steam are after hearing about some people with better games being turned away, but I heard someone here made some kinf of wrapper which allow Blitzmax to work with the Steam platform.  Does anyone have any information about that? <br><br></td></tr></table><br>
<a name="950746"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tachyon</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Eschalon is on Steam. I hired Brucey to write the wrapper for me.<br><br>However, if you don't use any of the "extras" such as ranking or stats, then you actually don't need any part of the Steamworks SDK. You just use their content tool to package your game into Steam's DRM and upload it, so I never actually needed the BlitzMax Steamworks wrapper. <br><br></td></tr></table><br>
<a name="950747"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >plash</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Tachyon: That was my assumption of the SDK.. You only need them for the extras. <br><br></td></tr></table><br>
<a name="950750"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> My dll/wrapper is free but I prefer you already have game id established on the steam servers before I distribute to you. <br><br>It has two users so far, one Blitz3D and one BlitzMax, achievements only on both games. From my understanding both games weren't allowed on steam without having at minimum a rewards system. <br><br></td></tr></table><br>
<a name="950764"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jkrankie</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Skid, actually, I added achievements to Bullet Candy via you wrapper around 2 and a half years after it first appeared on the service (Steamworks didn't exist as it does now when they contacted me with the deal). However, it seems to be the case now that you'd need to add achievements as part of the 'getting on Steam' process.<br><br>Cheers<br>Charlie <br><br></td></tr></table><br>
<a name="950827"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> How do achievements work?  I mean, with Steam.  <br><br>Do you call a function to report that the player achieved a particular objective?  And do you have to read a player's achievements from the Steam servers so they keep them no matter where they log in?  Wouldn't you want to do this with high scores as well?  I suppose depending on how you can define the achievements you could store high scores in this way.<br><br>It seems like you'd need to have two versions of the game, one for Steam and one for everyone else, if you port stuff like scores and achievments over the accounts. <br><br></td></tr></table><br>
<a name="998924"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Valve are interested in my game Super Laser Racer but have requested that I implement a leaderboard and achievements with Steam. I have access to the sdk but no nothing about writing a wrapper. Any chance I could use yours Skid? <br><br></td></tr></table><br>
<a name="999014"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have uploaded latest version of stub for bb and bmx here:<br><br><a href="http://code.google.com/p/max-edit/downloads/list" target="_blank">http://code.google.com/p/max-edit/downloads/list</a><br><br>Siread and others, please don't publish / advertise this link. I am not currently an official steam developer. You will need dev status with steam then I think it should be ok to post any questions here. sswift you should get basic idea of capabilities of sdk from the decls file. <br><br></td></tr></table><br>
<a name="999096"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >siread</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks Skid, that works beautifully. I punched the air when I saw the Steam notification come up with an achievement. :D<br><br>I would like to add the leaderboard commands to the wrapper but don't know how to create the .a and stub.dll files. Can you point me at a thread with info regarding this? <br><br></td></tr></table><br>
<a name="999105"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2009)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> if you have a steamid (or not), please email me mods and i'll build an update (visual studio required) simonarmstrong+chr(64)+blitzbasic.com <br><br></td></tr></table><br>
<a name="1139722"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sonic</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sorry to revive an old thread, but I was wondering what the possibility of getting a Steam network wrapper for BMax written.  <br><br>I've just released my previous game on Steam, Lone Survivor <a href="http://lonesurvivor.co.uk/" target="_blank">[link here]</a> (written in Flash + Air, but the tools were all made in BlitzMax), and I'm thinking about doing something with multiplayer aspects planned from the start.  I'm currently thinking about using Unity for it, but I'm still considering a lower-fi version using BlitzMax + MiniB3D as it's what I feel most comfortable with, and I already have a prototype I kind of like in it.<br><br>I just wondered in theory if anyone still posting here would have this kind of expertise and might be interested in working on this, paid of course?<br><br>To give an idea of what I'm going for, it's kind of an invisible pvp matchmaking similar to From Software's Dark Souls.  I want up to four players, 2v2, and I'd be proposing to Steam that I use their networking from the ground up.  It's all very nebulous at the moment, and it would depend on Steam's interest in the idea, but I just wanted to see if there was anyone around who might be able to do this in theory?<br><br>If you'd prefer to contact me privately, my email is jasper at superflatgames dot com.  Thanks! <br><br></td></tr></table><br>
<a name="1203139"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2013)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> I am looking for something like this as well.  I am an approved Steam developer:<br><a href="http://steamcommunity.com/sharedfiles/filedetails/?id=145716110" target="_blank">http://steamcommunity.com/sharedfiles/filedetails/?id=145716110</a> <br><br></td></tr></table><br>
<a name="1253726"></a>

<a name="1253729"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Godra25</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> i'm sorry if i bump this tread..<br><br>i've try the "mod" from skidracer. and it worked perfectly :)<br><br>but, i need just one more command from steamworks:<br><pre class=code>SteamUserStats()-&gt;ResetAllStats();</pre><br><br>how to use that command with skidracer's mod ?<br><br>thanks <br><br></td></tr></table><br>
<a name="1264778"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi Skidracer,<br><br>Just checking with you if I can use your Steam wrapper for my BlitzMax game Regency Solitaire: <a href="http://steamcommunity.com/sharedfiles/filedetails/?id=383336796" target="_blank">http://steamcommunity.com/sharedfiles/filedetails/?id=383336796</a><br><br>I found a link to steamstub4a.zip (Mar 2010) via the link above.<br><br>Do I just include the dlls in the same folder as my exe? I'm guessing I should probably get a newer version of steam_api.dll from valve as the steamstub.dll is yours right?  Anything else I should know? I'm a noob.<br><br>I'm planning on using it for achievements only at the moment. I'm also doing trading cards but they don't need the API do they? I think I just set them up in the Steam backend, but could be wrong.<br><br>Many thanks for your help! :-) <br><br></td></tr></table><br>
<a name="1264966"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yes and yes. <br><br>The Mac setup is a bit more tricky so I recommend starting with windows. <br><br></td></tr></table><br>
<a name="1264978"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> Great thanks skid!<br><br>Anyone got any tips about the Mac integration? I don't know where to start. Thx. <br><br></td></tr></table><br>
<a name="1265076"></a>

<a name="1265077"></a>

<a name="1265079"></a>

<a name="1265080"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK some incoming questions!<br><br>1) Does OpenSteam() call SteamUserStats()-&gt;RequestCurrentStats()?  The docs say the to set any stats or achievements you must have called that first. Also the docs say it's an async callback so I don't know how soon after calling that it's safe to actually start setting stats, or does the lib handle that?<br><br>I notice that ReadSteam() returns "stats received!" so I'm guessing it's working as expected (and I do appear to be able to get/set stats.) Note that I was getting a stats error before until I actually set up a test stat on Steamworks and published it.<br><br>2) If I peak in the lib I see ClearSteamAchievement but it's not in the steamtest.bmx  Is it safe to use it like this?<br><pre class=code>Function GetSteamAchievement%(id$z)</pre> It would be useful during test to clear them after setting them so I can retest.<br><br>3) Also in the lib is CloseSteam. Do I ever need to call that? It's not called in steamtest.bmx <br><br>4) When is the best time to call OpenSteam()? Right at the top of my code or after the game has created a graphics window?<br><br>5) When should I see that little Steam popup in the corner? I made a build of my game (with no API integrated) and uploaded it via Steam Pipe then installed it. When I click the icon, it calls steam://rungameid/*myappid* and I see the popup in the corner and shift+tab works, yay!  However, if I run the game direct in the steamapps\common\Regency Solitaire folder there's no overlay (which is to be expected I guess as there's no API integrated).<br><br>BUT when I run the game via my Blitmax compiler (not in the steam install folder) and I'm properly loading the dlls and calling OpenSteam() (which is returning 1) and I'm able to get/set stats OK, I don't see any kind of pop up (and shift+tab doesn't do anything). Should I? I've yet to try this with setting achievements to see if I see an achievements popup.<br><br>6) If I just call OpenSteam() and it returns 1, then later I exit my game I see this message in the console window:<br>"Setting breakpad minidump AppID = *myappid*<br>Steam_SetMinidumpSteamID:  Caching Steam ID:  76561197994138291 [API loaded no]"<br><br>What does that mean? Does it mean I need CloseSteam() first? or something failed somewhere?<br><br>Also weirdly that only appears when I run in release mode. If I run in debug mode I don't see it. Is that because the exe has a different name and Steam knows?<br><br><br><br>Phew a lot of questions, sorry, but I want to make sure I've done things correctly.<br><br>Also btw, calling FindNumberOfCurrentPlayers() with the latest steam_api.dll results in an Access Violation. So I'm guessing the lib is no longer compatible with that. I don't actually need it, just a heads up for Skid. <br><br></td></tr></table><br>
<a name="1265104"></a>

<a name="1265892"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> Related to no.5 a friend of mine said I need to call SteamAPI_RunCallbacks() every frame to see the popups and so shift+tab works and achievement popups show etc.  That isn't in the lib but I thought that maybe ReadSteam() has the same effect? So I call ReadSteam() every frame (which returns null except for when I get/set stats) but I don't see the Steam overlay.  Any ideas?<br><br>[EDIT]I checked out steamstub.cpp and I see that ReadSteam() does call SteamAPI_RunCallbacks(), which is good. Also in the SDK docs they say to call that at 10Hz or higher, but say most people call it every render (so maybe 60Hz). So that answers that. <br><br></td></tr></table><br>
<a name="1265115"></a>

<a name="1265116"></a>

<a name="1265117"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> Grey, good to see you are up and running. I'll review your questions tonight when I'm home from work. <br><br></td></tr></table><br>
<a name="1265135"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mac integration thread is <a href="/posts.php?topic=96950" target="_blank">here</a>. You don't need the steamstub dll as you can include steamstub.cpp directly into blitzmax but you do need a post compile step where the steam api library needs to be copied into the .app folder.<br><br>1 yes, see steamstub.cpp source in other thread if you don't have a copy<br><br>2.i will add ClearSteamAchievement to next release, I like the idea of a game that wipes out your achievements if you do something really bad<br><br>3. I doubt it, guys in other thread would know more<br><br>6. that crash is I think steamstub trying to call printf which it shouldn't be, <br><br><br>I would prefer to build a MSVC based bmk for windows blitzmax steam apps so we could drop use of the extra .dll but until then it will need to be compiled. Are you in a position to build the .dll Grey? I would prefer to focus on Mac support and if you could build the dll from source in visual studio that would make things easier for me. <br><br></td></tr></table><br>
<a name="1265147"></a>

<a name="1265399"></a>

<a name="1265400"></a>

<a name="1265401"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for the answers Skidracer, I'll check out that other thread now.  I'm keen to know how to get the Steam overlay (and pop up) showing (as per question 5 above) and to know if I should be calling SteamAPI_RunCallbacks() every frame (or maybe less frequently). Any ideas?<br><br>[EDIT: The other thread suggests that the overlay will only appear when running the game via Steam, so I'll test that.  However, do I still need to call ReadSteam() every so often for anything? Is it likely to impact performance at all and so I should call it sparingly? Like it won't hitch up gameplay I hope.]<br><br>I do have an evaluation copy of Visual Studio Pro 2010 installed (that I can get a trial key for), but I'm not experienced in using it at all, so it depends how easy it is to build the dll - but I'm willing to try. <br><br></td></tr></table><br>
<a name="1265636"></a>

<a name="1265637"></a>

<a name="1265638"></a>

<a name="1265641"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Another question:<br><br>I can obviously check the result of OpenSteam() and then only call things like GetSteamStat() if Steam is running.  If Steam isn't running then calling GetSteamStat() results in an access violation.  So what can I do in situation whereSteam is running when the game boots up, but the player closes Steam and keeps playing the game and then I call a function like GetSteamStat()?<br><br>At the moment I'll get an access violation unless I ALWAYS call OpenSteam() before any other functions. Is it safe to call it multiple times in a row, is it slow, is there are better way to do this?  Wouldn't it be better if GetSteamStat() failed more gracefully than an access violation?<br><br>[EDIT] OK a friend tells me that if you try to close Steam whilst a game is running, it'll force quit the game. Tested and confirmed that.  So I guess the above is a non issue as long as I cache the result of OpenSteam() on game boot. <br><br></td></tr></table><br>
<a name="1265642"></a>

<a name="1265644"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> On a related note to the above post, how are people handling stuff like awarding an achievement when Steam isn't running? Store it locally and just send the current state of achievements to Steam every time the game runs? Or just assuming Steam is always running (bit dangerous as the achievements could get out of sync) <br><br></td></tr></table><br>
<a name="1265645"></a>

<a name="1265646"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> How are people handling non-STEAM builds once they have integrated the lib and dlls?<br><br>I don't want to ship the dlls with the game to portals like Big Fish Games, but if I leave the Import "steamstub.lib" in my code and the various Externs like OpenSteam() etc. then when I run the game without the steamstub.dll in the exe folder, it obviously bombs because it can't find the .dll.<br><br>So I can comment out all the imports/externs AND every single call to any Steam functions but it's a massive hassle and not a sensible way to do things.<br><br>I can't use a Const to filter out those imports/externs and Steam function calls because I need to use a conditional compiler variable instead (a #define basically).  However you can't make custom compiler directives in BlitzMax :-(<br><br>So maybe I need to make a file called dummySteam.bmx and includ that for non-Steam builds. It could have no externs and I can have empty steam function calls in it so that the rest of my code compiles.  Workable? <br><br></td></tr></table><br>
<a name="1265771"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pingus</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> <i>It could have no externs and I can have empty steam function calls in it so that the rest of my code compiles. Workable? </i><br><br>That's what I do for stuff that I do not want to compile in the release build. Not very elegant but of course it works. For things that do not have to change it is tedious but no big deal. <br><br></td></tr></table><br>
<a name="1265789"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK thanks. Guess I'll try that then. <br><br></td></tr></table><br>
<a name="1265814"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you buy Leadwerks the editor DLL has Steam C functions you can hook into.  All you have to do is call SteamworksInitialize() and SteamworksShutdown() at a minimum.  It works with BMX. <br><br></td></tr></table><br>
<a name="1265816"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pingus</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> Josh, could you post some bmax code samples ? Sounds interresting... <br><br></td></tr></table><br>
<a name="1265827"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah sounds interesting. Btw, why does Shutdown have to be called? <br><br></td></tr></table><br>
<a name="1265849"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> You would need the lib file to do it this way, or you can just call LoadLibraryA() and get the function pointers:<br><pre class=code>?debug
Import "../Library/DLL/Debug/Leadwerks.lib"
?
?Not debug
Import "../Library/DLL/Release/Leadwerks.lib"
?

Extern "C"
	'Steamworks
	Function SteamworksCountSubscribedWorkshopItems:Int()
	Function SteamworksGetSubscribedWorkshopItem(fileid:Byte Ptr,index:Int)
	Function SteamworksGetWorkshopItemTimeUpdated_(fileid:Long,time:Byte Ptr)="SteamworksGetWorkshopItemTimeUpdated"
	Function SteamworksGetWorkshopItemTitle_(fileid:Long,buf:Byte Ptr,sz:Int)="SteamworksGetWorkshopItemTitle"
	Function SteamworksInstallPackage:Int(fileid:Long, installhook(filepath:Byte Ptr))	
	Function SteamworksUninstallPackage:Int(path$z)
	Function SteamworksExtractWorkshopFiles:Int(force:Int)
	Function SteamworksGetWorkshopFileDescription:Int(fileid:Long,buf:Byte Ptr,sz:Int)
	Function SteamworksIncrementAchievementProgress(name$z)
	Function SteamworksSetAchievement(name$z)
	Function SteamworksGetAchievement:Int(name$z)
	Function SteamGetAppID:Int()
	Function SteamGetAppAge:Int(fileid:Long)
	Function SteamworksSubscribeAndDownloadWorkshopFile:Int(fileid:Long,callback:Byte Ptr)
	Function SteamworksUnsubscribeWorkshopFile:Int(fileid:Long,callback:Byte Ptr)
	Function GetUserPublishedFileTags(index:Int,buf:Byte Ptr,sz:Int)
	Function SteamworksDLCSubscribed:Int(appid:Long)
	Function SteamworksDLCInstalled:Int(appid:Long)
	Function SteamworksGetUserID(buf:Byte Ptr)
	Function CountUserPublishedWorkshopFiles:Int()
	Function GetUserPublishedWorkshopFileAppID(index:Int,buf:Byte Ptr)
	Function GetUserPublishedWorkshopFileID(index:Int,buf:Byte Ptr)
	Function GetUserPublishedWorkshopFileTitle(index:Int,buf:Byte Ptr,sz:Int)
	Function SteamworksUpdateWorkshopItemFile:Int(fileid:Long,filename$z,previewfile$z,comment$z,callback:Byte Ptr)
	Function SteamworksUpdateWorkshopItemPreviewFile:Int(fileid:Long,filename$z)
	Function SteamworksSyncSubscribedFiles(callback:Byte Ptr,downloadgames:Int)
	Function GetWorkshopCachePath_(buf:Byte Ptr,sz:Int)="GetWorkshopCachePath"
	Function SteamworksLoadBank:LEBank(path$z)
	Function SteamworksSaveFile_:Int(path$z, data:Byte Ptr, size:Int)="SteamworksSaveFile"
	Function SteamworksPublishScreenshot:Int(path$z,title$z,desc$z,tags$z,callback:Byte Ptr,result:Byte Ptr)
	Function SteamworksAddScreenshot:Int(path$z,width:Int,height:Int)
	Function SteamworksShutdown()
	Function SteamworksInitialize:Int()
	Function SteamworksPublishVideo:Int(vid$z,title$z,desc$z,buf:Byte Ptr)
	Function SteamworksPublishFile:Int(path$z, title$z, desc$z, previewfile$z, price:Int, callback:Byte Ptr, fileid:Byte Ptr, tags$z, privacy:Int, appid:Long)
EndExtern</pre> <br><br></td></tr></table><br>
<a name="1265891"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for posting that. Is that an example list of externs or everything you support? It seems like a pretty comprehensive list but there are a few things that seem missing that could be useful unless I'm misinterpreting things:<br><br>For testing:<br><br>SteamAPI_ISteamUserStats_ClearAchievement(intptr_t instancePtr, const char * pchName);<br><br>OR<br><br>SteamAPI_ISteamUserStats_ResetAllStats(intptr_t instancePtr, bool bAchievementsToo);<br><br>Also GetStat() and SetStat(). Although admittedly I don't plan to use those at the moment, just thought they might be useful.<br><br>Also I don't see a RequestStats() call or a StoreStats() call.  Apparently we have to call those before and after setting an achievement or do your SteamworksSetAchievement() and SteamworksSetAchievement() function do that internally?<br><br>I read that I'm supposed to call SteamAPI_RunCallbacks() every render frame but I don't see a function in your Externs, so how should I handle that?<br><br>Thanks. <br><br></td></tr></table><br>
<a name="1265896"></a>

<a name="1265897"></a>

<a name="1265898"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Skidracer: OK I checked out steamstub.cpp and see it has a couple more useful functions such as ClearSteamAchievement() and also CloseSteam() (which the SDK docs say I should call on game shutdown). Previously I found them by looking at the raw .lib file but I didn't see them in your example code. However, I'm guessing they are easy to add as Externs like this:<br><br><pre class=code>
Function ClearSteamAchievement(id$z)
Function CloseSteam()
</pre><br><br>That's probably all I need to be honest. Will test out and report back.<br><br>Also is it possible to just import the .cpp file into my BlitzMax project instead of using the .lib? That way I can tweak the .cpp as I need to. Sounds like I have to do that on Mac anyway so I'd prefer it if both were the same, but maybe it's not that simple... <br><br></td></tr></table><br>
<a name="1266212"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> Unfortunately no, steamstub needs to be built with visual c stool chain. <br><br></td></tr></table><br>
<a name="1267144"></a>

<a name="1267145"></a>

<a name="1267146"></a>

<a name="1267147"></a>

<a name="1267148"></a>

<a name="1267149"></a>

<a name="1267150"></a>

<a name="1267220"></a>

<a name="1267221"></a>

<a name="1267222"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> I can confirm that adding those two Externs above worked fine.  Also I'm using wrapper functions for all the lib functions I use (that test if Steam is active before calling the lib functions). This also means that I can have a file called SteamDummy.bmx with *empty* wrapper functions that I can include in non-Steam builds (so I only need to change one line of code (the include filename) instead of in many places).<br><br>Anyway it's all working now, yay! Just writing some code to save my achievements locally so that I can update their status on Steam if they're out of sync when the game boots.<br><br>[EDIT]Done that too and have seen the achievement popup in-game when I run a proper Steam build that I've uploaded via Steampipe.<br><br>Everything is working as expected although I'm still seeing this in the Console window when I exit (and I am calling CloseSteam() before exiting) Don't know if it's something I should be worried about:<br><br><pre class=code>
Setting breakpad minidump AppID = 351090
Steam_SetMinidumpSteamID:  Caching Steam ID:  76561197994138291 [API loaded no]
</pre> <br><br></td></tr></table><br>
<a name="1267275"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pingus</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> Uff, having a game on Steam seems quite a fight... <br><br></td></tr></table><br>
<a name="1268748"></a>

<a name="1268749"></a>

<a name="1268750"></a>

<a name="1268751"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Grey Alien</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> OK so the game launched and in theory it seems to work OK.  However, I did get a problem when I was testing my achievements where suddenly sending stuff to Steam was failing (more details in a moment.)<br><br>Also one user reported some achievements not unlocking and the Steam overlay disappearing (I guess meaning Steam had crashed).  I got them to reboot Steam and the game and then their achievements unlocked but that's because I have special code where my game ALWAYS logs the achievements and stores them in a local file and then when the game boots, it compares them to the Steam achievements and updates any that are out of sync. So I'm glad I coded that safeguard.<br><br>So what happened when I got the issue in testing was:<br><br>I unlocked two achievements in my game when I beat a level and my debug output looked like this:<br><br><pre class=code>
SET Steam Achievement:Stars20
SET Steam Achievement:Gold5000
&lt;ReadSteam&gt;:stats stored!
&lt;ReadSteam&gt;:Achievement 'Stars20' unlocked!
&lt;ReadSteam&gt;:stats stored failed 16!
</pre><br>You can see that the second achievement never unlocked and that stats stored failed.<br><br>Then as I continued to play this happened when I unlocked a single achievement when I beat a level:<br><br><pre class=code>
SET Steam Achievement:Gold6000
&lt;ReadSteam&gt;:Achievement 'Gold5000' unlocked!
&lt;ReadSteam&gt;:Achievement 'Gold6000' unlocked!
&lt;ReadSteam&gt;:stats stored failed 16!
</pre><br>So the Gold 5000 unlocked then (and I saw it pop up) but I was still getting the stored stats failed message.<br><br>I also got another achievement after this and it unlocked and popped up but I was still getting the stats failed message.<br><br>Then I exited and reloaded the game but was getting an error on game boot when retrieving the stats from Steam. I shut down steam and logged on again and then it worked. So definitely something went FUBAR.<br><br>Here's my code for setting achievements:<br><pre class=code>
Function SetSteamAchievementWrapper(name:String)
	'Do not call this until ReadSteam has returned "stats received"
	If Not SteamIsActive Then Return
	
	SetSteamAchievement(name)
	StoreSteamStats() 'It seems to work without this but the SDK docs say I need this.
	If STEAM_DEBUG Then		
		Print "SET Steam Achievement:" + name
	EndIf		
End Function
</pre><br><br>Note how it it calls StoreSteamStats() after setting an achievement. This is because that's what it does in the Steam SDK docs. I thought that was kinda weird, but I'm doing it anyway.  Maybe it's wrong? Any ideas?<br><br>Also, I call ReadSteam() every frame (after each screen draw).  This means that I might set multiple achievements using my code above BEFORE calling ReadSteam. In theory that should be find as ReadSteam just processes the Steam callbacks and reports the status, but maybe there's a problem there?<br><br>I actually tested this again and successfully unlocked 2 achievements at once. So it's more like an intermittent problem and I don't know the inner workings of things.<br><br>Anyway, just reporting it in case anyone else discovers something similar or has any ideas. <br><br></td></tr></table><br>
<a name="1268759"></a>

<a name="1268760"></a>

<a name="1268761"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why are you calling StoreSteamStats???<br><br>If you had looked at the c++ source in the mac thread you can see that steamstub is already calling this function.<br><br>I think what you are doing is having another conversation with the steam network that will generate confirmations that will make no sense whatsoever.<br><br>Why are you calling StoreSteamStats? It's not even exposed... <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
