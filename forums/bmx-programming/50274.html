<!DOCTYPE html><html lang="en" ><head ><title >Jerky Movement Code</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Jerky Movement Code</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Jerky Movement Code</a><br><br>
<a name="559080"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jay Kyburz</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think something is wrong with my game timing and main loop. <br><br>I have locked the frame rate to 50 fps (or 20 ms). Basically I measure the time since last frame and wait any unused time until 20ms has passed, then increment the position of objects and render again.<br><br>It may be my imagination but the movement seems really jerky and uneven.  I know 50 fps is slow these days but there is an unevenness that I would not have expected. I've tried it at 100fps and the problem still exists. I'm using frame deltas and have even logged them. They seem to be working correctly, always exactly 20ms. <br><br>I'd appreciate if you guys could take a look and see if you think it looks a bit rough as well. Have you seen this is your projects and how did you fix it?<br><br><a href="http://www.jaykyburz.com/files/GameTest.zip" target="_blank">http://www.jaykyburz.com/files/GameTest.zip</a><br><br><br>I've read about some c++ guys doing sub pixel rendering. Does Bmax support this? Are the screen x and y passed to DrawImage converted to ints somewhere? <br><br></td></tr></table><br>
<a name="559084"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Sledge</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you are locking your game to 50Hz and the lowest rate your monitor supports is, say, 60Hz (like mine) then of course it will look jerky. The highest rate mine will support at some resolutions is 85Hz, so both your examples (60 and 100Hz) would fail to sync correctly for me.<br><br>Post another test that attempts 60Hz and I will happily check that out - the one you've got at the time of writing does indeed look a bit jerky on my setup.<br><br>EDIT: Also, delta-timing is also bound to introduce jerkyness - if you've got an object that has to move a fixed two pixels right every frame at a resolution of 800*600, that's not going to translate into a fixed pixel distance per frame at either 640*480 (1.6 pixels per frame) or 1024x768 (2.56 pixels per frame). Sub-pixel rendering would help mask this and although Max does pixel-perfect 2D by default (crosses fingers and hopes that's correct) I would be surprised if it wasn't available (I'm waiting for the 3D module and decent audio so can't investigate - perhaps the OpenGL forum here could shed better light on this issue). <br><br></td></tr></table><br>
<a name="559091"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jay Kyburz</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> oh.. i should add I've disabled vsync<br><br>I was just looking at the example here <br><a href="http://www.blitzbasic.com/Community/posts.php?topic=50249" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=50249</a><br><br>and if you add a 20 ms delay and disable vsync you get a similar jerkiness. Perhaps not as bad. If you enable vsync it look crap like my game so perhaps I'm not disabling vsync properly.<br><br><pre class=code>

Strict

'SetGraphicsDriver D3D7Max2DDriver()
Graphics 800,600,32',NOSYNC

Local x = 0

Repeat

	If KeyHit( KEY_ESCAPE ) Then Exit

	x = x + 1
	If x &gt; 800 Then x = 0

	Cls
	DrawRect x, 0, 32, 50
	Flip
	
	Delay (20)

	FlushMem

Forever

End

</pre> <br><br></td></tr></table><br>
<a name="559100"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jay Kyburz</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> also, if somebody points me in the direction of the formating stuff for the fourm that would be great. :) <br><br></td></tr></table><br>
<a name="559101"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Hotcakes</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> The problem is this : your screen does not get updated with the graphics the same speed as your program is producing them.  The refresh rate of most people's screens is probably going to be 75 or 85 - but let's use an example of 60.<br><br>If you program your game to use a set speed of 50 frames a second, what will happen is that every 1 in 5 frames will be doubled, compensating for the extra 10 frames per second.  This is what causes the notable jerkiness.<br><br>The ultimate solution is to find out what refresh rate the graphics card/drivers/directx/opengl/whatever have chosen to kick into - however this doesn't seem to be possible in directx7, don't know the situation for dx9 or ogl - if you could find out the exact number you can adjust all the timing in your game by that amount...  but since you can't, well, there's other ways.  You -could- force the refresh rate setting to a number chosen by you - but you have to be extra careful that the gfx card or monitor can handle it - and even if the drivers tell you it can be handled, they could be lieing.  This is what BlitzMax tries to rely on.  It seems to be the preferred way...<br><br>Another option is to run your game at 1000 fps =] That will look smooth on anybody's system (if it can handle the computations) =] <br><br></td></tr></table><br>
<a name="559141"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ozak</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why not disable vsync and the use delta timing to make sure it runs the same speed in all cases? <br><br></td></tr></table><br>
<a name="559532"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Jay Kyburz</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> For anybody interested I just decided to run my update at 10ms or 100 fps instead of 50.  I spent many hours last night playing with all kinds of systems for stepping time and decided that 50fps is the problem not some inaccuracy in the movement calculations. <br><br></td></tr></table><br>
<a name="559789"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Wiering</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I was playing around with Jay´s code, running in a window now. If I change the driver to OpenGL, I do get perfectly smooth motion without tearing! (set the frequency to something the same or higher than your actual monitor frequency).<br><br>Using the D3D7 driver there is always tearing. Even if I set the frequency to 85 Hz (which is what my monitor does), the tearing keeps staying at the same place for a while.<br><br>&lt;code&gt;<br>Strict<br>' SetGraphicsDriver D3D7Max2DDriver ()<br>SetGraphicsDriver GLMax2DDriver ()<br>Graphics 800, 600, 0, 100<br>SetClsColor 0, 50, 150<br>SetColor 255, 240, 210<br>Local x = 0<br>Repeat<br>	x = x + 8<br>	If x &gt; 800 Then x = 0<br>	Cls<br>	DrawRect x, 0, 32, 600<br>	Flip<br>	FlushMem<br>Until KeyHit (KEY_ESCAPE)<br>End<br>&lt;/code&gt; <br><br></td></tr></table><br>
<a name="559891"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Steve Elliott</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I get tearing in Wiering's example for both OpenGL and DirectX - only when the refresh rate matches my monitor refresh rate does it disappear.<br><br>btw Jay Kyburz, the formatting codes can be selected from the Home Page, FAQ then Website - Forum. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
