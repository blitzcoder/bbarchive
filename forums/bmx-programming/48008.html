<!DOCTYPE html><html lang="en" ><head ><title >How to find the most time-consuming function?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >How to find the most time-consuming function?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >How to find the most time-consuming function?</a><br><br>
<a name="533598"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Somewhere I got some function that slows everything down. I'm guessing it has to do with my packing functions because they are no way optimized and I have no idea what to look for or how to code them in a more efficient way. It's easy to check the time a function takes to execute by simply runnin it 100000 times and check the total time. But how do I know when a function is slow or fast? I mean any function takes some time. What would be considered fast or slow? Anyone who has any experience in this? <br><br></td></tr></table><br>
<a name="533626"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LarsG</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> You have to measure it to the rest of your code...<br>you can for example run different functions repeatively, and timeing them with millisecs, to get an quick overview of which function is the most time consuming.. <br><br></td></tr></table><br>
<a name="533628"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >SoggyP</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello.<br><br>You need to consider each function in relation to the other functions around it.  How often is each function being called per iteration - the function might not be particularly slow but if it's being called a massive number of times then that's where it will impact.<br><br>Whether a function is slow or fast is relative: if it's doing an overly complex task then it will take a long time - see if there's a way you can run a particular function in chunks.  Check out the code archives or post code and ask for more optimum solutions.<br><br>Goodbye. <br><br></td></tr></table><br>
<a name="533631"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> are you using flushmem inside your loops (I'm assuming your packing function uses a for or while loop somewhere in it)?<br>Flushmem can dramatically speed up a large loop. <br><br></td></tr></table><br>
<a name="533647"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you know your most used/most time consuming function you, at least, have a way of knowing where potential time savings are. <br>Looking at a function which takes 0-5ms and is called once won't be high on your optimisation lists even if you save 1 ms.<br>If you have a function which takes 1000 ms and is called<br>every loop (or every nth loop) and you save 50ms it's a better use of time.<br>Just an idea, how about creating a small viewport which displays a coloured rect in proportion to the  function time to get a graphical output of where you're spending time. Alternatively, save the times to a type and then use that at the end to create a graph of time spent along with the raw data. <br><br></td></tr></table><br>
<a name="533664"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I guess I have to test each function with my benchmark test. All my packing stuff does pretty small but complex things which should take but a fraction of the CPU. I mean if the pack/unpack makes the game slower (online) than by sending tha unpacked Data then somethings is really wrong =)<br><br><br><div class="quote"> are you using flushmem inside your loops (I'm assuming your packing function uses a for or while loop somewhere in it)?<br>Flushmem can dramatically speed up a large loop. <br></div>Can you explain how/why, seems like a good thing to know. <br><br></td></tr></table><br>
<a name="533741"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> You might find that sometimes an optimization that you try to make, such as compressing something, may actually end up being slower and less efficient than the routine was before you optimized it. It really depends. Optimizing doesn't always give you better results. I would compare the optimized version of something with the original and see how it fares. Sometimes a more elegant algorithm is better, sometimes it makes a total meal of it. <br><br></td></tr></table><br>
<a name="533875"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> "more elegant algorithm" have the problem that they were often created for "industrial usage" with really large amount of data and stuff and not for "little games" which is why their "computer science small constant" overhead sometimes tends too make them run worse than naive algorithm implementations because the constant was never meant for 1000 operations or similar "funny little values" ;-)<br><br>Can only agree with AngelDaniel, perhaps even extend it:<br><br>If you optimize stuff you should not only check single functions on their runtimes but check for crossreferences that might have influence on other functions. <br><br></td></tr></table><br>
<a name="534079"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Bollocks. A more elegant algorithm (ie. one with a lower degree of time complexity) will always be more effective than one with a higher degree of time complexity. Particularly with larger datasets, or many itterations. If an algorithm has linear time complexity (for example) on 100.000 objects run 100.000 times, it will still have linear time complexity on a 100 objects with 100 itterations, the time factor will just be smaller. The only worthwhile optimisation is to design an more elegant algorithm, with a lower degree of time complexity, namely logarithmic or constant.<br><br>In this light, the better test would be not to test the same function several thousands of times with the same input, but instead test it only once, with increasingly larger inputs. That way you can get a good picture about which factors contribute to slower code.<br><br>BlitzMax really could use a code profiler tho'. <br><br></td></tr></table><br>
<a name="534195"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Perturbatio</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Can you explain how/why, seems like a good thing to know. <br></div><br>The <a href="http://www.blitzwiki.org/index.php/FlushMem" target="_blank">BlitzWiki</a> has a reasonable page on flushmem <br><br></td></tr></table><br>
<a name="534317"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> I see now why Flushmem help when I do that many irritations. I did really speed up the test times.<br><br>FlameDuck I agree that looping it thousands of times may not be the best way of measure, still if I loop it less than a couple of tousand times, the time to complete the function will be smaller than a millisec. Then I can't measure it, right?<br><br>Also I have the problem that all packing functions seems to run fast enought, 22 microsecs at most. Is there a crucial limit I should watch for and have as high-cap? Let's say I run a function that takes 22microsecs five times when a pack arrives, that would mean a 0,1 millisec delay which shouldn't be noticable.<br><br>I re-made the test. This seems to give a much better measure. Anyone has any idea on how to improve it?<br><pre class=code>

Strict

Graphics 80,40,0,-1
Global Loops = 10000000'Set This depending on the speed of your function
	
Local T%=0, MinFlex!=4321, MaxFlex! , PicoDelay% = 0

For Local NR_Times = 1 To 5'Do the test 5 times
	
	Local Start = MilliSecs()
	
	'	\	\	\	\	\	\	\	\
	For Local Count = 0 To Loops 
		' I N S E R T   F U N C T I O N   T O	 T E S T   H E R E
	
		
	
	
		FlushMem
		' A N D   C H E C K S   H O W   L O N G   I T   T A K E S 
	Next
	'	/	/	/	/	/	/	/	/
	
	Local Tex% = ( MilliSecs() - Start )'Time since loops started
	Local Flex! = 1000*( Double(Tex) / Double(Loops) )'time For each loop
	
		T:+1
		If Flex &gt; MaxFlex MaxFlex = Flex'Get slowest time ')
		If Flex &lt; MinFlex MinFlex = Flex'Get best time =)

	Print "Test"+T+" - Time for "+Loops+" loops is "+Tex+" MilliSec. Each Loop Avg :"+Flex+" MicroSec"
	CalcAvg.Create( Tex, Flex )'Time, EachTime
	FlushMem
	Delay 100
Next

CalcAvg.Avg()

Print ""
Print "AVERAGE Time for "+Loops+" loops is "+CalcAvg.AvgMilli+" MilliSec."
Print ""
Print "Each Loop Avg :"+CalcAvg.AvgMicro+" MicroSec"
Print ""
Print "In PICO sec: "+CalcAvg.AvgMicro*1000


Type CalcAvg

	Global AvgMicro!,AvgMilli!,List2:TList
	Field Micro!,Milli!

	Function Create(Milli!,Micro!)'Milli=TimeForAllLoops, Micro=TimeFor1Loop
		Local C:CalcAvg = New CalcAvg
		If List2 = Null Then List2 = CreateList()
		List2.Addlast(C)
		C.Micro = Micro
		C.Milli = Milli
	EndFunction
	Function Avg()
		Local TotalMicro!,TotalMilli!,Count
		For Local C:CalcAvg = EachIn List2
			TotalMicro:+ C.Micro
			TotalMilli:+ C.Milli
			Count:+1
		Next
		AvgMicro = TotalMicro/Count
		AvgMilli = TotalMilli/Count
	EndFunction
	
EndType	
</pre> <br><br></td></tr></table><br>
<a name="534324"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Tibit</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> What about doing it simple and right within the actuall code of the main program? <br><br>Time = Millisecs()<br><br>Update() 'Function to test<br><br>TimeTook = Millisecs() - Time<br><br>But how would I make the above work if Update() takes less than 1 millisec. I want a better timer.. <br><br>What is the precition of the CPU clock? Is that what blitz uses? It it impossible to measure in nanosecs() or better? <br><br></td></tr></table><br>
<a name="534341"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >BadJim</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> I suggest putting a counter in your functions so you get an idea of how often they are being called.<br><br><br>"A more elegant algorithm (ie. one with a lower degree of time complexity) will always be more effective than one with a higher degree of time complexity."<br><br>Not true. Take, for example, the quicksort vs insertion sort. On large disorganised databases the quicksort wins hands down. <br><br>However, the recursive function calls are time consuming. With just a few elements the insertion sort will be a lot faster since the time complexity isn't slowing it down yet. Optimised quicksorts sort down to small groups then use another algorithm to sort the small groups out.<br><br>Also, the insertion sort has much better time complexity on mostly sorted data. If it sorts something in a game loop then it may already be mostly ordered from the previous frame and the insertion sort will be faster. <br><br></td></tr></table><br>
<a name="534424"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >LeisureSuitLurie</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Unless I dreamt it, I think Mark mentioned support for code profiling at some point.<br><br>It appears not to have been implemented yet. <br><br></td></tr></table><br>
<a name="534646"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >teamonkey</td><td align="right"><font class=tiny>(Posted 2005)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I wrote a simple profiler a while ago. It should do the job.<br><br><a href="http://blitzbasic.com/Community/posts.php?topic=43396" target="_blank">http://blitzbasic.com/Community/posts.php?topic=43396</a> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
