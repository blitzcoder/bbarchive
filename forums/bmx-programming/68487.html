<!DOCTYPE html><html lang="en" ><head ><title >where does VarPtr point to?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >where does VarPtr point to?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >where does VarPtr point to?</a><br><br>
<a name="765204"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rozek</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello!<br><br>Lets assume that I have two variables<br><br>  StringVar:String<br>  ArrayVar:Byte[]<br><br>In that case, will<br><br>  VarPtr StringVar<br>  VarPtr ArrayVar<br><br>point to the first character in StringVar or the first element in ArrayVar, resp.? Both types are actually Objects, which means that VarPtr could yield the address of s.th. else...<br><br>(FYI: I'm asking because I'll have to pass pointers to external C functions and would like to know if I'll have to do some addtional preparations or may pass the VarPtr's as such - don't worry about "length" issues: the "length" is always passed separately) <br><br></td></tr></table><br>
<a name="765217"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rozek</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hmmm,<br><br>I think I found a different approach to solve the underlying problem - but (for academic reasons) the question persists... <br><br></td></tr></table><br>
<a name="765251"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >grable</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Varptr gives you the pointer to the variable itself, like <b>&amp;</b> in c.<br><br>Passing the array would suffice as its just a pointer to its first element anyway.<br><br>Strings has to be passed via a <b>$z</b> parameter or by using  <b>.ToCString()</b> (dont forget to <b>MemFree()</b> it when your done!). <br><br></td></tr></table><br>
<a name="765254"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Brucey</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> If you had an int,<br><br>Local x:int = 5<br><br>and you had a C function - void myFunc( int x )<br><pre class=code>
Extern
    Function myFunc( x:Int )
End Extern
</pre><br>you could pass x into the function with<br><br>myFunc(x)<br><br>If the C function was - void myFunc( int * x )<br><pre class=code>
Extern
    Function myFunc( x:Int Ptr )
End Extern
</pre><br>you could pass it into the function with<br><br>myFunc( Varptr x)<br><br><br>For Strings... it depends on the context. I've found occasions where I can define my Extern as   myString:Byte Ptr, and simply pass the string into the function itself.<br>In other places I convert to a CString first... <br><br></td></tr></table><br>
<a name="765293"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Azathoth</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> What they said though if the C functions use wide chars use WString instead of CString. <br><br></td></tr></table><br>
<a name="765296"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Rozek</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for your posts!<br><br>Indeed, a Byte[] seems to be the same as a pointer to its first element - the following test illustrates this:<br><pre class=code>
local Text:Byte[] = [byte(0),byte(1),byte(2),byte(3),byte(4),byte(5),byte(6),byte(7)]
local TextPtr:Byte Ptr = Text
print(TextPtr[0]+","+TextPtr[1]+","+TextPtr[2]+","+TextPtr[3])
print(TextPtr[4]+","+TextPtr[5]+","+TextPtr[6]+","+TextPtr[7])
</pre><br>yields<br><br>0,1,2,3<br>4,5,6,7<br><br>as expected. On the other side, a similar code<br><pre class=code>
local Text:String = "abc~0def"
local TextPtr:Byte Ptr = Text
</pre><br>is rejected by the compiler - and<br><pre class=code>
local Text:String = "abc~0def"
local TextPtr:Byte Ptr = VarPtr Text
print(TextPtr[0]+","+TextPtr[1]+","+TextPtr[2]+","+TextPtr[3])
print(TextPtr[4]+","+TextPtr[5]+","+TextPtr[6]+","+TextPtr[7])
</pre><br>produces<br><br>16,211,102,0<br>104,255,168,0<br><br>which is *not* what you would expect. <br><br></td></tr></table><br>
<a name="765302"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2007)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> A string is a string.<br>It is a special object no array of char like in C nor is a VAR an actual pointer that you can use on arrays like in C. BM is managed and can if needed move and resort data where needed so if you use pointer, always be aware that they will cause you many problems of done within BM or if you rely on "long term aliveness".<br><br>If you need array of char, you have to use the above mentioned CString and WString functions and use them. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
