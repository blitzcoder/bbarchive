<!DOCTYPE html><html lang="en" ><head ><title >Looping sounds with fixed start/end positions?</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Looping sounds with fixed start/end positions?</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >Looping sounds with fixed start/end positions?</a><br><br>
<a name="1111500"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Johnsprogram</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> I know there are programmatic ways to play a song with one part played once and the other part loop forever; I've made one myself as two sound files. But the problem with my solution is that it's prone for so-called "silent gaps" to happen during the switch from one-played song to looping-song. Therefore, adjusting the framerate maximum to lower than 60 fps would make the gaps more noticeable; especially for slower computers.<br><br>I take it that any audio playing in the blitz app will be running asynchronously with the actual blitz program, correct? (Which includes both the app and the modules.) Therefore, I wonder if the DirectSound, OpenAL, or FreeSound drivers could be able to play a sound and loop at different points?<br><br>Why do I want to loop at different points the hard way than the easy programmatic way? It's because of the following reasons...<br>1) Depending how slow the blitz app is, you'll notice the silent gaps more easily.<br>2) The audio would play upon end while the app is too busy to respond in time to loop the audio; especially if you drag the blitz app window cross.<br>3) I thought it would sound more professional to have the audio to loop (from one point to another) smoothly. <br><br></td></tr></table><br>
<a name="1111541"></a>

<a name="1111543"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just high-level information. You'll have to research further.<br><br>When working with OpenAL, you could create 2 buffers: one that contains the beginning of the sound, and the second containing the <i>rest of the sound that's supposed to loop</i>.<br><br>Then queue both buffers into the same Source with alSourceQueueBuffers(), and play it.<br>In your game loop or <i>on a separate thread</i>, keep polling the source to see how many buffers were processed (using alGetSourcei() with the AL_BUFFERS_PROCESSED constant). If it has processed 1, we know it's currently playing the second buffer. Therefore, at that moment we can take action and set the source's playing mode (alSourcei() and AL_LOOP constant) to AL_TRUE.<br><br>With this I think the source will lock at looping the second buffer, which is the section of the sound you want to play like that. <br>I'm sure DirectSound has similar functionality, but you need to research. The BlitzMax audio modules source code can be of help here.<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1111612"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midimaster</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> perhaps it will help you:<br><br>sound used: <br><a href="http://www.blitzforum.de/upload/file.php?id=11057" target="_blank">http://www.blitzforum.de/upload/file.php?id=11057</a><br><pre class=code>Graphics 800,600
Global Channel:TChannel, Zeit%
Global Klang:TSound=LoadSound("rock.ogg")
Repeat
	PlayAgain
Until KeyHit(1)

Function PlayAgain()
	If Zeit&lt;MilliSecs()
	Print "play"
		oldChannel=Channel
		Channel=PlaySound(Klang)
		Delay 200
		If oldchannel&lt;&gt;Null
			StopChannel oldchannel
		EndIf
		Zeit=MilliSecs()+5620
	EndIf
End Function
</pre><br><br>it demonstrates how to punch out of a sound (before finished) and start the next one without gaps<br><br>have a look on the sound with audacity. it fades in and out <br><br></td></tr></table><br>
<a name="1111730"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Johnsprogram</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> Midimaster: I'm planning on a new game, so I cannot use this because the code just focuses on the audio only.<br><br>Kryzon: I wonder if there's a way to set OpenAi only once to play two song (with the 2nd one looping) and not periodically check the driver to tell it to switch songs?<br><br>I've tried switching sounds by threading before, but the application ends up being too slow. I might try that approach again, but I wanted to find out if I could just send instructions to the sound drivers themselves. <br><br></td></tr></table><br>
<a name="1111737"></a>

<a name="1111738"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Midimaster</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> the sample code focuses on the audio, but of course it also works in a game where you use a 60Hz timer. Also the DELAY only should demonstrate you to stop the first sound 200msec after starting the same in a second channel.<br><br>Of course it also works in a event driven GUI.<br><br>Where do you see problems using my solution?<br><br>We never had problems with gaps! And we are doing a lot of music stuff with BMax! Do you know you have to find the right point to punch out? Perhaps your gaps are a result of not searching for a zero-crossing?<br><br><font class="tiny">Last edited 2011</font> <br><br></td></tr></table><br>
<a name="1111740"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Kryzon</td><td align="right"><font class=tiny>(Posted 2011)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> You can't do automation with OpenAL or DirectSound. The only thing close is queueing buffers, and you can't loop them with an <b>offset</b> (i.e: play something all the way to the end then loopback to some specific point in the buffer, like a specific section of the buffer).<br><br>There is a feasible way though: with both songs loaded into one buffer each, queue the <b>first song</b> to some Source, then the second song to this same Source. Play the Source.<br>Game loop: Keep polling the Source's number of buffers processed. As soon as the Source is done processing <b>at least one buffer</b>, queue the <b>second song</b> again. <br><br>In the end, you are controlling the loop yourself. <b>You will never hear a pop</b> - the buffers are queued by the driver itself, and you never have to wait until everything stops playing to recycle data (you're doing it while it's playing).<br><br>This is all explained in detail in this real-time streaming article: <a href="http://www.devmaster.net/articles/openal-tutorials/lesson8.php" target="_blank">http://www.devmaster.net/articles/openal-tutorials/lesson8.php</a> <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
