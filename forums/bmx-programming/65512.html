<!DOCTYPE html><html lang="en" ><head ><title >GC Hell</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >GC Hell</h1><a href="forums.php" >BlitzMax Forums</a>/<a href="topics.php?forum=102" >BlitzMax Programming</a>/<a href="#bottom" >GC Hell</a><br><br>
<a name="731663"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any tips for debugging memory leaks in Max?  I have a type I can't seem to free without leaking memory.  It references and gets referenced by many other types, so it is very hard to make sure all the references are deleted. <br><br></td></tr></table><br>
<a name="731681"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Show me an UML classdiagram and I'll tell you the problem. <br><br></td></tr></table><br>
<a name="731692"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Sounds like the OO design would need some rework if you have that many references to it that you can't say if all references are removed.<br><br>Normally, memory leaks are caused by cyclic structures (rings). for example: <br><br>a references b, b references c and c references a<br><br>such a ring will never be freed unless you manually break up at least 1 of those 3 references, because they all keep each other alive.<br>In such a case, you need a destroy method (which you most likely need anyway to remove its reference from the handling list / map) which just null-ifies all references stored on the current object. That way you normally do not have any problem. If you have a ring assigned to the object, just make sure that before you null the reference, that you call the destroy method on your "ring reference" as well. <br><br></td></tr></table><br>
<a name="731715"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't know of any way to debug Max memory leaks other than elbow grease and time.  :-/ <br><br></td></tr></table><br>
<a name="731770"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImaginaryHuman</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> Flameduck what the hell are you talking about? lol <br><br></td></tr></table><br>
<a name="731779"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> I've had this bug for three months.  That's how difficult it is to sort this all out.<br><br>It would be nice if there was a way to get some feedback from the garbage collector, like give it a variable and find out how many references exist to that variable. <br><br></td></tr></table><br>
<a name="731785"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> <a href="http://en.wikipedia.org/wiki/Unified_Modeling_Language" target="_blank">UML</a> <a href="http://en.wikipedia.org/wiki/Class_diagram" target="_blank">Class Diagram</a>. A static visualization of the different interactions between your software classes. It is usually used during software design activities, but just as often reverse engineered from code to help identify poor design choices (like for instance the cyclic references Dreamora is on about). <br><br></td></tr></table><br>
<a name="731789"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think someone just wants to show off how smart they think they are. <br><br></td></tr></table><br>
<a name="731798"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> You're entitled to your ill-informed opinion. But by all means keep sifting through your code for another three months, rather than solving it straight away.<br><br>See how much I care. <br><br></td></tr></table><br>
<a name="731827"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gabriel</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> It would be nice if there was a way to get some feedback from the garbage collector, like give it a variable and find out how many references exist to that variable. <br></div><br>I've requested this several times, and didn't get any reply. Feel free to add your voice.<br><br>There's also a workaround ( which might break at any time ) from Dreamora in there.<br><br><a href="http://www.blitzbasic.com/Community/posts.php?topic=62724#725019" target="_blank">http://www.blitzbasic.com/Community/posts.php?topic=62724#725019</a> <br><br></td></tr></table><br>
<a name="731829"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Warren</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Flameduck what the hell are you talking about? lol <br></div><br>He's still in school. <br><br></td></tr></table><br>
<a name="731830"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> @FlameDuck:<br>Good and clear design certainly help, sure.<br>On the other hand I really can't understand how people can seriously think that having cyclic references is a bad design per se. I've been hearing that here and there, and to me that's just pure nonsense.<br>And from the moment you have cyclic references AND a garbage collector that cannot handle them gracefully, you have to be very carefull *at the global level*. That is, ensuring there is no memory leak requires knowledge about the whole application.<br>With a full GC that's not true anymore. If an object is not collected, then it is still reachable. If it is not, it will be collected eventually. And that's it. No need to know the whole graph of references, which makes quite a difference.<br><br>So there is a real concern about memory leaks handling in BlitzMax. That's life and we just have to live with that, but saying otherwise won't help anyone.<br><br>Being pedantic won't help either.<br><br>@Leadwerks : There was a thread on the subject recently. You can get the reference count of an object by getting an integer pointer p (not reference) to your object, and use it to address p[-1] (or maybe [-2] etc, just test it). That's a hack but could certainly help you in your debugging. But to be of any use you'd need to be sure at any time which objects are *supposed* to be freed (but are not). <br><br></td></tr></table><br>
<a name="731836"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nelvin</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why, at least for as long as there's no complete garbage collector, isn't Max tracking allocations and spit out a list of those not referenced after the application was run in debug mode. It's dead simple to implement and pretty effective for tracking most leaks and it ususally doesn't need any noticable resources - and even if it would it wouldn't harm as it should obviously be optional / debug only.<br><br>Another maybe even better way would be to add user definable callbacks/notification for allocation events (alloc, free, add/remove ref, relocate - if the memory manager supports it) - so it would be even possible to easily create runtime memory monitors, track only relevant events etc. <br><br></td></tr></table><br>
<a name="731866"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tonyg</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any way to use <a href="/codearcs.php?code=1808" target="_blank"> this </a> and parse the output after each allocation in debug mode? It won't tell you how many references to an object but you might see if there's a difference. <br>Might help... might not. <br><br></td></tr></table><br>
<a name="732050"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >FlameDuck</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> He's still in school. <br></div>Like Halo, you to are entitled to your ignorant uninformed opinion.<br><br><div class="quote"> Being pedantic won't help either. <br></div>I'm not being pedantic. I'm trying to help. If Halo doesn't want my help, that's fine too. I really couldn't care less whether he bangs his head against the wall for another 3 months. But tracking down a memoryleak without (at least) some indication of how his program is structured is impossible. <br><br></td></tr></table><br>
<a name="732079"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Koriolis</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> That's true, but tracking it with only your nice UML diagram is close to be as foolish, and I dare to hope you realize it. So all in all your answer doesn't seem to be helpfull in anyway to me. It doesn't even appear to try to.<br>Not that I would care if you just don't want to help him mind you, that's something I can very easily understand. But why not just NOT post? If you seriously want me to think you were offering real help, you'll need to be very convincing. And pay me more than one pint of beer. <br><br></td></tr></table><br>
<a name="732136"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshK</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> Okay, I fixed the problem.<br><br>It wasn't an old existing bug.  I recreated an old bug I hadn't seen in a long time, and I hadn't been using the portal system for a while, so I freaked out and thought it was something else I remembered from a long time ago.<br><br>Whew! <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
