<!DOCTYPE html><html lang="en" ><head ><title >unloading memory  (freeimage)</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >unloading memory  (freeimage)</h1><a href="forums.php" >Archives Forums</a>/<a href="topics.php?forum=50" >Blitz3D Bug Reports</a>/<a href="#bottom" >unloading memory  (freeimage)</a><br><br>
<a name="1157523"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ILonion</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hello!<br><br>I found some trouble in &lt;FreeImage&gt; operator:<br><br>I trying to unload images, using Freeimage. Well, it seems strange (by task manager):<br><br>win7 64 bit:<br>start program, blitzcc.exe used - 14 Mb;<br>after load images (big animimages) - 74 Mb;<br>after FreeImage - 38,5...44 Mb.<br><br>win7 32bit:<br>14 Mb - 74 Mb - 74 Mb...<br><br>Where is unloading memory? :)<br><br><br><br>testunit:<br>;-------------------------------------------------------------------<br>;-------------------------------------------------------------------<br>;-------------------------------------------------------------------<br>Global curdir$ = CurrentDir$()<br><br>Graphics 800,600,16,2<br>SetBuffer BackBuffer()<br><br>Global limitspeed = CreateTimer(70)<br>Global image1<br>Global image2<br>Global image3<br>Global load_animation<br>Global op_menu<br>Global animation_clock = 0<br>Global anim_secs = MilliSecs()<br>Global frame<br>;-------------------------------------------------------------------<br>;-------------------------------------------------------------------<br>While Not KeyHit(1);esc<br>	<br><br>	WaitTimer(limitspeed)<br>	Cls<br>	<br>	Text 10,10,"press SPACE to start\stop"<br>	<br><br>	If Not (MilliSecs() &lt;= (anim_secs + 33));33 ms.<br>		animation_clock = 1<br>		anim_secs = MilliSecs()<br>	End If<br>		<br><br>	;<br>	If KeyHit(57); space button<br>		If op_menu = 1<br>			op_menu = 0<br>			load_animation = 0		<br>		;<br>			FreeImage image1<br>			FreeImage image2<br>			FreeImage image3<br>		Else<br>			op_menu = 1<br>		End If<br>	End If<br>	<br>	;<br>	If op_menu = 1<br>		open_menu()<br>	End If<br>	<br>	animation_clock = 0<br>	<br>	<br>	<br>Flip<br>Wend<br>;-------------------------------------------------------------------<br>;-------------------------------------------------------------------<br>Function open_menu()<br>	;<br>	If load_animation = 0<br> 		image1 = LoadAnimImage (curdir$ + "image1.png",410,172,0,30)<br> 	 	image2 = LoadAnimImage (curdir$ + "image2.png",167,404,0,30)<br> 	 	image3 = LoadAnimImage (curdir$ + "image3.png",200,407,0,30)<br>		load_animation = 1<br>	End If<br><br>	If animation_clock = 1		<br>		frame = frame + 1<br>		If frame = 26 Then frame = 0<br>	End If<br>	<br>		DrawImage image2,50,23,frame<br>		DrawImage image1,185,320,frame<br>		DrawImage image3,600,30,frame<br><br>End Function<br><br>;-------------------------------------------------------------------<br>;-------------------------------------------------------------------<br>;-------------------------------------------------------------------<br><br>Help somebody! :)<br><br><br><br>the images used (gray lines in top):<br><img src="http://tau.rghost.ru/40461659/image.png">      - image1<br><img src="http://higgs.rghost.ru/40461682/image.png">   - image2<br><img src="http://tau.rghost.ru/40461686/image.png">      - image3 <br><br></td></tr></table><br>
<a name="1157535"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Yasha</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> Task Manager is not a good way to measure your program's memory use. It displays the amount of memory allocated by the system, for the whole program, <i>not</i> the amount of memory allocated by the program for use as objects.<br><br>-- if the system is not under memory pressure, it will be relaxed about reclaiming memory that it doesn't need and may be used again in short order by your program.<br><br>-- if small objects allocated by your program persist on a memory page, that entire page is lost to the system even if most of it is unused. So if you allocate huge image - tiny wrapper object - huge image - tiny wrapper object... and each pair takes up one page, then deallocate all the images, all the memory will stay in use by your program because the wrapper objects are all on separate pages.<br><br>A slightly better test is to see what happens to the Task Manager figure when you reload the images. Does usage jump up to 140MB? Or does it reuse that space, indicating that the system was just being conservative? <br><br></td></tr></table><br>
<a name="1157541"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ILonion</td><td align="right"><font class=tiny>(Posted 2012)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thank you very much, Yasha!<br><br>Yes, the memory is not increased. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
