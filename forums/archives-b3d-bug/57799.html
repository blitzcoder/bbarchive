<!DOCTYPE html><html lang="en" ><head ><title >Incorrect Floating Point comparisons with NaN</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Incorrect Floating Point comparisons with NaN</h1><a href="forums.php" >Archives Forums</a>/<a href="topics.php?forum=50" >Blitz3D Bug Reports</a>/<a href="#bottom" >Incorrect Floating Point comparisons with NaN</a><br><br>
<a name="642901"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >octothorpe</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> The <a href="http://en.wikipedia.org/wiki/NaN" target="_blank">Wikipedia article on NaN</a> states:<br><br><div class="quote"> A NaN <b>does not compare equal</b> to any floating-point number or NaN, even if the latter has an identical representation. One can therefore test whether a variable has a NaN value by comparing it to itself (i.e. if x != x then x is NaN). <br></div><br><br><pre class=code>
n# = Sqr(-1)
Print n
If n = 0 Then Print "oops"
If Not(n &lt;&gt; n) Then Print "oops"
</pre> <br><br></td></tr></table><br>
<a name="642919"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Damien Sturdy</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> I find this useful! <br><br></td></tr></table><br>
<a name="642983"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >octothorpe</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Please explain how you find this incorrect behaviour useful and I will explain how to find the correct behaviour useful. <br><br></td></tr></table><br>
<a name="643017"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Beaker</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> <pre class=code>n# = Sqr(-1)
Print n
If n = 0 Then Print "oops"
If n = n+1 Then Print "YAY"</pre> <br><br></td></tr></table><br>
<a name="643042"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >octothorpe</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> EDIT:&lt;offtopic&gt;That's an ambiguous test because n=n+1 also returns true for positive and negative infinity and very large (+ or -) values of n.&lt;/offtopic&gt;<br><br>If Blitz3D's floating point support was correct, you could still test for NaN - and with the standard test of n&lt;&gt;n as described by my Wikipedia quote above. <br><br></td></tr></table><br>
<a name="643055"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >sswift</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> If n# =  1.0/ZERO print "n = infinity"<br>If n# = -1.0/ZERO print "n = -infinity"<br>If n# = sqr(-1) print "n = NaN"<br><br>Have to use a zero variable because Blitz will stop you if you just try to divide by 0.  You can't use a constant because it will detect that as well.  <br><br>You may put NaN in a constant though. <br><br></td></tr></table><br>
<a name="643281"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >octothorpe</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> EDIT: sswift's NaN test is broken and will return true for any value of n#.<br><br>Yes, it is possible to test for NaN, Infinity, and -Infinity (albiet you'll need <a href="/posts.php?topic=57660#642748" target="_blank">better tests</a> than sswift's if you want to distinguish between them) with Blitz's current (incorrect) implementation of floats.  It would <i>also</i> be possible to test for these special values with a <i>correct</i> implementation!<br><br>Let's keep this on topic please.  The issue at hand is whether or not Blitz's NaN handling is correct and whether or not that constitutes a bug. <br><br></td></tr></table><br>
<a name="643288"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >skidracer</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> And what if the "correct behavior" degrades the peformance of every floating point comparison in your program? <br><br></td></tr></table><br>
<a name="643289"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >octothorpe</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't see any C programmers complaining that their language is inefficient. <br><br></td></tr></table><br>
<a name="643291"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Dreamora</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> Yeah but this is Blitz3D and not a 30 years high optimized C compiler :-) <br><br></td></tr></table><br>
<a name="643310"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >octothorpe</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> My point was that if the most famously efficient programming language in the world can afford to get floats right mandatorily without annoying the nerdiest of the optimizing hacker nerds, it's probably not much (if any) of a performance hit to do it properly.  I suspect this was a mistake as opposed to a design decision. <br><br></td></tr></table><br>
<a name="645008"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >jfk EO-11110</td><td align="right"><font class=tiny>(Posted 2006)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> yeah, not a big deal. they return true nomatter what. I guess it won't be that hard to make them return flase nomatter what, when compared with valid numbers. I think that's the standard and it will also prevent problems in code. Not an urgent one IMHO. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
