<!DOCTYPE html><html lang="en" ><head ><title >C to monkey2 converter 95% ready</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >C to monkey2 converter 95% ready</h1><a href="forums.php" >Community Forums</a>/<a href="topics.php?forum=530" >Monkey2 Talk</a>/<a href="#bottom" >C to monkey2 converter 95% ready</a><br><br>
<a name="2108646"></a>

<a name="2108647"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GC-Martijn</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> edit, I can't post the full topic.<br>Do it in multiple.<br><br><br>In my previous topic here <a href="http://www.monkey-x.com/Community/posts.php?topic=9953&amp;post=108371" target="_blank">http://www.monkey-x.com/Community/posts.php?topic=9953&amp;post=108371</a><br>I say that one monkey2 power is to extend with third party C modules.<br>Without any problem and with one click.<br><br>What I made is a C parser to Monkey2 (alpha version 00.1)<br>There are some small issues before its 100% working and I need some info from mark.<br><br>the steps are simple.<br>1. download a C lib, for example the latest SDL2 <a href="https://www.libsdl.org/download-2.0.php" target="_blank">https://www.libsdl.org/download-2.0.php</a><br>2. use the parser (not ready yet) (point to the tar/zip file)<br>3. give the monkey path, or copy the output files manual to the modules dir.<br><br>example output for the SDL2 C Lib<br><br>1.) din't check if all functions/structs/enums are 100% oke.<br>2.) I did only parse using the prefix SDL_ <br><br></td></tr></table><br>
<a name="2109211"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GC-Martijn</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> deleted because this was a big old output <br><br></td></tr></table><br>
<a name="2108648"></a>

<a name="2109210"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GC-Martijn</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> deleted because this was a big old output <br><br></td></tr></table><br>
<a name="2108649"></a>

<a name="2109209"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GC-Martijn</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> deleted because this was a big old output <br><br></td></tr></table><br>
<a name="2108650"></a>

<a name="2108651"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GC-Martijn</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> The non 5% working issue is this<br><br>1. can't use all reserved words...<br>I don't have the time now to think how to handle this, I can rename it to _something<br>But I think that stuct is not working then anymore<br><pre class=code>
Struct SOMETHING
	Field start:Int
	'Field end:Int  &lt;=== end is a reserved word in monkey
End
</pre><br><br>2. A struct using a Field struct<br>Did not test this yet, but I guess its not working (yet)<br><pre class=code>
Struct StuctA
	Field start:Int
End
Struct StructB
	Field bla:StructA
End
</pre><br><br>3. There where some duplicated Fields inside the struct with the same name but different Data Types.<br>Din't check the actual C code yet, if this is possible inside C<br><pre class=code>
Struct StructB
	Field bla:StructB
        Field bla:Int
End
</pre><br><br><br>Need Marks info about this.<br>1.) are you going to make a C converter ? (then I can stop :))<br>2.) I don't know if this is possible, but make the Stuct and Enum dynamic without the need to give all the possible fields.<br><br>Then there is no problem with reserved names, and its easy to parse C libs.<br><br>For example:<br><br>this is the new current output<br><pre class=code>
Struct SDL_Surface
	Field flags:Int
	Field format:SDL_PixelFormat
	Field w:Int
	Field pitch:Int
	Field pixels:void
	Field userdata:void
	Field locked:Int
	Field lock_data:void
	Field clip_rect:SDL_Rect
	Field map:Void
	Field refcount:Int
End
</pre><br><br>In your example code you do this<br><pre class=code>
Struct SDL_Surface
	Field format:SDL_PixelFormat Ptr
End
</pre><br><br>I want this<br><pre class=code>
Struct SDL_Surface
End
</pre> <br><br></td></tr></table><br>
<a name="2108683"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; 1.) are you going to make a C converter ? (then I can stop :))<br><br>Well, I was thinking about it, but may not have to now! I had a quick look at SWIG, but it's pretty complex. Maybe later...<br><br>&gt;	'Field end:Int  &lt;=== end is a reserved word in monkey<br><br>You'll need to do something like:<br><br>Field end_:Int="end"<br><br>So the compiler knows the 'real' name of end_.<br><br>&gt;	Field format:SDL_PixelFormat<br><br>You need the 'Ptr' at the end here because this is exactly what 'format' is - a pointer to a SDL_PixelFormat struct, not an instance of the struct. <br><br></td></tr></table><br>
<a name="2108684"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >therevills</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> Is MX2 going to support DLLs? If so would this mean a C to MX2 wouldnt be needed? <br><br></td></tr></table><br>
<a name="2108685"></a>

<a name="2108686"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Depends what you mean by 'support DLLs'.<br><br>If you mean 'load openall.dll' or similar AND you have access to the 'static link lib' for the dll, then yes, no problem. However, some kind mx2 wrapper will still be needed so mx2 knows what the dll contains, and the easiest way to do this is probably just to run a c2mx2 convertor on the lib's header files.<br><br>If you mean 'load openall.dll' and you don't have access to the static link lib, then you'll need to 'roll your own' using a bunch of GetProcAddress calls or similar. A c2mx2 util could also probably generate this for you based on the lib header files.<br><br>If you mean 'load dlls written in monkey', this is also doable but is in the 'later' pile. However, I am keeping it in mind. <br><br></td></tr></table><br>
<a name="2108702"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Richard Betson</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> Neat stuff. :) +1 <br><br></td></tr></table><br>
<a name="2108729"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GC-Martijn</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> I have &lt; 3 hours time this week, so I guess next week I have a valid converter (98% ready).<br><br>@marksibly<br>The first thing I did was trying SWIG but that was overkill and din't work how I think it needs to work ;)<br><pre class=code>
Field end_:Int="end" 
Yea i'm happy with this
</pre> <br><br></td></tr></table><br>
<a name="2109085"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GC-Martijn</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> @marksibly<br><br>I'm stuck because monkey2 enums has this bug<br><pre class=code>
Enum SDL_TextureModulate
	SDL_TEXTUREMODULATE_COLOR=1,
	SDL_TEXTUREMODULATE_ALPHA=-2,
	SDL_TEXTUREMODULATE_NONE=0
End
</pre><br>Enum initializer must be an int literal<br><br>Could you fix that -ints are oke for Enums<br><br>there are a few things to tackle but then the C to MX2 converter is ready.<br>i'm now looking what to do with typedef for example this C code:<br><pre class=code>
typedef void (SDLCALL * SDL_AudioCallback) (void *userdata, Uint8 * stream,int len);
</pre><br><br>bug 2 (not really but that you know it)<br><pre class=code>
Struct SDL_Surface
	'Field format_:SDL_PixelFormat Ptr="format"
	Field format:SDL_PixelFormat Ptr
End
</pre><br>When I use the first format_ to avoid forbidden names, then the program don't detect it using this.<br><br><pre class=code>
Local format:=surface[0].format
</pre><br><br>In this case its not a forbidden name, but when it was then there was a problem. <br><br></td></tr></table><br>
<a name="2109083"></a>

<a name="2109092"></a>

<a name="2109093"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; typedef void (SDLCALL * SDL_AudioCallback) (void *userdata, Uint8 * stream,int len);<br><br>It work work in the current release, but the mx2 equivalent of this is:<br><br>Alias SDL_AudioCallback:Void( userdata:Void Ptr,stream:Int Ptr,len:Int )<br><br>This declares a new 'type' that can be used with vars etc, eg:<br><br>Function SDL_StartAudio:Void( callback:SDL_AudioCallback )   'just an example, no idea if this func exists! <br><br></td></tr></table><br>
<a name="2109208"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GC-Martijn</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> @marksibly<br><br>I created my first git here :) maybe someone wants to help :)<br>I really don't know what will happen when someone does haha, but I guess it will work after the sync button :)<br><br><a href="https://github.com/gcmartijn/C2MX2" target="_blank">https://github.com/gcmartijn/C2MX2</a><br><br>The first goal is to get the full SDL2 lib working, after that it will be 'easy' to create many C bindings for Monkey2<br><br>Example output:<br><a href="https://github.com/gcmartijn/C2MX2/tree/master/example/sdl3" target="_blank">https://github.com/gcmartijn/C2MX2/tree/master/example/sdl3</a><br><br>(I use the name sdl3, to test it in monkey, and not to overwrite the sdl2 lib)<br><br>The enums with a negative number problem exists, but I don't know if the enum needs a value or if its a placeholder<br>But maybe you can see other things that need te be fixed ?<br><br>I don't have a C background nor monkey2 :)<br>Some quick questions:<br>- does the Cons need to have the default C value (I saw you din't do that)<br>- does the enum need to have the default C value (negative numbers gives a error now)<br>the main rule in the converter is : "if its not a monkey2 type (int/float/string/void) then its a Ptr <br><br></td></tr></table><br>
<a name="2109233"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looking good!<br><br>&gt; does the Cons need to have the default C value (I saw you din't do that)<br><br>You mean 'Const'?<br><br>No, if it's Extern, Const is really just a symbol that gets dumped into the c++ code. Since the c++ code includes the sdl.h files, the const values are already defined there so we don't need to define them again.<br><br>&gt; does the enum need to have the default C value (negative numbers gives a error now)<br><br>I haven't attempted to get extern enums working yet. You'll notice that in my little sdl2 wrapper I just converted all enums to consts. This 'sort of' works, because C enums aren't really scoped - you can just use the name of the enum directly pretty much as if it were a const. More work to be done here, but in general enums probably wont need initializer values either, as long as they're declared 'extern'.<br><br>To get something 'good enough' going, you could drop 'enum' altogether and convert enum members to plain consts, eg: this...<br><br><pre class=code>
Enum SDL_TextureModulate
	SDL_TEXTUREMODULATE_NONE=0,
	SDL_TEXTUREMODULATE_ALPHA=2,
	SDL_TEXTUREMODULATE_COLOR=1
End
</pre><br><br>...becomes this...<br><br><pre class=code>
Const SDL_TEXTUREMODULATE_NONE:Int
Const SDL_TEXTUREMODULATE_ALPHA:Int
Const SDL_TEXTUREMODULATE_COLOR:Int
</pre><br><br>I think it'd be a good idea to retain the ability to emit proper enums though, and to determine enum/const initializers where possible for the future. If we want it to be possible to ship modules without C/C++ source code (eg: just a blah.lib and a blah.mx2), then we WILL need to know the values of all consts and enums.<br><br>&gt; the main rule in the converter is : "if its not a monkey2 type (int/float/string/void) then its a Ptr<br><br>That wont work everywhere, eg:<br><br><pre class=code>
typedef struct SDL_Surface
{
    //lots chopped out
    SDL_PixelFormat *format;
    void *pixels;
    SDL_Rect clip_rect;
} SDL_Surface;
</pre><br><br>Here, 'format' is a pointer (because there's a '*' before it) while 'clip_rect' is not (because there's no '*'). Also, monkey2 types may need a Ptr, eg: the 'pixels' field above. Here's the above in monkey2:<br><br><pre class=code>
Struct SDL_Surface
   Field format:SDL_PixelFormat Ptr
   Field pixels:Void Ptr
   Field clip_rect:SDL_Rect
End
</pre> <br><br></td></tr></table><br>
<a name="2109231"></a>

<a name="2109232"></a>

<a name="2109230"></a>

<a name="2109229"></a>

<a name="2109228"></a>

<a name="2109227"></a>

<a name="2109226"></a>

<a name="2109225"></a>

<a name="2109224"></a>

<a name="2109222"></a>

<a name="2109223"></a>

<a name="2109238"></a>

<a name="2109239"></a>

<a name="2109240"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danilo</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any news about MX2 basic data types? (Byte, Short, Ascii, Unicode, Char, Long, Int, Int8, Int16, Int32, Int64, Quad, Float, Double, ...)<br><br>It is especially important to have fixed 'Int32' and 'Int64' types. Could be 'Long' and 'Quad', for example.<br>And one 'Int' type that is 32bit when compiled with 32bit C++ compilers, and 64bit with 64bit compilers.<br><br>WinAPI uses many DWORD and LONG parameters, that are always 32bit, even with 64bit compiler.<br>On Mac and Linux it's often different sizes in 32bit and 64bit compilation mode. <br><br></td></tr></table><br>
<a name="2109235"></a>

<a name="2109236"></a>

<a name="2109237"></a>

<a name="2109263"></a>

<a name="2109264"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I haven't given this too much thought as yet, but as far as I can tell most 64 bit OSes use either the LP64 or LLP64 data model, see:<br><br><a href="https://en.wikipedia.org/wiki/64-bit_computing#64-bit_data_models" target="_blank">https://en.wikipedia.org/wiki/64-bit_computing#64-bit_data_models</a><br><br>In these models, ints are still 32 bit. Only pointers (and either 'longs' or 'long longs') are 64 bit. This has been my experience messing around on 64 bit Mac/Windows/Linux recently.<br><br>So I think we should keep it simple:<br><br>Byte = 8 bits<br>Short = 16 bits<br>Int = 32 bits<br>Long = 64 bits<br>Float = 32 bits<br>Double = 64 bits<br>Char = (byte, short or int depending on a build setting?)<br><br>(There may be more/longer types eventually, but this is a good starting point).<br><br>So Int and Long are our 'fixed' 32 and 64 bit types, and there are no 'unfixed' types.<br><br>The size of int only really affects how data is stored. Bytes and shorts are always 'promoted' to ints when math is performed (which is a NOP if they're already in a local/register) so the choice of 8, 16, 32 or 64 bit ints only affects how much memory objects/arrays consume and struct layout. Which is of course important if you're interacting with an extern API.<br><br>If we ever want to support 'HAL Computer Systems port of Solaris to SPARC64' (never say never!) which has 64 bit ints, there will hopefully be an int32 c/c++ typedef available for use to use as a monkey 'int'. Failing that, the translator could do 32 bit int loads/stores manually. Math would occur in 64 bit and ints not already in registers would require promotion along with bytes/shorts, but that shouldn't be a problem. <br><br></td></tr></table><br>
<a name="2109261"></a>

<a name="2109262"></a>

<a name="2109260"></a>

<a name="2109259"></a>

<a name="2109258"></a>

<a name="2109265"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> @marksibly: Char = (byte, short or int depending on a build setting?) <br></div><br>I think you're best making char 16-bit for better wide character support.  Also, have you decided on whether it will support explicitly unsigned types? <br><br></td></tr></table><br>
<a name="2109267"></a>

<a name="2109268"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ImmutableOctet(SKNG)</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> I agree with Samah, <b>+1</b> for Char being 16-bit (At least as the default). As for consistent sizes, I assume you'll be supporting C++11 and onward, if not C++14 and onward. If that's the case, could use the <a href="http://en.cppreference.com/w/cpp/types/integer" target="_blank">'cstdint' header</a>. Though, depending on your settings with g++, that could cause problems. Plus, support might be a problem on some hardware platforms. Perhaps the best option is to go with the usual semi-loose type definitions?<br><br>Something like this:<br>* 'Char' is system or compiler defined.<br>* 'Byte' is at least 8 bit.<br>* 'Short' is at least 16 bit.<br>* 'Int' is at least 32-bit. (And commonly defined as such)<br>* 'Long' is normally at least 64-bit, but can be configured to be smaller on systems that don't support it...? (May just be easier to say it's not always portable)<br><br>At least with <a href="http://en.cppreference.com/w/cpp/language/types" target="_blank">C++11</a>, 'long long' is defined as at least 64-bit. Though, the traditional size of 'int' has been semi-defined as 32-bit, even though it's supposed to be at least 16. And of course, 'long' in C++ is usually 32-bit on Windows, but all the other vendors are fine making it 64-bit.<br><br>There's also the question of extensions/external types. It would be nice to be able to declare an 'Alias' as external/native. That way, we could theoretically have types like 'double double'. By the way, any thoughts on a definitive size-type? One that could be signed or unsigned, but would be the most effective for storing something's size. Basically, I'm asking if we'll see 'size_t'. <br><br></td></tr></table><br>
<a name="2109277"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; Also, have you decided on whether it will support explicitly unsigned types?<br><br>I'm still firmly in the 'unsigned is evil' camp, as it has all sorts of weird effects, eg:<br><br>If x-1&gt;x  '...if x is unsigned, this can be true!<br>While i&gt;=0   '...if i is unsigned, this loop will never exit! <br><br>...and many, many more. And you can end up with unsigned expressions if ANY of the subexpressions are unsigned so it can quite easy for an expression to become 'infected' with unsigned-ness without you knowing it. I stopped using unsigned ages ago, and have NEVER missed it.<br><br>There is probably only one situation I can think of where signed/unsigned might be useful, and that's for controlling how bytes/shorts are promoted to ints.<br><br>For example, DataBuffer.PeekByte() in monkey1 sign extends the byte when you load it. This effectively makes the data in a databuffer signed. If you want to treat it as unsigned, then you need to use PeekByte(blah) &amp; 255.<br><br>IMO, this is an acceptable solution, but here are alternatives that don't involve going 'full on' unsigned, including:<br><br>* Change byte/short to be unsigned instead of signed. You'd still need to use '&amp; 255' when dealing with 'signed' data so this just flips the problem, while introducing an 'exception' to the language. 'All data is signed' is IMO better than 'All data is signed except for bytes/shorts'. Some byte data is signed, some is unsigned, so I don't think there's a 'right' approach here, in which case KISS wins. But then, perhaps this is the one case where the 'extra bit of storage' argument makes sense?<br><br>* Allow unsigned for just byte/short. An extremely practical approach, but I suspect it'd be controversial - "if I can have unsigned bytes/shorts, why not ints?!?".<br><br>The current situation is still 'all data is signed, and if you're working with low level stuff you may have to use &amp; now and then...' but I'm still thinking this stuff over. <br><br></td></tr></table><br>
<a name="2109276"></a>

<a name="2109272"></a>

<a name="2109273"></a>

<a name="2109271"></a>

<a name="2109269"></a>

<a name="2109270"></a>

<a name="2109278"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; I think you're best making char 16-bit for better wide character support. <br><br>16 bit chars are OK for most apps, but for full unicode support we need at least the option of 32 bit chars don't we? <br><br></td></tr></table><br>
<a name="2109274"></a>

<a name="2109275"></a>

<a name="2109287"></a>

<a name="2109288"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> @marksibly: I'm still firmly in the 'unsigned is evil' camp... <br></div><br>Enforced signedness is one of the things I hate about Java.  It means that reading a byte from a stream must return something greater than 8 bits to prevent negative values.  In some terrible design decision they went for 32-bit, and streams are big-endian by default.<br><br><div class="quote"> If x-1&gt;x '...if x is unsigned, this can be true!<br>While i&gt;=0 '...if i is unsigned, this loop will never exit! <br></div><br>In each of these examples the developer would see the variable declaration and know immediately whether it was unsigned.  If it's a return value from another method, they really should be reading the documentation... XD<br><br><div class="quote"> @marksibly: There is probably only one situation I can think of where signed/unsigned might be useful, and that's for controlling how bytes/shorts are promoted to ints. <br></div><br>Such as supporting both big- and little-endianness.<br><br><div class="quote"> @marksibly: ...sign extends the byte when you load it... <br></div><br>That's fine for 8-bit, but how do you extend a 64-bit integer to ignore the sign?<br><br><div class="quote"> @marksibly: Allow unsigned for just byte/short.  <br></div><br>This is probably the best compromise, as it removes the need for stupid workarounds as outlined above, and small unsigned values are much more useful than large ones.<br><br><div class="quote"> @marksibly: 16 bit chars are OK for most apps, but for full unicode support we need at least the option of 32 bit chars don't we? <br></div><br>Then you should probably allow for Long Char as 32-bit, or they can just use Int. <br><br></td></tr></table><br>
<a name="2109286"></a>

<a name="2109297"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> Why exactly are Chars needed as a type primitive?  I'm only hearing about the disadvantages.  If they do end up being used, however, wide chars should use 32 bits by default, because 16-bit wide chars require supplemental pairs to handle unicode extended planes.  This is 2015, not 1994, so not being able to handle that case scenario is kinda unacceptable. <br><br></td></tr></table><br>
<a name="2109298"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GC-Martijn</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> I think the first question is: for who is monkey2<br>- for beginners/basic = keep it simple Int,Float<br>- for beginners and pro's = use extra types: Byte,Short,Int,Long,Float,Double<br>- only for pro's = maybe the other things <br><br></td></tr></table><br>
<a name="2109299"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> 16 bit chars are OK for most apps, but for full unicode support we need at least the option of 32 bit chars don't we? <br></div>True. Somewhere in the unicode specification it tells you why wchar_t shouldn't be used in portable code.<br><a href="http://unicode.org/standard/standard.html" target="_blank">Unincode Standard</a> <br><br></td></tr></table><br>
<a name="2109306"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Gerry Quinn</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> Just thinking aloud...<br><br>Could many of these problems be solved by adding some functions like Databuffer.PeekByteUnsigned:Int( address:Int )? <br><br></td></tr></table><br>
<a name="2109307"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >tiresius</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> I thought wchar_t in C++ was what we should be using and what I thought Mark was hinting at making Monkey Char behave as it.<br>So confused...  :-/ <br><br></td></tr></table><br>
<a name="2109308"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Pharmhaus</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>If x-1&gt;x '...if x is unsigned, this can be true!<br>While i&gt;=0 '...if i is unsigned, this loop will never exit!<br> <br></div><br>Would it be possible to change trans so that a conversion from int to uint and vice versa needs to be stated explicitly?<br>It is still better to me than no unsigned at all and it would be way easier to spot errors like these. <br><br></td></tr></table><br>
<a name="2109338"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danilo</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> 'x-1' is valid with both, signed and unsigned, number types. Both wrap around, so I don't see a problem here. It is known behavior.<br><br>If you make Unicode strings with 32-bit characters, you need to convert it for every system API function call (forth and back), because most<br>systems don't use 32-bit chars directly. Linux is the only one, AFAIK.<br>I think <a href="https://en.wikipedia.org/wiki/UTF-16" target="_blank"><u>UTF-16</u></a> is the most used today. It saves space and memory, compared to <a href="https://en.wikipedia.org/wiki/UTF-32" target="_blank"><u>UTF-32</u></a>. For english texts ASCII is usually enough,<br>and with UTF-32 you always quadruplicate the required string space/memory. With UTF-16 it's only doubling space/memory consumption,<br>most of the time. See also <a href="https://en.wikipedia.org/wiki/UTF-16#Usage" target="_blank"><u>UTF-16: Usage</u></a>.<br><br>UTF-16 can use multiple Words to encode one character, for some extended languages.<br>There is a limited subset of UTF-16. It's called <a href="https://en.wikipedia.org/wiki/Universal_Coded_Character_Set" target="_blank"><u>UCS-2</u></a> (sometimes UCS-16) and is limited to a Word (2 Bytes)<br>for one character. It supports the <a href="https://en.wikipedia.org/wiki/Plane_(Unicode)#Basic_Multilingual_Plane" target="_blank"><u>Basic Multilanguage Plane</u></a> only.<br>That means one characters is always 2 bytes long. UCS-2 can already display many languages, but not all.<br><br>For all characters, UTF-16 should be the best choice for most platforms. But if you fully support UTF-16, there must be functions<br>to differentiate string.ByteLen() and string.Len(). With the limited UCS-2 set, byteLen is always string.Len() * 2.<br><br>In ASCII compilation mode, additional support for <a href="https://en.wikipedia.org/wiki/UTF-8" target="_blank"><u>UTF-8</u></a> could be helpful, but that's library functions,<br>no built-in type. UTF-8 is compatible to 7-bit ASCII and uses 1 up to 4 bytes to encode all Unicode characters. <br><br></td></tr></table><br>
<a name="2109337"></a>

<a name="2109336"></a>

<a name="2109335"></a>

<a name="2109331"></a>

<a name="2109332"></a>

<a name="2109333"></a>

<a name="2109334"></a>

<a name="2109344"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> I don't think that the fact some OS's still use ancient UCS-2 encoding is a good enough reason to deliberately gimp wide chars.  But then again, I'm still wondering why char types are necessary.  Is this too silly a question to be addressed?  As far as I can tell, they're the same thing as int values, just with some different handling in c-style syntax, which mx2 isn't in the first place.  Do chars offer some intrinsic value to the language other than some syntax tricks which can offset a whole mess of target-specific baggage? <br><br></td></tr></table><br>
<a name="2109343"></a>

<a name="2109367"></a>

<a name="2109371"></a>

<a name="2109372"></a>

<a name="2109373"></a>

<a name="2109378"></a>

<a name="2109379"></a>

<a name="2109380"></a>

<a name="2109381"></a>

<a name="2109384"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danilo</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> For system API programming and importing many different (C/C++/System) libraries, it makes sense to think about it, IMO.<br>It is also important for low-level pointer-access (which is basically what the systems and libs do).<br>*charPointer + sizeOf(Char) to access the next character, or variable-length encodings, where the next character could be at<br>*charPointer + 1 or *charPointer + 2 or *charPointer + 3 or *charPointer + 4.<br>Most underlying things (library internals, behind the scene) is interaction with the system libraries. So, if the language uses<br>32-bit strings internally, and almost all other systems require UTF-16 encoded strings, you have the convert language strings<br>to system strings back and forth all the time. That's for all system calls. CreateWindow, GetText, GetWindowTitle, etc...<br><br>I'm using Unicode and 64-bit compilation for many, many years. 64-bit started with XP Professional for me, round about 10 years ago.<br>With PureBasic, I make my codes compilable in Ascii/Unicode and 32bit/64bit mode, most of the time.<br>It's just a compiler switch, and should just work, most of the time. And, I'm doing custom work using PB (side job),<br>where I always try to make sure it works with Ascii/Unicode and x86/x64, and Windows+Linux+MacOS,<br>and any combinations of that. I think my customers are happy with the work, according to the feedback. ;)<br>A good C++ code can just be re-compiled using a different compiler switch, and will work in ASCII/Unicode mode, and 32bit + 64bit compilation mode.<br><br>But, at the same time, I'm still aware that it's a very complicated topic nonetheless, especially when it comes to different underlying operating systems,<br>and things like supporting right-to-left languages. Even with programming language systems that actively support Unicode -<br>there are almost always some problems... when it comes to conversations between encodings,<br>and when it comes to certain languages (Vietnamese, Indian languages, Arabic, etc).<br><br>Using 32bit chars isn't such a big problem at all. SizeOf(Char) is always 4 (bytes), and that's very nice, even for pointer access.<br>It's just a waste of memory and space - and on many systems you have to always use conversion functions to exchange (give to and get from)<br>the underlying system. Every system function call requires a string conversion in this case. If the system (like Windows) does not<br>understand 32-bit null-terminated strings, you have to convert it to UFT-16, for example. That's slow and occupies system resources, if<br>you need to convert every simple string. MX2 isn't a closed system in itself. Internally, 95%+ is interaction with the underlying systems,<br>so I consider this to be important to think about. <br><br></td></tr></table><br>
<a name="2109362"></a>

<a name="2109361"></a>

<a name="2109360"></a>

<a name="2109359"></a>

<a name="2109358"></a>

<a name="2109357"></a>

<a name="2109356"></a>

<a name="2109354"></a>

<a name="2109352"></a>

<a name="2109351"></a>

<a name="2109350"></a>

<a name="2109382"></a>

<a name="2109385"></a>

<a name="2109386"></a>

<a name="2109387"></a>

<a name="2109392"></a>

<a name="2109393"></a>

<a name="2109394"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >dawlane</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> I think UTF-16 is the most used today. <br></div>I think that UTF-8 would be the most used when you throw in text files and the Internet.<br>When using Qt and QChar the internal encoding is UTF-16, but saving text is converted to UTF-8 or what ever you choose. GTK expects UTF-8 strings.<br><a href="http://cppwhispers.blogspot.it/2012/11/unicode-and-your-application-1-of-n.html" target="_blank">Here's a little blog that I stumbled across</a> about unicode and applications, with the pro's and con's. <br><br></td></tr></table><br>
<a name="2109391"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >DruggedBunny</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> <br>Would it be possible to change trans so that a conversion from int to uint and vice versa needs to be stated explicitly?<br>It is still better to me than no unsigned at all and it would be way easier to spot errors like these.<br> <br></div><br>Still think this would be a good way of handling both signed and unsigned types... <br><br></td></tr></table><br>
<a name="2109395"></a>

<a name="2109396"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GC-Martijn</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> Not to be rude haha but this topic is about the C binding creator ;) :)<br><br>@marksibly<br>I'm now at the point that the debugger don't give me information what went wrong.<br>When I run this code:<br><pre class=code>
Using sdl3
Global window:SDL_Window Ptr
Local init:=SDL_Init( SDL_INIT_VIDEO )
	window=SDL_CreateWindow( "SDL2 Window",SDL_WINDOWPOS_UNDEFINED,SDL_WINDOWPOS_UNDEFINED,640,480,SDL_WINDOW_OPENGL )
	While window&lt;&gt;Null
	'	main_loop()
	'	SDL_Delay( 10 )
	Wend
</pre><br><br>using this file:<br><a href="https://github.com/gcmartijn/C2MX2/tree/master/example/sdl3" target="_blank">https://github.com/gcmartijn/C2MX2/tree/master/example/sdl3</a><br><br>Ted will say:<br><pre class=code>
Parsing...
Semanting...
2 error(s):
Expression is not a type expression
Expression is not a type expression
Done.
</pre><br><br>would love to know what line that is.<br><br>Edit: I know its something inside the sdl3.monkey2 file but what ? <br><br></td></tr></table><br>
<a name="2109397"></a>

<a name="2109398"></a>

<a name="2109399"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danilo</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; Not to be rude haha but this topic is about the C binding creator ;) :)<br><br>Sorry, but how do you want to create such a conversion tool, if decisions like<br>basic supported data types in MX2 are not decided yet? It does not make sense!<br><br>MX2 is still in the pre-planning stage. The most basic things are not even planned yet,<br>and you want to code a tool for those theoretical language, that's not even fully planned... !? <br><br></td></tr></table><br>
<a name="2109400"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GC-Martijn</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> yep, as ypu can see its almost working, and c have a small set of types. its only a small function to create the bindings.<br><br>for now a sint,int,uint is just a int.<br>if monkey2 will get sint, then its one line to change <br><br></td></tr></table><br>
<a name="2109402"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danilo</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> An almost working thing, for a theoretical language that hasn't even fully planned yet? :D <br><br></td></tr></table><br>
<a name="2109404"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GC-Martijn</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> yep, did you check the sdl2 example inside monkey2??<br>then you can see that you could create a game now at this moment using only those c sdl2 bindings.<br><br>sdl2 has everything inside to create a game.<br><br>only waiting for some monkey2 things.<br>i agree and understand that monkey2 is not ready, but using extern libs is almost done.<br>and easy to modify. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
