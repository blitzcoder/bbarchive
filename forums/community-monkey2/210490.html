<!DOCTYPE html><html lang="en" ><head ><title >MX2 Library Init function</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >MX2 Library Init function</h1><a href="forums.php" >Community Forums</a>/<a href="topics.php?forum=530" >Monkey2 Talk</a>/<a href="#bottom" >MX2 Library Init function</a><br><br>
<a name="2118659"></a>

<a name="2118660"></a>

<a name="2118661"></a>

<a name="2118662"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danilo</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Looking at modules/std/std.monkey2 we see a module-private "Main()" function.<br><br>1.) Are such library initializers automatically called as soon as we #Import the lib?<br>2.) At what exact stage is the lib init function called? Right before executing userâ€™s Main() function?<br>3.) Is there also a way for a clean-up function for libraries? For example for closing automatically still opened files at program end, etc.<br><br>Thanks in advance! <br><br></td></tr></table><br>
<a name="2118663"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; Looking at modules/std/std.monkey2 we see a module-private "Main()" function.<br><br>Any module with a Main() in it will have its Main() called automatically just *after* all globals/consts have been initialized but *before* app Main() executes.<br><br>Since modules can't have cyclic dependencies, they will always be called in correct order, eg: if module X imports module Y (ie: depends on), then module Y's main is guaranteed to be called *before* module X's.<br><br>Actually, there's no difference between app Main() and module Main(). Since the app depends on ALL modules, and NO modules depend on the app, app Main() just happens to be the Main called last!<br><br>There is no 'clean up' function as yet, but for most things like open files, allocated memory etc. it's just fine to let the OS do the cleanup. In fact, in the case of memory allocation it's usually WAY faster.<br><br>There's a libc function called 'atexit' that allows you to register a cleanup function for a process (not added yet) and I may add something similar for monkey code, like Global MainReturned:Void(), so you can register cleanup functions inside a modules Main(). But not sure how this will work exactly yet. <br><br></td></tr></table><br>
<a name="2118689"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danilo</td><td align="right"><font class=tiny>(Posted 2016)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Very nice! Thank you! :) <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
