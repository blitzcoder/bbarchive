<!DOCTYPE html><html lang="en" ><head ><title >Pointers</title><meta name='viewport' content='width=device-width, initial-scale=0.66'><meta name='description' content='language:basic, target:desktop, category:game development'><link rel="styleSheet" href="../skins/granite/style.css" type="text/css"><style type="text/css">div.bbcode {padding: 8px;background: #E5E5E5;color: #000000;border: 1px dashed #B4B4BE;}</style></head><body ><table width=100% cellspacing=0 cellpadding=0><tr ><td class="menubarleft"></td><td class="menubar"><table cellspacing="0" cellpadding="0"><tr ><td >&nbsp;</td><td class="menuitemleft"></td><td class="menuitem"><a href="/" class="menuitem">News</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/forums.php" class="menuitem">Forums</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/codearcs.php" class="menuitem">Code</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/logs.php" class="menuitem">Logs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/gallery.php" class="menuitem">Gallery</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/sdkspecs.php" class="menuitem">Specs</a></td><td class="menuitemright"></td><td class="menuitemleft"></td><td class="menuitem"><a href="/search.php" class="menuitem">Search</a></td><td class="menuitemright"></td></tr></table></td><td class="menubarright"></td></tr></table><div class="main"><h1 >Pointers</h1><a href="forums.php" >Community Forums</a>/<a href="topics.php?forum=530" >Monkey2 Talk</a>/<a href="#bottom" >Pointers</a><br><br>
<a name="2103555"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >abakobo</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#1">[#1]</a></td></tr></table></td></tr><tr ><td class="posttext"> Hi,<br><br>Will we get pointers and function pointers?<br><br>Thanks for the great work and I hope we can quickly help the r&amp;d with the crowdfunding! <br><br></td></tr></table><br>
<a name="2103448"></a>

<a name="2103450"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#2">[#2]</a></td></tr></table></td></tr><tr ><td class="posttext"> If we're getting delegates, I don't think we need function pointers. And, well not sure why would you need data pointers on a reference based language, but maybe I'm loosing something? <br><br></td></tr></table><br>
<a name="2103451"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >abakobo</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#3">[#3]</a></td></tr></table></td></tr><tr ><td class="posttext"> Data pointers are dynamic and allow you to do whatever you want in your data structure... you can even use arithmetics to point!. Your imagination and memory is the limit... I know it's dangerous and source for headhakes, but i love them. <br><br></td></tr></table><br>
<a name="2103452"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#4">[#4]</a></td></tr></table></td></tr><tr ><td class="posttext"> The problem, as I see it, is that this kind of pointers can overcomplicate the GC to no end, and I'm not sure they introduce any improvement to the language. But Mark could know better than me if he's using a GC that is compatible with this, and also fast. <br><br></td></tr></table><br>
<a name="2103468"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#5">[#5]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; Will we get pointers and function pointers?<br><br>Yes, but as Ziggy points out, pointers are very unsafe as they don't play nicely with the GC.<br><br>Besides, in Monkey everything is already a 'pointer' when it comes to objects. Pointers to ints etc are a different story, but this can also be achieved safely via: Int[] or a wrapper object.<br><br>&gt; If we're getting delegates<br><br>Define delegate!<br><br>I've tried, but I can't seem to find a definitive definition. I've seem them described as everything from a plain function pointer to a pointer to a member function to a C# style strongly typed function pointer.<br><br>In Monkey2, there is only really a function pointer, eg:<br><br>local somefunc:void(int)   'somefunc is a function that takes an int and returns void.<br><br>However, this can be used quite flexibily, eg:<br><br>somefunc=Blah     'assign global function (closure one day...)<br>somefunc=c.Etc    'assign instance method, ie: somefunc holds both an object and a method.<br><br>Function types can be alised to provide C#-ish 'delegates', eg:<br><br>alias SortFunc:int(int,int)   'similar to "delegate int SortFunc( int,int )" in C#<br><br>local t:SomeFunc=CompareInts<br>t=c.CompareInts<br><br>But these are not strongly typed as in c#. eg: in c#, delegate x:int() and delegate y:int() are completely different types (I think). You can't assign a var holding an x to a var holding a y. But in monkey you can, as they will just be aliases for the same function type. Which is both a good and a bad thing...but IMO it's more flexible.<br><br>So I'm not sure if monkey2 supports delegates or not! <br><br></td></tr></table><br>
<a name="2103467"></a>

<a name="2103474"></a>

<a name="2103475"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#6">[#6]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> @marksibly: Define delegate! <br></div><br>A combination function pointer with an object reference.<br><pre class=code>Local d:Delegate = New Delegate(object, method)
d(1, 2, 3) ' calls object.method(1, 2, 3)</pre><br>Not sure how you'd define argument/return types, but that's the general idea. <br><br></td></tr></table><br>
<a name="2103492"></a>

<a name="2103494"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW_</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#7">[#7]</a></td></tr></table></td></tr><tr ><td class="posttext"> neat. <br><br></td></tr></table><br>
<a name="2103489"></a>

<a name="2103490"></a>

<a name="2103491"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >JoshKlint</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#8">[#8]</a></td></tr></table></td></tr><tr ><td class="posttext"> Any external library that uses callbacks needs function pointers. <br><br></td></tr></table><br>
<a name="2103499"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#9">[#9]</a></td></tr></table></td></tr><tr ><td class="posttext"> @Marksibly, yes, what Samah said. It's a pointer to a function that can also retain a specific instance of an object to access instance methods.<br><br>Idea:<br><pre class=code>
Class MyClass
    Method CallWithADelegate
        Local myDelegate:= AddressOf Self.MyMethod
        myDelegate.Invoke(12,"hello world")
    End
    MyMethod(value:Int, data:String)
        Print value + " " + data
    End
End
</pre><br><br>This example is just silly, but I think you'll get the idea. They're very very useful to build event systems.<br><br>Example:<br><pre class=code>
Class EventHandler&lt;T&gt;
    Field listeners:List&lt;Delegate(sender:Object, arguments:T)&gt;
    Method RaiseEvent(sender:Object, arguments:T)
        For each del:=listeners
            del.Invoke(sender,arguments)
        End
End Class

Class MyClassThatRaisesAnEvent
    Field ImDone:EventHandler&lt;Bool&gt;
    Method DoStuff()
        ...
        ...
        ImDone.RaiseEvent(Self, True)
    End
End

Class MyClassThatListensToAnEvent
    Field instance:=New MyClassThatRaisesAnEvent
    Method New
        instance.ImDone.listeners.Add(AddressOf Me.InstanceHasDoneStuff)
    End
    Method InstanceHasDoneStuff(sender:Object, success:Bool)
        ....
        Print "Listening to instance! It's done it's stuff!"
    End
End
</pre><br>This gives tones of flexibility compared to regular function pointers, as they play very nice with OO design. <br>I don't think it is important to have then "type safe" as you said. A delegate is just a sort of signature for a function or method with instance pointer. All delegates with identical signature can be the same object. If ou ask me, the big questions here would be how to treat references into delegates. They can be took into account in the GC or not, and if they're not, delegates need to be nullified when the reference is free by the GC. When a delegate points to a non instance method, it should act as a regular function pointer. <br><br></td></tr></table><br>
<a name="2103498"></a>

<a name="2103497"></a>

<a name="2103496"></a>

<a name="2103518"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#10">[#10]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; They're very very useful to build event systems.<br><br>I think that code is more or less covered - here's how it'd look in monkey2:<br><br><pre class=code>
Class EventHandler&lt;T&gt;

	Field listeners:=New List&lt;Void(Object,T)&gt;
    
	Method RaiseEvent( sender:Object,arguments:T )
		For Local del:=Eachin listeners
    			del( sender,arguments )
    		Next
    	End
    	
End

Class MyClassThatRaisesAnEvent

    Field ImDone:=New EventHandler&lt;Bool&gt;
    
    Method DoStuff()
    		Print "thinking..."
		ImDone.RaiseEvent( Self,True )
    End

End

Class MyClassThatListensToAnEvent

	Field instance:=New MyClassThatRaisesAnEvent
	
	Method New()
		instance.ImDone.listeners.AddLast( InstanceHasDoneStuff )
	End

	Method InstanceHasDoneStuff:Void( sender:Object,success:Bool )
		Print "Listening to instance! It's done it's stuff!"
    End
End
</pre><br><br>Think I'm gonna try and get that building tomorrow!<br><br>You could also alias the function pointer type to make it a bit cleaner, eg:<br><br><pre class=code>
Class EventHandler&lt;T&gt;

	Alias Listener:Void( Object,T )  'kind of like c# delegate? Listener is a 'type'.
	
	Field listeners:=New List&lt;Listener&gt;
...etc...
</pre><br><br>This also allows other code to get at the type of a listener, eg:<br><br>Local myListener:EventHandler&lt;Bool&gt;.Listener 'same as Local myListener:Void(Object,Bool)<br><br>Similar to the way the STL typedefs 'ValueType', 'IteratorType' etc inside containers.<br><br>&gt; They can be took into account in the GC or not, and if they're not, delegates need to be nullified when the reference is free by the GC.<br><br>I don't think this will be too bad - I'm currently using 'copy on write' to handle 'function pointer values' which contain objects (or not) and I think it'll work OK. If not, I can fallback to make them real objects (with associated overhead). <br><br></td></tr></table><br>
<a name="2103516"></a>

<a name="2103515"></a>

<a name="2103512"></a>

<a name="2103509"></a>

<a name="2103585"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#11">[#11]</a></td></tr></table></td></tr><tr ><td class="posttext"> If this can be done, I'll be *finishing* JungleGui for Monkey2. It was sort of stopped because of the problems I was getting using reflection to "emulate" delegates at runtime. HAving all this handled at compile time would be a dream to me! <br><br></td></tr></table><br>
<a name="2103591"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >itto</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#12">[#12]</a></td></tr></table></td></tr><tr ><td class="posttext"> Are you saying we will finally have real callback methods/functions instead of having to rely on interfaces? This would be amazing! <br><br></td></tr></table><br>
<a name="2103592"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#13">[#13]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> Are you saying we will finally have real callback methods/functions instead of having to rely on interfaces?  <br></div>Yes, that's what delegates are for! (and also can be used to do some malakary on multithreading) <br><br></td></tr></table><br>
<a name="2103603"></a>

<a name="2103604"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#14">[#14]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; problems I was getting using reflection to "emulate" delegates at runtime<br><br>Watching you struggle with that was what partly convinced me that good old function pointers could be very useful (that and learning Qts slots and signals stuff) - and that Monkey really needed a rewrite as it's one of several things that I would never have been able to add to monkey1 without going insane in the process.<br><br>There is ONE very curly issue with function types though, and that's parsing. In particular, when you actually declare functions, eg:<br><br>Function Update:Int()<br><br>The parser wants to parse the return type of Update as 'function returning an Int' because it sees 'Int()', but that's wrong. That would be:<br><br>Function Update:Int()()  'function returning a function.<br><br>As I did in BlitzMax, I am strongly tempted to just hack the parser to make it work, as I think it's worth it for the 'cleaner' usage, but then the idea of a nice clean 'grammar' goes out the window!<br><br>Any thoughts on this? Is hacking the parser like this ever justifiable? When?!? <br><br></td></tr></table><br>
<a name="2103617"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#15">[#15]</a></td></tr></table></td></tr><tr ><td class="posttext"> I would suggest a keyword-based identifier (I'm using Action as a keyword, but it could be Alias or whatever you like):<br><pre class=code>
Action MyDelegate:Bool(param1:String, param2:String) '--&gt; Defines a method signature here, using Action 

Function Update:MyDelegate(parameter1:Int) '--&gt; Define a function with an integer parameter, and this function returns a function that returns an Bool, and has 2 string parameters, because it returns a MyDelegate type

Field myCallback:MyDelegate = me.StuffDone '--&gt; Where StuffDone is a method that returns a Bool and has 2 string parameters
If myCallback("Hello ", "world")
    DoStuff...
End If
</pre><br><br>Another idea could be an operator intended to provide readabiltiy. Approach for the same example:<br><pre class=code>
Function Update:&amp;Bool(param1:String, param2:String)(parameter1:Int)
</pre><br><br>In my opinion, operator-based approach is a lot less readable:<br><pre class=code>
Field myPointer:&amp;Bool(param1:String, param2:String)
...
myPointer = me.DoSomething
If myPointer("hello ", "world") = True Then
    DoStuff
EndIf
</pre><br>It's obvious that the operator itself is not required for the compiler to solve the datatype, but it could help providing readability?<br><br>Those are the 2 ideas that come to my mind. Being honest, in my opinion, first approach it a lot better when it comes to understand and follow code. The second one can make code too cryptic for no good reason.<br><br>Now going back to your example:<br><pre class=code>
Action MyIntegerFunction:Int() '-&gt; That's the "delegate" signature definition.
...
Function Update:MyIntegerFunction() '-&gt;That's usage of that definition.
</pre><br>I think it's better than Update:Int()() approach <br><br></td></tr></table><br>
<a name="2103615"></a>

<a name="2103616"></a>

<a name="2103614"></a>

<a name="2103613"></a>

<a name="2103611"></a>

<a name="2103612"></a>

<a name="2103621"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW_</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#16">[#16]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm finding the colon token '<b>:</b>' a bit strange here. <br>For Bmax and Monkey, it's always been &lt;ident&gt; <b>:</b> &lt;primitive type | class type&gt; <br>I thinking that maybe some other type of lexeme could be used to avoid confusion.  <br>It seems kinda off-putting to see function prototypes after the colon.<br>Maybe i'm just confused.<br><br>btw: I second ziggy's opinion that a keyword would be preferable to '&amp;' etc. and definitely no arrow '-&gt;' . <br>;-) <br><br></td></tr></table><br>
<a name="2103620"></a>

<a name="2103619"></a>

<a name="2103618"></a>

<a name="2103623"></a>

<a name="2103624"></a>

<a name="2103625"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#17">[#17]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; Action MyDelegate:Bool(param1:String, param2:String) '--&gt; Defines a method signature here, using Action <br>&gt; Function Update:MyDelegate(parameter1:Int) '--&gt; Define a function with an integer parameter, and this function returns a function that return<br><br>So all function types would have to be 'named' before they could be used?<br><br>I think aliasing function types is definitely nice in a lot of situations, but I wouldn't like to make it compulsory, c# style. Still, it's an option.<br><br>&gt; I'm finding the colon token ':' a bit strange here. <br><br>The general idea of ':' is it's always followed by a type, so in the case of function decls it's followed by the function return type. <br><br>Perhaps you could post an example of how you'd like function decls to look?<br><br>I think this more consistent than somehow specifying function return types *without* a preceding ':', as it breaks that rule. <br><br></td></tr></table><br>
<a name="2103626"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#18">[#18]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> @marksibly: Class EventHandler&lt;T&gt;... <br></div><br>That's not really an example of delegates though, that's just a listener pattern.  For "Void(Object,T)" to be a delegate, it would need to have both a reference to an object, and a reference to one of that object's class's methods. <br><br></td></tr></table><br>
<a name="2103638"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#19">[#19]</a></td></tr></table></td></tr><tr ><td class="posttext"> It does! Checkout...<br><br>instance.ImDone.listeners.AddLast( InstanceHasDoneStuff )    'a 'delegate' with (self,InstanceHasDoneStuff)<br><br>Ditto...<br><br>local c:=new C<br>SomeFunc( c.SomeMethod )    'if SomeFunc takes a valid func ptr, a delegate with (c,SomeMethod) is created.<br><br>Effectively: {object}.{method} can be converted to a function ptr.<br><br>If there's no {object}, it's the same as self.{method}<br><br>Anyway, I got Ziggy's code translating (minus Eachin...), but not compiling yet due to forwards refs in c++...argh. <br><br></td></tr></table><br>
<a name="2103637"></a>

<a name="2103633"></a>

<a name="2103634"></a>

<a name="2103635"></a>

<a name="2103636"></a>

<a name="2103644"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW_</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#20">[#20]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> The general idea of ':' is it's always followed by a type, so in the case of function decls it's followed by the function return type.<br>Perhaps you could post an example of how you'd like function decls to look? <br></div><br>I was referring to this.<br><pre class=code>Action MyIntegerFunction:Int() '-&gt; That's the "delegate" signature definition.
...
Function Update:MyIntegerFunction() '-&gt;That's usage of that definition.</pre><br>Just seems strange to me as it's harder to reason about the return type.  But I'm definitely reserving judgment until I see it in action, especially if I'm the only one who thinks it's not intuitive (most likely). Either way, whatever IDE Monkey2 uses will need to have some clever and robust code completion. <br><br></td></tr></table><br>
<a name="2103643"></a>

<a name="2103648"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#21">[#21]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; I was referring to this.<br><br>Ahh, OK.<br><br>It does actually make sense if you think of Action as a simple 'type alias' instead, eg:<br><br><pre class=code>
alias RetType1:void(int,int)
alias RetType2:int
alias RetType3:List&lt;Actor&gt;
function func1:RetType1()   'returns a void(int,int) function
function func2:RetType2()   'returns an int
function func3:RetType3()   'returns a List&lt;Actor&gt;
</pre><br><br>You will definitely be able to do this in monkey2, and it can be very useful esp. when dealing with more complex types.<br><br>I'd just like to avoid forcing people to have to alias function types anywhere. <br><br></td></tr></table><br>
<a name="2103647"></a>

<a name="2103653"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW_</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#22">[#22]</a></td></tr></table></td></tr><tr ><td class="posttext"> I get it. That example makes things more clear.  Thanks <br><br></td></tr></table><br>
<a name="2103654"></a>

<a name="2103655"></a>

<a name="2103656"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#23">[#23]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> @marksibly: It does! <br></div><br>Based on the definition of delegate on Wikipedia, your example is "kinda" correct I guess.  I'll resign myself to wishy-washy definitions.<br><br>It looks like what I'm talking about (and ziggy seems to agrees with) is a "method pointer" as opposed to a "function pointer".  Since a method requires an instance, the instance and method pointer must be passed as a tuple.<br><br>This is an example of a "method pointer?", and an implicit generic operator like Java's &lt;&gt;<br><pre class=code>Class Foo
	Method Bar:Int(str:String)
		Print str
		Return 1
	End
End

' instance of class
Local inst:Foo = New Foo

' instantiate method pointer passing the object and a pointer to its method
Local mp:MethodPtr&lt;Foo,Int(String)&gt; = New MethodPtr&lt;&gt;(inst, Foo.Bar)

' execute the method pointer (prints "blah" and 1)
Print mp("blah")

' essentially the same as: Print inst.Bar("blah")</pre> <br><br></td></tr></table><br>
<a name="2103660"></a>

<a name="2103661"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#24">[#24]</a></td></tr></table></td></tr><tr ><td class="posttext"> What would you call this, if not a method pointer?<br><br><pre class=code>
class C
   field t:=10
   method test:void()
      print t
   next
end

function main:void()
   local c:=New C
   local f:void()=c.test   'Note: "c.test" is the 'tuple' you're after...
   f()
end
</pre><br><br>Prints 10!<br><br>Sure, 'f' looks like a function pointer, but that's the point (ha!). <br><br></td></tr></table><br>
<a name="2103662"></a>

<a name="2103663"></a>

<a name="2103664"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW_</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#25">[#25]</a></td></tr></table></td></tr><tr ><td class="posttext"> NM, Mark cleared it up. ;) <br><br></td></tr></table><br>
<a name="2103673"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#26">[#26]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> @marksibly: What would you call this, if not a method pointer? <br></div><br>That's different to your previous example though, because you're including both "c" and "test" in the same declaration.  Previously you were keeping it as just a function pointer and enforcing the idea of passing an instance as the first argument.<br><br><pre class=code>local f:void()=c.test   'Note: "c.test" is the 'tuple' you're after...
f()</pre><br>Your example here is much better, and something I'd love to see in the language. <br><br></td></tr></table><br>
<a name="2103680"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danilo</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#27">[#27]</a></td></tr></table></td></tr><tr ><td class="posttext"> Somehow this can make large codes very unreadable:<br><pre class=code>class C
   field t:=10

   method test:void()
      print t
   end

   method s:int()
      return 2
   end
end

function func:void()
   print "func()"
end

function l:int()
   return 1
end


function main:void()
   local h:void()
   local i:int, j:int
   local k:int

   local c:=New C

   local f:void()=c.test   ' Note: "c.test" is the 'tuple' you're after...
   f()

   local g:void()=func     ' function pointers look exactly like method pointers?
   g()

   ' Without actually seeing the definition of h:void(),
   ' it's hard to guess what the following line does:

   h = func   ' this assigns a pointer-to-func to h,
              ' but in MonkeyX this could also be read
              ' as a function call (because parenthesis is not required),
              ' and it could as well be a variable assignment
   i = j
   k = l
end</pre><br>It looks all the same, like "a = b".<br><br>No way to differentiate what is a function call, what is a function pointer assignment, and what is just<br>a variable assignment.<br>That's why I like it to have functions/methods use always parenthesis, and something like '@' or "adressOf" operator<br>to differentiate between function call and function pointer.<br><pre class=code>h = @func()            ' clearly a function pointer
h = addressOf func()   ' clearly a function pointer
i = j                  ' clearly 2 variables
i = c.t                ' clearly 2 variables
k = c.s()              ' clearly a method   call
k = l()                ' clearly a function call</pre> <br><br></td></tr></table><br>
<a name="2103679"></a>

<a name="2103678"></a>

<a name="2103676"></a>

<a name="2103675"></a>

<a name="2103674"></a>

<a name="2103677"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#28">[#28]</a></td></tr></table></td></tr><tr ><td class="posttext"> I agree having @ or AddressOf or any other identifier can help make the code easier to follow. <br><br></td></tr></table><br>
<a name="2103689"></a>

<a name="2103690"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#29">[#29]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; have functions/methods use always parenthesis<br><br>This is definitely happening! And with that in place...<br><br>&gt; '@' or "adressOf" operator<br><br>...is redundant, and I don't think will make code any easier to follow once people get used to it. But we'll see how it goes in practice.<br><br>I also think the term 'function pointers' may be causing some confusion, and suggest we start using the term 'function variables' instead. These are variables that can hold global functions or delegate methods or closures or lambdas or whatever. They can be stored in lists, arrays etc just like another other variable.<br><br>See: std::function in c++! <br><br></td></tr></table><br>
<a name="2103687"></a>

<a name="2103688"></a>

<a name="2103686"></a>

<a name="2103685"></a>

<a name="2103684"></a>

<a name="2103682"></a>

<a name="2103692"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danilo</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#30">[#30]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thx Mark! So it actually looks like the following, if I understood correctly (from the many snippets):<br><pre class=code>class C
   method test:int()
      return 1
   end
end

function test:int()
   return 2
end

function main:void()
   local x:int()   ' function variable / method variable
   local y:int     ' int variable

   local c:=New C()

   x = c.test()  ' assign function variable / method variable
   y = c.test()  ' direct   method call
   y = x()       ' indirect method call

   x = test()    ' assign function variable
   y = test()    ' direct   function call
   y = x()       ' indirect function call
end</pre><br>So it looks like Monkey2 (do you want to remove the 'X' from MonkeyX?) will differentiate itself<br>if you use a method or a function with a function variable?<br>Because internally in C++ it's a difference, the hidden 'this' pointer. <br><br></td></tr></table><br>
<a name="2103702"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#31">[#31]</a></td></tr></table></td></tr><tr ><td class="posttext"> Almost - the assignments to x wont work/compile because in both cases you're trying to assign an int (the value returned by the test functions, which is called since you added '()' ) to the function var x. You were probably after this:<br><br>x=test         'assign function to function var<br>x=c.test      'ditto (although it's really a method - but who cares?)<br><br>So you (almost) can't get it wrong anyway as the compiler will catch you, eg:<br><br>y=test     'wont work/compile - attempting to assign a function to an int var!<br><br>Basically, '()' means a function gets called, and everything else is a variable or value - if you consider declared methods and functions as values (which they are internally). <br><br>I dunno, it's pretty clear to me but I think it might be a little 'different'. Adding something like '@' is an option if people struggle with it, eg:<br><br>x=@...<br>x=@test<br><br>But IMO, that makes something that is actually pretty normal code (assigning a value to a variable) look more exotic than it really is.<br><br>&gt; differentiate itself if you use a method or a function with a function variable?<br><br>This is all done behind the scenes when you assign an actual function or method to a function var. It automatically creates the 'right' kind of function var for you, and stores 'this' and any other hidden info in it if necessary. <br><br></td></tr></table><br>
<a name="2103701"></a>

<a name="2103697"></a>

<a name="2103696"></a>

<a name="2103695"></a>

<a name="2103694"></a>

<a name="2103723"></a>

<a name="2103724"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Danilo</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#32">[#32]</a></td></tr></table></td></tr><tr ><td class="posttext"> Thanks for your explanation, I think it's pretty clear and readable:<br><pre class=code>class C
   method test:int()
      return 1
   end
end

function test:int()
   return 2
end

function main:void()
   local x:int()   ' function variable / method variable
   local y:int     ' int variable

   local c:=New C()

   x = c.test    ' assign function variable / method variable
   y = c.test()  ' direct   method call
   y = x()       ' indirect method call

   x = test      ' assign function variable
   y = test()    ' direct   function call
   y = x()       ' indirect function call
end</pre><br>It just means that variable names and function/method/property names can't be the same, otherwise<br>things like "x := test" and "x := c.test" would collide (variable/property or function/method delegate?).<br>But that shouldn't be a big problem generally. Such collisions could happen if we import a new module<br>and one of our existing variable names collides with a function name in the external module. <br><br></td></tr></table><br>
<a name="2103712"></a>

<a name="2103711"></a>

<a name="2103710"></a>

<a name="2103725"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >abakobo</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#33">[#33]</a></td></tr></table></td></tr><tr ><td class="posttext"> I'm quite confused.<br><br>will the equivalent of all these ANSI C pointer commands will be available? Will we be able to extract the adress of a variable(functions included) and use arithmetics to point?<br><br><pre class=code>
//This is ANSI C code reference! No monkey code here.

void * -&gt;  Generic pointer type
NULL -&gt;  Null pointer (GC panic in monkey?)
type *name -&gt;  Declare pointer to type
type *f() -&gt;  Declare function returning pointer to type
type (*pf)() -&gt;  Declare pointer to function returning type
*pointer -&gt;  Object pointed to by pointer
&amp;name -&gt;  Address of object name
pointer -&gt; the pointer itself (is more or less an int)
pointer=5000 -&gt;generate a warning:initialization makes pointer from integer without a cast
</pre> <br><br></td></tr></table><br>
<a name="2103832"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >GW_</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#34">[#34]</a></td></tr></table></td></tr><tr ><td class="posttext"> Pointers are in, along with reference arguments to functions. <br>Nearly all of you examples are possible with Blitzmax, and It seems like M2 will match and exceed Blitzmax's ability to use pointers. <br><br></td></tr></table><br>
<a name="2103746"></a>

<a name="2103755"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#35">[#35]</a></td></tr></table></td></tr><tr ><td class="posttext"> Mark please, <br>if you're finally going for the Update:Int()() syntax, please consider leaving this out for properties, so they can still look like fields.<br>This looks very weird:<br><pre class=code>myObject.X()+=1</pre> <br><br></td></tr></table><br>
<a name="2103754"></a>

<a name="2103760"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#36">[#36]</a></td></tr></table></td></tr><tr ><td class="posttext"> @abakobo: Monkey as a managed language is based on references. That is, when you need to use an object, you access it by using a reference. Each reference is indeed a pointer, with the given plus that object lifetime can be handled automatically by the language runtime.  In this scenario, arithmetic over pointer "address" is not always possible and type safe. If you need to make weird things on memory blocks you can use a databuffer, use arrays, etc. This ensures type safeness and allows the GC to handle objects lifetime, being the only exception objects that wrap limited resources (as VRam, etc). those ones need to provide an explicit destructor (discard or free method) to free resources early (before the GC reclaims them, if it ever does! <br><br></td></tr></table><br>
<a name="2103756"></a>

<a name="2103757"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#37">[#37]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; It just means that variable names and function/method/property names can't be the same, otherwise<br>things like "x := test" and "x := c.test" would collide<br><br>You should get exactly the same 'collisions' as you do for calling functions, as it's pretty much the same logic internally. So basically, if you can call it, you can assign it to something.<br><br>&gt; if you're finally going for the Update:Int()() syntax, please consider leaving this out for properties,<br><br>Not sure what you mean here - can you post a fuller example? I haven't given much thought to how properties work with this... <br><br></td></tr></table><br>
<a name="2103771"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >ziggy</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#38">[#38]</a></td></tr></table></td></tr><tr ><td class="posttext"> Well, consider this a function:<br><pre class=code>Function Whatever:Int(param1:String)</pre><br>When you reference its address, you do it be function name:<br><pre class=code>Field myFunctionPointer:=Whatever</pre><br>Now, if you classify Properties to be methods, given this getter and setter:<br><pre class=code>Method Position:Int() Property
Method Position:Void(value:int) Property</pre><br>Any getter usage would require to be written with a () appended, to differenciate it from a pointer to its associated method, and the same goes for the setter<br><pre class=code>
myInstance.Position() = 45  'This looks very weird
Print "current position is " + myInstance.Position() 'That's weird too, makes it look like a method
meInstance.Position()+=5 'This looks syntactly very weird.</pre><br>I would get rid of any pointer to a property, in order to maintain a cleaner syntax. Properties are meant to provide a clean syntax for getter/setters, making code easier to read, while keeping a nice level of encapsulation and control of internal class attributes changes. I think it would be very sensible to keep a syntax that expresses this too.<br><br>This is even more important if we finally get a better syntax to declare properties as you suggested somewhere else:<br><pre class=code>Class C
   Property Foo:Int
      Field foo:int   'can be accessed ONLY by members of this class via Foo.foo
      Getter
         Return foo
      Setter
         foo=value
   End
End </pre> <br>Don't force people to use Foo as Foo() for both getter and setter, to differenciate it from a potential getter or setter method pointer declared as Foo without parenthesis.<br>EDIT2: By the way, I love the idea of having a private field inside property. It adds an even nicer level of encapsulation. I've always wondered why .Net does not allow it.<br>EDIT:<br>By the way, if we use function names to express a function pointer, how would overloading be solved? <br><br></td></tr></table><br>
<a name="2103769"></a>

<a name="2103764"></a>

<a name="2103763"></a>

<a name="2103777"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Nobuyuki</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#39">[#39]</a></td></tr></table></td></tr><tr ><td class="posttext"> he means that he wants the calling syntax for Properties to resemble this (old Monkey syntax here, ignore the definition code in MyClass):<br><br><pre class=code>
Class MyClass
Private
  Local _a:Int
Public
  Method A:Int() Property
    Return _a
  End
  Method A:Void(value:Int) Property
    _a = value
  End 
End Class

Function Main:Int()
  Local Foo:=New MyClass()

  Foo.A = 42   'Notice no parenthesis to call member A
  Print (Foo.A)  
End 
</pre><br>Obviously this syntax would have to be amended to support parenthesis if you plan on incorporating multi-param properties (for tuples, swizzling, etc), but until then, this is the expected behavior for Properties for most people, and does pass trans in Strict mode (as it should!).  The calling convention is identical to VB.net.<br><br>Edit:  Whoops, beaten to the punch... <br><br></td></tr></table><br>
<a name="2103776"></a>

<a name="2103775"></a>

<a name="2103781"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >marksibly</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#40">[#40]</a></td></tr></table></td></tr><tr ><td class="posttext"> &gt; Any getter usage would require to be written with a () appended, to differenciate it from a pointer to its associated method, and the same goes for the setter<br><br>Ah, OK.<br><br>Monkey2 will be much stricter about properties - you wont be able to 'call' them like methods (unless they hold a function!) if you feel like it the way you can in monkey1. They will always have to be used like fields. I don't think we really have a choice here for the reasons you've pointed out. And I agree it's better that way.<br><br>&gt; myInstance.Position() = 45<br><br>Whatever happens, that wont!<br><br>&gt; By the way, I love the idea of having a private field inside property.<br><br>I've actually gone off this idea a bit after having looked through some of my 'real code', but more on that later.<br><br>&gt; By the way, if we use function names to express a function pointer, how would overloading be solved?<br><br>Very trickily! I've got it mostly going, and it works internally by using a 'FuncListValue' in place of a FuncValue if a function is overloaded. Only when a conversion or invokation happens is the overload resolved into a unique FuncValue. Conversions happens when something is assigned or passed as a parameter etc. However, when you're coding, you can just think of a funclist as a single function. <br><br></td></tr></table><br>
<a name="2103805"></a>

<a name="2103806"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td class="posthead"><table width=100% cellspacing=0 cellpadding=0><tr ><td >Samah</td><td align="right"><font class=tiny>(Posted 2015)</font>&nbsp;<a href="#41">[#41]</a></td></tr></table></td></tr><tr ><td class="posttext"> <div class="quote"> @marksibly: Monkey2 will be much stricter about properties... <br></div><br>Strict is good.  Needing to add the Strict keyword is evil.  Please remove it.  XD<br><br>Also, slightly off topic, can we please have static properties?  It would make singletons look much neater rather than requiring parentheses on the getter function.  Non-compiling example from Monkey X:<br><pre class=code>Class Foo Final
Private
	' singleton instance
	Global instance:Foo
	
	' private constructor to prevent external instantiation
	Method New(); End
	
Public
	' static property to auto-create the singleton
	Function Instance:Foo() Property
		If Not instance Then instance = New Foo
		Return instance
	End
	
	Method Hello:Int()
		Return 10
	End
	' dragons be here
End

Function Main()
	' as a property
	Foo.Instance.Hello()
	
	' not as a property
	Foo.Instance().Hello()
End</pre><br>Subtle difference, but I think I prefer the property access. <br><br></td></tr></table><br>
<a name="bottom"></a>
<table width=100% cellspacing=0 cellpadding=0><tr ><td align="right"><a href="http://monkeycoder.co.nz" target="_blank"><img src="/img/monkey2.svg" ></a> <a href="https://github.com/blitz-research" target="_blank"><img src="/img/github.svg" ></a> <a href="https://discord.gg/qJccbSp" target="_blank"><img src="/img/discord.svg" ></a></td></tr></table><br></div><br><table width="100%"><tr><td></body></html lang="en">
